!function(e){function t(t){for(var n,r,o=t[0],s=t[1],a=0,l=[];a<o.length;a++)r=o[a],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&l.push(i[r][0]),i[r]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);for(c&&c(t);l.length;)l.shift()()}var n={},i={165:0};function r(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var o=new Promise((function(t,r){n=i[e]=[t,r]}));t.push(n[2]=o);var s,a=document.createElement("script");a.charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.src=function(e){return r.p+""+({0:"locales/dayjs/af",1:"locales/dayjs/ar",2:"locales/dayjs/ar-dz",3:"locales/dayjs/ar-kw",4:"locales/dayjs/ar-ly",5:"locales/dayjs/ar-ma",6:"locales/dayjs/ar-sa",7:"locales/dayjs/ar-tn",8:"locales/dayjs/az",9:"locales/dayjs/be",10:"locales/dayjs/bg",11:"locales/dayjs/bm",12:"locales/dayjs/bn",13:"locales/dayjs/bo",14:"locales/dayjs/br",15:"locales/dayjs/bs",16:"locales/dayjs/ca",17:"locales/dayjs/cs",18:"locales/dayjs/cv",19:"locales/dayjs/cy",20:"locales/dayjs/da",21:"locales/dayjs/de",22:"locales/dayjs/de-at",23:"locales/dayjs/de-ch",24:"locales/dayjs/dv",25:"locales/dayjs/el",26:"locales/dayjs/en",27:"locales/dayjs/en-SG",28:"locales/dayjs/en-au",29:"locales/dayjs/en-ca",30:"locales/dayjs/en-gb",31:"locales/dayjs/en-ie",32:"locales/dayjs/en-il",33:"locales/dayjs/en-nz",34:"locales/dayjs/eo",35:"locales/dayjs/es",36:"locales/dayjs/es-do",37:"locales/dayjs/es-us",38:"locales/dayjs/et",39:"locales/dayjs/eu",40:"locales/dayjs/fa",41:"locales/dayjs/fi",42:"locales/dayjs/fo",43:"locales/dayjs/fr",44:"locales/dayjs/fr-ca",45:"locales/dayjs/fr-ch",46:"locales/dayjs/fy",47:"locales/dayjs/ga",48:"locales/dayjs/gd",49:"locales/dayjs/gl",50:"locales/dayjs/gom-latn",51:"locales/dayjs/gu",52:"locales/dayjs/he",53:"locales/dayjs/hi",54:"locales/dayjs/hr",55:"locales/dayjs/hu",56:"locales/dayjs/hy-am",57:"locales/dayjs/id",58:"locales/dayjs/is",59:"locales/dayjs/it",60:"locales/dayjs/it-ch",61:"locales/dayjs/ja",62:"locales/dayjs/jv",63:"locales/dayjs/ka",64:"locales/dayjs/kk",65:"locales/dayjs/km",66:"locales/dayjs/kn",67:"locales/dayjs/ko",68:"locales/dayjs/ku",69:"locales/dayjs/ky",70:"locales/dayjs/lb",71:"locales/dayjs/lo",72:"locales/dayjs/lt",73:"locales/dayjs/lv",74:"locales/dayjs/me",75:"locales/dayjs/mi",76:"locales/dayjs/mk",77:"locales/dayjs/ml",78:"locales/dayjs/mn",79:"locales/dayjs/mr",80:"locales/dayjs/ms",81:"locales/dayjs/ms-my",82:"locales/dayjs/mt",83:"locales/dayjs/my",84:"locales/dayjs/nb",85:"locales/dayjs/ne",86:"locales/dayjs/nl",87:"locales/dayjs/nl-be",88:"locales/dayjs/nn",89:"locales/dayjs/oc-lnc",90:"locales/dayjs/pa-in",91:"locales/dayjs/pl",92:"locales/dayjs/pt",93:"locales/dayjs/pt-br",94:"locales/dayjs/ro",95:"locales/dayjs/ru",96:"locales/dayjs/sd",97:"locales/dayjs/se",98:"locales/dayjs/si",99:"locales/dayjs/sk",100:"locales/dayjs/sl",101:"locales/dayjs/sq",102:"locales/dayjs/sr",103:"locales/dayjs/sr-cyrl",104:"locales/dayjs/ss",105:"locales/dayjs/sv",106:"locales/dayjs/sw",107:"locales/dayjs/ta",108:"locales/dayjs/te",109:"locales/dayjs/tet",110:"locales/dayjs/tg",111:"locales/dayjs/th",112:"locales/dayjs/tl-ph",113:"locales/dayjs/tlh",114:"locales/dayjs/tr",115:"locales/dayjs/tzl",116:"locales/dayjs/tzm",117:"locales/dayjs/tzm-latn",118:"locales/dayjs/ug-cn",119:"locales/dayjs/uk",120:"locales/dayjs/ur",121:"locales/dayjs/uz",122:"locales/dayjs/uz-latn",123:"locales/dayjs/vi",124:"locales/dayjs/x-pseudo",125:"locales/dayjs/yo",126:"locales/dayjs/zh-cn",127:"locales/dayjs/zh-hk",128:"locales/dayjs/zh-tw",129:"emojis",130:"locales/af-LC_MESSAGES-converse-po",131:"locales/ar-LC_MESSAGES-converse-po",132:"locales/bg-LC_MESSAGES-converse-po",133:"locales/ca-LC_MESSAGES-converse-po",134:"locales/cs-LC_MESSAGES-converse-po",135:"locales/de-LC_MESSAGES-converse-po",136:"locales/eo-LC_MESSAGES-converse-po",137:"locales/es-LC_MESSAGES-converse-po",138:"locales/eu-LC_MESSAGES-converse-po",139:"locales/fi-LC_MESSAGES-converse-po",140:"locales/fr-LC_MESSAGES-converse-po",141:"locales/gl-LC_MESSAGES-converse-po",142:"locales/he-LC_MESSAGES-converse-po",143:"locales/hi-LC_MESSAGES-converse-po",144:"locales/hu-LC_MESSAGES-converse-po",145:"locales/id-LC_MESSAGES-converse-po",146:"locales/it-LC_MESSAGES-converse-po",147:"locales/ja-LC_MESSAGES-converse-po",148:"locales/lt-LC_MESSAGES-converse-po",149:"locales/mr-LC_MESSAGES-converse-po",150:"locales/nb-LC_MESSAGES-converse-po",151:"locales/nl-LC_MESSAGES-converse-po",152:"locales/nl_BE-LC_MESSAGES-converse-po",153:"locales/oc-LC_MESSAGES-converse-po",154:"locales/pl-LC_MESSAGES-converse-po",155:"locales/pt-LC_MESSAGES-converse-po",156:"locales/pt_BR-LC_MESSAGES-converse-po",157:"locales/ro-LC_MESSAGES-converse-po",158:"locales/ru-LC_MESSAGES-converse-po",159:"locales/th-LC_MESSAGES-converse-po",160:"locales/tr-LC_MESSAGES-converse-po",161:"locales/uk-LC_MESSAGES-converse-po",162:"locales/vi-LC_MESSAGES-converse-po",163:"locales/zh_CN-LC_MESSAGES-converse-po",164:"locales/zh_TW-LC_MESSAGES-converse-po"}[e]||e)+".js"}(e);var c=new Error;s=function(t){a.onerror=a.onload=null,clearTimeout(l);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+r+": "+o+")",c.name="ChunkLoadError",c.type=r,c.request=o,n[1](c)}i[e]=void 0}};var l=setTimeout((function(){s({type:"timeout",target:a})}),12e4);a.onerror=a.onload=s,document.head.appendChild(a)}return Promise.all(t)},r.m=e,r.c=n,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r.oe=function(e){throw console.error(e),e};var o=window.webpackJsonp=window.webpackJsonp||[],s=o.push.bind(o);o.push=t,o=o.slice();for(var a=0;a<o.length;a++)t(o[a]);var c=s;r(r.s=282)}([function(e,t,n){(function(e,i){var r;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var o="Expected a function",s="__lodash_placeholder__",a=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],c="[object Arguments]",l="[object Array]",u="[object Boolean]",d="[object Date]",h="[object Error]",f="[object Function]",p="[object GeneratorFunction]",g="[object Map]",m="[object Number]",v="[object Object]",_="[object RegExp]",b="[object Set]",y="[object String]",w="[object Symbol]",S="[object WeakMap]",x="[object ArrayBuffer]",E="[object DataView]",A="[object Float32Array]",j="[object Float64Array]",C="[object Int8Array]",k="[object Int16Array]",O="[object Int32Array]",T="[object Uint8Array]",N="[object Uint16Array]",M="[object Uint32Array]",I=/\b__p \+= '';/g,R=/\b(__p \+=) '' \+/g,D=/(__e\(.*?\)|\b__t\)) \+\n'';/g,P=/&(?:amp|lt|gt|quot|#39);/g,L=/[&<>"']/g,z=RegExp(P.source),F=RegExp(L.source),B=/<%-([\s\S]+?)%>/g,q=/<%([\s\S]+?)%>/g,U=/<%=([\s\S]+?)%>/g,H=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$=/^\w*$/,W=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,V=/[\\^$.*+?()[\]{}|]/g,G=RegExp(V.source),J=/^\s+|\s+$/g,Q=/^\s+/,K=/\s+$/,Y=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,X=/\{\n\/\* \[wrapped with (.+)\] \*/,Z=/,? & /,ee=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,te=/\\(\\)?/g,ne=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ie=/\w*$/,re=/^[-+]0x[0-9a-f]+$/i,oe=/^0b[01]+$/i,se=/^\[object .+?Constructor\]$/,ae=/^0o[0-7]+$/i,ce=/^(?:0|[1-9]\d*)$/,le=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ue=/($^)/,de=/['\n\r\u2028\u2029\\]/g,he="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",fe="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",pe="[\\ud800-\\udfff]",ge="["+fe+"]",me="["+he+"]",ve="\\d+",_e="[\\u2700-\\u27bf]",be="[a-z\\xdf-\\xf6\\xf8-\\xff]",ye="[^\\ud800-\\udfff"+fe+ve+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",we="\\ud83c[\\udffb-\\udfff]",Se="[^\\ud800-\\udfff]",xe="(?:\\ud83c[\\udde6-\\uddff]){2}",Ee="[\\ud800-\\udbff][\\udc00-\\udfff]",Ae="[A-Z\\xc0-\\xd6\\xd8-\\xde]",je="(?:"+be+"|"+ye+")",Ce="(?:"+Ae+"|"+ye+")",ke="(?:"+me+"|"+we+")"+"?",Oe="[\\ufe0e\\ufe0f]?"+ke+("(?:\\u200d(?:"+[Se,xe,Ee].join("|")+")[\\ufe0e\\ufe0f]?"+ke+")*"),Te="(?:"+[_e,xe,Ee].join("|")+")"+Oe,Ne="(?:"+[Se+me+"?",me,xe,Ee,pe].join("|")+")",Me=RegExp("['’]","g"),Ie=RegExp(me,"g"),Re=RegExp(we+"(?="+we+")|"+Ne+Oe,"g"),De=RegExp([Ae+"?"+be+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[ge,Ae,"$"].join("|")+")",Ce+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[ge,Ae+je,"$"].join("|")+")",Ae+"?"+je+"+(?:['’](?:d|ll|m|re|s|t|ve))?",Ae+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ve,Te].join("|"),"g"),Pe=RegExp("[\\u200d\\ud800-\\udfff"+he+"\\ufe0e\\ufe0f]"),Le=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ze=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Fe=-1,Be={};Be[A]=Be[j]=Be[C]=Be[k]=Be[O]=Be[T]=Be["[object Uint8ClampedArray]"]=Be[N]=Be[M]=!0,Be[c]=Be[l]=Be[x]=Be[u]=Be[E]=Be[d]=Be[h]=Be[f]=Be[g]=Be[m]=Be[v]=Be[_]=Be[b]=Be[y]=Be[S]=!1;var qe={};qe[c]=qe[l]=qe[x]=qe[E]=qe[u]=qe[d]=qe[A]=qe[j]=qe[C]=qe[k]=qe[O]=qe[g]=qe[m]=qe[v]=qe[_]=qe[b]=qe[y]=qe[w]=qe[T]=qe["[object Uint8ClampedArray]"]=qe[N]=qe[M]=!0,qe[h]=qe[f]=qe[S]=!1;var Ue={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},He=parseFloat,$e=parseInt,We="object"==typeof e&&e&&e.Object===Object&&e,Ve="object"==typeof self&&self&&self.Object===Object&&self,Ge=We||Ve||Function("return this")(),Je=t&&!t.nodeType&&t,Qe=Je&&"object"==typeof i&&i&&!i.nodeType&&i,Ke=Qe&&Qe.exports===Je,Ye=Ke&&We.process,Xe=function(){try{var e=Qe&&Qe.require&&Qe.require("util").types;return e||Ye&&Ye.binding&&Ye.binding("util")}catch(e){}}(),Ze=Xe&&Xe.isArrayBuffer,et=Xe&&Xe.isDate,tt=Xe&&Xe.isMap,nt=Xe&&Xe.isRegExp,it=Xe&&Xe.isSet,rt=Xe&&Xe.isTypedArray;function ot(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function st(e,t,n,i){for(var r=-1,o=null==e?0:e.length;++r<o;){var s=e[r];t(i,s,n(s),e)}return i}function at(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e}function ct(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function lt(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(!t(e[n],n,e))return!1;return!0}function ut(e,t){for(var n=-1,i=null==e?0:e.length,r=0,o=[];++n<i;){var s=e[n];t(s,n,e)&&(o[r++]=s)}return o}function dt(e,t){return!!(null==e?0:e.length)&&wt(e,t,0)>-1}function ht(e,t,n){for(var i=-1,r=null==e?0:e.length;++i<r;)if(n(t,e[i]))return!0;return!1}function ft(e,t){for(var n=-1,i=null==e?0:e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r}function pt(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}function gt(e,t,n,i){var r=-1,o=null==e?0:e.length;for(i&&o&&(n=e[++r]);++r<o;)n=t(n,e[r],r,e);return n}function mt(e,t,n,i){var r=null==e?0:e.length;for(i&&r&&(n=e[--r]);r--;)n=t(n,e[r],r,e);return n}function vt(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}var _t=At("length");function bt(e,t,n){var i;return n(e,(function(e,n,r){if(t(e,n,r))return i=n,!1})),i}function yt(e,t,n,i){for(var r=e.length,o=n+(i?1:-1);i?o--:++o<r;)if(t(e[o],o,e))return o;return-1}function wt(e,t,n){return t==t?function(e,t,n){var i=n-1,r=e.length;for(;++i<r;)if(e[i]===t)return i;return-1}(e,t,n):yt(e,xt,n)}function St(e,t,n,i){for(var r=n-1,o=e.length;++r<o;)if(i(e[r],t))return r;return-1}function xt(e){return e!=e}function Et(e,t){var n=null==e?0:e.length;return n?kt(e,t)/n:NaN}function At(e){return function(t){return null==t?void 0:t[e]}}function jt(e){return function(t){return null==e?void 0:e[t]}}function Ct(e,t,n,i,r){return r(e,(function(e,r,o){n=i?(i=!1,e):t(n,e,r,o)})),n}function kt(e,t){for(var n,i=-1,r=e.length;++i<r;){var o=t(e[i]);void 0!==o&&(n=void 0===n?o:n+o)}return n}function Ot(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}function Tt(e){return function(t){return e(t)}}function Nt(e,t){return ft(t,(function(t){return e[t]}))}function Mt(e,t){return e.has(t)}function It(e,t){for(var n=-1,i=e.length;++n<i&&wt(t,e[n],0)>-1;);return n}function Rt(e,t){for(var n=e.length;n--&&wt(t,e[n],0)>-1;);return n}function Dt(e,t){for(var n=e.length,i=0;n--;)e[n]===t&&++i;return i}var Pt=jt({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),Lt=jt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function zt(e){return"\\"+Ue[e]}function Ft(e){return Pe.test(e)}function Bt(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n}function qt(e,t){return function(n){return e(t(n))}}function Ut(e,t){for(var n=-1,i=e.length,r=0,o=[];++n<i;){var a=e[n];a!==t&&a!==s||(e[n]=s,o[r++]=n)}return o}function Ht(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}function $t(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=[e,e]})),n}function Wt(e){return Ft(e)?function(e){var t=Re.lastIndex=0;for(;Re.test(e);)++t;return t}(e):_t(e)}function Vt(e){return Ft(e)?function(e){return e.match(Re)||[]}(e):function(e){return e.split("")}(e)}var Gt=jt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Jt=function e(t){var n,i=(t=null==t?Ge:Jt.defaults(Ge.Object(),t,Jt.pick(Ge,ze))).Array,r=t.Date,he=t.Error,fe=t.Function,pe=t.Math,ge=t.Object,me=t.RegExp,ve=t.String,_e=t.TypeError,be=i.prototype,ye=fe.prototype,we=ge.prototype,Se=t["__core-js_shared__"],xe=ye.toString,Ee=we.hasOwnProperty,Ae=0,je=(n=/[^.]+$/.exec(Se&&Se.keys&&Se.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",Ce=we.toString,ke=xe.call(ge),Oe=Ge._,Te=me("^"+xe.call(Ee).replace(V,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ne=Ke?t.Buffer:void 0,Re=t.Symbol,Pe=t.Uint8Array,Ue=Ne?Ne.allocUnsafe:void 0,We=qt(ge.getPrototypeOf,ge),Ve=ge.create,Je=we.propertyIsEnumerable,Qe=be.splice,Ye=Re?Re.isConcatSpreadable:void 0,Xe=Re?Re.iterator:void 0,_t=Re?Re.toStringTag:void 0,jt=function(){try{var e=Zr(ge,"defineProperty");return e({},"",{}),e}catch(e){}}(),Qt=t.clearTimeout!==Ge.clearTimeout&&t.clearTimeout,Kt=r&&r.now!==Ge.Date.now&&r.now,Yt=t.setTimeout!==Ge.setTimeout&&t.setTimeout,Xt=pe.ceil,Zt=pe.floor,en=ge.getOwnPropertySymbols,tn=Ne?Ne.isBuffer:void 0,nn=t.isFinite,rn=be.join,on=qt(ge.keys,ge),sn=pe.max,an=pe.min,cn=r.now,ln=t.parseInt,un=pe.random,dn=be.reverse,hn=Zr(t,"DataView"),fn=Zr(t,"Map"),pn=Zr(t,"Promise"),gn=Zr(t,"Set"),mn=Zr(t,"WeakMap"),vn=Zr(ge,"create"),_n=mn&&new mn,bn={},yn=Co(hn),wn=Co(fn),Sn=Co(pn),xn=Co(gn),En=Co(mn),An=Re?Re.prototype:void 0,jn=An?An.valueOf:void 0,Cn=An?An.toString:void 0;function kn(e){if($s(e)&&!Is(e)&&!(e instanceof Mn)){if(e instanceof Nn)return e;if(Ee.call(e,"__wrapped__"))return ko(e)}return new Nn(e)}var On=function(){function e(){}return function(t){if(!Hs(t))return{};if(Ve)return Ve(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function Tn(){}function Nn(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}function Mn(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function In(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Rn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Dn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Pn(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Dn;++t<n;)this.add(e[t])}function Ln(e){var t=this.__data__=new Rn(e);this.size=t.size}function zn(e,t){var n=Is(e),i=!n&&Ms(e),r=!n&&!i&&Ls(e),o=!n&&!i&&!r&&Xs(e),s=n||i||r||o,a=s?Ot(e.length,ve):[],c=a.length;for(var l in e)!t&&!Ee.call(e,l)||s&&("length"==l||r&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||so(l,c))||a.push(l);return a}function Fn(e){var t=e.length;return t?e[Pi(0,t-1)]:void 0}function Bn(e,t){return Eo(vr(e),Qn(t,0,e.length))}function qn(e){return Eo(vr(e))}function Un(e,t,n){(void 0!==n&&!Os(e[t],n)||void 0===n&&!(t in e))&&Gn(e,t,n)}function Hn(e,t,n){var i=e[t];Ee.call(e,t)&&Os(i,n)&&(void 0!==n||t in e)||Gn(e,t,n)}function $n(e,t){for(var n=e.length;n--;)if(Os(e[n][0],t))return n;return-1}function Wn(e,t,n,i){return ei(e,(function(e,r,o){t(i,e,n(e),o)})),i}function Vn(e,t){return e&&_r(t,ya(t),e)}function Gn(e,t,n){"__proto__"==t&&jt?jt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Jn(e,t){for(var n=-1,r=t.length,o=i(r),s=null==e;++n<r;)o[n]=s?void 0:ga(e,t[n]);return o}function Qn(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e}function Kn(e,t,n,i,r,o){var s,a=1&t,l=2&t,h=4&t;if(n&&(s=r?n(e,i,r,o):n(e)),void 0!==s)return s;if(!Hs(e))return e;var S=Is(e);if(S){if(s=function(e){var t=e.length,n=new e.constructor(t);t&&"string"==typeof e[0]&&Ee.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!a)return vr(e,s)}else{var I=no(e),R=I==f||I==p;if(Ls(e))return dr(e,a);if(I==v||I==c||R&&!r){if(s=l||R?{}:ro(e),!a)return l?function(e,t){return _r(e,to(e),t)}(e,function(e,t){return e&&_r(t,wa(t),e)}(s,e)):function(e,t){return _r(e,eo(e),t)}(e,Vn(s,e))}else{if(!qe[I])return r?e:{};s=function(e,t,n){var i=e.constructor;switch(t){case x:return hr(e);case u:case d:return new i(+e);case E:return function(e,t){var n=t?hr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case A:case j:case C:case k:case O:case T:case"[object Uint8ClampedArray]":case N:case M:return fr(e,n);case g:return new i;case m:case y:return new i(e);case _:return function(e){var t=new e.constructor(e.source,ie.exec(e));return t.lastIndex=e.lastIndex,t}(e);case b:return new i;case w:return r=e,jn?ge(jn.call(r)):{}}var r}(e,I,a)}}o||(o=new Ln);var D=o.get(e);if(D)return D;o.set(e,s),Qs(e)?e.forEach((function(i){s.add(Kn(i,t,n,i,e,o))})):Ws(e)&&e.forEach((function(i,r){s.set(r,Kn(i,t,n,r,e,o))}));var P=S?void 0:(h?l?Vr:Wr:l?wa:ya)(e);return at(P||e,(function(i,r){P&&(i=e[r=i]),Hn(s,r,Kn(i,t,n,r,e,o))})),s}function Yn(e,t,n){var i=n.length;if(null==e)return!i;for(e=ge(e);i--;){var r=n[i],o=t[r],s=e[r];if(void 0===s&&!(r in e)||!o(s))return!1}return!0}function Xn(e,t,n){if("function"!=typeof e)throw new _e(o);return yo((function(){e.apply(void 0,n)}),t)}function Zn(e,t,n,i){var r=-1,o=dt,s=!0,a=e.length,c=[],l=t.length;if(!a)return c;n&&(t=ft(t,Tt(n))),i?(o=ht,s=!1):t.length>=200&&(o=Mt,s=!1,t=new Pn(t));e:for(;++r<a;){var u=e[r],d=null==n?u:n(u);if(u=i||0!==u?u:0,s&&d==d){for(var h=l;h--;)if(t[h]===d)continue e;c.push(u)}else o(t,d,i)||c.push(u)}return c}kn.templateSettings={escape:B,evaluate:q,interpolate:U,variable:"",imports:{_:kn}},kn.prototype=Tn.prototype,kn.prototype.constructor=kn,Nn.prototype=On(Tn.prototype),Nn.prototype.constructor=Nn,Mn.prototype=On(Tn.prototype),Mn.prototype.constructor=Mn,In.prototype.clear=function(){this.__data__=vn?vn(null):{},this.size=0},In.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},In.prototype.get=function(e){var t=this.__data__;if(vn){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Ee.call(t,e)?t[e]:void 0},In.prototype.has=function(e){var t=this.__data__;return vn?void 0!==t[e]:Ee.call(t,e)},In.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=vn&&void 0===t?"__lodash_hash_undefined__":t,this},Rn.prototype.clear=function(){this.__data__=[],this.size=0},Rn.prototype.delete=function(e){var t=this.__data__,n=$n(t,e);return!(n<0)&&(n==t.length-1?t.pop():Qe.call(t,n,1),--this.size,!0)},Rn.prototype.get=function(e){var t=this.__data__,n=$n(t,e);return n<0?void 0:t[n][1]},Rn.prototype.has=function(e){return $n(this.__data__,e)>-1},Rn.prototype.set=function(e,t){var n=this.__data__,i=$n(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this},Dn.prototype.clear=function(){this.size=0,this.__data__={hash:new In,map:new(fn||Rn),string:new In}},Dn.prototype.delete=function(e){var t=Yr(this,e).delete(e);return this.size-=t?1:0,t},Dn.prototype.get=function(e){return Yr(this,e).get(e)},Dn.prototype.has=function(e){return Yr(this,e).has(e)},Dn.prototype.set=function(e,t){var n=Yr(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this},Pn.prototype.add=Pn.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Pn.prototype.has=function(e){return this.__data__.has(e)},Ln.prototype.clear=function(){this.__data__=new Rn,this.size=0},Ln.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Ln.prototype.get=function(e){return this.__data__.get(e)},Ln.prototype.has=function(e){return this.__data__.has(e)},Ln.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Rn){var i=n.__data__;if(!fn||i.length<199)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new Dn(i)}return n.set(e,t),this.size=n.size,this};var ei=wr(ci),ti=wr(li,!0);function ni(e,t){var n=!0;return ei(e,(function(e,i,r){return n=!!t(e,i,r)})),n}function ii(e,t,n){for(var i=-1,r=e.length;++i<r;){var o=e[i],s=t(o);if(null!=s&&(void 0===a?s==s&&!Ys(s):n(s,a)))var a=s,c=o}return c}function ri(e,t){var n=[];return ei(e,(function(e,i,r){t(e,i,r)&&n.push(e)})),n}function oi(e,t,n,i,r){var o=-1,s=e.length;for(n||(n=oo),r||(r=[]);++o<s;){var a=e[o];t>0&&n(a)?t>1?oi(a,t-1,n,i,r):pt(r,a):i||(r[r.length]=a)}return r}var si=Sr(),ai=Sr(!0);function ci(e,t){return e&&si(e,t,ya)}function li(e,t){return e&&ai(e,t,ya)}function ui(e,t){return ut(t,(function(t){return Bs(e[t])}))}function di(e,t){for(var n=0,i=(t=ar(t,e)).length;null!=e&&n<i;)e=e[jo(t[n++])];return n&&n==i?e:void 0}function hi(e,t,n){var i=t(e);return Is(e)?i:pt(i,n(e))}function fi(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":_t&&_t in ge(e)?function(e){var t=Ee.call(e,_t),n=e[_t];try{e[_t]=void 0;var i=!0}catch(e){}var r=Ce.call(e);i&&(t?e[_t]=n:delete e[_t]);return r}(e):function(e){return Ce.call(e)}(e)}function pi(e,t){return e>t}function gi(e,t){return null!=e&&Ee.call(e,t)}function mi(e,t){return null!=e&&t in ge(e)}function vi(e,t,n){for(var r=n?ht:dt,o=e[0].length,s=e.length,a=s,c=i(s),l=1/0,u=[];a--;){var d=e[a];a&&t&&(d=ft(d,Tt(t))),l=an(d.length,l),c[a]=!n&&(t||o>=120&&d.length>=120)?new Pn(a&&d):void 0}d=e[0];var h=-1,f=c[0];e:for(;++h<o&&u.length<l;){var p=d[h],g=t?t(p):p;if(p=n||0!==p?p:0,!(f?Mt(f,g):r(u,g,n))){for(a=s;--a;){var m=c[a];if(!(m?Mt(m,g):r(e[a],g,n)))continue e}f&&f.push(g),u.push(p)}}return u}function _i(e,t,n){var i=null==(e=mo(e,t=ar(t,e)))?e:e[jo(Fo(t))];return null==i?void 0:ot(i,e,n)}function bi(e){return $s(e)&&fi(e)==c}function yi(e,t,n,i,r){return e===t||(null==e||null==t||!$s(e)&&!$s(t)?e!=e&&t!=t:function(e,t,n,i,r,o){var s=Is(e),a=Is(t),f=s?l:no(e),p=a?l:no(t),S=(f=f==c?v:f)==v,A=(p=p==c?v:p)==v,j=f==p;if(j&&Ls(e)){if(!Ls(t))return!1;s=!0,S=!1}if(j&&!S)return o||(o=new Ln),s||Xs(e)?Hr(e,t,n,i,r,o):function(e,t,n,i,r,o,s){switch(n){case E:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case x:return!(e.byteLength!=t.byteLength||!o(new Pe(e),new Pe(t)));case u:case d:case m:return Os(+e,+t);case h:return e.name==t.name&&e.message==t.message;case _:case y:return e==t+"";case g:var a=Bt;case b:var c=1&i;if(a||(a=Ht),e.size!=t.size&&!c)return!1;var l=s.get(e);if(l)return l==t;i|=2,s.set(e,t);var f=Hr(a(e),a(t),i,r,o,s);return s.delete(e),f;case w:if(jn)return jn.call(e)==jn.call(t)}return!1}(e,t,f,n,i,r,o);if(!(1&n)){var C=S&&Ee.call(e,"__wrapped__"),k=A&&Ee.call(t,"__wrapped__");if(C||k){var O=C?e.value():e,T=k?t.value():t;return o||(o=new Ln),r(O,T,n,i,o)}}if(!j)return!1;return o||(o=new Ln),function(e,t,n,i,r,o){var s=1&n,a=Wr(e),c=a.length,l=Wr(t).length;if(c!=l&&!s)return!1;var u=c;for(;u--;){var d=a[u];if(!(s?d in t:Ee.call(t,d)))return!1}var h=o.get(e);if(h&&o.get(t))return h==t;var f=!0;o.set(e,t),o.set(t,e);var p=s;for(;++u<c;){d=a[u];var g=e[d],m=t[d];if(i)var v=s?i(m,g,d,t,e,o):i(g,m,d,e,t,o);if(!(void 0===v?g===m||r(g,m,n,i,o):v)){f=!1;break}p||(p="constructor"==d)}if(f&&!p){var _=e.constructor,b=t.constructor;_==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof b&&b instanceof b||(f=!1)}return o.delete(e),o.delete(t),f}(e,t,n,i,r,o)}(e,t,n,i,yi,r))}function wi(e,t,n,i){var r=n.length,o=r,s=!i;if(null==e)return!o;for(e=ge(e);r--;){var a=n[r];if(s&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++r<o;){var c=(a=n[r])[0],l=e[c],u=a[1];if(s&&a[2]){if(void 0===l&&!(c in e))return!1}else{var d=new Ln;if(i)var h=i(l,u,c,e,t,d);if(!(void 0===h?yi(u,l,3,i,d):h))return!1}}return!0}function Si(e){return!(!Hs(e)||(t=e,je&&je in t))&&(Bs(e)?Te:se).test(Co(e));var t}function xi(e){return"function"==typeof e?e:null==e?Va:"object"==typeof e?Is(e)?Oi(e[0],e[1]):ki(e):tc(e)}function Ei(e){if(!ho(e))return on(e);var t=[];for(var n in ge(e))Ee.call(e,n)&&"constructor"!=n&&t.push(n);return t}function Ai(e){if(!Hs(e))return function(e){var t=[];if(null!=e)for(var n in ge(e))t.push(n);return t}(e);var t=ho(e),n=[];for(var i in e)("constructor"!=i||!t&&Ee.call(e,i))&&n.push(i);return n}function ji(e,t){return e<t}function Ci(e,t){var n=-1,r=Ds(e)?i(e.length):[];return ei(e,(function(e,i,o){r[++n]=t(e,i,o)})),r}function ki(e){var t=Xr(e);return 1==t.length&&t[0][2]?po(t[0][0],t[0][1]):function(n){return n===e||wi(n,e,t)}}function Oi(e,t){return co(e)&&fo(t)?po(jo(e),t):function(n){var i=ga(n,e);return void 0===i&&i===t?ma(n,e):yi(t,i,3)}}function Ti(e,t,n,i,r){e!==t&&si(t,(function(o,s){if(r||(r=new Ln),Hs(o))!function(e,t,n,i,r,o,s){var a=_o(e,n),c=_o(t,n),l=s.get(c);if(l)return void Un(e,n,l);var u=o?o(a,c,n+"",e,t,s):void 0,d=void 0===u;if(d){var h=Is(c),f=!h&&Ls(c),p=!h&&!f&&Xs(c);u=c,h||f||p?Is(a)?u=a:Ps(a)?u=vr(a):f?(d=!1,u=dr(c,!0)):p?(d=!1,u=fr(c,!0)):u=[]:Gs(c)||Ms(c)?(u=a,Ms(a)?u=sa(a):Hs(a)&&!Bs(a)||(u=ro(c))):d=!1}d&&(s.set(c,u),r(u,c,i,o,s),s.delete(c));Un(e,n,u)}(e,t,s,n,Ti,i,r);else{var a=i?i(_o(e,s),o,s+"",e,t,r):void 0;void 0===a&&(a=o),Un(e,s,a)}}),wa)}function Ni(e,t){var n=e.length;if(n)return so(t+=t<0?n:0,n)?e[t]:void 0}function Mi(e,t,n){var i=-1;return t=ft(t.length?t:[Va],Tt(Kr())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(Ci(e,(function(e,n,r){return{criteria:ft(t,(function(t){return t(e)})),index:++i,value:e}})),(function(e,t){return function(e,t,n){var i=-1,r=e.criteria,o=t.criteria,s=r.length,a=n.length;for(;++i<s;){var c=pr(r[i],o[i]);if(c){if(i>=a)return c;var l=n[i];return c*("desc"==l?-1:1)}}return e.index-t.index}(e,t,n)}))}function Ii(e,t,n){for(var i=-1,r=t.length,o={};++i<r;){var s=t[i],a=di(e,s);n(a,s)&&qi(o,ar(s,e),a)}return o}function Ri(e,t,n,i){var r=i?St:wt,o=-1,s=t.length,a=e;for(e===t&&(t=vr(t)),n&&(a=ft(e,Tt(n)));++o<s;)for(var c=0,l=t[o],u=n?n(l):l;(c=r(a,u,c,i))>-1;)a!==e&&Qe.call(a,c,1),Qe.call(e,c,1);return e}function Di(e,t){for(var n=e?t.length:0,i=n-1;n--;){var r=t[n];if(n==i||r!==o){var o=r;so(r)?Qe.call(e,r,1):Zi(e,r)}}return e}function Pi(e,t){return e+Zt(un()*(t-e+1))}function Li(e,t){var n="";if(!e||t<1||t>9007199254740991)return n;do{t%2&&(n+=e),(t=Zt(t/2))&&(e+=e)}while(t);return n}function zi(e,t){return wo(go(e,t,Va),e+"")}function Fi(e){return Fn(Oa(e))}function Bi(e,t){var n=Oa(e);return Eo(n,Qn(t,0,n.length))}function qi(e,t,n,i){if(!Hs(e))return e;for(var r=-1,o=(t=ar(t,e)).length,s=o-1,a=e;null!=a&&++r<o;){var c=jo(t[r]),l=n;if(r!=s){var u=a[c];void 0===(l=i?i(u,c,a):void 0)&&(l=Hs(u)?u:so(t[r+1])?[]:{})}Hn(a,c,l),a=a[c]}return e}var Ui=_n?function(e,t){return _n.set(e,t),e}:Va,Hi=jt?function(e,t){return jt(e,"toString",{configurable:!0,enumerable:!1,value:Ha(t),writable:!0})}:Va;function $i(e){return Eo(Oa(e))}function Wi(e,t,n){var r=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(n=n>o?o:n)<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var s=i(o);++r<o;)s[r]=e[r+t];return s}function Vi(e,t){var n;return ei(e,(function(e,i,r){return!(n=t(e,i,r))})),!!n}function Gi(e,t,n){var i=0,r=null==e?i:e.length;if("number"==typeof t&&t==t&&r<=2147483647){for(;i<r;){var o=i+r>>>1,s=e[o];null!==s&&!Ys(s)&&(n?s<=t:s<t)?i=o+1:r=o}return r}return Ji(e,t,Va,n)}function Ji(e,t,n,i){t=n(t);for(var r=0,o=null==e?0:e.length,s=t!=t,a=null===t,c=Ys(t),l=void 0===t;r<o;){var u=Zt((r+o)/2),d=n(e[u]),h=void 0!==d,f=null===d,p=d==d,g=Ys(d);if(s)var m=i||p;else m=l?p&&(i||h):a?p&&h&&(i||!f):c?p&&h&&!f&&(i||!g):!f&&!g&&(i?d<=t:d<t);m?r=u+1:o=u}return an(o,4294967294)}function Qi(e,t){for(var n=-1,i=e.length,r=0,o=[];++n<i;){var s=e[n],a=t?t(s):s;if(!n||!Os(a,c)){var c=a;o[r++]=0===s?0:s}}return o}function Ki(e){return"number"==typeof e?e:Ys(e)?NaN:+e}function Yi(e){if("string"==typeof e)return e;if(Is(e))return ft(e,Yi)+"";if(Ys(e))return Cn?Cn.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Xi(e,t,n){var i=-1,r=dt,o=e.length,s=!0,a=[],c=a;if(n)s=!1,r=ht;else if(o>=200){var l=t?null:Lr(e);if(l)return Ht(l);s=!1,r=Mt,c=new Pn}else c=t?[]:a;e:for(;++i<o;){var u=e[i],d=t?t(u):u;if(u=n||0!==u?u:0,s&&d==d){for(var h=c.length;h--;)if(c[h]===d)continue e;t&&c.push(d),a.push(u)}else r(c,d,n)||(c!==a&&c.push(d),a.push(u))}return a}function Zi(e,t){return null==(e=mo(e,t=ar(t,e)))||delete e[jo(Fo(t))]}function er(e,t,n,i){return qi(e,t,n(di(e,t)),i)}function tr(e,t,n,i){for(var r=e.length,o=i?r:-1;(i?o--:++o<r)&&t(e[o],o,e););return n?Wi(e,i?0:o,i?o+1:r):Wi(e,i?o+1:0,i?r:o)}function nr(e,t){var n=e;return n instanceof Mn&&(n=n.value()),gt(t,(function(e,t){return t.func.apply(t.thisArg,pt([e],t.args))}),n)}function ir(e,t,n){var r=e.length;if(r<2)return r?Xi(e[0]):[];for(var o=-1,s=i(r);++o<r;)for(var a=e[o],c=-1;++c<r;)c!=o&&(s[o]=Zn(s[o]||a,e[c],t,n));return Xi(oi(s,1),t,n)}function rr(e,t,n){for(var i=-1,r=e.length,o=t.length,s={};++i<r;){var a=i<o?t[i]:void 0;n(s,e[i],a)}return s}function or(e){return Ps(e)?e:[]}function sr(e){return"function"==typeof e?e:Va}function ar(e,t){return Is(e)?e:co(e,t)?[e]:Ao(aa(e))}var cr=zi;function lr(e,t,n){var i=e.length;return n=void 0===n?i:n,!t&&n>=i?e:Wi(e,t,n)}var ur=Qt||function(e){return Ge.clearTimeout(e)};function dr(e,t){if(t)return e.slice();var n=e.length,i=Ue?Ue(n):new e.constructor(n);return e.copy(i),i}function hr(e){var t=new e.constructor(e.byteLength);return new Pe(t).set(new Pe(e)),t}function fr(e,t){var n=t?hr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function pr(e,t){if(e!==t){var n=void 0!==e,i=null===e,r=e==e,o=Ys(e),s=void 0!==t,a=null===t,c=t==t,l=Ys(t);if(!a&&!l&&!o&&e>t||o&&s&&c&&!a&&!l||i&&s&&c||!n&&c||!r)return 1;if(!i&&!o&&!l&&e<t||l&&n&&r&&!i&&!o||a&&n&&r||!s&&r||!c)return-1}return 0}function gr(e,t,n,r){for(var o=-1,s=e.length,a=n.length,c=-1,l=t.length,u=sn(s-a,0),d=i(l+u),h=!r;++c<l;)d[c]=t[c];for(;++o<a;)(h||o<s)&&(d[n[o]]=e[o]);for(;u--;)d[c++]=e[o++];return d}function mr(e,t,n,r){for(var o=-1,s=e.length,a=-1,c=n.length,l=-1,u=t.length,d=sn(s-c,0),h=i(d+u),f=!r;++o<d;)h[o]=e[o];for(var p=o;++l<u;)h[p+l]=t[l];for(;++a<c;)(f||o<s)&&(h[p+n[a]]=e[o++]);return h}function vr(e,t){var n=-1,r=e.length;for(t||(t=i(r));++n<r;)t[n]=e[n];return t}function _r(e,t,n,i){var r=!n;n||(n={});for(var o=-1,s=t.length;++o<s;){var a=t[o],c=i?i(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),r?Gn(n,a,c):Hn(n,a,c)}return n}function br(e,t){return function(n,i){var r=Is(n)?st:Wn,o=t?t():{};return r(n,e,Kr(i,2),o)}}function yr(e){return zi((function(t,n){var i=-1,r=n.length,o=r>1?n[r-1]:void 0,s=r>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(r--,o):void 0,s&&ao(n[0],n[1],s)&&(o=r<3?void 0:o,r=1),t=ge(t);++i<r;){var a=n[i];a&&e(t,a,i,o)}return t}))}function wr(e,t){return function(n,i){if(null==n)return n;if(!Ds(n))return e(n,i);for(var r=n.length,o=t?r:-1,s=ge(n);(t?o--:++o<r)&&!1!==i(s[o],o,s););return n}}function Sr(e){return function(t,n,i){for(var r=-1,o=ge(t),s=i(t),a=s.length;a--;){var c=s[e?a:++r];if(!1===n(o[c],c,o))break}return t}}function xr(e){return function(t){var n=Ft(t=aa(t))?Vt(t):void 0,i=n?n[0]:t.charAt(0),r=n?lr(n,1).join(""):t.slice(1);return i[e]()+r}}function Er(e){return function(t){return gt(Ba(Ma(t).replace(Me,"")),e,"")}}function Ar(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=On(e.prototype),i=e.apply(n,t);return Hs(i)?i:n}}function jr(e){return function(t,n,i){var r=ge(t);if(!Ds(t)){var o=Kr(n,3);t=ya(t),n=function(e){return o(r[e],e,r)}}var s=e(t,n,i);return s>-1?r[o?t[s]:s]:void 0}}function Cr(e){return $r((function(t){var n=t.length,i=n,r=Nn.prototype.thru;for(e&&t.reverse();i--;){var s=t[i];if("function"!=typeof s)throw new _e(o);if(r&&!a&&"wrapper"==Jr(s))var a=new Nn([],!0)}for(i=a?i:n;++i<n;){var c=Jr(s=t[i]),l="wrapper"==c?Gr(s):void 0;a=l&&lo(l[0])&&424==l[1]&&!l[4].length&&1==l[9]?a[Jr(l[0])].apply(a,l[3]):1==s.length&&lo(s)?a[c]():a.thru(s)}return function(){var e=arguments,i=e[0];if(a&&1==e.length&&Is(i))return a.plant(i).value();for(var r=0,o=n?t[r].apply(this,e):i;++r<n;)o=t[r].call(this,o);return o}}))}function kr(e,t,n,r,o,s,a,c,l,u){var d=128&t,h=1&t,f=2&t,p=24&t,g=512&t,m=f?void 0:Ar(e);return function v(){for(var _=arguments.length,b=i(_),y=_;y--;)b[y]=arguments[y];if(p)var w=Qr(v),S=Dt(b,w);if(r&&(b=gr(b,r,o,p)),s&&(b=mr(b,s,a,p)),_-=S,p&&_<u){var x=Ut(b,w);return Dr(e,t,kr,v.placeholder,n,b,x,c,l,u-_)}var E=h?n:this,A=f?E[e]:e;return _=b.length,c?b=vo(b,c):g&&_>1&&b.reverse(),d&&l<_&&(b.length=l),this&&this!==Ge&&this instanceof v&&(A=m||Ar(A)),A.apply(E,b)}}function Or(e,t){return function(n,i){return function(e,t,n,i){return ci(e,(function(e,r,o){t(i,n(e),r,o)})),i}(n,e,t(i),{})}}function Tr(e,t){return function(n,i){var r;if(void 0===n&&void 0===i)return t;if(void 0!==n&&(r=n),void 0!==i){if(void 0===r)return i;"string"==typeof n||"string"==typeof i?(n=Yi(n),i=Yi(i)):(n=Ki(n),i=Ki(i)),r=e(n,i)}return r}}function Nr(e){return $r((function(t){return t=ft(t,Tt(Kr())),zi((function(n){var i=this;return e(t,(function(e){return ot(e,i,n)}))}))}))}function Mr(e,t){var n=(t=void 0===t?" ":Yi(t)).length;if(n<2)return n?Li(t,e):t;var i=Li(t,Xt(e/Wt(t)));return Ft(t)?lr(Vt(i),0,e).join(""):i.slice(0,e)}function Ir(e){return function(t,n,r){return r&&"number"!=typeof r&&ao(t,n,r)&&(n=r=void 0),t=na(t),void 0===n?(n=t,t=0):n=na(n),function(e,t,n,r){for(var o=-1,s=sn(Xt((t-e)/(n||1)),0),a=i(s);s--;)a[r?s:++o]=e,e+=n;return a}(t,n,r=void 0===r?t<n?1:-1:na(r),e)}}function Rr(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=oa(t),n=oa(n)),e(t,n)}}function Dr(e,t,n,i,r,o,s,a,c,l){var u=8&t;t|=u?32:64,4&(t&=~(u?64:32))||(t&=-4);var d=[e,t,r,u?o:void 0,u?s:void 0,u?void 0:o,u?void 0:s,a,c,l],h=n.apply(void 0,d);return lo(e)&&bo(h,d),h.placeholder=i,So(h,e,t)}function Pr(e){var t=pe[e];return function(e,n){if(e=oa(e),(n=null==n?0:an(ia(n),292))&&nn(e)){var i=(aa(e)+"e").split("e");return+((i=(aa(t(i[0]+"e"+(+i[1]+n)))+"e").split("e"))[0]+"e"+(+i[1]-n))}return t(e)}}var Lr=gn&&1/Ht(new gn([,-0]))[1]==1/0?function(e){return new gn(e)}:Ya;function zr(e){return function(t){var n=no(t);return n==g?Bt(t):n==b?$t(t):function(e,t){return ft(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Fr(e,t,n,r,a,c,l,u){var d=2&t;if(!d&&"function"!=typeof e)throw new _e(o);var h=r?r.length:0;if(h||(t&=-97,r=a=void 0),l=void 0===l?l:sn(ia(l),0),u=void 0===u?u:ia(u),h-=a?a.length:0,64&t){var f=r,p=a;r=a=void 0}var g=d?void 0:Gr(e),m=[e,t,n,r,a,f,p,c,l,u];if(g&&function(e,t){var n=e[1],i=t[1],r=n|i,o=r<131,a=128==i&&8==n||128==i&&256==n&&e[7].length<=t[8]||384==i&&t[7].length<=t[8]&&8==n;if(!o&&!a)return e;1&i&&(e[2]=t[2],r|=1&n?0:4);var c=t[3];if(c){var l=e[3];e[3]=l?gr(l,c,t[4]):c,e[4]=l?Ut(e[3],s):t[4]}(c=t[5])&&(l=e[5],e[5]=l?mr(l,c,t[6]):c,e[6]=l?Ut(e[5],s):t[6]);(c=t[7])&&(e[7]=c);128&i&&(e[8]=null==e[8]?t[8]:an(e[8],t[8]));null==e[9]&&(e[9]=t[9]);e[0]=t[0],e[1]=r}(m,g),e=m[0],t=m[1],n=m[2],r=m[3],a=m[4],!(u=m[9]=void 0===m[9]?d?0:e.length:sn(m[9]-h,0))&&24&t&&(t&=-25),t&&1!=t)v=8==t||16==t?function(e,t,n){var r=Ar(e);return function o(){for(var s=arguments.length,a=i(s),c=s,l=Qr(o);c--;)a[c]=arguments[c];var u=s<3&&a[0]!==l&&a[s-1]!==l?[]:Ut(a,l);if((s-=u.length)<n)return Dr(e,t,kr,o.placeholder,void 0,a,u,void 0,void 0,n-s);var d=this&&this!==Ge&&this instanceof o?r:e;return ot(d,this,a)}}(e,t,u):32!=t&&33!=t||a.length?kr.apply(void 0,m):function(e,t,n,r){var o=1&t,s=Ar(e);return function t(){for(var a=-1,c=arguments.length,l=-1,u=r.length,d=i(u+c),h=this&&this!==Ge&&this instanceof t?s:e;++l<u;)d[l]=r[l];for(;c--;)d[l++]=arguments[++a];return ot(h,o?n:this,d)}}(e,t,n,r);else var v=function(e,t,n){var i=1&t,r=Ar(e);return function t(){var o=this&&this!==Ge&&this instanceof t?r:e;return o.apply(i?n:this,arguments)}}(e,t,n);return So((g?Ui:bo)(v,m),e,t)}function Br(e,t,n,i){return void 0===e||Os(e,we[n])&&!Ee.call(i,n)?t:e}function qr(e,t,n,i,r,o){return Hs(e)&&Hs(t)&&(o.set(t,e),Ti(e,t,void 0,qr,o),o.delete(t)),e}function Ur(e){return Gs(e)?void 0:e}function Hr(e,t,n,i,r,o){var s=1&n,a=e.length,c=t.length;if(a!=c&&!(s&&c>a))return!1;var l=o.get(e);if(l&&o.get(t))return l==t;var u=-1,d=!0,h=2&n?new Pn:void 0;for(o.set(e,t),o.set(t,e);++u<a;){var f=e[u],p=t[u];if(i)var g=s?i(p,f,u,t,e,o):i(f,p,u,e,t,o);if(void 0!==g){if(g)continue;d=!1;break}if(h){if(!vt(t,(function(e,t){if(!Mt(h,t)&&(f===e||r(f,e,n,i,o)))return h.push(t)}))){d=!1;break}}else if(f!==p&&!r(f,p,n,i,o)){d=!1;break}}return o.delete(e),o.delete(t),d}function $r(e){return wo(go(e,void 0,Ro),e+"")}function Wr(e){return hi(e,ya,eo)}function Vr(e){return hi(e,wa,to)}var Gr=_n?function(e){return _n.get(e)}:Ya;function Jr(e){for(var t=e.name+"",n=bn[t],i=Ee.call(bn,t)?n.length:0;i--;){var r=n[i],o=r.func;if(null==o||o==e)return r.name}return t}function Qr(e){return(Ee.call(kn,"placeholder")?kn:e).placeholder}function Kr(){var e=kn.iteratee||Ga;return e=e===Ga?xi:e,arguments.length?e(arguments[0],arguments[1]):e}function Yr(e,t){var n,i,r=e.__data__;return("string"==(i=typeof(n=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof t?"string":"hash"]:r.map}function Xr(e){for(var t=ya(e),n=t.length;n--;){var i=t[n],r=e[i];t[n]=[i,r,fo(r)]}return t}function Zr(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Si(n)?n:void 0}var eo=en?function(e){return null==e?[]:(e=ge(e),ut(en(e),(function(t){return Je.call(e,t)})))}:rc,to=en?function(e){for(var t=[];e;)pt(t,eo(e)),e=We(e);return t}:rc,no=fi;function io(e,t,n){for(var i=-1,r=(t=ar(t,e)).length,o=!1;++i<r;){var s=jo(t[i]);if(!(o=null!=e&&n(e,s)))break;e=e[s]}return o||++i!=r?o:!!(r=null==e?0:e.length)&&Us(r)&&so(s,r)&&(Is(e)||Ms(e))}function ro(e){return"function"!=typeof e.constructor||ho(e)?{}:On(We(e))}function oo(e){return Is(e)||Ms(e)||!!(Ye&&e&&e[Ye])}function so(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&ce.test(e))&&e>-1&&e%1==0&&e<t}function ao(e,t,n){if(!Hs(n))return!1;var i=typeof t;return!!("number"==i?Ds(n)&&so(t,n.length):"string"==i&&t in n)&&Os(n[t],e)}function co(e,t){if(Is(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Ys(e))||($.test(e)||!H.test(e)||null!=t&&e in ge(t))}function lo(e){var t=Jr(e),n=kn[t];if("function"!=typeof n||!(t in Mn.prototype))return!1;if(e===n)return!0;var i=Gr(n);return!!i&&e===i[0]}(hn&&no(new hn(new ArrayBuffer(1)))!=E||fn&&no(new fn)!=g||pn&&"[object Promise]"!=no(pn.resolve())||gn&&no(new gn)!=b||mn&&no(new mn)!=S)&&(no=function(e){var t=fi(e),n=t==v?e.constructor:void 0,i=n?Co(n):"";if(i)switch(i){case yn:return E;case wn:return g;case Sn:return"[object Promise]";case xn:return b;case En:return S}return t});var uo=Se?Bs:oc;function ho(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||we)}function fo(e){return e==e&&!Hs(e)}function po(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in ge(n)))}}function go(e,t,n){return t=sn(void 0===t?e.length-1:t,0),function(){for(var r=arguments,o=-1,s=sn(r.length-t,0),a=i(s);++o<s;)a[o]=r[t+o];o=-1;for(var c=i(t+1);++o<t;)c[o]=r[o];return c[t]=n(a),ot(e,this,c)}}function mo(e,t){return t.length<2?e:di(e,Wi(t,0,-1))}function vo(e,t){for(var n=e.length,i=an(t.length,n),r=vr(e);i--;){var o=t[i];e[i]=so(o,n)?r[o]:void 0}return e}function _o(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var bo=xo(Ui),yo=Yt||function(e,t){return Ge.setTimeout(e,t)},wo=xo(Hi);function So(e,t,n){var i=t+"";return wo(e,function(e,t){var n=t.length;if(!n)return e;var i=n-1;return t[i]=(n>1?"& ":"")+t[i],t=t.join(n>2?", ":" "),e.replace(Y,"{\n/* [wrapped with "+t+"] */\n")}(i,function(e,t){return at(a,(function(n){var i="_."+n[0];t&n[1]&&!dt(e,i)&&e.push(i)})),e.sort()}(function(e){var t=e.match(X);return t?t[1].split(Z):[]}(i),n)))}function xo(e){var t=0,n=0;return function(){var i=cn(),r=16-(i-n);if(n=i,r>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function Eo(e,t){var n=-1,i=e.length,r=i-1;for(t=void 0===t?i:t;++n<t;){var o=Pi(n,r),s=e[o];e[o]=e[n],e[n]=s}return e.length=t,e}var Ao=function(e){var t=xs(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(W,(function(e,n,i,r){t.push(i?r.replace(te,"$1"):n||e)})),t}));function jo(e){if("string"==typeof e||Ys(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Co(e){if(null!=e){try{return xe.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ko(e){if(e instanceof Mn)return e.clone();var t=new Nn(e.__wrapped__,e.__chain__);return t.__actions__=vr(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Oo=zi((function(e,t){return Ps(e)?Zn(e,oi(t,1,Ps,!0)):[]})),To=zi((function(e,t){var n=Fo(t);return Ps(n)&&(n=void 0),Ps(e)?Zn(e,oi(t,1,Ps,!0),Kr(n,2)):[]})),No=zi((function(e,t){var n=Fo(t);return Ps(n)&&(n=void 0),Ps(e)?Zn(e,oi(t,1,Ps,!0),void 0,n):[]}));function Mo(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=null==n?0:ia(n);return r<0&&(r=sn(i+r,0)),yt(e,Kr(t,3),r)}function Io(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=i-1;return void 0!==n&&(r=ia(n),r=n<0?sn(i+r,0):an(r,i-1)),yt(e,Kr(t,3),r,!0)}function Ro(e){return(null==e?0:e.length)?oi(e,1):[]}function Do(e){return e&&e.length?e[0]:void 0}var Po=zi((function(e){var t=ft(e,or);return t.length&&t[0]===e[0]?vi(t):[]})),Lo=zi((function(e){var t=Fo(e),n=ft(e,or);return t===Fo(n)?t=void 0:n.pop(),n.length&&n[0]===e[0]?vi(n,Kr(t,2)):[]})),zo=zi((function(e){var t=Fo(e),n=ft(e,or);return(t="function"==typeof t?t:void 0)&&n.pop(),n.length&&n[0]===e[0]?vi(n,void 0,t):[]}));function Fo(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var Bo=zi(qo);function qo(e,t){return e&&e.length&&t&&t.length?Ri(e,t):e}var Uo=$r((function(e,t){var n=null==e?0:e.length,i=Jn(e,t);return Di(e,ft(t,(function(e){return so(e,n)?+e:e})).sort(pr)),i}));function Ho(e){return null==e?e:dn.call(e)}var $o=zi((function(e){return Xi(oi(e,1,Ps,!0))})),Wo=zi((function(e){var t=Fo(e);return Ps(t)&&(t=void 0),Xi(oi(e,1,Ps,!0),Kr(t,2))})),Vo=zi((function(e){var t=Fo(e);return t="function"==typeof t?t:void 0,Xi(oi(e,1,Ps,!0),void 0,t)}));function Go(e){if(!e||!e.length)return[];var t=0;return e=ut(e,(function(e){if(Ps(e))return t=sn(e.length,t),!0})),Ot(t,(function(t){return ft(e,At(t))}))}function Jo(e,t){if(!e||!e.length)return[];var n=Go(e);return null==t?n:ft(n,(function(e){return ot(t,void 0,e)}))}var Qo=zi((function(e,t){return Ps(e)?Zn(e,t):[]})),Ko=zi((function(e){return ir(ut(e,Ps))})),Yo=zi((function(e){var t=Fo(e);return Ps(t)&&(t=void 0),ir(ut(e,Ps),Kr(t,2))})),Xo=zi((function(e){var t=Fo(e);return t="function"==typeof t?t:void 0,ir(ut(e,Ps),void 0,t)})),Zo=zi(Go);var es=zi((function(e){var t=e.length,n=t>1?e[t-1]:void 0;return n="function"==typeof n?(e.pop(),n):void 0,Jo(e,n)}));function ts(e){var t=kn(e);return t.__chain__=!0,t}function ns(e,t){return t(e)}var is=$r((function(e){var t=e.length,n=t?e[0]:0,i=this.__wrapped__,r=function(t){return Jn(t,e)};return!(t>1||this.__actions__.length)&&i instanceof Mn&&so(n)?((i=i.slice(n,+n+(t?1:0))).__actions__.push({func:ns,args:[r],thisArg:void 0}),new Nn(i,this.__chain__).thru((function(e){return t&&!e.length&&e.push(void 0),e}))):this.thru(r)}));var rs=br((function(e,t,n){Ee.call(e,n)?++e[n]:Gn(e,n,1)}));var os=jr(Mo),ss=jr(Io);function as(e,t){return(Is(e)?at:ei)(e,Kr(t,3))}function cs(e,t){return(Is(e)?ct:ti)(e,Kr(t,3))}var ls=br((function(e,t,n){Ee.call(e,n)?e[n].push(t):Gn(e,n,[t])}));var us=zi((function(e,t,n){var r=-1,o="function"==typeof t,s=Ds(e)?i(e.length):[];return ei(e,(function(e){s[++r]=o?ot(t,e,n):_i(e,t,n)})),s})),ds=br((function(e,t,n){Gn(e,n,t)}));function hs(e,t){return(Is(e)?ft:Ci)(e,Kr(t,3))}var fs=br((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]}));var ps=zi((function(e,t){if(null==e)return[];var n=t.length;return n>1&&ao(e,t[0],t[1])?t=[]:n>2&&ao(t[0],t[1],t[2])&&(t=[t[0]]),Mi(e,oi(t,1),[])})),gs=Kt||function(){return Ge.Date.now()};function ms(e,t,n){return t=n?void 0:t,Fr(e,128,void 0,void 0,void 0,void 0,t=e&&null==t?e.length:t)}function vs(e,t){var n;if("function"!=typeof t)throw new _e(o);return e=ia(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}}var _s=zi((function(e,t,n){var i=1;if(n.length){var r=Ut(n,Qr(_s));i|=32}return Fr(e,i,t,n,r)})),bs=zi((function(e,t,n){var i=3;if(n.length){var r=Ut(n,Qr(bs));i|=32}return Fr(t,i,e,n,r)}));function ys(e,t,n){var i,r,s,a,c,l,u=0,d=!1,h=!1,f=!0;if("function"!=typeof e)throw new _e(o);function p(t){var n=i,o=r;return i=r=void 0,u=t,a=e.apply(o,n)}function g(e){return u=e,c=yo(v,t),d?p(e):a}function m(e){var n=e-l;return void 0===l||n>=t||n<0||h&&e-u>=s}function v(){var e=gs();if(m(e))return _(e);c=yo(v,function(e){var n=t-(e-l);return h?an(n,s-(e-u)):n}(e))}function _(e){return c=void 0,f&&i?p(e):(i=r=void 0,a)}function b(){var e=gs(),n=m(e);if(i=arguments,r=this,l=e,n){if(void 0===c)return g(l);if(h)return ur(c),c=yo(v,t),p(l)}return void 0===c&&(c=yo(v,t)),a}return t=oa(t)||0,Hs(n)&&(d=!!n.leading,s=(h="maxWait"in n)?sn(oa(n.maxWait)||0,t):s,f="trailing"in n?!!n.trailing:f),b.cancel=function(){void 0!==c&&ur(c),u=0,i=l=r=c=void 0},b.flush=function(){return void 0===c?a:_(gs())},b}var ws=zi((function(e,t){return Xn(e,1,t)})),Ss=zi((function(e,t,n){return Xn(e,oa(t)||0,n)}));function xs(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new _e(o);var n=function(){var i=arguments,r=t?t.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var s=e.apply(this,i);return n.cache=o.set(r,s)||o,s};return n.cache=new(xs.Cache||Dn),n}function Es(e){if("function"!=typeof e)throw new _e(o);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}xs.Cache=Dn;var As=cr((function(e,t){var n=(t=1==t.length&&Is(t[0])?ft(t[0],Tt(Kr())):ft(oi(t,1),Tt(Kr()))).length;return zi((function(i){for(var r=-1,o=an(i.length,n);++r<o;)i[r]=t[r].call(this,i[r]);return ot(e,this,i)}))})),js=zi((function(e,t){return Fr(e,32,void 0,t,Ut(t,Qr(js)))})),Cs=zi((function(e,t){return Fr(e,64,void 0,t,Ut(t,Qr(Cs)))})),ks=$r((function(e,t){return Fr(e,256,void 0,void 0,void 0,t)}));function Os(e,t){return e===t||e!=e&&t!=t}var Ts=Rr(pi),Ns=Rr((function(e,t){return e>=t})),Ms=bi(function(){return arguments}())?bi:function(e){return $s(e)&&Ee.call(e,"callee")&&!Je.call(e,"callee")},Is=i.isArray,Rs=Ze?Tt(Ze):function(e){return $s(e)&&fi(e)==x};function Ds(e){return null!=e&&Us(e.length)&&!Bs(e)}function Ps(e){return $s(e)&&Ds(e)}var Ls=tn||oc,zs=et?Tt(et):function(e){return $s(e)&&fi(e)==d};function Fs(e){if(!$s(e))return!1;var t=fi(e);return t==h||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!Gs(e)}function Bs(e){if(!Hs(e))return!1;var t=fi(e);return t==f||t==p||"[object AsyncFunction]"==t||"[object Proxy]"==t}function qs(e){return"number"==typeof e&&e==ia(e)}function Us(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function Hs(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function $s(e){return null!=e&&"object"==typeof e}var Ws=tt?Tt(tt):function(e){return $s(e)&&no(e)==g};function Vs(e){return"number"==typeof e||$s(e)&&fi(e)==m}function Gs(e){if(!$s(e)||fi(e)!=v)return!1;var t=We(e);if(null===t)return!0;var n=Ee.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&xe.call(n)==ke}var Js=nt?Tt(nt):function(e){return $s(e)&&fi(e)==_};var Qs=it?Tt(it):function(e){return $s(e)&&no(e)==b};function Ks(e){return"string"==typeof e||!Is(e)&&$s(e)&&fi(e)==y}function Ys(e){return"symbol"==typeof e||$s(e)&&fi(e)==w}var Xs=rt?Tt(rt):function(e){return $s(e)&&Us(e.length)&&!!Be[fi(e)]};var Zs=Rr(ji),ea=Rr((function(e,t){return e<=t}));function ta(e){if(!e)return[];if(Ds(e))return Ks(e)?Vt(e):vr(e);if(Xe&&e[Xe])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[Xe]());var t=no(e);return(t==g?Bt:t==b?Ht:Oa)(e)}function na(e){return e?(e=oa(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function ia(e){var t=na(e),n=t%1;return t==t?n?t-n:t:0}function ra(e){return e?Qn(ia(e),0,4294967295):0}function oa(e){if("number"==typeof e)return e;if(Ys(e))return NaN;if(Hs(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Hs(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(J,"");var n=oe.test(e);return n||ae.test(e)?$e(e.slice(2),n?2:8):re.test(e)?NaN:+e}function sa(e){return _r(e,wa(e))}function aa(e){return null==e?"":Yi(e)}var ca=yr((function(e,t){if(ho(t)||Ds(t))_r(t,ya(t),e);else for(var n in t)Ee.call(t,n)&&Hn(e,n,t[n])})),la=yr((function(e,t){_r(t,wa(t),e)})),ua=yr((function(e,t,n,i){_r(t,wa(t),e,i)})),da=yr((function(e,t,n,i){_r(t,ya(t),e,i)})),ha=$r(Jn);var fa=zi((function(e,t){e=ge(e);var n=-1,i=t.length,r=i>2?t[2]:void 0;for(r&&ao(t[0],t[1],r)&&(i=1);++n<i;)for(var o=t[n],s=wa(o),a=-1,c=s.length;++a<c;){var l=s[a],u=e[l];(void 0===u||Os(u,we[l])&&!Ee.call(e,l))&&(e[l]=o[l])}return e})),pa=zi((function(e){return e.push(void 0,qr),ot(xa,void 0,e)}));function ga(e,t,n){var i=null==e?void 0:di(e,t);return void 0===i?n:i}function ma(e,t){return null!=e&&io(e,t,mi)}var va=Or((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Ce.call(t)),e[t]=n}),Ha(Va)),_a=Or((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Ce.call(t)),Ee.call(e,t)?e[t].push(n):e[t]=[n]}),Kr),ba=zi(_i);function ya(e){return Ds(e)?zn(e):Ei(e)}function wa(e){return Ds(e)?zn(e,!0):Ai(e)}var Sa=yr((function(e,t,n){Ti(e,t,n)})),xa=yr((function(e,t,n,i){Ti(e,t,n,i)})),Ea=$r((function(e,t){var n={};if(null==e)return n;var i=!1;t=ft(t,(function(t){return t=ar(t,e),i||(i=t.length>1),t})),_r(e,Vr(e),n),i&&(n=Kn(n,7,Ur));for(var r=t.length;r--;)Zi(n,t[r]);return n}));var Aa=$r((function(e,t){return null==e?{}:function(e,t){return Ii(e,t,(function(t,n){return ma(e,n)}))}(e,t)}));function ja(e,t){if(null==e)return{};var n=ft(Vr(e),(function(e){return[e]}));return t=Kr(t),Ii(e,n,(function(e,n){return t(e,n[0])}))}var Ca=zr(ya),ka=zr(wa);function Oa(e){return null==e?[]:Nt(e,ya(e))}var Ta=Er((function(e,t,n){return t=t.toLowerCase(),e+(n?Na(t):t)}));function Na(e){return Fa(aa(e).toLowerCase())}function Ma(e){return(e=aa(e))&&e.replace(le,Pt).replace(Ie,"")}var Ia=Er((function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),Ra=Er((function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),Da=xr("toLowerCase");var Pa=Er((function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}));var La=Er((function(e,t,n){return e+(n?" ":"")+Fa(t)}));var za=Er((function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),Fa=xr("toUpperCase");function Ba(e,t,n){return e=aa(e),void 0===(t=n?void 0:t)?function(e){return Le.test(e)}(e)?function(e){return e.match(De)||[]}(e):function(e){return e.match(ee)||[]}(e):e.match(t)||[]}var qa=zi((function(e,t){try{return ot(e,void 0,t)}catch(e){return Fs(e)?e:new he(e)}})),Ua=$r((function(e,t){return at(t,(function(t){t=jo(t),Gn(e,t,_s(e[t],e))})),e}));function Ha(e){return function(){return e}}var $a=Cr(),Wa=Cr(!0);function Va(e){return e}function Ga(e){return xi("function"==typeof e?e:Kn(e,1))}var Ja=zi((function(e,t){return function(n){return _i(n,e,t)}})),Qa=zi((function(e,t){return function(n){return _i(e,n,t)}}));function Ka(e,t,n){var i=ya(t),r=ui(t,i);null!=n||Hs(t)&&(r.length||!i.length)||(n=t,t=e,e=this,r=ui(t,ya(t)));var o=!(Hs(n)&&"chain"in n&&!n.chain),s=Bs(e);return at(r,(function(n){var i=t[n];e[n]=i,s&&(e.prototype[n]=function(){var t=this.__chain__;if(o||t){var n=e(this.__wrapped__),r=n.__actions__=vr(this.__actions__);return r.push({func:i,args:arguments,thisArg:e}),n.__chain__=t,n}return i.apply(e,pt([this.value()],arguments))})})),e}function Ya(){}var Xa=Nr(ft),Za=Nr(lt),ec=Nr(vt);function tc(e){return co(e)?At(jo(e)):function(e){return function(t){return di(t,e)}}(e)}var nc=Ir(),ic=Ir(!0);function rc(){return[]}function oc(){return!1}var sc=Tr((function(e,t){return e+t}),0),ac=Pr("ceil"),cc=Tr((function(e,t){return e/t}),1),lc=Pr("floor");var uc,dc=Tr((function(e,t){return e*t}),1),hc=Pr("round"),fc=Tr((function(e,t){return e-t}),0);return kn.after=function(e,t){if("function"!=typeof t)throw new _e(o);return e=ia(e),function(){if(--e<1)return t.apply(this,arguments)}},kn.ary=ms,kn.assign=ca,kn.assignIn=la,kn.assignInWith=ua,kn.assignWith=da,kn.at=ha,kn.before=vs,kn.bind=_s,kn.bindAll=Ua,kn.bindKey=bs,kn.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Is(e)?e:[e]},kn.chain=ts,kn.chunk=function(e,t,n){t=(n?ao(e,t,n):void 0===t)?1:sn(ia(t),0);var r=null==e?0:e.length;if(!r||t<1)return[];for(var o=0,s=0,a=i(Xt(r/t));o<r;)a[s++]=Wi(e,o,o+=t);return a},kn.compact=function(e){for(var t=-1,n=null==e?0:e.length,i=0,r=[];++t<n;){var o=e[t];o&&(r[i++]=o)}return r},kn.concat=function(){var e=arguments.length;if(!e)return[];for(var t=i(e-1),n=arguments[0],r=e;r--;)t[r-1]=arguments[r];return pt(Is(n)?vr(n):[n],oi(t,1))},kn.cond=function(e){var t=null==e?0:e.length,n=Kr();return e=t?ft(e,(function(e){if("function"!=typeof e[1])throw new _e(o);return[n(e[0]),e[1]]})):[],zi((function(n){for(var i=-1;++i<t;){var r=e[i];if(ot(r[0],this,n))return ot(r[1],this,n)}}))},kn.conforms=function(e){return function(e){var t=ya(e);return function(n){return Yn(n,e,t)}}(Kn(e,1))},kn.constant=Ha,kn.countBy=rs,kn.create=function(e,t){var n=On(e);return null==t?n:Vn(n,t)},kn.curry=function e(t,n,i){var r=Fr(t,8,void 0,void 0,void 0,void 0,void 0,n=i?void 0:n);return r.placeholder=e.placeholder,r},kn.curryRight=function e(t,n,i){var r=Fr(t,16,void 0,void 0,void 0,void 0,void 0,n=i?void 0:n);return r.placeholder=e.placeholder,r},kn.debounce=ys,kn.defaults=fa,kn.defaultsDeep=pa,kn.defer=ws,kn.delay=Ss,kn.difference=Oo,kn.differenceBy=To,kn.differenceWith=No,kn.drop=function(e,t,n){var i=null==e?0:e.length;return i?Wi(e,(t=n||void 0===t?1:ia(t))<0?0:t,i):[]},kn.dropRight=function(e,t,n){var i=null==e?0:e.length;return i?Wi(e,0,(t=i-(t=n||void 0===t?1:ia(t)))<0?0:t):[]},kn.dropRightWhile=function(e,t){return e&&e.length?tr(e,Kr(t,3),!0,!0):[]},kn.dropWhile=function(e,t){return e&&e.length?tr(e,Kr(t,3),!0):[]},kn.fill=function(e,t,n,i){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&ao(e,t,n)&&(n=0,i=r),function(e,t,n,i){var r=e.length;for((n=ia(n))<0&&(n=-n>r?0:r+n),(i=void 0===i||i>r?r:ia(i))<0&&(i+=r),i=n>i?0:ra(i);n<i;)e[n++]=t;return e}(e,t,n,i)):[]},kn.filter=function(e,t){return(Is(e)?ut:ri)(e,Kr(t,3))},kn.flatMap=function(e,t){return oi(hs(e,t),1)},kn.flatMapDeep=function(e,t){return oi(hs(e,t),1/0)},kn.flatMapDepth=function(e,t,n){return n=void 0===n?1:ia(n),oi(hs(e,t),n)},kn.flatten=Ro,kn.flattenDeep=function(e){return(null==e?0:e.length)?oi(e,1/0):[]},kn.flattenDepth=function(e,t){return(null==e?0:e.length)?oi(e,t=void 0===t?1:ia(t)):[]},kn.flip=function(e){return Fr(e,512)},kn.flow=$a,kn.flowRight=Wa,kn.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,i={};++t<n;){var r=e[t];i[r[0]]=r[1]}return i},kn.functions=function(e){return null==e?[]:ui(e,ya(e))},kn.functionsIn=function(e){return null==e?[]:ui(e,wa(e))},kn.groupBy=ls,kn.initial=function(e){return(null==e?0:e.length)?Wi(e,0,-1):[]},kn.intersection=Po,kn.intersectionBy=Lo,kn.intersectionWith=zo,kn.invert=va,kn.invertBy=_a,kn.invokeMap=us,kn.iteratee=Ga,kn.keyBy=ds,kn.keys=ya,kn.keysIn=wa,kn.map=hs,kn.mapKeys=function(e,t){var n={};return t=Kr(t,3),ci(e,(function(e,i,r){Gn(n,t(e,i,r),e)})),n},kn.mapValues=function(e,t){var n={};return t=Kr(t,3),ci(e,(function(e,i,r){Gn(n,i,t(e,i,r))})),n},kn.matches=function(e){return ki(Kn(e,1))},kn.matchesProperty=function(e,t){return Oi(e,Kn(t,1))},kn.memoize=xs,kn.merge=Sa,kn.mergeWith=xa,kn.method=Ja,kn.methodOf=Qa,kn.mixin=Ka,kn.negate=Es,kn.nthArg=function(e){return e=ia(e),zi((function(t){return Ni(t,e)}))},kn.omit=Ea,kn.omitBy=function(e,t){return ja(e,Es(Kr(t)))},kn.once=function(e){return vs(2,e)},kn.orderBy=function(e,t,n,i){return null==e?[]:(Is(t)||(t=null==t?[]:[t]),Is(n=i?void 0:n)||(n=null==n?[]:[n]),Mi(e,t,n))},kn.over=Xa,kn.overArgs=As,kn.overEvery=Za,kn.overSome=ec,kn.partial=js,kn.partialRight=Cs,kn.partition=fs,kn.pick=Aa,kn.pickBy=ja,kn.property=tc,kn.propertyOf=function(e){return function(t){return null==e?void 0:di(e,t)}},kn.pull=Bo,kn.pullAll=qo,kn.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?Ri(e,t,Kr(n,2)):e},kn.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?Ri(e,t,void 0,n):e},kn.pullAt=Uo,kn.range=nc,kn.rangeRight=ic,kn.rearg=ks,kn.reject=function(e,t){return(Is(e)?ut:ri)(e,Es(Kr(t,3)))},kn.remove=function(e,t){var n=[];if(!e||!e.length)return n;var i=-1,r=[],o=e.length;for(t=Kr(t,3);++i<o;){var s=e[i];t(s,i,e)&&(n.push(s),r.push(i))}return Di(e,r),n},kn.rest=function(e,t){if("function"!=typeof e)throw new _e(o);return zi(e,t=void 0===t?t:ia(t))},kn.reverse=Ho,kn.sampleSize=function(e,t,n){return t=(n?ao(e,t,n):void 0===t)?1:ia(t),(Is(e)?Bn:Bi)(e,t)},kn.set=function(e,t,n){return null==e?e:qi(e,t,n)},kn.setWith=function(e,t,n,i){return i="function"==typeof i?i:void 0,null==e?e:qi(e,t,n,i)},kn.shuffle=function(e){return(Is(e)?qn:$i)(e)},kn.slice=function(e,t,n){var i=null==e?0:e.length;return i?(n&&"number"!=typeof n&&ao(e,t,n)?(t=0,n=i):(t=null==t?0:ia(t),n=void 0===n?i:ia(n)),Wi(e,t,n)):[]},kn.sortBy=ps,kn.sortedUniq=function(e){return e&&e.length?Qi(e):[]},kn.sortedUniqBy=function(e,t){return e&&e.length?Qi(e,Kr(t,2)):[]},kn.split=function(e,t,n){return n&&"number"!=typeof n&&ao(e,t,n)&&(t=n=void 0),(n=void 0===n?4294967295:n>>>0)?(e=aa(e))&&("string"==typeof t||null!=t&&!Js(t))&&!(t=Yi(t))&&Ft(e)?lr(Vt(e),0,n):e.split(t,n):[]},kn.spread=function(e,t){if("function"!=typeof e)throw new _e(o);return t=null==t?0:sn(ia(t),0),zi((function(n){var i=n[t],r=lr(n,0,t);return i&&pt(r,i),ot(e,this,r)}))},kn.tail=function(e){var t=null==e?0:e.length;return t?Wi(e,1,t):[]},kn.take=function(e,t,n){return e&&e.length?Wi(e,0,(t=n||void 0===t?1:ia(t))<0?0:t):[]},kn.takeRight=function(e,t,n){var i=null==e?0:e.length;return i?Wi(e,(t=i-(t=n||void 0===t?1:ia(t)))<0?0:t,i):[]},kn.takeRightWhile=function(e,t){return e&&e.length?tr(e,Kr(t,3),!1,!0):[]},kn.takeWhile=function(e,t){return e&&e.length?tr(e,Kr(t,3)):[]},kn.tap=function(e,t){return t(e),e},kn.throttle=function(e,t,n){var i=!0,r=!0;if("function"!=typeof e)throw new _e(o);return Hs(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),ys(e,t,{leading:i,maxWait:t,trailing:r})},kn.thru=ns,kn.toArray=ta,kn.toPairs=Ca,kn.toPairsIn=ka,kn.toPath=function(e){return Is(e)?ft(e,jo):Ys(e)?[e]:vr(Ao(aa(e)))},kn.toPlainObject=sa,kn.transform=function(e,t,n){var i=Is(e),r=i||Ls(e)||Xs(e);if(t=Kr(t,4),null==n){var o=e&&e.constructor;n=r?i?new o:[]:Hs(e)&&Bs(o)?On(We(e)):{}}return(r?at:ci)(e,(function(e,i,r){return t(n,e,i,r)})),n},kn.unary=function(e){return ms(e,1)},kn.union=$o,kn.unionBy=Wo,kn.unionWith=Vo,kn.uniq=function(e){return e&&e.length?Xi(e):[]},kn.uniqBy=function(e,t){return e&&e.length?Xi(e,Kr(t,2)):[]},kn.uniqWith=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?Xi(e,void 0,t):[]},kn.unset=function(e,t){return null==e||Zi(e,t)},kn.unzip=Go,kn.unzipWith=Jo,kn.update=function(e,t,n){return null==e?e:er(e,t,sr(n))},kn.updateWith=function(e,t,n,i){return i="function"==typeof i?i:void 0,null==e?e:er(e,t,sr(n),i)},kn.values=Oa,kn.valuesIn=function(e){return null==e?[]:Nt(e,wa(e))},kn.without=Qo,kn.words=Ba,kn.wrap=function(e,t){return js(sr(t),e)},kn.xor=Ko,kn.xorBy=Yo,kn.xorWith=Xo,kn.zip=Zo,kn.zipObject=function(e,t){return rr(e||[],t||[],Hn)},kn.zipObjectDeep=function(e,t){return rr(e||[],t||[],qi)},kn.zipWith=es,kn.entries=Ca,kn.entriesIn=ka,kn.extend=la,kn.extendWith=ua,Ka(kn,kn),kn.add=sc,kn.attempt=qa,kn.camelCase=Ta,kn.capitalize=Na,kn.ceil=ac,kn.clamp=function(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=oa(n))==n?n:0),void 0!==t&&(t=(t=oa(t))==t?t:0),Qn(oa(e),t,n)},kn.clone=function(e){return Kn(e,4)},kn.cloneDeep=function(e){return Kn(e,5)},kn.cloneDeepWith=function(e,t){return Kn(e,5,t="function"==typeof t?t:void 0)},kn.cloneWith=function(e,t){return Kn(e,4,t="function"==typeof t?t:void 0)},kn.conformsTo=function(e,t){return null==t||Yn(e,t,ya(t))},kn.deburr=Ma,kn.defaultTo=function(e,t){return null==e||e!=e?t:e},kn.divide=cc,kn.endsWith=function(e,t,n){e=aa(e),t=Yi(t);var i=e.length,r=n=void 0===n?i:Qn(ia(n),0,i);return(n-=t.length)>=0&&e.slice(n,r)==t},kn.eq=Os,kn.escape=function(e){return(e=aa(e))&&F.test(e)?e.replace(L,Lt):e},kn.escapeRegExp=function(e){return(e=aa(e))&&G.test(e)?e.replace(V,"\\$&"):e},kn.every=function(e,t,n){var i=Is(e)?lt:ni;return n&&ao(e,t,n)&&(t=void 0),i(e,Kr(t,3))},kn.find=os,kn.findIndex=Mo,kn.findKey=function(e,t){return bt(e,Kr(t,3),ci)},kn.findLast=ss,kn.findLastIndex=Io,kn.findLastKey=function(e,t){return bt(e,Kr(t,3),li)},kn.floor=lc,kn.forEach=as,kn.forEachRight=cs,kn.forIn=function(e,t){return null==e?e:si(e,Kr(t,3),wa)},kn.forInRight=function(e,t){return null==e?e:ai(e,Kr(t,3),wa)},kn.forOwn=function(e,t){return e&&ci(e,Kr(t,3))},kn.forOwnRight=function(e,t){return e&&li(e,Kr(t,3))},kn.get=ga,kn.gt=Ts,kn.gte=Ns,kn.has=function(e,t){return null!=e&&io(e,t,gi)},kn.hasIn=ma,kn.head=Do,kn.identity=Va,kn.includes=function(e,t,n,i){e=Ds(e)?e:Oa(e),n=n&&!i?ia(n):0;var r=e.length;return n<0&&(n=sn(r+n,0)),Ks(e)?n<=r&&e.indexOf(t,n)>-1:!!r&&wt(e,t,n)>-1},kn.indexOf=function(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=null==n?0:ia(n);return r<0&&(r=sn(i+r,0)),wt(e,t,r)},kn.inRange=function(e,t,n){return t=na(t),void 0===n?(n=t,t=0):n=na(n),function(e,t,n){return e>=an(t,n)&&e<sn(t,n)}(e=oa(e),t,n)},kn.invoke=ba,kn.isArguments=Ms,kn.isArray=Is,kn.isArrayBuffer=Rs,kn.isArrayLike=Ds,kn.isArrayLikeObject=Ps,kn.isBoolean=function(e){return!0===e||!1===e||$s(e)&&fi(e)==u},kn.isBuffer=Ls,kn.isDate=zs,kn.isElement=function(e){return $s(e)&&1===e.nodeType&&!Gs(e)},kn.isEmpty=function(e){if(null==e)return!0;if(Ds(e)&&(Is(e)||"string"==typeof e||"function"==typeof e.splice||Ls(e)||Xs(e)||Ms(e)))return!e.length;var t=no(e);if(t==g||t==b)return!e.size;if(ho(e))return!Ei(e).length;for(var n in e)if(Ee.call(e,n))return!1;return!0},kn.isEqual=function(e,t){return yi(e,t)},kn.isEqualWith=function(e,t,n){var i=(n="function"==typeof n?n:void 0)?n(e,t):void 0;return void 0===i?yi(e,t,void 0,n):!!i},kn.isError=Fs,kn.isFinite=function(e){return"number"==typeof e&&nn(e)},kn.isFunction=Bs,kn.isInteger=qs,kn.isLength=Us,kn.isMap=Ws,kn.isMatch=function(e,t){return e===t||wi(e,t,Xr(t))},kn.isMatchWith=function(e,t,n){return n="function"==typeof n?n:void 0,wi(e,t,Xr(t),n)},kn.isNaN=function(e){return Vs(e)&&e!=+e},kn.isNative=function(e){if(uo(e))throw new he("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Si(e)},kn.isNil=function(e){return null==e},kn.isNull=function(e){return null===e},kn.isNumber=Vs,kn.isObject=Hs,kn.isObjectLike=$s,kn.isPlainObject=Gs,kn.isRegExp=Js,kn.isSafeInteger=function(e){return qs(e)&&e>=-9007199254740991&&e<=9007199254740991},kn.isSet=Qs,kn.isString=Ks,kn.isSymbol=Ys,kn.isTypedArray=Xs,kn.isUndefined=function(e){return void 0===e},kn.isWeakMap=function(e){return $s(e)&&no(e)==S},kn.isWeakSet=function(e){return $s(e)&&"[object WeakSet]"==fi(e)},kn.join=function(e,t){return null==e?"":rn.call(e,t)},kn.kebabCase=Ia,kn.last=Fo,kn.lastIndexOf=function(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=i;return void 0!==n&&(r=(r=ia(n))<0?sn(i+r,0):an(r,i-1)),t==t?function(e,t,n){for(var i=n+1;i--;)if(e[i]===t)return i;return i}(e,t,r):yt(e,xt,r,!0)},kn.lowerCase=Ra,kn.lowerFirst=Da,kn.lt=Zs,kn.lte=ea,kn.max=function(e){return e&&e.length?ii(e,Va,pi):void 0},kn.maxBy=function(e,t){return e&&e.length?ii(e,Kr(t,2),pi):void 0},kn.mean=function(e){return Et(e,Va)},kn.meanBy=function(e,t){return Et(e,Kr(t,2))},kn.min=function(e){return e&&e.length?ii(e,Va,ji):void 0},kn.minBy=function(e,t){return e&&e.length?ii(e,Kr(t,2),ji):void 0},kn.stubArray=rc,kn.stubFalse=oc,kn.stubObject=function(){return{}},kn.stubString=function(){return""},kn.stubTrue=function(){return!0},kn.multiply=dc,kn.nth=function(e,t){return e&&e.length?Ni(e,ia(t)):void 0},kn.noConflict=function(){return Ge._===this&&(Ge._=Oe),this},kn.noop=Ya,kn.now=gs,kn.pad=function(e,t,n){e=aa(e);var i=(t=ia(t))?Wt(e):0;if(!t||i>=t)return e;var r=(t-i)/2;return Mr(Zt(r),n)+e+Mr(Xt(r),n)},kn.padEnd=function(e,t,n){e=aa(e);var i=(t=ia(t))?Wt(e):0;return t&&i<t?e+Mr(t-i,n):e},kn.padStart=function(e,t,n){e=aa(e);var i=(t=ia(t))?Wt(e):0;return t&&i<t?Mr(t-i,n)+e:e},kn.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),ln(aa(e).replace(Q,""),t||0)},kn.random=function(e,t,n){if(n&&"boolean"!=typeof n&&ao(e,t,n)&&(t=n=void 0),void 0===n&&("boolean"==typeof t?(n=t,t=void 0):"boolean"==typeof e&&(n=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=na(e),void 0===t?(t=e,e=0):t=na(t)),e>t){var i=e;e=t,t=i}if(n||e%1||t%1){var r=un();return an(e+r*(t-e+He("1e-"+((r+"").length-1))),t)}return Pi(e,t)},kn.reduce=function(e,t,n){var i=Is(e)?gt:Ct,r=arguments.length<3;return i(e,Kr(t,4),n,r,ei)},kn.reduceRight=function(e,t,n){var i=Is(e)?mt:Ct,r=arguments.length<3;return i(e,Kr(t,4),n,r,ti)},kn.repeat=function(e,t,n){return t=(n?ao(e,t,n):void 0===t)?1:ia(t),Li(aa(e),t)},kn.replace=function(){var e=arguments,t=aa(e[0]);return e.length<3?t:t.replace(e[1],e[2])},kn.result=function(e,t,n){var i=-1,r=(t=ar(t,e)).length;for(r||(r=1,e=void 0);++i<r;){var o=null==e?void 0:e[jo(t[i])];void 0===o&&(i=r,o=n),e=Bs(o)?o.call(e):o}return e},kn.round=hc,kn.runInContext=e,kn.sample=function(e){return(Is(e)?Fn:Fi)(e)},kn.size=function(e){if(null==e)return 0;if(Ds(e))return Ks(e)?Wt(e):e.length;var t=no(e);return t==g||t==b?e.size:Ei(e).length},kn.snakeCase=Pa,kn.some=function(e,t,n){var i=Is(e)?vt:Vi;return n&&ao(e,t,n)&&(t=void 0),i(e,Kr(t,3))},kn.sortedIndex=function(e,t){return Gi(e,t)},kn.sortedIndexBy=function(e,t,n){return Ji(e,t,Kr(n,2))},kn.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var i=Gi(e,t);if(i<n&&Os(e[i],t))return i}return-1},kn.sortedLastIndex=function(e,t){return Gi(e,t,!0)},kn.sortedLastIndexBy=function(e,t,n){return Ji(e,t,Kr(n,2),!0)},kn.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var n=Gi(e,t,!0)-1;if(Os(e[n],t))return n}return-1},kn.startCase=La,kn.startsWith=function(e,t,n){return e=aa(e),n=null==n?0:Qn(ia(n),0,e.length),t=Yi(t),e.slice(n,n+t.length)==t},kn.subtract=fc,kn.sum=function(e){return e&&e.length?kt(e,Va):0},kn.sumBy=function(e,t){return e&&e.length?kt(e,Kr(t,2)):0},kn.template=function(e,t,n){var i=kn.templateSettings;n&&ao(e,t,n)&&(t=void 0),e=aa(e),t=ua({},t,i,Br);var r,o,s=ua({},t.imports,i.imports,Br),a=ya(s),c=Nt(s,a),l=0,u=t.interpolate||ue,d="__p += '",h=me((t.escape||ue).source+"|"+u.source+"|"+(u===U?ne:ue).source+"|"+(t.evaluate||ue).source+"|$","g"),f="//# sourceURL="+(Ee.call(t,"sourceURL")?(t.sourceURL+"").replace(/[\r\n]/g," "):"lodash.templateSources["+ ++Fe+"]")+"\n";e.replace(h,(function(t,n,i,s,a,c){return i||(i=s),d+=e.slice(l,c).replace(de,zt),n&&(r=!0,d+="' +\n__e("+n+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),i&&(d+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),l=c+t.length,t})),d+="';\n";var p=Ee.call(t,"variable")&&t.variable;p||(d="with (obj) {\n"+d+"\n}\n"),d=(o?d.replace(I,""):d).replace(R,"$1").replace(D,"$1;"),d="function("+(p||"obj")+") {\n"+(p?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(r?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=qa((function(){return fe(a,f+"return "+d).apply(void 0,c)}));if(g.source=d,Fs(g))throw g;return g},kn.times=function(e,t){if((e=ia(e))<1||e>9007199254740991)return[];var n=4294967295,i=an(e,4294967295);e-=4294967295;for(var r=Ot(i,t=Kr(t));++n<e;)t(n);return r},kn.toFinite=na,kn.toInteger=ia,kn.toLength=ra,kn.toLower=function(e){return aa(e).toLowerCase()},kn.toNumber=oa,kn.toSafeInteger=function(e){return e?Qn(ia(e),-9007199254740991,9007199254740991):0===e?e:0},kn.toString=aa,kn.toUpper=function(e){return aa(e).toUpperCase()},kn.trim=function(e,t,n){if((e=aa(e))&&(n||void 0===t))return e.replace(J,"");if(!e||!(t=Yi(t)))return e;var i=Vt(e),r=Vt(t);return lr(i,It(i,r),Rt(i,r)+1).join("")},kn.trimEnd=function(e,t,n){if((e=aa(e))&&(n||void 0===t))return e.replace(K,"");if(!e||!(t=Yi(t)))return e;var i=Vt(e);return lr(i,0,Rt(i,Vt(t))+1).join("")},kn.trimStart=function(e,t,n){if((e=aa(e))&&(n||void 0===t))return e.replace(Q,"");if(!e||!(t=Yi(t)))return e;var i=Vt(e);return lr(i,It(i,Vt(t))).join("")},kn.truncate=function(e,t){var n=30,i="...";if(Hs(t)){var r="separator"in t?t.separator:r;n="length"in t?ia(t.length):n,i="omission"in t?Yi(t.omission):i}var o=(e=aa(e)).length;if(Ft(e)){var s=Vt(e);o=s.length}if(n>=o)return e;var a=n-Wt(i);if(a<1)return i;var c=s?lr(s,0,a).join(""):e.slice(0,a);if(void 0===r)return c+i;if(s&&(a+=c.length-a),Js(r)){if(e.slice(a).search(r)){var l,u=c;for(r.global||(r=me(r.source,aa(ie.exec(r))+"g")),r.lastIndex=0;l=r.exec(u);)var d=l.index;c=c.slice(0,void 0===d?a:d)}}else if(e.indexOf(Yi(r),a)!=a){var h=c.lastIndexOf(r);h>-1&&(c=c.slice(0,h))}return c+i},kn.unescape=function(e){return(e=aa(e))&&z.test(e)?e.replace(P,Gt):e},kn.uniqueId=function(e){var t=++Ae;return aa(e)+t},kn.upperCase=za,kn.upperFirst=Fa,kn.each=as,kn.eachRight=cs,kn.first=Do,Ka(kn,(uc={},ci(kn,(function(e,t){Ee.call(kn.prototype,t)||(uc[t]=e)})),uc),{chain:!1}),kn.VERSION="4.17.15",at(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){kn[e].placeholder=kn})),at(["drop","take"],(function(e,t){Mn.prototype[e]=function(n){n=void 0===n?1:sn(ia(n),0);var i=this.__filtered__&&!t?new Mn(this):this.clone();return i.__filtered__?i.__takeCount__=an(n,i.__takeCount__):i.__views__.push({size:an(n,4294967295),type:e+(i.__dir__<0?"Right":"")}),i},Mn.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),at(["filter","map","takeWhile"],(function(e,t){var n=t+1,i=1==n||3==n;Mn.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Kr(e,3),type:n}),t.__filtered__=t.__filtered__||i,t}})),at(["head","last"],(function(e,t){var n="take"+(t?"Right":"");Mn.prototype[e]=function(){return this[n](1).value()[0]}})),at(["initial","tail"],(function(e,t){var n="drop"+(t?"":"Right");Mn.prototype[e]=function(){return this.__filtered__?new Mn(this):this[n](1)}})),Mn.prototype.compact=function(){return this.filter(Va)},Mn.prototype.find=function(e){return this.filter(e).head()},Mn.prototype.findLast=function(e){return this.reverse().find(e)},Mn.prototype.invokeMap=zi((function(e,t){return"function"==typeof e?new Mn(this):this.map((function(n){return _i(n,e,t)}))})),Mn.prototype.reject=function(e){return this.filter(Es(Kr(e)))},Mn.prototype.slice=function(e,t){e=ia(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Mn(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),void 0!==t&&(n=(t=ia(t))<0?n.dropRight(-t):n.take(t-e)),n)},Mn.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Mn.prototype.toArray=function(){return this.take(4294967295)},ci(Mn.prototype,(function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),i=/^(?:head|last)$/.test(t),r=kn[i?"take"+("last"==t?"Right":""):t],o=i||/^find/.test(t);r&&(kn.prototype[t]=function(){var t=this.__wrapped__,s=i?[1]:arguments,a=t instanceof Mn,c=s[0],l=a||Is(t),u=function(e){var t=r.apply(kn,pt([e],s));return i&&d?t[0]:t};l&&n&&"function"==typeof c&&1!=c.length&&(a=l=!1);var d=this.__chain__,h=!!this.__actions__.length,f=o&&!d,p=a&&!h;if(!o&&l){t=p?t:new Mn(this);var g=e.apply(t,s);return g.__actions__.push({func:ns,args:[u],thisArg:void 0}),new Nn(g,d)}return f&&p?e.apply(this,s):(g=this.thru(u),f?i?g.value()[0]:g.value():g)})})),at(["pop","push","shift","sort","splice","unshift"],(function(e){var t=be[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);kn.prototype[e]=function(){var e=arguments;if(i&&!this.__chain__){var r=this.value();return t.apply(Is(r)?r:[],e)}return this[n]((function(n){return t.apply(Is(n)?n:[],e)}))}})),ci(Mn.prototype,(function(e,t){var n=kn[t];if(n){var i=n.name+"";Ee.call(bn,i)||(bn[i]=[]),bn[i].push({name:t,func:n})}})),bn[kr(void 0,2).name]=[{name:"wrapper",func:void 0}],Mn.prototype.clone=function(){var e=new Mn(this.__wrapped__);return e.__actions__=vr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=vr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=vr(this.__views__),e},Mn.prototype.reverse=function(){if(this.__filtered__){var e=new Mn(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Mn.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=Is(e),i=t<0,r=n?e.length:0,o=function(e,t,n){var i=-1,r=n.length;for(;++i<r;){var o=n[i],s=o.size;switch(o.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=an(t,e+s);break;case"takeRight":e=sn(e,t-s)}}return{start:e,end:t}}(0,r,this.__views__),s=o.start,a=o.end,c=a-s,l=i?a:s-1,u=this.__iteratees__,d=u.length,h=0,f=an(c,this.__takeCount__);if(!n||!i&&r==c&&f==c)return nr(e,this.__actions__);var p=[];e:for(;c--&&h<f;){for(var g=-1,m=e[l+=t];++g<d;){var v=u[g],_=v.iteratee,b=v.type,y=_(m);if(2==b)m=y;else if(!y){if(1==b)continue e;break e}}p[h++]=m}return p},kn.prototype.at=is,kn.prototype.chain=function(){return ts(this)},kn.prototype.commit=function(){return new Nn(this.value(),this.__chain__)},kn.prototype.next=function(){void 0===this.__values__&&(this.__values__=ta(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?void 0:this.__values__[this.__index__++]}},kn.prototype.plant=function(e){for(var t,n=this;n instanceof Tn;){var i=ko(n);i.__index__=0,i.__values__=void 0,t?r.__wrapped__=i:t=i;var r=i;n=n.__wrapped__}return r.__wrapped__=e,t},kn.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Mn){var t=e;return this.__actions__.length&&(t=new Mn(this)),(t=t.reverse()).__actions__.push({func:ns,args:[Ho],thisArg:void 0}),new Nn(t,this.__chain__)}return this.thru(Ho)},kn.prototype.toJSON=kn.prototype.valueOf=kn.prototype.value=function(){return nr(this.__wrapped__,this.__actions__)},kn.prototype.first=kn.prototype.head,Xe&&(kn.prototype[Xe]=function(){return this}),kn}();Ge._=Jt,void 0===(r=function(){return Jt}.call(t,n,t,i))||(i.exports=r)}).call(this)}).call(this,n(9),n(21)(e))},function(e,t,n){(function(e,i){var r;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var o="Expected a function",s="__lodash_placeholder__",a=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],c="[object Arguments]",l="[object Array]",u="[object Boolean]",d="[object Date]",h="[object Error]",f="[object Function]",p="[object GeneratorFunction]",g="[object Map]",m="[object Number]",v="[object Object]",_="[object RegExp]",b="[object Set]",y="[object String]",w="[object Symbol]",S="[object WeakMap]",x="[object ArrayBuffer]",E="[object DataView]",A="[object Float32Array]",j="[object Float64Array]",C="[object Int8Array]",k="[object Int16Array]",O="[object Int32Array]",T="[object Uint8Array]",N="[object Uint16Array]",M="[object Uint32Array]",I=/\b__p \+= '';/g,R=/\b(__p \+=) '' \+/g,D=/(__e\(.*?\)|\b__t\)) \+\n'';/g,P=/&(?:amp|lt|gt|quot|#39);/g,L=/[&<>"']/g,z=RegExp(P.source),F=RegExp(L.source),B=/<%-([\s\S]+?)%>/g,q=/<%([\s\S]+?)%>/g,U=/<%=([\s\S]+?)%>/g,H=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$=/^\w*$/,W=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,V=/[\\^$.*+?()[\]{}|]/g,G=RegExp(V.source),J=/^\s+|\s+$/g,Q=/^\s+/,K=/\s+$/,Y=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,X=/\{\n\/\* \[wrapped with (.+)\] \*/,Z=/,? & /,ee=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,te=/\\(\\)?/g,ne=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ie=/\w*$/,re=/^[-+]0x[0-9a-f]+$/i,oe=/^0b[01]+$/i,se=/^\[object .+?Constructor\]$/,ae=/^0o[0-7]+$/i,ce=/^(?:0|[1-9]\d*)$/,le=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ue=/($^)/,de=/['\n\r\u2028\u2029\\]/g,he="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",fe="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",pe="[\\ud800-\\udfff]",ge="["+fe+"]",me="["+he+"]",ve="\\d+",_e="[\\u2700-\\u27bf]",be="[a-z\\xdf-\\xf6\\xf8-\\xff]",ye="[^\\ud800-\\udfff"+fe+ve+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",we="\\ud83c[\\udffb-\\udfff]",Se="[^\\ud800-\\udfff]",xe="(?:\\ud83c[\\udde6-\\uddff]){2}",Ee="[\\ud800-\\udbff][\\udc00-\\udfff]",Ae="[A-Z\\xc0-\\xd6\\xd8-\\xde]",je="(?:"+be+"|"+ye+")",Ce="(?:"+Ae+"|"+ye+")",ke="(?:"+me+"|"+we+")"+"?",Oe="[\\ufe0e\\ufe0f]?"+ke+("(?:\\u200d(?:"+[Se,xe,Ee].join("|")+")[\\ufe0e\\ufe0f]?"+ke+")*"),Te="(?:"+[_e,xe,Ee].join("|")+")"+Oe,Ne="(?:"+[Se+me+"?",me,xe,Ee,pe].join("|")+")",Me=RegExp("['’]","g"),Ie=RegExp(me,"g"),Re=RegExp(we+"(?="+we+")|"+Ne+Oe,"g"),De=RegExp([Ae+"?"+be+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[ge,Ae,"$"].join("|")+")",Ce+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[ge,Ae+je,"$"].join("|")+")",Ae+"?"+je+"+(?:['’](?:d|ll|m|re|s|t|ve))?",Ae+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ve,Te].join("|"),"g"),Pe=RegExp("[\\u200d\\ud800-\\udfff"+he+"\\ufe0e\\ufe0f]"),Le=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ze=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Fe=-1,Be={};Be[A]=Be[j]=Be[C]=Be[k]=Be[O]=Be[T]=Be["[object Uint8ClampedArray]"]=Be[N]=Be[M]=!0,Be[c]=Be[l]=Be[x]=Be[u]=Be[E]=Be[d]=Be[h]=Be[f]=Be[g]=Be[m]=Be[v]=Be[_]=Be[b]=Be[y]=Be[S]=!1;var qe={};qe[c]=qe[l]=qe[x]=qe[E]=qe[u]=qe[d]=qe[A]=qe[j]=qe[C]=qe[k]=qe[O]=qe[g]=qe[m]=qe[v]=qe[_]=qe[b]=qe[y]=qe[w]=qe[T]=qe["[object Uint8ClampedArray]"]=qe[N]=qe[M]=!0,qe[h]=qe[f]=qe[S]=!1;var Ue={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},He=parseFloat,$e=parseInt,We="object"==typeof e&&e&&e.Object===Object&&e,Ve="object"==typeof self&&self&&self.Object===Object&&self,Ge=We||Ve||Function("return this")(),Je=t&&!t.nodeType&&t,Qe=Je&&"object"==typeof i&&i&&!i.nodeType&&i,Ke=Qe&&Qe.exports===Je,Ye=Ke&&We.process,Xe=function(){try{var e=Qe&&Qe.require&&Qe.require("util").types;return e||Ye&&Ye.binding&&Ye.binding("util")}catch(e){}}(),Ze=Xe&&Xe.isArrayBuffer,et=Xe&&Xe.isDate,tt=Xe&&Xe.isMap,nt=Xe&&Xe.isRegExp,it=Xe&&Xe.isSet,rt=Xe&&Xe.isTypedArray;function ot(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function st(e,t,n,i){for(var r=-1,o=null==e?0:e.length;++r<o;){var s=e[r];t(i,s,n(s),e)}return i}function at(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e}function ct(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function lt(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(!t(e[n],n,e))return!1;return!0}function ut(e,t){for(var n=-1,i=null==e?0:e.length,r=0,o=[];++n<i;){var s=e[n];t(s,n,e)&&(o[r++]=s)}return o}function dt(e,t){return!!(null==e?0:e.length)&&wt(e,t,0)>-1}function ht(e,t,n){for(var i=-1,r=null==e?0:e.length;++i<r;)if(n(t,e[i]))return!0;return!1}function ft(e,t){for(var n=-1,i=null==e?0:e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r}function pt(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}function gt(e,t,n,i){var r=-1,o=null==e?0:e.length;for(i&&o&&(n=e[++r]);++r<o;)n=t(n,e[r],r,e);return n}function mt(e,t,n,i){var r=null==e?0:e.length;for(i&&r&&(n=e[--r]);r--;)n=t(n,e[r],r,e);return n}function vt(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}var _t=At("length");function bt(e,t,n){var i;return n(e,(function(e,n,r){if(t(e,n,r))return i=n,!1})),i}function yt(e,t,n,i){for(var r=e.length,o=n+(i?1:-1);i?o--:++o<r;)if(t(e[o],o,e))return o;return-1}function wt(e,t,n){return t==t?function(e,t,n){var i=n-1,r=e.length;for(;++i<r;)if(e[i]===t)return i;return-1}(e,t,n):yt(e,xt,n)}function St(e,t,n,i){for(var r=n-1,o=e.length;++r<o;)if(i(e[r],t))return r;return-1}function xt(e){return e!=e}function Et(e,t){var n=null==e?0:e.length;return n?kt(e,t)/n:NaN}function At(e){return function(t){return null==t?void 0:t[e]}}function jt(e){return function(t){return null==e?void 0:e[t]}}function Ct(e,t,n,i,r){return r(e,(function(e,r,o){n=i?(i=!1,e):t(n,e,r,o)})),n}function kt(e,t){for(var n,i=-1,r=e.length;++i<r;){var o=t(e[i]);void 0!==o&&(n=void 0===n?o:n+o)}return n}function Ot(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}function Tt(e){return function(t){return e(t)}}function Nt(e,t){return ft(t,(function(t){return e[t]}))}function Mt(e,t){return e.has(t)}function It(e,t){for(var n=-1,i=e.length;++n<i&&wt(t,e[n],0)>-1;);return n}function Rt(e,t){for(var n=e.length;n--&&wt(t,e[n],0)>-1;);return n}function Dt(e,t){for(var n=e.length,i=0;n--;)e[n]===t&&++i;return i}var Pt=jt({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),Lt=jt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function zt(e){return"\\"+Ue[e]}function Ft(e){return Pe.test(e)}function Bt(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n}function qt(e,t){return function(n){return e(t(n))}}function Ut(e,t){for(var n=-1,i=e.length,r=0,o=[];++n<i;){var a=e[n];a!==t&&a!==s||(e[n]=s,o[r++]=n)}return o}function Ht(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}function $t(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=[e,e]})),n}function Wt(e){return Ft(e)?function(e){var t=Re.lastIndex=0;for(;Re.test(e);)++t;return t}(e):_t(e)}function Vt(e){return Ft(e)?function(e){return e.match(Re)||[]}(e):function(e){return e.split("")}(e)}var Gt=jt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Jt=function e(t){var n,i=(t=null==t?Ge:Jt.defaults(Ge.Object(),t,Jt.pick(Ge,ze))).Array,r=t.Date,he=t.Error,fe=t.Function,pe=t.Math,ge=t.Object,me=t.RegExp,ve=t.String,_e=t.TypeError,be=i.prototype,ye=fe.prototype,we=ge.prototype,Se=t["__core-js_shared__"],xe=ye.toString,Ee=we.hasOwnProperty,Ae=0,je=(n=/[^.]+$/.exec(Se&&Se.keys&&Se.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",Ce=we.toString,ke=xe.call(ge),Oe=Ge._,Te=me("^"+xe.call(Ee).replace(V,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ne=Ke?t.Buffer:void 0,Re=t.Symbol,Pe=t.Uint8Array,Ue=Ne?Ne.allocUnsafe:void 0,We=qt(ge.getPrototypeOf,ge),Ve=ge.create,Je=we.propertyIsEnumerable,Qe=be.splice,Ye=Re?Re.isConcatSpreadable:void 0,Xe=Re?Re.iterator:void 0,_t=Re?Re.toStringTag:void 0,jt=function(){try{var e=Zr(ge,"defineProperty");return e({},"",{}),e}catch(e){}}(),Qt=t.clearTimeout!==Ge.clearTimeout&&t.clearTimeout,Kt=r&&r.now!==Ge.Date.now&&r.now,Yt=t.setTimeout!==Ge.setTimeout&&t.setTimeout,Xt=pe.ceil,Zt=pe.floor,en=ge.getOwnPropertySymbols,tn=Ne?Ne.isBuffer:void 0,nn=t.isFinite,rn=be.join,on=qt(ge.keys,ge),sn=pe.max,an=pe.min,cn=r.now,ln=t.parseInt,un=pe.random,dn=be.reverse,hn=Zr(t,"DataView"),fn=Zr(t,"Map"),pn=Zr(t,"Promise"),gn=Zr(t,"Set"),mn=Zr(t,"WeakMap"),vn=Zr(ge,"create"),_n=mn&&new mn,bn={},yn=Co(hn),wn=Co(fn),Sn=Co(pn),xn=Co(gn),En=Co(mn),An=Re?Re.prototype:void 0,jn=An?An.valueOf:void 0,Cn=An?An.toString:void 0;function kn(e){if($s(e)&&!Is(e)&&!(e instanceof Mn)){if(e instanceof Nn)return e;if(Ee.call(e,"__wrapped__"))return ko(e)}return new Nn(e)}var On=function(){function e(){}return function(t){if(!Hs(t))return{};if(Ve)return Ve(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function Tn(){}function Nn(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}function Mn(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function In(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Rn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Dn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Pn(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Dn;++t<n;)this.add(e[t])}function Ln(e){var t=this.__data__=new Rn(e);this.size=t.size}function zn(e,t){var n=Is(e),i=!n&&Ms(e),r=!n&&!i&&Ls(e),o=!n&&!i&&!r&&Xs(e),s=n||i||r||o,a=s?Ot(e.length,ve):[],c=a.length;for(var l in e)!t&&!Ee.call(e,l)||s&&("length"==l||r&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||so(l,c))||a.push(l);return a}function Fn(e){var t=e.length;return t?e[Pi(0,t-1)]:void 0}function Bn(e,t){return Eo(vr(e),Qn(t,0,e.length))}function qn(e){return Eo(vr(e))}function Un(e,t,n){(void 0!==n&&!Os(e[t],n)||void 0===n&&!(t in e))&&Gn(e,t,n)}function Hn(e,t,n){var i=e[t];Ee.call(e,t)&&Os(i,n)&&(void 0!==n||t in e)||Gn(e,t,n)}function $n(e,t){for(var n=e.length;n--;)if(Os(e[n][0],t))return n;return-1}function Wn(e,t,n,i){return ei(e,(function(e,r,o){t(i,e,n(e),o)})),i}function Vn(e,t){return e&&_r(t,ya(t),e)}function Gn(e,t,n){"__proto__"==t&&jt?jt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Jn(e,t){for(var n=-1,r=t.length,o=i(r),s=null==e;++n<r;)o[n]=s?void 0:ga(e,t[n]);return o}function Qn(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e}function Kn(e,t,n,i,r,o){var s,a=1&t,l=2&t,h=4&t;if(n&&(s=r?n(e,i,r,o):n(e)),void 0!==s)return s;if(!Hs(e))return e;var S=Is(e);if(S){if(s=function(e){var t=e.length,n=new e.constructor(t);t&&"string"==typeof e[0]&&Ee.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!a)return vr(e,s)}else{var I=no(e),R=I==f||I==p;if(Ls(e))return dr(e,a);if(I==v||I==c||R&&!r){if(s=l||R?{}:ro(e),!a)return l?function(e,t){return _r(e,to(e),t)}(e,function(e,t){return e&&_r(t,wa(t),e)}(s,e)):function(e,t){return _r(e,eo(e),t)}(e,Vn(s,e))}else{if(!qe[I])return r?e:{};s=function(e,t,n){var i=e.constructor;switch(t){case x:return hr(e);case u:case d:return new i(+e);case E:return function(e,t){var n=t?hr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case A:case j:case C:case k:case O:case T:case"[object Uint8ClampedArray]":case N:case M:return fr(e,n);case g:return new i;case m:case y:return new i(e);case _:return function(e){var t=new e.constructor(e.source,ie.exec(e));return t.lastIndex=e.lastIndex,t}(e);case b:return new i;case w:return r=e,jn?ge(jn.call(r)):{}}var r}(e,I,a)}}o||(o=new Ln);var D=o.get(e);if(D)return D;o.set(e,s),Qs(e)?e.forEach((function(i){s.add(Kn(i,t,n,i,e,o))})):Ws(e)&&e.forEach((function(i,r){s.set(r,Kn(i,t,n,r,e,o))}));var P=S?void 0:(h?l?Vr:Wr:l?wa:ya)(e);return at(P||e,(function(i,r){P&&(i=e[r=i]),Hn(s,r,Kn(i,t,n,r,e,o))})),s}function Yn(e,t,n){var i=n.length;if(null==e)return!i;for(e=ge(e);i--;){var r=n[i],o=t[r],s=e[r];if(void 0===s&&!(r in e)||!o(s))return!1}return!0}function Xn(e,t,n){if("function"!=typeof e)throw new _e(o);return yo((function(){e.apply(void 0,n)}),t)}function Zn(e,t,n,i){var r=-1,o=dt,s=!0,a=e.length,c=[],l=t.length;if(!a)return c;n&&(t=ft(t,Tt(n))),i?(o=ht,s=!1):t.length>=200&&(o=Mt,s=!1,t=new Pn(t));e:for(;++r<a;){var u=e[r],d=null==n?u:n(u);if(u=i||0!==u?u:0,s&&d==d){for(var h=l;h--;)if(t[h]===d)continue e;c.push(u)}else o(t,d,i)||c.push(u)}return c}kn.templateSettings={escape:B,evaluate:q,interpolate:U,variable:"",imports:{_:kn}},kn.prototype=Tn.prototype,kn.prototype.constructor=kn,Nn.prototype=On(Tn.prototype),Nn.prototype.constructor=Nn,Mn.prototype=On(Tn.prototype),Mn.prototype.constructor=Mn,In.prototype.clear=function(){this.__data__=vn?vn(null):{},this.size=0},In.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},In.prototype.get=function(e){var t=this.__data__;if(vn){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Ee.call(t,e)?t[e]:void 0},In.prototype.has=function(e){var t=this.__data__;return vn?void 0!==t[e]:Ee.call(t,e)},In.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=vn&&void 0===t?"__lodash_hash_undefined__":t,this},Rn.prototype.clear=function(){this.__data__=[],this.size=0},Rn.prototype.delete=function(e){var t=this.__data__,n=$n(t,e);return!(n<0)&&(n==t.length-1?t.pop():Qe.call(t,n,1),--this.size,!0)},Rn.prototype.get=function(e){var t=this.__data__,n=$n(t,e);return n<0?void 0:t[n][1]},Rn.prototype.has=function(e){return $n(this.__data__,e)>-1},Rn.prototype.set=function(e,t){var n=this.__data__,i=$n(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this},Dn.prototype.clear=function(){this.size=0,this.__data__={hash:new In,map:new(fn||Rn),string:new In}},Dn.prototype.delete=function(e){var t=Yr(this,e).delete(e);return this.size-=t?1:0,t},Dn.prototype.get=function(e){return Yr(this,e).get(e)},Dn.prototype.has=function(e){return Yr(this,e).has(e)},Dn.prototype.set=function(e,t){var n=Yr(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this},Pn.prototype.add=Pn.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Pn.prototype.has=function(e){return this.__data__.has(e)},Ln.prototype.clear=function(){this.__data__=new Rn,this.size=0},Ln.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Ln.prototype.get=function(e){return this.__data__.get(e)},Ln.prototype.has=function(e){return this.__data__.has(e)},Ln.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Rn){var i=n.__data__;if(!fn||i.length<199)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new Dn(i)}return n.set(e,t),this.size=n.size,this};var ei=wr(ci),ti=wr(li,!0);function ni(e,t){var n=!0;return ei(e,(function(e,i,r){return n=!!t(e,i,r)})),n}function ii(e,t,n){for(var i=-1,r=e.length;++i<r;){var o=e[i],s=t(o);if(null!=s&&(void 0===a?s==s&&!Ys(s):n(s,a)))var a=s,c=o}return c}function ri(e,t){var n=[];return ei(e,(function(e,i,r){t(e,i,r)&&n.push(e)})),n}function oi(e,t,n,i,r){var o=-1,s=e.length;for(n||(n=oo),r||(r=[]);++o<s;){var a=e[o];t>0&&n(a)?t>1?oi(a,t-1,n,i,r):pt(r,a):i||(r[r.length]=a)}return r}var si=Sr(),ai=Sr(!0);function ci(e,t){return e&&si(e,t,ya)}function li(e,t){return e&&ai(e,t,ya)}function ui(e,t){return ut(t,(function(t){return Bs(e[t])}))}function di(e,t){for(var n=0,i=(t=ar(t,e)).length;null!=e&&n<i;)e=e[jo(t[n++])];return n&&n==i?e:void 0}function hi(e,t,n){var i=t(e);return Is(e)?i:pt(i,n(e))}function fi(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":_t&&_t in ge(e)?function(e){var t=Ee.call(e,_t),n=e[_t];try{e[_t]=void 0;var i=!0}catch(e){}var r=Ce.call(e);i&&(t?e[_t]=n:delete e[_t]);return r}(e):function(e){return Ce.call(e)}(e)}function pi(e,t){return e>t}function gi(e,t){return null!=e&&Ee.call(e,t)}function mi(e,t){return null!=e&&t in ge(e)}function vi(e,t,n){for(var r=n?ht:dt,o=e[0].length,s=e.length,a=s,c=i(s),l=1/0,u=[];a--;){var d=e[a];a&&t&&(d=ft(d,Tt(t))),l=an(d.length,l),c[a]=!n&&(t||o>=120&&d.length>=120)?new Pn(a&&d):void 0}d=e[0];var h=-1,f=c[0];e:for(;++h<o&&u.length<l;){var p=d[h],g=t?t(p):p;if(p=n||0!==p?p:0,!(f?Mt(f,g):r(u,g,n))){for(a=s;--a;){var m=c[a];if(!(m?Mt(m,g):r(e[a],g,n)))continue e}f&&f.push(g),u.push(p)}}return u}function _i(e,t,n){var i=null==(e=mo(e,t=ar(t,e)))?e:e[jo(Fo(t))];return null==i?void 0:ot(i,e,n)}function bi(e){return $s(e)&&fi(e)==c}function yi(e,t,n,i,r){return e===t||(null==e||null==t||!$s(e)&&!$s(t)?e!=e&&t!=t:function(e,t,n,i,r,o){var s=Is(e),a=Is(t),f=s?l:no(e),p=a?l:no(t),S=(f=f==c?v:f)==v,A=(p=p==c?v:p)==v,j=f==p;if(j&&Ls(e)){if(!Ls(t))return!1;s=!0,S=!1}if(j&&!S)return o||(o=new Ln),s||Xs(e)?Hr(e,t,n,i,r,o):function(e,t,n,i,r,o,s){switch(n){case E:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case x:return!(e.byteLength!=t.byteLength||!o(new Pe(e),new Pe(t)));case u:case d:case m:return Os(+e,+t);case h:return e.name==t.name&&e.message==t.message;case _:case y:return e==t+"";case g:var a=Bt;case b:var c=1&i;if(a||(a=Ht),e.size!=t.size&&!c)return!1;var l=s.get(e);if(l)return l==t;i|=2,s.set(e,t);var f=Hr(a(e),a(t),i,r,o,s);return s.delete(e),f;case w:if(jn)return jn.call(e)==jn.call(t)}return!1}(e,t,f,n,i,r,o);if(!(1&n)){var C=S&&Ee.call(e,"__wrapped__"),k=A&&Ee.call(t,"__wrapped__");if(C||k){var O=C?e.value():e,T=k?t.value():t;return o||(o=new Ln),r(O,T,n,i,o)}}if(!j)return!1;return o||(o=new Ln),function(e,t,n,i,r,o){var s=1&n,a=Wr(e),c=a.length,l=Wr(t).length;if(c!=l&&!s)return!1;var u=c;for(;u--;){var d=a[u];if(!(s?d in t:Ee.call(t,d)))return!1}var h=o.get(e);if(h&&o.get(t))return h==t;var f=!0;o.set(e,t),o.set(t,e);var p=s;for(;++u<c;){d=a[u];var g=e[d],m=t[d];if(i)var v=s?i(m,g,d,t,e,o):i(g,m,d,e,t,o);if(!(void 0===v?g===m||r(g,m,n,i,o):v)){f=!1;break}p||(p="constructor"==d)}if(f&&!p){var _=e.constructor,b=t.constructor;_==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof b&&b instanceof b||(f=!1)}return o.delete(e),o.delete(t),f}(e,t,n,i,r,o)}(e,t,n,i,yi,r))}function wi(e,t,n,i){var r=n.length,o=r,s=!i;if(null==e)return!o;for(e=ge(e);r--;){var a=n[r];if(s&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++r<o;){var c=(a=n[r])[0],l=e[c],u=a[1];if(s&&a[2]){if(void 0===l&&!(c in e))return!1}else{var d=new Ln;if(i)var h=i(l,u,c,e,t,d);if(!(void 0===h?yi(u,l,3,i,d):h))return!1}}return!0}function Si(e){return!(!Hs(e)||(t=e,je&&je in t))&&(Bs(e)?Te:se).test(Co(e));var t}function xi(e){return"function"==typeof e?e:null==e?Va:"object"==typeof e?Is(e)?Oi(e[0],e[1]):ki(e):tc(e)}function Ei(e){if(!ho(e))return on(e);var t=[];for(var n in ge(e))Ee.call(e,n)&&"constructor"!=n&&t.push(n);return t}function Ai(e){if(!Hs(e))return function(e){var t=[];if(null!=e)for(var n in ge(e))t.push(n);return t}(e);var t=ho(e),n=[];for(var i in e)("constructor"!=i||!t&&Ee.call(e,i))&&n.push(i);return n}function ji(e,t){return e<t}function Ci(e,t){var n=-1,r=Ds(e)?i(e.length):[];return ei(e,(function(e,i,o){r[++n]=t(e,i,o)})),r}function ki(e){var t=Xr(e);return 1==t.length&&t[0][2]?po(t[0][0],t[0][1]):function(n){return n===e||wi(n,e,t)}}function Oi(e,t){return co(e)&&fo(t)?po(jo(e),t):function(n){var i=ga(n,e);return void 0===i&&i===t?ma(n,e):yi(t,i,3)}}function Ti(e,t,n,i,r){e!==t&&si(t,(function(o,s){if(r||(r=new Ln),Hs(o))!function(e,t,n,i,r,o,s){var a=_o(e,n),c=_o(t,n),l=s.get(c);if(l)return void Un(e,n,l);var u=o?o(a,c,n+"",e,t,s):void 0,d=void 0===u;if(d){var h=Is(c),f=!h&&Ls(c),p=!h&&!f&&Xs(c);u=c,h||f||p?Is(a)?u=a:Ps(a)?u=vr(a):f?(d=!1,u=dr(c,!0)):p?(d=!1,u=fr(c,!0)):u=[]:Gs(c)||Ms(c)?(u=a,Ms(a)?u=sa(a):Hs(a)&&!Bs(a)||(u=ro(c))):d=!1}d&&(s.set(c,u),r(u,c,i,o,s),s.delete(c));Un(e,n,u)}(e,t,s,n,Ti,i,r);else{var a=i?i(_o(e,s),o,s+"",e,t,r):void 0;void 0===a&&(a=o),Un(e,s,a)}}),wa)}function Ni(e,t){var n=e.length;if(n)return so(t+=t<0?n:0,n)?e[t]:void 0}function Mi(e,t,n){var i=-1;return t=ft(t.length?t:[Va],Tt(Kr())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(Ci(e,(function(e,n,r){return{criteria:ft(t,(function(t){return t(e)})),index:++i,value:e}})),(function(e,t){return function(e,t,n){var i=-1,r=e.criteria,o=t.criteria,s=r.length,a=n.length;for(;++i<s;){var c=pr(r[i],o[i]);if(c){if(i>=a)return c;var l=n[i];return c*("desc"==l?-1:1)}}return e.index-t.index}(e,t,n)}))}function Ii(e,t,n){for(var i=-1,r=t.length,o={};++i<r;){var s=t[i],a=di(e,s);n(a,s)&&qi(o,ar(s,e),a)}return o}function Ri(e,t,n,i){var r=i?St:wt,o=-1,s=t.length,a=e;for(e===t&&(t=vr(t)),n&&(a=ft(e,Tt(n)));++o<s;)for(var c=0,l=t[o],u=n?n(l):l;(c=r(a,u,c,i))>-1;)a!==e&&Qe.call(a,c,1),Qe.call(e,c,1);return e}function Di(e,t){for(var n=e?t.length:0,i=n-1;n--;){var r=t[n];if(n==i||r!==o){var o=r;so(r)?Qe.call(e,r,1):Zi(e,r)}}return e}function Pi(e,t){return e+Zt(un()*(t-e+1))}function Li(e,t){var n="";if(!e||t<1||t>9007199254740991)return n;do{t%2&&(n+=e),(t=Zt(t/2))&&(e+=e)}while(t);return n}function zi(e,t){return wo(go(e,t,Va),e+"")}function Fi(e){return Fn(Oa(e))}function Bi(e,t){var n=Oa(e);return Eo(n,Qn(t,0,n.length))}function qi(e,t,n,i){if(!Hs(e))return e;for(var r=-1,o=(t=ar(t,e)).length,s=o-1,a=e;null!=a&&++r<o;){var c=jo(t[r]),l=n;if(r!=s){var u=a[c];void 0===(l=i?i(u,c,a):void 0)&&(l=Hs(u)?u:so(t[r+1])?[]:{})}Hn(a,c,l),a=a[c]}return e}var Ui=_n?function(e,t){return _n.set(e,t),e}:Va,Hi=jt?function(e,t){return jt(e,"toString",{configurable:!0,enumerable:!1,value:Ha(t),writable:!0})}:Va;function $i(e){return Eo(Oa(e))}function Wi(e,t,n){var r=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(n=n>o?o:n)<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var s=i(o);++r<o;)s[r]=e[r+t];return s}function Vi(e,t){var n;return ei(e,(function(e,i,r){return!(n=t(e,i,r))})),!!n}function Gi(e,t,n){var i=0,r=null==e?i:e.length;if("number"==typeof t&&t==t&&r<=2147483647){for(;i<r;){var o=i+r>>>1,s=e[o];null!==s&&!Ys(s)&&(n?s<=t:s<t)?i=o+1:r=o}return r}return Ji(e,t,Va,n)}function Ji(e,t,n,i){t=n(t);for(var r=0,o=null==e?0:e.length,s=t!=t,a=null===t,c=Ys(t),l=void 0===t;r<o;){var u=Zt((r+o)/2),d=n(e[u]),h=void 0!==d,f=null===d,p=d==d,g=Ys(d);if(s)var m=i||p;else m=l?p&&(i||h):a?p&&h&&(i||!f):c?p&&h&&!f&&(i||!g):!f&&!g&&(i?d<=t:d<t);m?r=u+1:o=u}return an(o,4294967294)}function Qi(e,t){for(var n=-1,i=e.length,r=0,o=[];++n<i;){var s=e[n],a=t?t(s):s;if(!n||!Os(a,c)){var c=a;o[r++]=0===s?0:s}}return o}function Ki(e){return"number"==typeof e?e:Ys(e)?NaN:+e}function Yi(e){if("string"==typeof e)return e;if(Is(e))return ft(e,Yi)+"";if(Ys(e))return Cn?Cn.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Xi(e,t,n){var i=-1,r=dt,o=e.length,s=!0,a=[],c=a;if(n)s=!1,r=ht;else if(o>=200){var l=t?null:Lr(e);if(l)return Ht(l);s=!1,r=Mt,c=new Pn}else c=t?[]:a;e:for(;++i<o;){var u=e[i],d=t?t(u):u;if(u=n||0!==u?u:0,s&&d==d){for(var h=c.length;h--;)if(c[h]===d)continue e;t&&c.push(d),a.push(u)}else r(c,d,n)||(c!==a&&c.push(d),a.push(u))}return a}function Zi(e,t){return null==(e=mo(e,t=ar(t,e)))||delete e[jo(Fo(t))]}function er(e,t,n,i){return qi(e,t,n(di(e,t)),i)}function tr(e,t,n,i){for(var r=e.length,o=i?r:-1;(i?o--:++o<r)&&t(e[o],o,e););return n?Wi(e,i?0:o,i?o+1:r):Wi(e,i?o+1:0,i?r:o)}function nr(e,t){var n=e;return n instanceof Mn&&(n=n.value()),gt(t,(function(e,t){return t.func.apply(t.thisArg,pt([e],t.args))}),n)}function ir(e,t,n){var r=e.length;if(r<2)return r?Xi(e[0]):[];for(var o=-1,s=i(r);++o<r;)for(var a=e[o],c=-1;++c<r;)c!=o&&(s[o]=Zn(s[o]||a,e[c],t,n));return Xi(oi(s,1),t,n)}function rr(e,t,n){for(var i=-1,r=e.length,o=t.length,s={};++i<r;){var a=i<o?t[i]:void 0;n(s,e[i],a)}return s}function or(e){return Ps(e)?e:[]}function sr(e){return"function"==typeof e?e:Va}function ar(e,t){return Is(e)?e:co(e,t)?[e]:Ao(aa(e))}var cr=zi;function lr(e,t,n){var i=e.length;return n=void 0===n?i:n,!t&&n>=i?e:Wi(e,t,n)}var ur=Qt||function(e){return Ge.clearTimeout(e)};function dr(e,t){if(t)return e.slice();var n=e.length,i=Ue?Ue(n):new e.constructor(n);return e.copy(i),i}function hr(e){var t=new e.constructor(e.byteLength);return new Pe(t).set(new Pe(e)),t}function fr(e,t){var n=t?hr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function pr(e,t){if(e!==t){var n=void 0!==e,i=null===e,r=e==e,o=Ys(e),s=void 0!==t,a=null===t,c=t==t,l=Ys(t);if(!a&&!l&&!o&&e>t||o&&s&&c&&!a&&!l||i&&s&&c||!n&&c||!r)return 1;if(!i&&!o&&!l&&e<t||l&&n&&r&&!i&&!o||a&&n&&r||!s&&r||!c)return-1}return 0}function gr(e,t,n,r){for(var o=-1,s=e.length,a=n.length,c=-1,l=t.length,u=sn(s-a,0),d=i(l+u),h=!r;++c<l;)d[c]=t[c];for(;++o<a;)(h||o<s)&&(d[n[o]]=e[o]);for(;u--;)d[c++]=e[o++];return d}function mr(e,t,n,r){for(var o=-1,s=e.length,a=-1,c=n.length,l=-1,u=t.length,d=sn(s-c,0),h=i(d+u),f=!r;++o<d;)h[o]=e[o];for(var p=o;++l<u;)h[p+l]=t[l];for(;++a<c;)(f||o<s)&&(h[p+n[a]]=e[o++]);return h}function vr(e,t){var n=-1,r=e.length;for(t||(t=i(r));++n<r;)t[n]=e[n];return t}function _r(e,t,n,i){var r=!n;n||(n={});for(var o=-1,s=t.length;++o<s;){var a=t[o],c=i?i(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),r?Gn(n,a,c):Hn(n,a,c)}return n}function br(e,t){return function(n,i){var r=Is(n)?st:Wn,o=t?t():{};return r(n,e,Kr(i,2),o)}}function yr(e){return zi((function(t,n){var i=-1,r=n.length,o=r>1?n[r-1]:void 0,s=r>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(r--,o):void 0,s&&ao(n[0],n[1],s)&&(o=r<3?void 0:o,r=1),t=ge(t);++i<r;){var a=n[i];a&&e(t,a,i,o)}return t}))}function wr(e,t){return function(n,i){if(null==n)return n;if(!Ds(n))return e(n,i);for(var r=n.length,o=t?r:-1,s=ge(n);(t?o--:++o<r)&&!1!==i(s[o],o,s););return n}}function Sr(e){return function(t,n,i){for(var r=-1,o=ge(t),s=i(t),a=s.length;a--;){var c=s[e?a:++r];if(!1===n(o[c],c,o))break}return t}}function xr(e){return function(t){var n=Ft(t=aa(t))?Vt(t):void 0,i=n?n[0]:t.charAt(0),r=n?lr(n,1).join(""):t.slice(1);return i[e]()+r}}function Er(e){return function(t){return gt(Ba(Ma(t).replace(Me,"")),e,"")}}function Ar(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=On(e.prototype),i=e.apply(n,t);return Hs(i)?i:n}}function jr(e){return function(t,n,i){var r=ge(t);if(!Ds(t)){var o=Kr(n,3);t=ya(t),n=function(e){return o(r[e],e,r)}}var s=e(t,n,i);return s>-1?r[o?t[s]:s]:void 0}}function Cr(e){return $r((function(t){var n=t.length,i=n,r=Nn.prototype.thru;for(e&&t.reverse();i--;){var s=t[i];if("function"!=typeof s)throw new _e(o);if(r&&!a&&"wrapper"==Jr(s))var a=new Nn([],!0)}for(i=a?i:n;++i<n;){var c=Jr(s=t[i]),l="wrapper"==c?Gr(s):void 0;a=l&&lo(l[0])&&424==l[1]&&!l[4].length&&1==l[9]?a[Jr(l[0])].apply(a,l[3]):1==s.length&&lo(s)?a[c]():a.thru(s)}return function(){var e=arguments,i=e[0];if(a&&1==e.length&&Is(i))return a.plant(i).value();for(var r=0,o=n?t[r].apply(this,e):i;++r<n;)o=t[r].call(this,o);return o}}))}function kr(e,t,n,r,o,s,a,c,l,u){var d=128&t,h=1&t,f=2&t,p=24&t,g=512&t,m=f?void 0:Ar(e);return function v(){for(var _=arguments.length,b=i(_),y=_;y--;)b[y]=arguments[y];if(p)var w=Qr(v),S=Dt(b,w);if(r&&(b=gr(b,r,o,p)),s&&(b=mr(b,s,a,p)),_-=S,p&&_<u){var x=Ut(b,w);return Dr(e,t,kr,v.placeholder,n,b,x,c,l,u-_)}var E=h?n:this,A=f?E[e]:e;return _=b.length,c?b=vo(b,c):g&&_>1&&b.reverse(),d&&l<_&&(b.length=l),this&&this!==Ge&&this instanceof v&&(A=m||Ar(A)),A.apply(E,b)}}function Or(e,t){return function(n,i){return function(e,t,n,i){return ci(e,(function(e,r,o){t(i,n(e),r,o)})),i}(n,e,t(i),{})}}function Tr(e,t){return function(n,i){var r;if(void 0===n&&void 0===i)return t;if(void 0!==n&&(r=n),void 0!==i){if(void 0===r)return i;"string"==typeof n||"string"==typeof i?(n=Yi(n),i=Yi(i)):(n=Ki(n),i=Ki(i)),r=e(n,i)}return r}}function Nr(e){return $r((function(t){return t=ft(t,Tt(Kr())),zi((function(n){var i=this;return e(t,(function(e){return ot(e,i,n)}))}))}))}function Mr(e,t){var n=(t=void 0===t?" ":Yi(t)).length;if(n<2)return n?Li(t,e):t;var i=Li(t,Xt(e/Wt(t)));return Ft(t)?lr(Vt(i),0,e).join(""):i.slice(0,e)}function Ir(e){return function(t,n,r){return r&&"number"!=typeof r&&ao(t,n,r)&&(n=r=void 0),t=na(t),void 0===n?(n=t,t=0):n=na(n),function(e,t,n,r){for(var o=-1,s=sn(Xt((t-e)/(n||1)),0),a=i(s);s--;)a[r?s:++o]=e,e+=n;return a}(t,n,r=void 0===r?t<n?1:-1:na(r),e)}}function Rr(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=oa(t),n=oa(n)),e(t,n)}}function Dr(e,t,n,i,r,o,s,a,c,l){var u=8&t;t|=u?32:64,4&(t&=~(u?64:32))||(t&=-4);var d=[e,t,r,u?o:void 0,u?s:void 0,u?void 0:o,u?void 0:s,a,c,l],h=n.apply(void 0,d);return lo(e)&&bo(h,d),h.placeholder=i,So(h,e,t)}function Pr(e){var t=pe[e];return function(e,n){if(e=oa(e),(n=null==n?0:an(ia(n),292))&&nn(e)){var i=(aa(e)+"e").split("e");return+((i=(aa(t(i[0]+"e"+(+i[1]+n)))+"e").split("e"))[0]+"e"+(+i[1]-n))}return t(e)}}var Lr=gn&&1/Ht(new gn([,-0]))[1]==1/0?function(e){return new gn(e)}:Ya;function zr(e){return function(t){var n=no(t);return n==g?Bt(t):n==b?$t(t):function(e,t){return ft(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Fr(e,t,n,r,a,c,l,u){var d=2&t;if(!d&&"function"!=typeof e)throw new _e(o);var h=r?r.length:0;if(h||(t&=-97,r=a=void 0),l=void 0===l?l:sn(ia(l),0),u=void 0===u?u:ia(u),h-=a?a.length:0,64&t){var f=r,p=a;r=a=void 0}var g=d?void 0:Gr(e),m=[e,t,n,r,a,f,p,c,l,u];if(g&&function(e,t){var n=e[1],i=t[1],r=n|i,o=r<131,a=128==i&&8==n||128==i&&256==n&&e[7].length<=t[8]||384==i&&t[7].length<=t[8]&&8==n;if(!o&&!a)return e;1&i&&(e[2]=t[2],r|=1&n?0:4);var c=t[3];if(c){var l=e[3];e[3]=l?gr(l,c,t[4]):c,e[4]=l?Ut(e[3],s):t[4]}(c=t[5])&&(l=e[5],e[5]=l?mr(l,c,t[6]):c,e[6]=l?Ut(e[5],s):t[6]);(c=t[7])&&(e[7]=c);128&i&&(e[8]=null==e[8]?t[8]:an(e[8],t[8]));null==e[9]&&(e[9]=t[9]);e[0]=t[0],e[1]=r}(m,g),e=m[0],t=m[1],n=m[2],r=m[3],a=m[4],!(u=m[9]=void 0===m[9]?d?0:e.length:sn(m[9]-h,0))&&24&t&&(t&=-25),t&&1!=t)v=8==t||16==t?function(e,t,n){var r=Ar(e);return function o(){for(var s=arguments.length,a=i(s),c=s,l=Qr(o);c--;)a[c]=arguments[c];var u=s<3&&a[0]!==l&&a[s-1]!==l?[]:Ut(a,l);if((s-=u.length)<n)return Dr(e,t,kr,o.placeholder,void 0,a,u,void 0,void 0,n-s);var d=this&&this!==Ge&&this instanceof o?r:e;return ot(d,this,a)}}(e,t,u):32!=t&&33!=t||a.length?kr.apply(void 0,m):function(e,t,n,r){var o=1&t,s=Ar(e);return function t(){for(var a=-1,c=arguments.length,l=-1,u=r.length,d=i(u+c),h=this&&this!==Ge&&this instanceof t?s:e;++l<u;)d[l]=r[l];for(;c--;)d[l++]=arguments[++a];return ot(h,o?n:this,d)}}(e,t,n,r);else var v=function(e,t,n){var i=1&t,r=Ar(e);return function t(){var o=this&&this!==Ge&&this instanceof t?r:e;return o.apply(i?n:this,arguments)}}(e,t,n);return So((g?Ui:bo)(v,m),e,t)}function Br(e,t,n,i){return void 0===e||Os(e,we[n])&&!Ee.call(i,n)?t:e}function qr(e,t,n,i,r,o){return Hs(e)&&Hs(t)&&(o.set(t,e),Ti(e,t,void 0,qr,o),o.delete(t)),e}function Ur(e){return Gs(e)?void 0:e}function Hr(e,t,n,i,r,o){var s=1&n,a=e.length,c=t.length;if(a!=c&&!(s&&c>a))return!1;var l=o.get(e);if(l&&o.get(t))return l==t;var u=-1,d=!0,h=2&n?new Pn:void 0;for(o.set(e,t),o.set(t,e);++u<a;){var f=e[u],p=t[u];if(i)var g=s?i(p,f,u,t,e,o):i(f,p,u,e,t,o);if(void 0!==g){if(g)continue;d=!1;break}if(h){if(!vt(t,(function(e,t){if(!Mt(h,t)&&(f===e||r(f,e,n,i,o)))return h.push(t)}))){d=!1;break}}else if(f!==p&&!r(f,p,n,i,o)){d=!1;break}}return o.delete(e),o.delete(t),d}function $r(e){return wo(go(e,void 0,Ro),e+"")}function Wr(e){return hi(e,ya,eo)}function Vr(e){return hi(e,wa,to)}var Gr=_n?function(e){return _n.get(e)}:Ya;function Jr(e){for(var t=e.name+"",n=bn[t],i=Ee.call(bn,t)?n.length:0;i--;){var r=n[i],o=r.func;if(null==o||o==e)return r.name}return t}function Qr(e){return(Ee.call(kn,"placeholder")?kn:e).placeholder}function Kr(){var e=kn.iteratee||Ga;return e=e===Ga?xi:e,arguments.length?e(arguments[0],arguments[1]):e}function Yr(e,t){var n,i,r=e.__data__;return("string"==(i=typeof(n=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof t?"string":"hash"]:r.map}function Xr(e){for(var t=ya(e),n=t.length;n--;){var i=t[n],r=e[i];t[n]=[i,r,fo(r)]}return t}function Zr(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Si(n)?n:void 0}var eo=en?function(e){return null==e?[]:(e=ge(e),ut(en(e),(function(t){return Je.call(e,t)})))}:rc,to=en?function(e){for(var t=[];e;)pt(t,eo(e)),e=We(e);return t}:rc,no=fi;function io(e,t,n){for(var i=-1,r=(t=ar(t,e)).length,o=!1;++i<r;){var s=jo(t[i]);if(!(o=null!=e&&n(e,s)))break;e=e[s]}return o||++i!=r?o:!!(r=null==e?0:e.length)&&Us(r)&&so(s,r)&&(Is(e)||Ms(e))}function ro(e){return"function"!=typeof e.constructor||ho(e)?{}:On(We(e))}function oo(e){return Is(e)||Ms(e)||!!(Ye&&e&&e[Ye])}function so(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&ce.test(e))&&e>-1&&e%1==0&&e<t}function ao(e,t,n){if(!Hs(n))return!1;var i=typeof t;return!!("number"==i?Ds(n)&&so(t,n.length):"string"==i&&t in n)&&Os(n[t],e)}function co(e,t){if(Is(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Ys(e))||($.test(e)||!H.test(e)||null!=t&&e in ge(t))}function lo(e){var t=Jr(e),n=kn[t];if("function"!=typeof n||!(t in Mn.prototype))return!1;if(e===n)return!0;var i=Gr(n);return!!i&&e===i[0]}(hn&&no(new hn(new ArrayBuffer(1)))!=E||fn&&no(new fn)!=g||pn&&"[object Promise]"!=no(pn.resolve())||gn&&no(new gn)!=b||mn&&no(new mn)!=S)&&(no=function(e){var t=fi(e),n=t==v?e.constructor:void 0,i=n?Co(n):"";if(i)switch(i){case yn:return E;case wn:return g;case Sn:return"[object Promise]";case xn:return b;case En:return S}return t});var uo=Se?Bs:oc;function ho(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||we)}function fo(e){return e==e&&!Hs(e)}function po(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in ge(n)))}}function go(e,t,n){return t=sn(void 0===t?e.length-1:t,0),function(){for(var r=arguments,o=-1,s=sn(r.length-t,0),a=i(s);++o<s;)a[o]=r[t+o];o=-1;for(var c=i(t+1);++o<t;)c[o]=r[o];return c[t]=n(a),ot(e,this,c)}}function mo(e,t){return t.length<2?e:di(e,Wi(t,0,-1))}function vo(e,t){for(var n=e.length,i=an(t.length,n),r=vr(e);i--;){var o=t[i];e[i]=so(o,n)?r[o]:void 0}return e}function _o(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var bo=xo(Ui),yo=Yt||function(e,t){return Ge.setTimeout(e,t)},wo=xo(Hi);function So(e,t,n){var i=t+"";return wo(e,function(e,t){var n=t.length;if(!n)return e;var i=n-1;return t[i]=(n>1?"& ":"")+t[i],t=t.join(n>2?", ":" "),e.replace(Y,"{\n/* [wrapped with "+t+"] */\n")}(i,function(e,t){return at(a,(function(n){var i="_."+n[0];t&n[1]&&!dt(e,i)&&e.push(i)})),e.sort()}(function(e){var t=e.match(X);return t?t[1].split(Z):[]}(i),n)))}function xo(e){var t=0,n=0;return function(){var i=cn(),r=16-(i-n);if(n=i,r>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function Eo(e,t){var n=-1,i=e.length,r=i-1;for(t=void 0===t?i:t;++n<t;){var o=Pi(n,r),s=e[o];e[o]=e[n],e[n]=s}return e.length=t,e}var Ao=function(e){var t=xs(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(W,(function(e,n,i,r){t.push(i?r.replace(te,"$1"):n||e)})),t}));function jo(e){if("string"==typeof e||Ys(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Co(e){if(null!=e){try{return xe.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ko(e){if(e instanceof Mn)return e.clone();var t=new Nn(e.__wrapped__,e.__chain__);return t.__actions__=vr(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Oo=zi((function(e,t){return Ps(e)?Zn(e,oi(t,1,Ps,!0)):[]})),To=zi((function(e,t){var n=Fo(t);return Ps(n)&&(n=void 0),Ps(e)?Zn(e,oi(t,1,Ps,!0),Kr(n,2)):[]})),No=zi((function(e,t){var n=Fo(t);return Ps(n)&&(n=void 0),Ps(e)?Zn(e,oi(t,1,Ps,!0),void 0,n):[]}));function Mo(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=null==n?0:ia(n);return r<0&&(r=sn(i+r,0)),yt(e,Kr(t,3),r)}function Io(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=i-1;return void 0!==n&&(r=ia(n),r=n<0?sn(i+r,0):an(r,i-1)),yt(e,Kr(t,3),r,!0)}function Ro(e){return(null==e?0:e.length)?oi(e,1):[]}function Do(e){return e&&e.length?e[0]:void 0}var Po=zi((function(e){var t=ft(e,or);return t.length&&t[0]===e[0]?vi(t):[]})),Lo=zi((function(e){var t=Fo(e),n=ft(e,or);return t===Fo(n)?t=void 0:n.pop(),n.length&&n[0]===e[0]?vi(n,Kr(t,2)):[]})),zo=zi((function(e){var t=Fo(e),n=ft(e,or);return(t="function"==typeof t?t:void 0)&&n.pop(),n.length&&n[0]===e[0]?vi(n,void 0,t):[]}));function Fo(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var Bo=zi(qo);function qo(e,t){return e&&e.length&&t&&t.length?Ri(e,t):e}var Uo=$r((function(e,t){var n=null==e?0:e.length,i=Jn(e,t);return Di(e,ft(t,(function(e){return so(e,n)?+e:e})).sort(pr)),i}));function Ho(e){return null==e?e:dn.call(e)}var $o=zi((function(e){return Xi(oi(e,1,Ps,!0))})),Wo=zi((function(e){var t=Fo(e);return Ps(t)&&(t=void 0),Xi(oi(e,1,Ps,!0),Kr(t,2))})),Vo=zi((function(e){var t=Fo(e);return t="function"==typeof t?t:void 0,Xi(oi(e,1,Ps,!0),void 0,t)}));function Go(e){if(!e||!e.length)return[];var t=0;return e=ut(e,(function(e){if(Ps(e))return t=sn(e.length,t),!0})),Ot(t,(function(t){return ft(e,At(t))}))}function Jo(e,t){if(!e||!e.length)return[];var n=Go(e);return null==t?n:ft(n,(function(e){return ot(t,void 0,e)}))}var Qo=zi((function(e,t){return Ps(e)?Zn(e,t):[]})),Ko=zi((function(e){return ir(ut(e,Ps))})),Yo=zi((function(e){var t=Fo(e);return Ps(t)&&(t=void 0),ir(ut(e,Ps),Kr(t,2))})),Xo=zi((function(e){var t=Fo(e);return t="function"==typeof t?t:void 0,ir(ut(e,Ps),void 0,t)})),Zo=zi(Go);var es=zi((function(e){var t=e.length,n=t>1?e[t-1]:void 0;return n="function"==typeof n?(e.pop(),n):void 0,Jo(e,n)}));function ts(e){var t=kn(e);return t.__chain__=!0,t}function ns(e,t){return t(e)}var is=$r((function(e){var t=e.length,n=t?e[0]:0,i=this.__wrapped__,r=function(t){return Jn(t,e)};return!(t>1||this.__actions__.length)&&i instanceof Mn&&so(n)?((i=i.slice(n,+n+(t?1:0))).__actions__.push({func:ns,args:[r],thisArg:void 0}),new Nn(i,this.__chain__).thru((function(e){return t&&!e.length&&e.push(void 0),e}))):this.thru(r)}));var rs=br((function(e,t,n){Ee.call(e,n)?++e[n]:Gn(e,n,1)}));var os=jr(Mo),ss=jr(Io);function as(e,t){return(Is(e)?at:ei)(e,Kr(t,3))}function cs(e,t){return(Is(e)?ct:ti)(e,Kr(t,3))}var ls=br((function(e,t,n){Ee.call(e,n)?e[n].push(t):Gn(e,n,[t])}));var us=zi((function(e,t,n){var r=-1,o="function"==typeof t,s=Ds(e)?i(e.length):[];return ei(e,(function(e){s[++r]=o?ot(t,e,n):_i(e,t,n)})),s})),ds=br((function(e,t,n){Gn(e,n,t)}));function hs(e,t){return(Is(e)?ft:Ci)(e,Kr(t,3))}var fs=br((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]}));var ps=zi((function(e,t){if(null==e)return[];var n=t.length;return n>1&&ao(e,t[0],t[1])?t=[]:n>2&&ao(t[0],t[1],t[2])&&(t=[t[0]]),Mi(e,oi(t,1),[])})),gs=Kt||function(){return Ge.Date.now()};function ms(e,t,n){return t=n?void 0:t,Fr(e,128,void 0,void 0,void 0,void 0,t=e&&null==t?e.length:t)}function vs(e,t){var n;if("function"!=typeof t)throw new _e(o);return e=ia(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}}var _s=zi((function(e,t,n){var i=1;if(n.length){var r=Ut(n,Qr(_s));i|=32}return Fr(e,i,t,n,r)})),bs=zi((function(e,t,n){var i=3;if(n.length){var r=Ut(n,Qr(bs));i|=32}return Fr(t,i,e,n,r)}));function ys(e,t,n){var i,r,s,a,c,l,u=0,d=!1,h=!1,f=!0;if("function"!=typeof e)throw new _e(o);function p(t){var n=i,o=r;return i=r=void 0,u=t,a=e.apply(o,n)}function g(e){return u=e,c=yo(v,t),d?p(e):a}function m(e){var n=e-l;return void 0===l||n>=t||n<0||h&&e-u>=s}function v(){var e=gs();if(m(e))return _(e);c=yo(v,function(e){var n=t-(e-l);return h?an(n,s-(e-u)):n}(e))}function _(e){return c=void 0,f&&i?p(e):(i=r=void 0,a)}function b(){var e=gs(),n=m(e);if(i=arguments,r=this,l=e,n){if(void 0===c)return g(l);if(h)return ur(c),c=yo(v,t),p(l)}return void 0===c&&(c=yo(v,t)),a}return t=oa(t)||0,Hs(n)&&(d=!!n.leading,s=(h="maxWait"in n)?sn(oa(n.maxWait)||0,t):s,f="trailing"in n?!!n.trailing:f),b.cancel=function(){void 0!==c&&ur(c),u=0,i=l=r=c=void 0},b.flush=function(){return void 0===c?a:_(gs())},b}var ws=zi((function(e,t){return Xn(e,1,t)})),Ss=zi((function(e,t,n){return Xn(e,oa(t)||0,n)}));function xs(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new _e(o);var n=function(){var i=arguments,r=t?t.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var s=e.apply(this,i);return n.cache=o.set(r,s)||o,s};return n.cache=new(xs.Cache||Dn),n}function Es(e){if("function"!=typeof e)throw new _e(o);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}xs.Cache=Dn;var As=cr((function(e,t){var n=(t=1==t.length&&Is(t[0])?ft(t[0],Tt(Kr())):ft(oi(t,1),Tt(Kr()))).length;return zi((function(i){for(var r=-1,o=an(i.length,n);++r<o;)i[r]=t[r].call(this,i[r]);return ot(e,this,i)}))})),js=zi((function(e,t){return Fr(e,32,void 0,t,Ut(t,Qr(js)))})),Cs=zi((function(e,t){return Fr(e,64,void 0,t,Ut(t,Qr(Cs)))})),ks=$r((function(e,t){return Fr(e,256,void 0,void 0,void 0,t)}));function Os(e,t){return e===t||e!=e&&t!=t}var Ts=Rr(pi),Ns=Rr((function(e,t){return e>=t})),Ms=bi(function(){return arguments}())?bi:function(e){return $s(e)&&Ee.call(e,"callee")&&!Je.call(e,"callee")},Is=i.isArray,Rs=Ze?Tt(Ze):function(e){return $s(e)&&fi(e)==x};function Ds(e){return null!=e&&Us(e.length)&&!Bs(e)}function Ps(e){return $s(e)&&Ds(e)}var Ls=tn||oc,zs=et?Tt(et):function(e){return $s(e)&&fi(e)==d};function Fs(e){if(!$s(e))return!1;var t=fi(e);return t==h||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!Gs(e)}function Bs(e){if(!Hs(e))return!1;var t=fi(e);return t==f||t==p||"[object AsyncFunction]"==t||"[object Proxy]"==t}function qs(e){return"number"==typeof e&&e==ia(e)}function Us(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function Hs(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function $s(e){return null!=e&&"object"==typeof e}var Ws=tt?Tt(tt):function(e){return $s(e)&&no(e)==g};function Vs(e){return"number"==typeof e||$s(e)&&fi(e)==m}function Gs(e){if(!$s(e)||fi(e)!=v)return!1;var t=We(e);if(null===t)return!0;var n=Ee.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&xe.call(n)==ke}var Js=nt?Tt(nt):function(e){return $s(e)&&fi(e)==_};var Qs=it?Tt(it):function(e){return $s(e)&&no(e)==b};function Ks(e){return"string"==typeof e||!Is(e)&&$s(e)&&fi(e)==y}function Ys(e){return"symbol"==typeof e||$s(e)&&fi(e)==w}var Xs=rt?Tt(rt):function(e){return $s(e)&&Us(e.length)&&!!Be[fi(e)]};var Zs=Rr(ji),ea=Rr((function(e,t){return e<=t}));function ta(e){if(!e)return[];if(Ds(e))return Ks(e)?Vt(e):vr(e);if(Xe&&e[Xe])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[Xe]());var t=no(e);return(t==g?Bt:t==b?Ht:Oa)(e)}function na(e){return e?(e=oa(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function ia(e){var t=na(e),n=t%1;return t==t?n?t-n:t:0}function ra(e){return e?Qn(ia(e),0,4294967295):0}function oa(e){if("number"==typeof e)return e;if(Ys(e))return NaN;if(Hs(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Hs(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(J,"");var n=oe.test(e);return n||ae.test(e)?$e(e.slice(2),n?2:8):re.test(e)?NaN:+e}function sa(e){return _r(e,wa(e))}function aa(e){return null==e?"":Yi(e)}var ca=yr((function(e,t){if(ho(t)||Ds(t))_r(t,ya(t),e);else for(var n in t)Ee.call(t,n)&&Hn(e,n,t[n])})),la=yr((function(e,t){_r(t,wa(t),e)})),ua=yr((function(e,t,n,i){_r(t,wa(t),e,i)})),da=yr((function(e,t,n,i){_r(t,ya(t),e,i)})),ha=$r(Jn);var fa=zi((function(e,t){e=ge(e);var n=-1,i=t.length,r=i>2?t[2]:void 0;for(r&&ao(t[0],t[1],r)&&(i=1);++n<i;)for(var o=t[n],s=wa(o),a=-1,c=s.length;++a<c;){var l=s[a],u=e[l];(void 0===u||Os(u,we[l])&&!Ee.call(e,l))&&(e[l]=o[l])}return e})),pa=zi((function(e){return e.push(void 0,qr),ot(xa,void 0,e)}));function ga(e,t,n){var i=null==e?void 0:di(e,t);return void 0===i?n:i}function ma(e,t){return null!=e&&io(e,t,mi)}var va=Or((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Ce.call(t)),e[t]=n}),Ha(Va)),_a=Or((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Ce.call(t)),Ee.call(e,t)?e[t].push(n):e[t]=[n]}),Kr),ba=zi(_i);function ya(e){return Ds(e)?zn(e):Ei(e)}function wa(e){return Ds(e)?zn(e,!0):Ai(e)}var Sa=yr((function(e,t,n){Ti(e,t,n)})),xa=yr((function(e,t,n,i){Ti(e,t,n,i)})),Ea=$r((function(e,t){var n={};if(null==e)return n;var i=!1;t=ft(t,(function(t){return t=ar(t,e),i||(i=t.length>1),t})),_r(e,Vr(e),n),i&&(n=Kn(n,7,Ur));for(var r=t.length;r--;)Zi(n,t[r]);return n}));var Aa=$r((function(e,t){return null==e?{}:function(e,t){return Ii(e,t,(function(t,n){return ma(e,n)}))}(e,t)}));function ja(e,t){if(null==e)return{};var n=ft(Vr(e),(function(e){return[e]}));return t=Kr(t),Ii(e,n,(function(e,n){return t(e,n[0])}))}var Ca=zr(ya),ka=zr(wa);function Oa(e){return null==e?[]:Nt(e,ya(e))}var Ta=Er((function(e,t,n){return t=t.toLowerCase(),e+(n?Na(t):t)}));function Na(e){return Fa(aa(e).toLowerCase())}function Ma(e){return(e=aa(e))&&e.replace(le,Pt).replace(Ie,"")}var Ia=Er((function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),Ra=Er((function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),Da=xr("toLowerCase");var Pa=Er((function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}));var La=Er((function(e,t,n){return e+(n?" ":"")+Fa(t)}));var za=Er((function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),Fa=xr("toUpperCase");function Ba(e,t,n){return e=aa(e),void 0===(t=n?void 0:t)?function(e){return Le.test(e)}(e)?function(e){return e.match(De)||[]}(e):function(e){return e.match(ee)||[]}(e):e.match(t)||[]}var qa=zi((function(e,t){try{return ot(e,void 0,t)}catch(e){return Fs(e)?e:new he(e)}})),Ua=$r((function(e,t){return at(t,(function(t){t=jo(t),Gn(e,t,_s(e[t],e))})),e}));function Ha(e){return function(){return e}}var $a=Cr(),Wa=Cr(!0);function Va(e){return e}function Ga(e){return xi("function"==typeof e?e:Kn(e,1))}var Ja=zi((function(e,t){return function(n){return _i(n,e,t)}})),Qa=zi((function(e,t){return function(n){return _i(e,n,t)}}));function Ka(e,t,n){var i=ya(t),r=ui(t,i);null!=n||Hs(t)&&(r.length||!i.length)||(n=t,t=e,e=this,r=ui(t,ya(t)));var o=!(Hs(n)&&"chain"in n&&!n.chain),s=Bs(e);return at(r,(function(n){var i=t[n];e[n]=i,s&&(e.prototype[n]=function(){var t=this.__chain__;if(o||t){var n=e(this.__wrapped__),r=n.__actions__=vr(this.__actions__);return r.push({func:i,args:arguments,thisArg:e}),n.__chain__=t,n}return i.apply(e,pt([this.value()],arguments))})})),e}function Ya(){}var Xa=Nr(ft),Za=Nr(lt),ec=Nr(vt);function tc(e){return co(e)?At(jo(e)):function(e){return function(t){return di(t,e)}}(e)}var nc=Ir(),ic=Ir(!0);function rc(){return[]}function oc(){return!1}var sc=Tr((function(e,t){return e+t}),0),ac=Pr("ceil"),cc=Tr((function(e,t){return e/t}),1),lc=Pr("floor");var uc,dc=Tr((function(e,t){return e*t}),1),hc=Pr("round"),fc=Tr((function(e,t){return e-t}),0);return kn.after=function(e,t){if("function"!=typeof t)throw new _e(o);return e=ia(e),function(){if(--e<1)return t.apply(this,arguments)}},kn.ary=ms,kn.assign=ca,kn.assignIn=la,kn.assignInWith=ua,kn.assignWith=da,kn.at=ha,kn.before=vs,kn.bind=_s,kn.bindAll=Ua,kn.bindKey=bs,kn.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Is(e)?e:[e]},kn.chain=ts,kn.chunk=function(e,t,n){t=(n?ao(e,t,n):void 0===t)?1:sn(ia(t),0);var r=null==e?0:e.length;if(!r||t<1)return[];for(var o=0,s=0,a=i(Xt(r/t));o<r;)a[s++]=Wi(e,o,o+=t);return a},kn.compact=function(e){for(var t=-1,n=null==e?0:e.length,i=0,r=[];++t<n;){var o=e[t];o&&(r[i++]=o)}return r},kn.concat=function(){var e=arguments.length;if(!e)return[];for(var t=i(e-1),n=arguments[0],r=e;r--;)t[r-1]=arguments[r];return pt(Is(n)?vr(n):[n],oi(t,1))},kn.cond=function(e){var t=null==e?0:e.length,n=Kr();return e=t?ft(e,(function(e){if("function"!=typeof e[1])throw new _e(o);return[n(e[0]),e[1]]})):[],zi((function(n){for(var i=-1;++i<t;){var r=e[i];if(ot(r[0],this,n))return ot(r[1],this,n)}}))},kn.conforms=function(e){return function(e){var t=ya(e);return function(n){return Yn(n,e,t)}}(Kn(e,1))},kn.constant=Ha,kn.countBy=rs,kn.create=function(e,t){var n=On(e);return null==t?n:Vn(n,t)},kn.curry=function e(t,n,i){var r=Fr(t,8,void 0,void 0,void 0,void 0,void 0,n=i?void 0:n);return r.placeholder=e.placeholder,r},kn.curryRight=function e(t,n,i){var r=Fr(t,16,void 0,void 0,void 0,void 0,void 0,n=i?void 0:n);return r.placeholder=e.placeholder,r},kn.debounce=ys,kn.defaults=fa,kn.defaultsDeep=pa,kn.defer=ws,kn.delay=Ss,kn.difference=Oo,kn.differenceBy=To,kn.differenceWith=No,kn.drop=function(e,t,n){var i=null==e?0:e.length;return i?Wi(e,(t=n||void 0===t?1:ia(t))<0?0:t,i):[]},kn.dropRight=function(e,t,n){var i=null==e?0:e.length;return i?Wi(e,0,(t=i-(t=n||void 0===t?1:ia(t)))<0?0:t):[]},kn.dropRightWhile=function(e,t){return e&&e.length?tr(e,Kr(t,3),!0,!0):[]},kn.dropWhile=function(e,t){return e&&e.length?tr(e,Kr(t,3),!0):[]},kn.fill=function(e,t,n,i){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&ao(e,t,n)&&(n=0,i=r),function(e,t,n,i){var r=e.length;for((n=ia(n))<0&&(n=-n>r?0:r+n),(i=void 0===i||i>r?r:ia(i))<0&&(i+=r),i=n>i?0:ra(i);n<i;)e[n++]=t;return e}(e,t,n,i)):[]},kn.filter=function(e,t){return(Is(e)?ut:ri)(e,Kr(t,3))},kn.flatMap=function(e,t){return oi(hs(e,t),1)},kn.flatMapDeep=function(e,t){return oi(hs(e,t),1/0)},kn.flatMapDepth=function(e,t,n){return n=void 0===n?1:ia(n),oi(hs(e,t),n)},kn.flatten=Ro,kn.flattenDeep=function(e){return(null==e?0:e.length)?oi(e,1/0):[]},kn.flattenDepth=function(e,t){return(null==e?0:e.length)?oi(e,t=void 0===t?1:ia(t)):[]},kn.flip=function(e){return Fr(e,512)},kn.flow=$a,kn.flowRight=Wa,kn.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,i={};++t<n;){var r=e[t];i[r[0]]=r[1]}return i},kn.functions=function(e){return null==e?[]:ui(e,ya(e))},kn.functionsIn=function(e){return null==e?[]:ui(e,wa(e))},kn.groupBy=ls,kn.initial=function(e){return(null==e?0:e.length)?Wi(e,0,-1):[]},kn.intersection=Po,kn.intersectionBy=Lo,kn.intersectionWith=zo,kn.invert=va,kn.invertBy=_a,kn.invokeMap=us,kn.iteratee=Ga,kn.keyBy=ds,kn.keys=ya,kn.keysIn=wa,kn.map=hs,kn.mapKeys=function(e,t){var n={};return t=Kr(t,3),ci(e,(function(e,i,r){Gn(n,t(e,i,r),e)})),n},kn.mapValues=function(e,t){var n={};return t=Kr(t,3),ci(e,(function(e,i,r){Gn(n,i,t(e,i,r))})),n},kn.matches=function(e){return ki(Kn(e,1))},kn.matchesProperty=function(e,t){return Oi(e,Kn(t,1))},kn.memoize=xs,kn.merge=Sa,kn.mergeWith=xa,kn.method=Ja,kn.methodOf=Qa,kn.mixin=Ka,kn.negate=Es,kn.nthArg=function(e){return e=ia(e),zi((function(t){return Ni(t,e)}))},kn.omit=Ea,kn.omitBy=function(e,t){return ja(e,Es(Kr(t)))},kn.once=function(e){return vs(2,e)},kn.orderBy=function(e,t,n,i){return null==e?[]:(Is(t)||(t=null==t?[]:[t]),Is(n=i?void 0:n)||(n=null==n?[]:[n]),Mi(e,t,n))},kn.over=Xa,kn.overArgs=As,kn.overEvery=Za,kn.overSome=ec,kn.partial=js,kn.partialRight=Cs,kn.partition=fs,kn.pick=Aa,kn.pickBy=ja,kn.property=tc,kn.propertyOf=function(e){return function(t){return null==e?void 0:di(e,t)}},kn.pull=Bo,kn.pullAll=qo,kn.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?Ri(e,t,Kr(n,2)):e},kn.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?Ri(e,t,void 0,n):e},kn.pullAt=Uo,kn.range=nc,kn.rangeRight=ic,kn.rearg=ks,kn.reject=function(e,t){return(Is(e)?ut:ri)(e,Es(Kr(t,3)))},kn.remove=function(e,t){var n=[];if(!e||!e.length)return n;var i=-1,r=[],o=e.length;for(t=Kr(t,3);++i<o;){var s=e[i];t(s,i,e)&&(n.push(s),r.push(i))}return Di(e,r),n},kn.rest=function(e,t){if("function"!=typeof e)throw new _e(o);return zi(e,t=void 0===t?t:ia(t))},kn.reverse=Ho,kn.sampleSize=function(e,t,n){return t=(n?ao(e,t,n):void 0===t)?1:ia(t),(Is(e)?Bn:Bi)(e,t)},kn.set=function(e,t,n){return null==e?e:qi(e,t,n)},kn.setWith=function(e,t,n,i){return i="function"==typeof i?i:void 0,null==e?e:qi(e,t,n,i)},kn.shuffle=function(e){return(Is(e)?qn:$i)(e)},kn.slice=function(e,t,n){var i=null==e?0:e.length;return i?(n&&"number"!=typeof n&&ao(e,t,n)?(t=0,n=i):(t=null==t?0:ia(t),n=void 0===n?i:ia(n)),Wi(e,t,n)):[]},kn.sortBy=ps,kn.sortedUniq=function(e){return e&&e.length?Qi(e):[]},kn.sortedUniqBy=function(e,t){return e&&e.length?Qi(e,Kr(t,2)):[]},kn.split=function(e,t,n){return n&&"number"!=typeof n&&ao(e,t,n)&&(t=n=void 0),(n=void 0===n?4294967295:n>>>0)?(e=aa(e))&&("string"==typeof t||null!=t&&!Js(t))&&!(t=Yi(t))&&Ft(e)?lr(Vt(e),0,n):e.split(t,n):[]},kn.spread=function(e,t){if("function"!=typeof e)throw new _e(o);return t=null==t?0:sn(ia(t),0),zi((function(n){var i=n[t],r=lr(n,0,t);return i&&pt(r,i),ot(e,this,r)}))},kn.tail=function(e){var t=null==e?0:e.length;return t?Wi(e,1,t):[]},kn.take=function(e,t,n){return e&&e.length?Wi(e,0,(t=n||void 0===t?1:ia(t))<0?0:t):[]},kn.takeRight=function(e,t,n){var i=null==e?0:e.length;return i?Wi(e,(t=i-(t=n||void 0===t?1:ia(t)))<0?0:t,i):[]},kn.takeRightWhile=function(e,t){return e&&e.length?tr(e,Kr(t,3),!1,!0):[]},kn.takeWhile=function(e,t){return e&&e.length?tr(e,Kr(t,3)):[]},kn.tap=function(e,t){return t(e),e},kn.throttle=function(e,t,n){var i=!0,r=!0;if("function"!=typeof e)throw new _e(o);return Hs(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),ys(e,t,{leading:i,maxWait:t,trailing:r})},kn.thru=ns,kn.toArray=ta,kn.toPairs=Ca,kn.toPairsIn=ka,kn.toPath=function(e){return Is(e)?ft(e,jo):Ys(e)?[e]:vr(Ao(aa(e)))},kn.toPlainObject=sa,kn.transform=function(e,t,n){var i=Is(e),r=i||Ls(e)||Xs(e);if(t=Kr(t,4),null==n){var o=e&&e.constructor;n=r?i?new o:[]:Hs(e)&&Bs(o)?On(We(e)):{}}return(r?at:ci)(e,(function(e,i,r){return t(n,e,i,r)})),n},kn.unary=function(e){return ms(e,1)},kn.union=$o,kn.unionBy=Wo,kn.unionWith=Vo,kn.uniq=function(e){return e&&e.length?Xi(e):[]},kn.uniqBy=function(e,t){return e&&e.length?Xi(e,Kr(t,2)):[]},kn.uniqWith=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?Xi(e,void 0,t):[]},kn.unset=function(e,t){return null==e||Zi(e,t)},kn.unzip=Go,kn.unzipWith=Jo,kn.update=function(e,t,n){return null==e?e:er(e,t,sr(n))},kn.updateWith=function(e,t,n,i){return i="function"==typeof i?i:void 0,null==e?e:er(e,t,sr(n),i)},kn.values=Oa,kn.valuesIn=function(e){return null==e?[]:Nt(e,wa(e))},kn.without=Qo,kn.words=Ba,kn.wrap=function(e,t){return js(sr(t),e)},kn.xor=Ko,kn.xorBy=Yo,kn.xorWith=Xo,kn.zip=Zo,kn.zipObject=function(e,t){return rr(e||[],t||[],Hn)},kn.zipObjectDeep=function(e,t){return rr(e||[],t||[],qi)},kn.zipWith=es,kn.entries=Ca,kn.entriesIn=ka,kn.extend=la,kn.extendWith=ua,Ka(kn,kn),kn.add=sc,kn.attempt=qa,kn.camelCase=Ta,kn.capitalize=Na,kn.ceil=ac,kn.clamp=function(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=oa(n))==n?n:0),void 0!==t&&(t=(t=oa(t))==t?t:0),Qn(oa(e),t,n)},kn.clone=function(e){return Kn(e,4)},kn.cloneDeep=function(e){return Kn(e,5)},kn.cloneDeepWith=function(e,t){return Kn(e,5,t="function"==typeof t?t:void 0)},kn.cloneWith=function(e,t){return Kn(e,4,t="function"==typeof t?t:void 0)},kn.conformsTo=function(e,t){return null==t||Yn(e,t,ya(t))},kn.deburr=Ma,kn.defaultTo=function(e,t){return null==e||e!=e?t:e},kn.divide=cc,kn.endsWith=function(e,t,n){e=aa(e),t=Yi(t);var i=e.length,r=n=void 0===n?i:Qn(ia(n),0,i);return(n-=t.length)>=0&&e.slice(n,r)==t},kn.eq=Os,kn.escape=function(e){return(e=aa(e))&&F.test(e)?e.replace(L,Lt):e},kn.escapeRegExp=function(e){return(e=aa(e))&&G.test(e)?e.replace(V,"\\$&"):e},kn.every=function(e,t,n){var i=Is(e)?lt:ni;return n&&ao(e,t,n)&&(t=void 0),i(e,Kr(t,3))},kn.find=os,kn.findIndex=Mo,kn.findKey=function(e,t){return bt(e,Kr(t,3),ci)},kn.findLast=ss,kn.findLastIndex=Io,kn.findLastKey=function(e,t){return bt(e,Kr(t,3),li)},kn.floor=lc,kn.forEach=as,kn.forEachRight=cs,kn.forIn=function(e,t){return null==e?e:si(e,Kr(t,3),wa)},kn.forInRight=function(e,t){return null==e?e:ai(e,Kr(t,3),wa)},kn.forOwn=function(e,t){return e&&ci(e,Kr(t,3))},kn.forOwnRight=function(e,t){return e&&li(e,Kr(t,3))},kn.get=ga,kn.gt=Ts,kn.gte=Ns,kn.has=function(e,t){return null!=e&&io(e,t,gi)},kn.hasIn=ma,kn.head=Do,kn.identity=Va,kn.includes=function(e,t,n,i){e=Ds(e)?e:Oa(e),n=n&&!i?ia(n):0;var r=e.length;return n<0&&(n=sn(r+n,0)),Ks(e)?n<=r&&e.indexOf(t,n)>-1:!!r&&wt(e,t,n)>-1},kn.indexOf=function(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=null==n?0:ia(n);return r<0&&(r=sn(i+r,0)),wt(e,t,r)},kn.inRange=function(e,t,n){return t=na(t),void 0===n?(n=t,t=0):n=na(n),function(e,t,n){return e>=an(t,n)&&e<sn(t,n)}(e=oa(e),t,n)},kn.invoke=ba,kn.isArguments=Ms,kn.isArray=Is,kn.isArrayBuffer=Rs,kn.isArrayLike=Ds,kn.isArrayLikeObject=Ps,kn.isBoolean=function(e){return!0===e||!1===e||$s(e)&&fi(e)==u},kn.isBuffer=Ls,kn.isDate=zs,kn.isElement=function(e){return $s(e)&&1===e.nodeType&&!Gs(e)},kn.isEmpty=function(e){if(null==e)return!0;if(Ds(e)&&(Is(e)||"string"==typeof e||"function"==typeof e.splice||Ls(e)||Xs(e)||Ms(e)))return!e.length;var t=no(e);if(t==g||t==b)return!e.size;if(ho(e))return!Ei(e).length;for(var n in e)if(Ee.call(e,n))return!1;return!0},kn.isEqual=function(e,t){return yi(e,t)},kn.isEqualWith=function(e,t,n){var i=(n="function"==typeof n?n:void 0)?n(e,t):void 0;return void 0===i?yi(e,t,void 0,n):!!i},kn.isError=Fs,kn.isFinite=function(e){return"number"==typeof e&&nn(e)},kn.isFunction=Bs,kn.isInteger=qs,kn.isLength=Us,kn.isMap=Ws,kn.isMatch=function(e,t){return e===t||wi(e,t,Xr(t))},kn.isMatchWith=function(e,t,n){return n="function"==typeof n?n:void 0,wi(e,t,Xr(t),n)},kn.isNaN=function(e){return Vs(e)&&e!=+e},kn.isNative=function(e){if(uo(e))throw new he("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Si(e)},kn.isNil=function(e){return null==e},kn.isNull=function(e){return null===e},kn.isNumber=Vs,kn.isObject=Hs,kn.isObjectLike=$s,kn.isPlainObject=Gs,kn.isRegExp=Js,kn.isSafeInteger=function(e){return qs(e)&&e>=-9007199254740991&&e<=9007199254740991},kn.isSet=Qs,kn.isString=Ks,kn.isSymbol=Ys,kn.isTypedArray=Xs,kn.isUndefined=function(e){return void 0===e},kn.isWeakMap=function(e){return $s(e)&&no(e)==S},kn.isWeakSet=function(e){return $s(e)&&"[object WeakSet]"==fi(e)},kn.join=function(e,t){return null==e?"":rn.call(e,t)},kn.kebabCase=Ia,kn.last=Fo,kn.lastIndexOf=function(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=i;return void 0!==n&&(r=(r=ia(n))<0?sn(i+r,0):an(r,i-1)),t==t?function(e,t,n){for(var i=n+1;i--;)if(e[i]===t)return i;return i}(e,t,r):yt(e,xt,r,!0)},kn.lowerCase=Ra,kn.lowerFirst=Da,kn.lt=Zs,kn.lte=ea,kn.max=function(e){return e&&e.length?ii(e,Va,pi):void 0},kn.maxBy=function(e,t){return e&&e.length?ii(e,Kr(t,2),pi):void 0},kn.mean=function(e){return Et(e,Va)},kn.meanBy=function(e,t){return Et(e,Kr(t,2))},kn.min=function(e){return e&&e.length?ii(e,Va,ji):void 0},kn.minBy=function(e,t){return e&&e.length?ii(e,Kr(t,2),ji):void 0},kn.stubArray=rc,kn.stubFalse=oc,kn.stubObject=function(){return{}},kn.stubString=function(){return""},kn.stubTrue=function(){return!0},kn.multiply=dc,kn.nth=function(e,t){return e&&e.length?Ni(e,ia(t)):void 0},kn.noConflict=function(){return Ge._===this&&(Ge._=Oe),this},kn.noop=Ya,kn.now=gs,kn.pad=function(e,t,n){e=aa(e);var i=(t=ia(t))?Wt(e):0;if(!t||i>=t)return e;var r=(t-i)/2;return Mr(Zt(r),n)+e+Mr(Xt(r),n)},kn.padEnd=function(e,t,n){e=aa(e);var i=(t=ia(t))?Wt(e):0;return t&&i<t?e+Mr(t-i,n):e},kn.padStart=function(e,t,n){e=aa(e);var i=(t=ia(t))?Wt(e):0;return t&&i<t?Mr(t-i,n)+e:e},kn.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),ln(aa(e).replace(Q,""),t||0)},kn.random=function(e,t,n){if(n&&"boolean"!=typeof n&&ao(e,t,n)&&(t=n=void 0),void 0===n&&("boolean"==typeof t?(n=t,t=void 0):"boolean"==typeof e&&(n=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=na(e),void 0===t?(t=e,e=0):t=na(t)),e>t){var i=e;e=t,t=i}if(n||e%1||t%1){var r=un();return an(e+r*(t-e+He("1e-"+((r+"").length-1))),t)}return Pi(e,t)},kn.reduce=function(e,t,n){var i=Is(e)?gt:Ct,r=arguments.length<3;return i(e,Kr(t,4),n,r,ei)},kn.reduceRight=function(e,t,n){var i=Is(e)?mt:Ct,r=arguments.length<3;return i(e,Kr(t,4),n,r,ti)},kn.repeat=function(e,t,n){return t=(n?ao(e,t,n):void 0===t)?1:ia(t),Li(aa(e),t)},kn.replace=function(){var e=arguments,t=aa(e[0]);return e.length<3?t:t.replace(e[1],e[2])},kn.result=function(e,t,n){var i=-1,r=(t=ar(t,e)).length;for(r||(r=1,e=void 0);++i<r;){var o=null==e?void 0:e[jo(t[i])];void 0===o&&(i=r,o=n),e=Bs(o)?o.call(e):o}return e},kn.round=hc,kn.runInContext=e,kn.sample=function(e){return(Is(e)?Fn:Fi)(e)},kn.size=function(e){if(null==e)return 0;if(Ds(e))return Ks(e)?Wt(e):e.length;var t=no(e);return t==g||t==b?e.size:Ei(e).length},kn.snakeCase=Pa,kn.some=function(e,t,n){var i=Is(e)?vt:Vi;return n&&ao(e,t,n)&&(t=void 0),i(e,Kr(t,3))},kn.sortedIndex=function(e,t){return Gi(e,t)},kn.sortedIndexBy=function(e,t,n){return Ji(e,t,Kr(n,2))},kn.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var i=Gi(e,t);if(i<n&&Os(e[i],t))return i}return-1},kn.sortedLastIndex=function(e,t){return Gi(e,t,!0)},kn.sortedLastIndexBy=function(e,t,n){return Ji(e,t,Kr(n,2),!0)},kn.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var n=Gi(e,t,!0)-1;if(Os(e[n],t))return n}return-1},kn.startCase=La,kn.startsWith=function(e,t,n){return e=aa(e),n=null==n?0:Qn(ia(n),0,e.length),t=Yi(t),e.slice(n,n+t.length)==t},kn.subtract=fc,kn.sum=function(e){return e&&e.length?kt(e,Va):0},kn.sumBy=function(e,t){return e&&e.length?kt(e,Kr(t,2)):0},kn.template=function(e,t,n){var i=kn.templateSettings;n&&ao(e,t,n)&&(t=void 0),e=aa(e),t=ua({},t,i,Br);var r,o,s=ua({},t.imports,i.imports,Br),a=ya(s),c=Nt(s,a),l=0,u=t.interpolate||ue,d="__p += '",h=me((t.escape||ue).source+"|"+u.source+"|"+(u===U?ne:ue).source+"|"+(t.evaluate||ue).source+"|$","g"),f="//# sourceURL="+(Ee.call(t,"sourceURL")?(t.sourceURL+"").replace(/[\r\n]/g," "):"lodash.templateSources["+ ++Fe+"]")+"\n";e.replace(h,(function(t,n,i,s,a,c){return i||(i=s),d+=e.slice(l,c).replace(de,zt),n&&(r=!0,d+="' +\n__e("+n+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),i&&(d+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),l=c+t.length,t})),d+="';\n";var p=Ee.call(t,"variable")&&t.variable;p||(d="with (obj) {\n"+d+"\n}\n"),d=(o?d.replace(I,""):d).replace(R,"$1").replace(D,"$1;"),d="function("+(p||"obj")+") {\n"+(p?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(r?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=qa((function(){return fe(a,f+"return "+d).apply(void 0,c)}));if(g.source=d,Fs(g))throw g;return g},kn.times=function(e,t){if((e=ia(e))<1||e>9007199254740991)return[];var n=4294967295,i=an(e,4294967295);e-=4294967295;for(var r=Ot(i,t=Kr(t));++n<e;)t(n);return r},kn.toFinite=na,kn.toInteger=ia,kn.toLength=ra,kn.toLower=function(e){return aa(e).toLowerCase()},kn.toNumber=oa,kn.toSafeInteger=function(e){return e?Qn(ia(e),-9007199254740991,9007199254740991):0===e?e:0},kn.toString=aa,kn.toUpper=function(e){return aa(e).toUpperCase()},kn.trim=function(e,t,n){if((e=aa(e))&&(n||void 0===t))return e.replace(J,"");if(!e||!(t=Yi(t)))return e;var i=Vt(e),r=Vt(t);return lr(i,It(i,r),Rt(i,r)+1).join("")},kn.trimEnd=function(e,t,n){if((e=aa(e))&&(n||void 0===t))return e.replace(K,"");if(!e||!(t=Yi(t)))return e;var i=Vt(e);return lr(i,0,Rt(i,Vt(t))+1).join("")},kn.trimStart=function(e,t,n){if((e=aa(e))&&(n||void 0===t))return e.replace(Q,"");if(!e||!(t=Yi(t)))return e;var i=Vt(e);return lr(i,It(i,Vt(t))).join("")},kn.truncate=function(e,t){var n=30,i="...";if(Hs(t)){var r="separator"in t?t.separator:r;n="length"in t?ia(t.length):n,i="omission"in t?Yi(t.omission):i}var o=(e=aa(e)).length;if(Ft(e)){var s=Vt(e);o=s.length}if(n>=o)return e;var a=n-Wt(i);if(a<1)return i;var c=s?lr(s,0,a).join(""):e.slice(0,a);if(void 0===r)return c+i;if(s&&(a+=c.length-a),Js(r)){if(e.slice(a).search(r)){var l,u=c;for(r.global||(r=me(r.source,aa(ie.exec(r))+"g")),r.lastIndex=0;l=r.exec(u);)var d=l.index;c=c.slice(0,void 0===d?a:d)}}else if(e.indexOf(Yi(r),a)!=a){var h=c.lastIndexOf(r);h>-1&&(c=c.slice(0,h))}return c+i},kn.unescape=function(e){return(e=aa(e))&&z.test(e)?e.replace(P,Gt):e},kn.uniqueId=function(e){var t=++Ae;return aa(e)+t},kn.upperCase=za,kn.upperFirst=Fa,kn.each=as,kn.eachRight=cs,kn.first=Do,Ka(kn,(uc={},ci(kn,(function(e,t){Ee.call(kn.prototype,t)||(uc[t]=e)})),uc),{chain:!1}),kn.VERSION="4.17.15",at(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){kn[e].placeholder=kn})),at(["drop","take"],(function(e,t){Mn.prototype[e]=function(n){n=void 0===n?1:sn(ia(n),0);var i=this.__filtered__&&!t?new Mn(this):this.clone();return i.__filtered__?i.__takeCount__=an(n,i.__takeCount__):i.__views__.push({size:an(n,4294967295),type:e+(i.__dir__<0?"Right":"")}),i},Mn.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),at(["filter","map","takeWhile"],(function(e,t){var n=t+1,i=1==n||3==n;Mn.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Kr(e,3),type:n}),t.__filtered__=t.__filtered__||i,t}})),at(["head","last"],(function(e,t){var n="take"+(t?"Right":"");Mn.prototype[e]=function(){return this[n](1).value()[0]}})),at(["initial","tail"],(function(e,t){var n="drop"+(t?"":"Right");Mn.prototype[e]=function(){return this.__filtered__?new Mn(this):this[n](1)}})),Mn.prototype.compact=function(){return this.filter(Va)},Mn.prototype.find=function(e){return this.filter(e).head()},Mn.prototype.findLast=function(e){return this.reverse().find(e)},Mn.prototype.invokeMap=zi((function(e,t){return"function"==typeof e?new Mn(this):this.map((function(n){return _i(n,e,t)}))})),Mn.prototype.reject=function(e){return this.filter(Es(Kr(e)))},Mn.prototype.slice=function(e,t){e=ia(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Mn(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),void 0!==t&&(n=(t=ia(t))<0?n.dropRight(-t):n.take(t-e)),n)},Mn.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Mn.prototype.toArray=function(){return this.take(4294967295)},ci(Mn.prototype,(function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),i=/^(?:head|last)$/.test(t),r=kn[i?"take"+("last"==t?"Right":""):t],o=i||/^find/.test(t);r&&(kn.prototype[t]=function(){var t=this.__wrapped__,s=i?[1]:arguments,a=t instanceof Mn,c=s[0],l=a||Is(t),u=function(e){var t=r.apply(kn,pt([e],s));return i&&d?t[0]:t};l&&n&&"function"==typeof c&&1!=c.length&&(a=l=!1);var d=this.__chain__,h=!!this.__actions__.length,f=o&&!d,p=a&&!h;if(!o&&l){t=p?t:new Mn(this);var g=e.apply(t,s);return g.__actions__.push({func:ns,args:[u],thisArg:void 0}),new Nn(g,d)}return f&&p?e.apply(this,s):(g=this.thru(u),f?i?g.value()[0]:g.value():g)})})),at(["pop","push","shift","sort","splice","unshift"],(function(e){var t=be[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);kn.prototype[e]=function(){var e=arguments;if(i&&!this.__chain__){var r=this.value();return t.apply(Is(r)?r:[],e)}return this[n]((function(n){return t.apply(Is(n)?n:[],e)}))}})),ci(Mn.prototype,(function(e,t){var n=kn[t];if(n){var i=n.name+"";Ee.call(bn,i)||(bn[i]=[]),bn[i].push({name:t,func:n})}})),bn[kr(void 0,2).name]=[{name:"wrapper",func:void 0}],Mn.prototype.clone=function(){var e=new Mn(this.__wrapped__);return e.__actions__=vr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=vr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=vr(this.__views__),e},Mn.prototype.reverse=function(){if(this.__filtered__){var e=new Mn(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Mn.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=Is(e),i=t<0,r=n?e.length:0,o=function(e,t,n){var i=-1,r=n.length;for(;++i<r;){var o=n[i],s=o.size;switch(o.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=an(t,e+s);break;case"takeRight":e=sn(e,t-s)}}return{start:e,end:t}}(0,r,this.__views__),s=o.start,a=o.end,c=a-s,l=i?a:s-1,u=this.__iteratees__,d=u.length,h=0,f=an(c,this.__takeCount__);if(!n||!i&&r==c&&f==c)return nr(e,this.__actions__);var p=[];e:for(;c--&&h<f;){for(var g=-1,m=e[l+=t];++g<d;){var v=u[g],_=v.iteratee,b=v.type,y=_(m);if(2==b)m=y;else if(!y){if(1==b)continue e;break e}}p[h++]=m}return p},kn.prototype.at=is,kn.prototype.chain=function(){return ts(this)},kn.prototype.commit=function(){return new Nn(this.value(),this.__chain__)},kn.prototype.next=function(){void 0===this.__values__&&(this.__values__=ta(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?void 0:this.__values__[this.__index__++]}},kn.prototype.plant=function(e){for(var t,n=this;n instanceof Tn;){var i=ko(n);i.__index__=0,i.__values__=void 0,t?r.__wrapped__=i:t=i;var r=i;n=n.__wrapped__}return r.__wrapped__=e,t},kn.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Mn){var t=e;return this.__actions__.length&&(t=new Mn(this)),(t=t.reverse()).__actions__.push({func:ns,args:[Ho],thisArg:void 0}),new Nn(t,this.__chain__)}return this.thru(Ho)},kn.prototype.toJSON=kn.prototype.valueOf=kn.prototype.value=function(){return nr(this.__wrapped__,this.__actions__)},kn.prototype.first=kn.prototype.head,Xe&&(kn.prototype[Xe]=function(){return this}),kn}();Ge._=Jt,void 0===(r=function(){return Jt}.call(t,n,t,i))||(i.exports=r)}).call(this)}).call(this,n(9),n(21)(e))},function(e,t,n){var i;
/*!
 * Sizzle CSS Selector Engine v2.3.5
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://js.foundation/
 *
 * Date: 2020-03-14
 */!function(r){var o,s,a,c,l,u,d,h,f,p,g,m,v,_,b,y,w,S,x,E="sizzle"+1*new Date,A=r.document,j=0,C=0,k=he(),O=he(),T=he(),N=he(),M=function(e,t){return e===t&&(g=!0),0},I={}.hasOwnProperty,R=[],D=R.pop,P=R.push,L=R.push,z=R.slice,F=function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},B="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",q="[\\x20\\t\\r\\n\\f]",U="(?:\\\\[\\da-fA-F]{1,6}"+q+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",H="\\["+q+"*("+U+")(?:"+q+"*([*^$|!~]?=)"+q+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+U+"))|)"+q+"*\\]",$=":("+U+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+H+")*)|.*)\\)|)",W=new RegExp(q+"+","g"),V=new RegExp("^"+q+"+|((?:^|[^\\\\])(?:\\\\.)*)"+q+"+$","g"),G=new RegExp("^"+q+"*,"+q+"*"),J=new RegExp("^"+q+"*([>+~]|"+q+")"+q+"*"),Q=new RegExp(q+"|>"),K=new RegExp($),Y=new RegExp("^"+U+"$"),X={ID:new RegExp("^#("+U+")"),CLASS:new RegExp("^\\.("+U+")"),TAG:new RegExp("^("+U+"|[*])"),ATTR:new RegExp("^"+H),PSEUDO:new RegExp("^"+$),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+q+"*(even|odd|(([+-]|)(\\d*)n|)"+q+"*(?:([+-]|)"+q+"*(\\d+)|))"+q+"*\\)|)","i"),bool:new RegExp("^(?:"+B+")$","i"),needsContext:new RegExp("^"+q+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+q+"*((?:-\\d)?\\d*)"+q+"*\\)|)(?=[^-]|$)","i")},Z=/HTML$/i,ee=/^(?:input|select|textarea|button)$/i,te=/^h\d$/i,ne=/^[^{]+\{\s*\[native \w/,ie=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,re=/[+~]/,oe=new RegExp("\\\\[\\da-fA-F]{1,6}"+q+"?|\\\\([^\\r\\n\\f])","g"),se=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},ae=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ce=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},le=function(){m()},ue=Ee((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{L.apply(R=z.call(A.childNodes),A.childNodes),R[A.childNodes.length].nodeType}catch(e){L={apply:R.length?function(e,t){P.apply(e,z.call(t))}:function(e,t){for(var n=e.length,i=0;e[n++]=t[i++];);e.length=n-1}}}function de(e,t,n,i){var r,o,a,c,l,d,f,p=t&&t.ownerDocument,g=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==g&&9!==g&&11!==g)return n;if(!i&&(m(t),t=t||v,b)){if(11!==g&&(l=ie.exec(e)))if(r=l[1]){if(9===g){if(!(a=t.getElementById(r)))return n;if(a.id===r)return n.push(a),n}else if(p&&(a=p.getElementById(r))&&x(t,a)&&a.id===r)return n.push(a),n}else{if(l[2])return L.apply(n,t.getElementsByTagName(e)),n;if((r=l[3])&&s.getElementsByClassName&&t.getElementsByClassName)return L.apply(n,t.getElementsByClassName(r)),n}if(s.qsa&&!N[e+" "]&&(!y||!y.test(e))&&(1!==g||"object"!==t.nodeName.toLowerCase())){if(f=e,p=t,1===g&&(Q.test(e)||J.test(e))){for((p=re.test(e)&&we(t.parentNode)||t)===t&&s.scope||((c=t.getAttribute("id"))?c=c.replace(ae,ce):t.setAttribute("id",c=E)),o=(d=u(e)).length;o--;)d[o]=(c?"#"+c:":scope")+" "+xe(d[o]);f=d.join(",")}try{return L.apply(n,p.querySelectorAll(f)),n}catch(t){N(e,!0)}finally{c===E&&t.removeAttribute("id")}}}return h(e.replace(V,"$1"),t,n,i)}function he(){var e=[];return function t(n,i){return e.push(n+" ")>a.cacheLength&&delete t[e.shift()],t[n+" "]=i}}function fe(e){return e[E]=!0,e}function pe(e){var t=v.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ge(e,t){for(var n=e.split("|"),i=n.length;i--;)a.attrHandle[n[i]]=t}function me(e,t){var n=t&&e,i=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(i)return i;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function ve(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function _e(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function be(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ue(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function ye(e){return fe((function(t){return t=+t,fe((function(n,i){for(var r,o=e([],n.length,t),s=o.length;s--;)n[r=o[s]]&&(n[r]=!(i[r]=n[r]))}))}))}function we(e){return e&&void 0!==e.getElementsByTagName&&e}for(o in s=de.support={},l=de.isXML=function(e){var t=e.namespaceURI,n=(e.ownerDocument||e).documentElement;return!Z.test(t||n&&n.nodeName||"HTML")},m=de.setDocument=function(e){var t,n,i=e?e.ownerDocument||e:A;return i!=v&&9===i.nodeType&&i.documentElement?(_=(v=i).documentElement,b=!l(v),A!=v&&(n=v.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",le,!1):n.attachEvent&&n.attachEvent("onunload",le)),s.scope=pe((function(e){return _.appendChild(e).appendChild(v.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),s.attributes=pe((function(e){return e.className="i",!e.getAttribute("className")})),s.getElementsByTagName=pe((function(e){return e.appendChild(v.createComment("")),!e.getElementsByTagName("*").length})),s.getElementsByClassName=ne.test(v.getElementsByClassName),s.getById=pe((function(e){return _.appendChild(e).id=E,!v.getElementsByName||!v.getElementsByName(E).length})),s.getById?(a.filter.ID=function(e){var t=e.replace(oe,se);return function(e){return e.getAttribute("id")===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&b){var n=t.getElementById(e);return n?[n]:[]}}):(a.filter.ID=function(e){var t=e.replace(oe,se);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&b){var n,i,r,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];for(r=t.getElementsByName(e),i=0;o=r[i++];)if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),a.find.TAG=s.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):s.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,i=[],r=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[r++];)1===n.nodeType&&i.push(n);return i}return o},a.find.CLASS=s.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&b)return t.getElementsByClassName(e)},w=[],y=[],(s.qsa=ne.test(v.querySelectorAll))&&(pe((function(e){var t;_.appendChild(e).innerHTML="<a id='"+E+"'></a><select id='"+E+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&y.push("[*^$]="+q+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||y.push("\\["+q+"*(?:value|"+B+")"),e.querySelectorAll("[id~="+E+"-]").length||y.push("~="),(t=v.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||y.push("\\["+q+"*name"+q+"*="+q+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||y.push(":checked"),e.querySelectorAll("a#"+E+"+*").length||y.push(".#.+[+~]"),e.querySelectorAll("\\\f"),y.push("[\\r\\n\\f]")})),pe((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=v.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&y.push("name"+q+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&y.push(":enabled",":disabled"),_.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&y.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),y.push(",.*:")}))),(s.matchesSelector=ne.test(S=_.matches||_.webkitMatchesSelector||_.mozMatchesSelector||_.oMatchesSelector||_.msMatchesSelector))&&pe((function(e){s.disconnectedMatch=S.call(e,"*"),S.call(e,"[s!='']:x"),w.push("!=",$)})),y=y.length&&new RegExp(y.join("|")),w=w.length&&new RegExp(w.join("|")),t=ne.test(_.compareDocumentPosition),x=t||ne.test(_.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},M=t?function(e,t){if(e===t)return g=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!s.sortDetached&&t.compareDocumentPosition(e)===n?e==v||e.ownerDocument==A&&x(A,e)?-1:t==v||t.ownerDocument==A&&x(A,t)?1:p?F(p,e)-F(p,t):0:4&n?-1:1)}:function(e,t){if(e===t)return g=!0,0;var n,i=0,r=e.parentNode,o=t.parentNode,s=[e],a=[t];if(!r||!o)return e==v?-1:t==v?1:r?-1:o?1:p?F(p,e)-F(p,t):0;if(r===o)return me(e,t);for(n=e;n=n.parentNode;)s.unshift(n);for(n=t;n=n.parentNode;)a.unshift(n);for(;s[i]===a[i];)i++;return i?me(s[i],a[i]):s[i]==A?-1:a[i]==A?1:0},v):v},de.matches=function(e,t){return de(e,null,null,t)},de.matchesSelector=function(e,t){if(m(e),s.matchesSelector&&b&&!N[t+" "]&&(!w||!w.test(t))&&(!y||!y.test(t)))try{var n=S.call(e,t);if(n||s.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){N(t,!0)}return de(t,v,null,[e]).length>0},de.contains=function(e,t){return(e.ownerDocument||e)!=v&&m(e),x(e,t)},de.attr=function(e,t){(e.ownerDocument||e)!=v&&m(e);var n=a.attrHandle[t.toLowerCase()],i=n&&I.call(a.attrHandle,t.toLowerCase())?n(e,t,!b):void 0;return void 0!==i?i:s.attributes||!b?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null},de.escape=function(e){return(e+"").replace(ae,ce)},de.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},de.uniqueSort=function(e){var t,n=[],i=0,r=0;if(g=!s.detectDuplicates,p=!s.sortStable&&e.slice(0),e.sort(M),g){for(;t=e[r++];)t===e[r]&&(i=n.push(r));for(;i--;)e.splice(n[i],1)}return p=null,e},c=de.getText=function(e){var t,n="",i=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=c(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[i++];)n+=c(t);return n},(a=de.selectors={cacheLength:50,createPseudo:fe,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(oe,se),e[3]=(e[3]||e[4]||e[5]||"").replace(oe,se),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||de.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&de.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return X.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&K.test(n)&&(t=u(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(oe,se).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=k[e+" "];return t||(t=new RegExp("(^|"+q+")"+e+"("+q+"|$)"))&&k(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(i){var r=de.attr(i,e);return null==r?"!="===t:!t||(r+="","="===t?r===n:"!="===t?r!==n:"^="===t?n&&0===r.indexOf(n):"*="===t?n&&r.indexOf(n)>-1:"$="===t?n&&r.slice(-n.length)===n:"~="===t?(" "+r.replace(W," ")+" ").indexOf(n)>-1:"|="===t&&(r===n||r.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,i,r){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===i&&0===r?function(e){return!!e.parentNode}:function(t,n,c){var l,u,d,h,f,p,g=o!==s?"nextSibling":"previousSibling",m=t.parentNode,v=a&&t.nodeName.toLowerCase(),_=!c&&!a,b=!1;if(m){if(o){for(;g;){for(h=t;h=h[g];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;p=g="only"===e&&!p&&"nextSibling"}return!0}if(p=[s?m.firstChild:m.lastChild],s&&_){for(b=(f=(l=(u=(d=(h=m)[E]||(h[E]={}))[h.uniqueID]||(d[h.uniqueID]={}))[e]||[])[0]===j&&l[1])&&l[2],h=f&&m.childNodes[f];h=++f&&h&&h[g]||(b=f=0)||p.pop();)if(1===h.nodeType&&++b&&h===t){u[e]=[j,f,b];break}}else if(_&&(b=f=(l=(u=(d=(h=t)[E]||(h[E]={}))[h.uniqueID]||(d[h.uniqueID]={}))[e]||[])[0]===j&&l[1]),!1===b)for(;(h=++f&&h&&h[g]||(b=f=0)||p.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++b||(_&&((u=(d=h[E]||(h[E]={}))[h.uniqueID]||(d[h.uniqueID]={}))[e]=[j,b]),h!==t)););return(b-=r)===i||b%i==0&&b/i>=0}}},PSEUDO:function(e,t){var n,i=a.pseudos[e]||a.setFilters[e.toLowerCase()]||de.error("unsupported pseudo: "+e);return i[E]?i(t):i.length>1?(n=[e,e,"",t],a.setFilters.hasOwnProperty(e.toLowerCase())?fe((function(e,n){for(var r,o=i(e,t),s=o.length;s--;)e[r=F(e,o[s])]=!(n[r]=o[s])})):function(e){return i(e,0,n)}):i}},pseudos:{not:fe((function(e){var t=[],n=[],i=d(e.replace(V,"$1"));return i[E]?fe((function(e,t,n,r){for(var o,s=i(e,null,r,[]),a=e.length;a--;)(o=s[a])&&(e[a]=!(t[a]=o))})):function(e,r,o){return t[0]=e,i(t,null,o,n),t[0]=null,!n.pop()}})),has:fe((function(e){return function(t){return de(e,t).length>0}})),contains:fe((function(e){return e=e.replace(oe,se),function(t){return(t.textContent||c(t)).indexOf(e)>-1}})),lang:fe((function(e){return Y.test(e||"")||de.error("unsupported lang: "+e),e=e.replace(oe,se).toLowerCase(),function(t){var n;do{if(n=b?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(e){var t=r.location&&r.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===_},focus:function(e){return e===v.activeElement&&(!v.hasFocus||v.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:be(!1),disabled:be(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!a.pseudos.empty(e)},header:function(e){return te.test(e.nodeName)},input:function(e){return ee.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ye((function(){return[0]})),last:ye((function(e,t){return[t-1]})),eq:ye((function(e,t,n){return[n<0?n+t:n]})),even:ye((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:ye((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:ye((function(e,t,n){for(var i=n<0?n+t:n>t?t:n;--i>=0;)e.push(i);return e})),gt:ye((function(e,t,n){for(var i=n<0?n+t:n;++i<t;)e.push(i);return e}))}}).pseudos.nth=a.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})a.pseudos[o]=ve(o);for(o in{submit:!0,reset:!0})a.pseudos[o]=_e(o);function Se(){}function xe(e){for(var t=0,n=e.length,i="";t<n;t++)i+=e[t].value;return i}function Ee(e,t,n){var i=t.dir,r=t.next,o=r||i,s=n&&"parentNode"===o,a=C++;return t.first?function(t,n,r){for(;t=t[i];)if(1===t.nodeType||s)return e(t,n,r);return!1}:function(t,n,c){var l,u,d,h=[j,a];if(c){for(;t=t[i];)if((1===t.nodeType||s)&&e(t,n,c))return!0}else for(;t=t[i];)if(1===t.nodeType||s)if(u=(d=t[E]||(t[E]={}))[t.uniqueID]||(d[t.uniqueID]={}),r&&r===t.nodeName.toLowerCase())t=t[i]||t;else{if((l=u[o])&&l[0]===j&&l[1]===a)return h[2]=l[2];if(u[o]=h,h[2]=e(t,n,c))return!0}return!1}}function Ae(e){return e.length>1?function(t,n,i){for(var r=e.length;r--;)if(!e[r](t,n,i))return!1;return!0}:e[0]}function je(e,t,n,i,r){for(var o,s=[],a=0,c=e.length,l=null!=t;a<c;a++)(o=e[a])&&(n&&!n(o,i,r)||(s.push(o),l&&t.push(a)));return s}function Ce(e,t,n,i,r,o){return i&&!i[E]&&(i=Ce(i)),r&&!r[E]&&(r=Ce(r,o)),fe((function(o,s,a,c){var l,u,d,h=[],f=[],p=s.length,g=o||function(e,t,n){for(var i=0,r=t.length;i<r;i++)de(e,t[i],n);return n}(t||"*",a.nodeType?[a]:a,[]),m=!e||!o&&t?g:je(g,h,e,a,c),v=n?r||(o?e:p||i)?[]:s:m;if(n&&n(m,v,a,c),i)for(l=je(v,f),i(l,[],a,c),u=l.length;u--;)(d=l[u])&&(v[f[u]]=!(m[f[u]]=d));if(o){if(r||e){if(r){for(l=[],u=v.length;u--;)(d=v[u])&&l.push(m[u]=d);r(null,v=[],l,c)}for(u=v.length;u--;)(d=v[u])&&(l=r?F(o,d):h[u])>-1&&(o[l]=!(s[l]=d))}}else v=je(v===s?v.splice(p,v.length):v),r?r(null,s,v,c):L.apply(s,v)}))}function ke(e){for(var t,n,i,r=e.length,o=a.relative[e[0].type],s=o||a.relative[" "],c=o?1:0,l=Ee((function(e){return e===t}),s,!0),u=Ee((function(e){return F(t,e)>-1}),s,!0),d=[function(e,n,i){var r=!o&&(i||n!==f)||((t=n).nodeType?l(e,n,i):u(e,n,i));return t=null,r}];c<r;c++)if(n=a.relative[e[c].type])d=[Ee(Ae(d),n)];else{if((n=a.filter[e[c].type].apply(null,e[c].matches))[E]){for(i=++c;i<r&&!a.relative[e[i].type];i++);return Ce(c>1&&Ae(d),c>1&&xe(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(V,"$1"),n,c<i&&ke(e.slice(c,i)),i<r&&ke(e=e.slice(i)),i<r&&xe(e))}d.push(n)}return Ae(d)}Se.prototype=a.filters=a.pseudos,a.setFilters=new Se,u=de.tokenize=function(e,t){var n,i,r,o,s,c,l,u=O[e+" "];if(u)return t?0:u.slice(0);for(s=e,c=[],l=a.preFilter;s;){for(o in n&&!(i=G.exec(s))||(i&&(s=s.slice(i[0].length)||s),c.push(r=[])),n=!1,(i=J.exec(s))&&(n=i.shift(),r.push({value:n,type:i[0].replace(V," ")}),s=s.slice(n.length)),a.filter)!(i=X[o].exec(s))||l[o]&&!(i=l[o](i))||(n=i.shift(),r.push({value:n,type:o,matches:i}),s=s.slice(n.length));if(!n)break}return t?s.length:s?de.error(e):O(e,c).slice(0)},d=de.compile=function(e,t){var n,i=[],r=[],o=T[e+" "];if(!o){for(t||(t=u(e)),n=t.length;n--;)(o=ke(t[n]))[E]?i.push(o):r.push(o);(o=T(e,function(e,t){var n=t.length>0,i=e.length>0,r=function(r,o,s,c,l){var u,d,h,p=0,g="0",_=r&&[],y=[],w=f,S=r||i&&a.find.TAG("*",l),x=j+=null==w?1:Math.random()||.1,E=S.length;for(l&&(f=o==v||o||l);g!==E&&null!=(u=S[g]);g++){if(i&&u){for(d=0,o||u.ownerDocument==v||(m(u),s=!b);h=e[d++];)if(h(u,o||v,s)){c.push(u);break}l&&(j=x)}n&&((u=!h&&u)&&p--,r&&_.push(u))}if(p+=g,n&&g!==p){for(d=0;h=t[d++];)h(_,y,o,s);if(r){if(p>0)for(;g--;)_[g]||y[g]||(y[g]=D.call(c));y=je(y)}L.apply(c,y),l&&!r&&y.length>0&&p+t.length>1&&de.uniqueSort(c)}return l&&(j=x,f=w),_};return n?fe(r):r}(r,i))).selector=e}return o},h=de.select=function(e,t,n,i){var r,o,s,c,l,h="function"==typeof e&&e,f=!i&&u(e=h.selector||e);if(n=n||[],1===f.length){if((o=f[0]=f[0].slice(0)).length>2&&"ID"===(s=o[0]).type&&9===t.nodeType&&b&&a.relative[o[1].type]){if(!(t=(a.find.ID(s.matches[0].replace(oe,se),t)||[])[0]))return n;h&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(r=X.needsContext.test(e)?0:o.length;r--&&(s=o[r],!a.relative[c=s.type]);)if((l=a.find[c])&&(i=l(s.matches[0].replace(oe,se),re.test(o[0].type)&&we(t.parentNode)||t))){if(o.splice(r,1),!(e=i.length&&xe(o)))return L.apply(n,i),n;break}}return(h||d(e,f))(i,t,!b,n,!t||re.test(e)&&we(t.parentNode)||t),n},s.sortStable=E.split("").sort(M).join("")===E,s.detectDuplicates=!!g,m(),s.sortDetached=pe((function(e){return 1&e.compareDocumentPosition(v.createElement("fieldset"))})),pe((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||ge("type|href|height|width",(function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),s.attributes&&pe((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||ge("value",(function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),pe((function(e){return null==e.getAttribute("disabled")}))||ge(B,(function(e,t,n){var i;if(!n)return!0===e[t]?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null}));var Oe=r.Sizzle;de.noConflict=function(){return r.Sizzle===de&&(r.Sizzle=Oe),de},void 0===(i=function(){return de}.call(t,n,t,e))||(e.exports=i)}(window)},function(e,t,n){var i=n(402),r=n(404),o=/[&<>"']/g,s=RegExp(o.source);e.exports=function(e){return(e=r(e))&&s.test(e)?e.replace(o,i):e}},function(e,t,n){!function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,(function(e){var n=t[s][1][e];return r(n||e)}),l,l.exports,e,t,n,i)}return n[s].exports}for(var o=!1,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){var i=e("cssfilter").FilterCSS,r=e("cssfilter").getDefaultWhiteList,o=e("./util");function s(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","loop","preload","src","height","width"]}}var a=new i;function c(e){return e.replace(l,"&lt;").replace(u,"&gt;")}var l=/</g,u=/>/g,d=/"/g,h=/&quot;/g,f=/&#([a-zA-Z0-9]*);?/gim,p=/&colon;?/gim,g=/&newline;?/gim,m=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,v=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,_=/u\s*r\s*l\s*\(.*/gi;function b(e){return e.replace(d,"&quot;")}function y(e){return e.replace(h,'"')}function w(e){return e.replace(f,(function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))}))}function S(e){return e.replace(p,":").replace(g," ")}function x(e){for(var t="",n=0,i=e.length;n<i;n++)t+=e.charCodeAt(n)<32?" ":e.charAt(n);return o.trim(t)}function E(e){return e=x(e=S(e=w(e=y(e))))}function A(e){return e=c(e=b(e))}var j=/<!--[\s\S]*?-->/g;n.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","loop","preload","src","height","width"]},n.getDefaultWhiteList=s,n.onTag=function(e,t,n){},n.onIgnoreTag=function(e,t,n){},n.onTagAttr=function(e,t,n){},n.onIgnoreTagAttr=function(e,t,n){},n.safeAttrValue=function(e,t,n,i){if(n=E(n),"href"===t||"src"===t){if("#"===(n=o.trim(n)))return"#";if("http://"!==n.substr(0,7)&&"https://"!==n.substr(0,8)&&"mailto:"!==n.substr(0,7)&&"tel:"!==n.substr(0,4)&&"#"!==n[0]&&"/"!==n[0])return""}else if("background"===t){if(m.lastIndex=0,m.test(n))return""}else if("style"===t){if(v.lastIndex=0,v.test(n))return"";if(_.lastIndex=0,_.test(n)&&(m.lastIndex=0,m.test(n)))return"";!1!==i&&(n=(i=i||a).process(n))}return n=A(n)},n.escapeHtml=c,n.escapeQuote=b,n.unescapeQuote=y,n.escapeHtmlEntities=w,n.escapeDangerHtml5Entities=S,n.clearNonPrintableCharacter=x,n.friendlyAttrValue=E,n.escapeAttrValue=A,n.onIgnoreTagStripAll=function(){return""},n.StripTagBody=function(e,t){"function"!=typeof t&&(t=function(){});var n=!Array.isArray(e),i=[],r=!1;return{onIgnoreTag:function(s,a,c){if(function(t){return!!n||-1!==o.indexOf(e,t)}(s)){if(c.isClosing){var l="[/removed]",u=c.position+l.length;return i.push([!1!==r?r:c.position,u]),r=!1,l}return r||(r=c.position),"[removed]"}return t(s,a,c)},remove:function(e){var t="",n=0;return o.forEach(i,(function(i){t+=e.slice(n,i[0]),n=i[1]})),t+=e.slice(n)}}},n.stripCommentTag=function(e){return e.replace(j,"")},n.stripBlankChar=function(e){var t=e.split("");return(t=t.filter((function(e){var t=e.charCodeAt(0);return 127!==t&&(!(t<=31)||(10===t||13===t))}))).join("")},n.cssFilter=a,n.getDefaultCSSWhiteList=r},{"./util":4,cssfilter:8}],2:[function(e,t,n){var i=e("./default"),r=e("./parser"),o=e("./xss");function s(e,t){return new o(t).process(e)}for(var a in(n=t.exports=s).filterXSS=s,n.FilterXSS=o,i)n[a]=i[a];for(var a in r)n[a]=r[a];"undefined"!=typeof window&&(window.filterXSS=t.exports),"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=t.exports)},{"./default":1,"./parser":3,"./xss":5}],3:[function(e,t,n){var i=e("./util");function r(e){var t=i.spaceIndex(e);if(-1===t)var n=e.slice(1,-1);else n=e.slice(1,t+1);return"/"===(n=i.trim(n).toLowerCase()).slice(0,1)&&(n=n.slice(1)),"/"===n.slice(-1)&&(n=n.slice(0,-1)),n}function o(e){return"</"===e.slice(0,2)}var s=/[^a-zA-Z0-9_:\.\-]/gim;function a(e,t){for(;t<e.length;t++){var n=e[t];if(" "!==n)return"="===n?t:-1}}function c(e,t){for(;t>0;t--){var n=e[t];if(" "!==n)return"="===n?t:-1}}function l(e){return function(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]}(e)?e.substr(1,e.length-2):e}n.parseTag=function(e,t,n){var i="",s=0,a=!1,c=!1,l=0,u=e.length,d="",h="";for(l=0;l<u;l++){var f=e.charAt(l);if(!1===a){if("<"===f){a=l;continue}}else if(!1===c){if("<"===f){i+=n(e.slice(s,l)),a=l,s=l;continue}if(">"===f){i+=n(e.slice(s,a)),d=r(h=e.slice(a,l+1)),i+=t(a,i.length,d,h,o(h)),s=l+1,a=!1;continue}if(('"'===f||"'"===f)&&"="===e.charAt(l-1)){c=f;continue}}else if(f===c){c=!1;continue}}return s<e.length&&(i+=n(e.substr(s))),i},n.parseAttr=function(e,t){var n=0,r=[],o=!1,u=e.length;function d(e,n){if(!((e=(e=i.trim(e)).replace(s,"").toLowerCase()).length<1)){var o=t(e,n||"");o&&r.push(o)}}for(var h=0;h<u;h++){var f,p=e.charAt(h);if(!1!==o||"="!==p)if(!1===o||h!==n||'"'!==p&&"'"!==p||"="!==e.charAt(h-1))if(/\s|\n|\t/.test(p)){if(e=e.replace(/\s|\n|\t/g," "),!1===o){if(-1===(f=a(e,h))){d(i.trim(e.slice(n,h))),o=!1,n=h+1;continue}h=f-1;continue}if(-1===(f=c(e,h-1))){d(o,l(i.trim(e.slice(n,h)))),o=!1,n=h+1;continue}}else;else{if(-1===(f=e.indexOf(p,h+1)))break;d(o,i.trim(e.slice(n+1,f))),o=!1,n=(h=f)+1}else o=e.slice(n,h),n=h+1}return n<e.length&&(!1===o?d(e.slice(n)):d(o,l(i.trim(e.slice(n))))),i.trim(r.join(" "))}},{"./util":4}],4:[function(e,t,n){t.exports={indexOf:function(e,t){var n,i;if(Array.prototype.indexOf)return e.indexOf(t);for(n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},forEach:function(e,t,n){var i,r;if(Array.prototype.forEach)return e.forEach(t,n);for(i=0,r=e.length;i<r;i++)t.call(n,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1}}},{}],5:[function(e,t,n){var i=e("cssfilter").FilterCSS,r=e("./default"),o=e("./parser"),s=o.parseTag,a=o.parseAttr,c=e("./util");function l(e){return null==e}function u(e){(e=function(e){var t={};for(var n in e)t[n]=e[n];return t}(e||{})).stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=r.onIgnoreTagStripAll),e.whiteList=e.whiteList||r.whiteList,e.onTag=e.onTag||r.onTag,e.onTagAttr=e.onTagAttr||r.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||r.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||r.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||r.safeAttrValue,e.escapeHtml=e.escapeHtml||r.escapeHtml,this.options=e,!1===e.css?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new i(e.css))}u.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,n=t.whiteList,i=t.onTag,o=t.onIgnoreTag,u=t.onTagAttr,d=t.onIgnoreTagAttr,h=t.safeAttrValue,f=t.escapeHtml,p=this.cssFilter;t.stripBlankChar&&(e=r.stripBlankChar(e)),t.allowCommentTag||(e=r.stripCommentTag(e));var g=!1;if(t.stripIgnoreTagBody){g=r.StripTagBody(t.stripIgnoreTagBody,o);o=g.onIgnoreTag}var m=s(e,(function(e,t,r,s,g){var m,v={sourcePosition:e,position:t,isClosing:g,isWhite:n.hasOwnProperty(r)};if(!l(m=i(r,s,v)))return m;if(v.isWhite){if(v.isClosing)return"</"+r+">";var _=function(e){var t=c.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var n="/"===(e=c.trim(e.slice(t+1,-1)))[e.length-1];return n&&(e=c.trim(e.slice(0,-1))),{html:e,closing:n}}(s),b=n[r],y=a(_.html,(function(e,t){var n,i=-1!==c.indexOf(b,e);return l(n=u(r,e,t,i))?i?(t=h(r,e,t,p))?e+'="'+t+'"':e:l(n=d(r,e,t,i))?void 0:n:n}));s="<"+r;return y&&(s+=" "+y),_.closing&&(s+=" /"),s+=">"}return l(m=o(r,s,v))?f(s):m}),f);return g&&(m=g.remove(m)),m},t.exports=u},{"./default":1,"./parser":3,"./util":4,cssfilter:8}],6:[function(e,t,n){var i=e("./default"),r=e("./parser");e("./util");function o(e){return null==e}function s(e){(e=function(e){var t={};for(var n in e)t[n]=e[n];return t}(e||{})).whiteList=e.whiteList||i.whiteList,e.onAttr=e.onAttr||i.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||i.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||i.safeAttrValue,this.options=e}s.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,n=t.whiteList,i=t.onAttr,s=t.onIgnoreAttr,a=t.safeAttrValue;return r(e,(function(e,t,r,c,l){var u=n[r],d=!1;if(!0===u?d=u:"function"==typeof u?d=u(c):u instanceof RegExp&&(d=u.test(c)),!0!==d&&(d=!1),c=a(r,c)){var h,f={position:t,sourcePosition:e,source:l,isWhite:d};return d?o(h=i(r,c,f))?r+":"+c:h:o(h=s(r,c,f))?void 0:h}}))},t.exports=s},{"./default":7,"./parser":9,"./util":10}],7:[function(e,t,n){function i(){var e={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1};return e}var r=/javascript\s*\:/gim;n.whiteList=i(),n.getDefaultWhiteList=i,n.onAttr=function(e,t,n){},n.onIgnoreAttr=function(e,t,n){},n.safeAttrValue=function(e,t){return r.test(t)?"":t}},{}],8:[function(e,t,n){var i=e("./default"),r=e("./css");for(var o in(n=t.exports=function(e,t){return new r(t).process(e)}).FilterCSS=r,i)n[o]=i[o];"undefined"!=typeof window&&(window.filterCSS=t.exports)},{"./css":6,"./default":7}],9:[function(e,t,n){var i=e("./util");t.exports=function(e,t){";"!==(e=i.trimRight(e))[e.length-1]&&(e+=";");var n=e.length,r=!1,o=0,s=0,a="";function c(){if(!r){var n=i.trim(e.slice(o,s)),c=n.indexOf(":");if(-1!==c){var l=i.trim(n.slice(0,c)),u=i.trim(n.slice(c+1));if(l){var d=t(o,a.length,l,u,n);d&&(a+=d+"; ")}}}o=s+1}for(;s<n;s++){var l=e[s];if("/"===l&&"*"===e[s+1]){var u=e.indexOf("*/",s+2);if(-1===u)break;o=(s=u+1)+1,r=!1}else"("===l?r=!0:")"===l?r=!1:";"===l?r||c():"\n"===l&&c()}return i.trim(a)}},{"./util":10}],10:[function(e,t,n){t.exports={indexOf:function(e,t){var n,i;if(Array.prototype.indexOf)return e.indexOf(t);for(n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},forEach:function(e,t,n){var i,r;if(Array.prototype.forEach)return e.forEach(t,n);for(i=0,r=e.length;i<r;i++)t.call(n,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}}},{}]},{},[2]),t.filterXSS=filterXSS,t.filterCSS=filterCSS},function(e,t,n){e.exports=function(){"use strict";var e="millisecond",t="second",n="minute",i="hour",r="day",o="week",s="month",a="quarter",c="year",l=/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,u=/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,d=function(e,t,n){var i=String(e);return!i||i.length>=t?e:""+Array(t+1-i.length).join(n)+e},h={s:d,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),i=Math.floor(n/60),r=n%60;return(t<=0?"+":"-")+d(i,2,"0")+":"+d(r,2,"0")},m:function(e,t){var n=12*(t.year()-e.year())+(t.month()-e.month()),i=e.clone().add(n,s),r=t-i<0,o=e.clone().add(n+(r?-1:1),s);return Number(-(n+(t-i)/(r?i-o:o-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(l){return{M:s,y:c,w:o,d:r,h:i,m:n,s:t,ms:e,Q:a}[l]||String(l||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},p="en",g={};g[p]=f;var m=function(e){return e instanceof y},v=function(e,t,n){var i;if(!e)return p;if("string"==typeof e)g[e]&&(i=e),t&&(g[e]=t,i=e);else{var r=e.name;g[r]=e,i=r}return n||(p=i),i},_=function(e,t,n){if(m(e))return e.clone();var i=t?"string"==typeof t?{format:t,pl:n}:t:{};return i.date=e,new y(i)},b=h;b.l=v,b.i=m,b.w=function(e,t){return _(e,{locale:t.$L,utc:t.$u})};var y=function(){function d(e){this.$L=this.$L||v(e.locale,null,!0),this.parse(e)}var h=d.prototype;return h.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(b.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var i=t.match(l);if(i)return n?new Date(Date.UTC(i[1],i[2]-1,i[3]||1,i[4]||0,i[5]||0,i[6]||0,i[7]||0)):new Date(i[1],i[2]-1,i[3]||1,i[4]||0,i[5]||0,i[6]||0,i[7]||0)}return new Date(t)}(e),this.init()},h.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},h.$utils=function(){return b},h.isValid=function(){return!("Invalid Date"===this.$d.toString())},h.isSame=function(e,t){var n=_(e);return this.startOf(t)<=n&&n<=this.endOf(t)},h.isAfter=function(e,t){return _(e)<this.startOf(t)},h.isBefore=function(e,t){return this.endOf(t)<_(e)},h.$g=function(e,t,n){return b.u(e)?this[t]:this.set(n,e)},h.year=function(e){return this.$g(e,"$y",c)},h.month=function(e){return this.$g(e,"$M",s)},h.day=function(e){return this.$g(e,"$W",r)},h.date=function(e){return this.$g(e,"$D","date")},h.hour=function(e){return this.$g(e,"$H",i)},h.minute=function(e){return this.$g(e,"$m",n)},h.second=function(e){return this.$g(e,"$s",t)},h.millisecond=function(t){return this.$g(t,"$ms",e)},h.unix=function(){return Math.floor(this.valueOf()/1e3)},h.valueOf=function(){return this.$d.getTime()},h.startOf=function(e,a){var l=this,u=!!b.u(a)||a,d=b.p(e),h=function(e,t){var n=b.w(l.$u?Date.UTC(l.$y,t,e):new Date(l.$y,t,e),l);return u?n:n.endOf(r)},f=function(e,t){return b.w(l.toDate()[e].apply(l.toDate(),(u?[0,0,0,0]:[23,59,59,999]).slice(t)),l)},p=this.$W,g=this.$M,m=this.$D,v="set"+(this.$u?"UTC":"");switch(d){case c:return u?h(1,0):h(31,11);case s:return u?h(1,g):h(0,g+1);case o:var _=this.$locale().weekStart||0,y=(p<_?p+7:p)-_;return h(u?m-y:m+(6-y),g);case r:case"date":return f(v+"Hours",0);case i:return f(v+"Minutes",1);case n:return f(v+"Seconds",2);case t:return f(v+"Milliseconds",3);default:return this.clone()}},h.endOf=function(e){return this.startOf(e,!1)},h.$set=function(o,a){var l,u=b.p(o),d="set"+(this.$u?"UTC":""),h=(l={},l.day=d+"Date",l.date=d+"Date",l[s]=d+"Month",l[c]=d+"FullYear",l[i]=d+"Hours",l[n]=d+"Minutes",l[t]=d+"Seconds",l[e]=d+"Milliseconds",l)[u],f=u===r?this.$D+(a-this.$W):a;if(u===s||u===c){var p=this.clone().set("date",1);p.$d[h](f),p.init(),this.$d=p.set("date",Math.min(this.$D,p.daysInMonth())).toDate()}else h&&this.$d[h](f);return this.init(),this},h.set=function(e,t){return this.clone().$set(e,t)},h.get=function(e){return this[b.p(e)]()},h.add=function(e,a){var l,u=this;e=Number(e);var d=b.p(a),h=function(t){var n=_(u);return b.w(n.date(n.date()+Math.round(t*e)),u)};if(d===s)return this.set(s,this.$M+e);if(d===c)return this.set(c,this.$y+e);if(d===r)return h(1);if(d===o)return h(7);var f=(l={},l[n]=6e4,l[i]=36e5,l[t]=1e3,l)[d]||1,p=this.valueOf()+e*f;return b.w(p,this)},h.subtract=function(e,t){return this.add(-1*e,t)},h.format=function(e){var t=this;if(!this.isValid())return"Invalid Date";var n=e||"YYYY-MM-DDTHH:mm:ssZ",i=b.z(this),r=this.$locale(),o=this.$H,s=this.$m,a=this.$M,c=r.weekdays,l=r.months,d=function(e,i,r,o){return e&&(e[i]||e(t,n))||r[i].substr(0,o)},h=function(e){return b.s(o%12||12,e,"0")},f=r.meridiem||function(e,t,n){var i=e<12?"AM":"PM";return n?i.toLowerCase():i},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:b.s(a+1,2,"0"),MMM:d(r.monthsShort,a,l,3),MMMM:l[a]||l(this,n),D:this.$D,DD:b.s(this.$D,2,"0"),d:String(this.$W),dd:d(r.weekdaysMin,this.$W,c,2),ddd:d(r.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(o),HH:b.s(o,2,"0"),h:h(1),hh:h(2),a:f(o,s,!0),A:f(o,s,!1),m:String(s),mm:b.s(s,2,"0"),s:String(this.$s),ss:b.s(this.$s,2,"0"),SSS:b.s(this.$ms,3,"0"),Z:i};return n.replace(u,(function(e,t){return t||p[e]||i.replace(":","")}))},h.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},h.diff=function(e,r,l){var u,d=b.p(r),h=_(e),f=6e4*(h.utcOffset()-this.utcOffset()),p=this-h,g=b.m(this,h);return g=(u={},u[c]=g/12,u[s]=g,u[a]=g/3,u[o]=(p-f)/6048e5,u.day=(p-f)/864e5,u[i]=p/36e5,u[n]=p/6e4,u[t]=p/1e3,u)[d]||p,l?g:b.a(g)},h.daysInMonth=function(){return this.endOf(s).$D},h.$locale=function(){return g[this.$L]},h.locale=function(e,t){if(!e)return this.$L;var n=this.clone();return n.$L=v(e,t,!0),n},h.clone=function(){return b.w(this.toDate(),this)},h.toDate=function(){return new Date(this.$d)},h.toJSON=function(){return this.toISOString()},h.toISOString=function(){return this.$d.toISOString()},h.toString=function(){return this.$d.toUTCString()},d}();return _.prototype=y.prototype,_.extend=function(e,t){return e(t,y,_),_},_.locale=v,_.isDayjs=m,_.unix=function(e){return _(1e3*e)},_.en=g[p],_.Ls=g,_}()},function(e,t,n){var i=n(58),r="object"==typeof self&&self&&self.Object===Object&&self,o=i||r||Function("return this")();e.exports=o},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){n(3);e.exports=function(e){return'\x3c!-- src/templates/spinner.html --\x3e\n<span class="spinner fa fa-spinner centered"/>\n','\x3c!-- src/templates/spinner.html --\x3e\n<span class="spinner fa fa-spinner centered"/>\n'}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){(function(n){var i,r,o;r=[],void 0===(o="function"==typeof(i=function(){"use strict";var e=void 0!==n?n:this||window,t=document,i=t.documentElement,r="body",o=e.BSN={},s=o.supports=[],a="data-toggle",c="delay",l="target",u="animation",d="onmouseleave"in t?["mouseenter","mouseleave"]:["mouseover","mouseout"],h="getAttribute",f="setAttribute",p="parentNode",g="length",m="style",v="push",_="active",b="left",y="top",w=/\b(top|bottom|left|right)+/,S=0,x="WebkitTransition"in i[m]||"Transition".toLowerCase()in i[m],E="WebkitTransition"in i[m]?"Webkit".toLowerCase()+"TransitionEnd":"Transition".toLowerCase()+"end",A="WebkitDuration"in i[m]?"Webkit".toLowerCase()+"TransitionDuration":"Transition".toLowerCase()+"Duration",j=function(e){e.focus?e.focus():e.setActive()},C=function(e,t){e.classList.add(t)},k=function(e,t){e.classList.remove(t)},O=function(e,t){return e.classList.contains(t)},T=function(e,t){return[].slice.call(e.getElementsByClassName(t))},N=function(e,n){return"object"==typeof e?e:(n||t).querySelector(e)},M=function(e,n){var i=n.charAt(0),r=n.substr(1);if("."===i){for(;e&&e!==t;e=e[p])if(null!==N(n,e[p])&&O(e,r))return e}else if("#"===i)for(;e&&e!==t;e=e[p])if(e.id===r)return e;return!1},I=function(e,t,n,i){i=i||!1,e.addEventListener(t,n,i)},R=function(e,t,n,i){i=i||!1,e.removeEventListener(t,n,i)},D=function(e,t,n,i){I(e,t,(function r(o){n(o),R(e,t,r,i)}),i)},P=!!function(){var t=!1;try{var n=Object.defineProperty({},"passive",{get:function(){t=!0}});D(e,"testPassive",null,n)}catch(e){}return t}()&&{passive:!0},L=function(t){var n=x?e.getComputedStyle(t)[A]:0;return n="number"!=typeof(n=parseFloat(n))||isNaN(n)?0:1e3*n},z=function(e,t){var n=0;L(e)?D(e,E,(function(e){!n&&t(e),n=1})):setTimeout((function(){!n&&t(),n=1}),17)},F=function(e,t,n){var i=new CustomEvent(e+".bs."+t);i.relatedTarget=n,this.dispatchEvent(i)},B=function(n,o,s,a){var c,l,u,d,h,f,p=o.offsetWidth,g=o.offsetHeight,v=i.clientWidth||t[r].clientWidth,_=i.clientHeight||t[r].clientHeight,S=n.getBoundingClientRect(),x=a===t[r]?{y:e.pageYOffset||i.scrollTop,x:e.pageXOffset||i.scrollLeft}:{x:a.offsetLeft+a.scrollLeft,y:a.offsetTop+a.scrollTop},E=S.right-S[b],A=S.bottom-S.top,j=O(o,"popover"),C=N(".arrow",o),k=S.top+A/2-g/2<0,T=S[b]+E/2-p/2<0,M=S[b]+p/2+E/2>=v,I=S.top+g/2+A/2>=_,R=S.top-g<0,D=S[b]-p<0,P=S.top+g+A>=_,L=S[b]+p+E>=v;s="right"===(s=(s="bottom"===(s=(s=(s===b||"right"===s)&&D&&L?y:s)===y&&R?"bottom":s)&&P?y:s)===b&&D?"right":s)&&L?b:s,-1===o.className.indexOf(s)&&(o.className=o.className.replace(w,s)),h=C.offsetWidth,f=C.offsetHeight,s===b||"right"===s?(l=s===b?S[b]+x.x-p-(j?h:0):S[b]+x.x+E,k?(c=S.top+x.y,u=A/2-h):I?(c=S.top+x.y-g+A,u=g-A/2-h):(c=S.top+x.y-g/2+A/2,u=g/2-(j?.9*f:f/2))):s!==y&&"bottom"!==s||(c=s===y?S.top+x.y-g-(j?f:0):S.top+x.y+A,T?(l=0,d=S[b]+E/2-h):M?(l=v-1.01*p,d=p-(v-S[b])+E/2-h/2):(l=S[b]+x.x-p/2+E/2,d=p/2-(j?h:h/2))),o[m].top=c+"px",o[m][b]=l+"px",u&&(C[m].top=u+"px"),d&&(C[m][b]=d+"px")};o.version="2.0.27";var q=function(e){e=N(e);var t=this,n=M(e,".alert"),i=function(i){n=M(i[l],".alert"),(e=N('[data-dismiss="alert"]',n))&&n&&(e===i[l]||e.contains(i[l]))&&t.close()},r=function(){F.call(n,"closed","alert"),R(e,"click",i),n[p].removeChild(n)};this.close=function(){n&&e&&O(n,"show")&&(F.call(n,"close","alert"),k(n,"show"),n&&(O(n,"fade")?z(n,r):r()))},"Alert"in e||I(e,"click",i),e.Alert=t};s[v](["Alert",q,'[data-dismiss="alert"]']);var U=function(e){e=N(e);var n=!1,i="checked",r=function(t){var r="LABEL"===t[l].tagName?t[l]:"LABEL"===t[l][p].tagName?t[l][p]:null;if(r){var o=T(r[p],"btn"),s=r.getElementsByTagName("INPUT")[0];if(s){if("checkbox"===s.type&&(s[i]?(k(r,_),s[h](i),s.removeAttribute(i),s[i]=!1):(C(r,_),s[h](i),s[f](i,i),s[i]=!0),n||(n=!0,F.call(s,"change","button"),F.call(e,"change","button"))),"radio"===s.type&&!n&&(!s[i]||0===t.screenX&&0==t.screenY)){C(r,_),C(r,"focus"),s[f](i,i),s[i]=!0,F.call(s,"change","button"),F.call(e,"change","button"),n=!0;for(var a=0,c=o[g];a<c;a++){var u=o[a],d=u.getElementsByTagName("INPUT")[0];u!==r&&O(u,_)&&(k(u,_),d.removeAttribute(i),d[i]=!1,F.call(d,"change","button"))}}setTimeout((function(){n=!1}),50)}}},o=function(e){C(e[l][p],"focus")},s=function(e){k(e[l][p],"focus")};if(!("Button"in e)){I(e,"click",r),I(e,"keyup",(function(e){32===(e.which||e.keyCode)&&e[l]===t.activeElement&&r(e)})),I(e,"keydown",(function(e){32===(e.which||e.keyCode)&&e.preventDefault()}));for(var a=T(e,"btn"),c=0;c<a.length;c++){var u=a[c].getElementsByTagName("INPUT")[0];I(u,"focus",o),I(u,"blur",s)}}var d=T(e,"btn"),m=d[g];for(c=0;c<m;c++)!O(d[c],_)&&N("input:checked",d[c])&&C(d[c],_);e.Button=this};s[v](["Button",U,"["+a+'="buttons"]']);var H=function(e,t){e=N(e),t=t||{};var n,i,r,o,s,a=null,c=null,l=this,u=e[h]("data-parent"),d=function(e,t){F.call(e,"hide","collapse"),e.isAnimating=!0,e[m].height=e.scrollHeight+"px",k(e,"collapse"),k(e,"show"),C(e,"collapsing"),e.offsetWidth,e[m].height="0px",z(e,(function(){e.isAnimating=!1,e[f]("aria-expanded","false"),t[f]("aria-expanded","false"),k(e,"collapsing"),C(e,"collapse"),e[m].height="",F.call(e,"hidden","collapse")}))};this.toggle=function(e){e.preventDefault(),O(c,"show")?l.hide():l.show()},this.hide=function(){c.isAnimating||(d(c,e),C(e,"collapsed"))},this.show=function(){var t,r;a&&(n=N(".collapse.show",a),i=n&&(N('[data-target="#'+n.id+'"]',a)||N('[href="#'+n.id+'"]',a))),(!c.isAnimating||n&&!n.isAnimating)&&(i&&n!==c&&(d(n,i),C(i,"collapsed")),r=e,F.call(t=c,"show","collapse"),t.isAnimating=!0,C(t,"collapsing"),k(t,"collapse"),t[m].height=t.scrollHeight+"px",z(t,(function(){t.isAnimating=!1,t[f]("aria-expanded","true"),r[f]("aria-expanded","true"),k(t,"collapsing"),C(t,"collapse"),C(t,"show"),t[m].height="",F.call(t,"shown","collapse")})),k(e,"collapsed"))},"Collapse"in e||I(e,"click",l.toggle),r=e.href&&e[h]("href"),o=e[h]("data-target"),s=r||o&&"#"===o.charAt(0)&&o,(c=s&&N(s)).isAnimating=!1,a=N(t.parent)||u&&M(e,u),e.Collapse=l};s[v](["Collapse",H,"["+a+'="collapse"]']);var $=function(e,n){e=N(e),this.persist=!0===n||"true"===e[h]("data-persist")||!1;var i=this,r=e[p],o=null,s=N(".dropdown-menu",r),c=function(){for(var e=s.children,t=[],n=0;n<e[g];n++)e[n].children[g]&&"A"===e[n].children[0].tagName&&t[v](e[n].children[0]),"A"===e[n].tagName&&t[v](e[n]);return t}(),u=function(e){(e.href&&"#"===e.href.slice(-1)||e[p]&&e[p].href&&"#"===e[p].href.slice(-1))&&this.preventDefault()},d=function(){var n=e.open?I:R;n(t,"click",m),n(t,"keydown",b),n(t,"keyup",y),n(t,"focus",m,!0)},m=function(t){var n=t[l],r=n&&(n[h](a)||n[p]&&h in n[p]&&n[p][h](a));("focus"!==t.type||n!==e&&n!==s&&!s.contains(n))&&(n!==s&&!s.contains(n)||!i.persist&&!r)&&(o=n===e||e.contains(n)?e:null,S(),u.call(t,n))},_=function(t){o=e,w(),u.call(t,t[l])},b=function(e){var t=e.which||e.keyCode;38!==t&&40!==t||e.preventDefault()},y=function(n){var r=n.which||n.keyCode,a=t.activeElement,l=c.indexOf(a),u=a===e,d=s.contains(a),h=a[p]===s||a[p][p]===s;h&&(l=u?0:38===r?l>1?l-1:0:40===r&&l<c[g]-1?l+1:l,c[l]&&j(c[l])),(c[g]&&h||!c[g]&&(d||u)||!d)&&e.open&&27===r&&(i.toggle(),o=null)},w=function(){F.call(r,"show","dropdown",o),C(s,"show"),C(r,"show"),e[f]("aria-expanded",!0),F.call(r,"shown","dropdown",o),e.open=!0,R(e,"click",_),setTimeout((function(){j(s.getElementsByTagName("INPUT")[0]||e),d()}),1)},S=function(){F.call(r,"hide","dropdown",o),k(s,"show"),k(r,"show"),e[f]("aria-expanded",!1),F.call(r,"hidden","dropdown",o),e.open=!1,d(),j(e),setTimeout((function(){I(e,"click",_)}),1)};e.open=!1,this.toggle=function(){O(r,"show")&&e.open?S():w()},"Dropdown"in e||(!1 in s&&s[f]("tabindex","0"),I(e,"click",_)),e.Dropdown=i};s[v](["Dropdown",$,"["+a+'="dropdown"]']);var W=function(n,o){var s=(n=N(n))[h]("data-target")||n[h]("href"),a=N(s),c=O(n,"modal")?n:a;if(O(n,"modal")&&(n=null),c){o=o||{},this.keyboard=!1!==o.keyboard&&"false"!==c[h]("data-keyboard"),this.backdrop="static"!==o.backdrop&&"static"!==c[h]("data-backdrop")||"static",this.backdrop=!1!==o.backdrop&&"false"!==c[h]("data-backdrop")&&this.backdrop,this[u]=!!O(c,"fade"),this.content=o.content,c.isAnimating=!1;var d,v,_,y,w,E=this,A=null,M=T(i,"fixed-top").concat(T(i,"fixed-bottom")),D=function(){var n,i=e.getComputedStyle(t[r]),o=parseInt(i.paddingRight,10);if(d&&(t[r][m].paddingRight=o+v+"px",c[m].paddingRight=v+"px",M[g]))for(var s=0;s<M[g];s++)n=e.getComputedStyle(M[s]).paddingRight,M[s][m].paddingRight=parseInt(n)+v+"px"},B=function(){var n,o,s;d=t[r].clientWidth<(n=i.getBoundingClientRect(),e.innerWidth||n.right-Math.abs(n[b])),(s=t.createElement("div")).className="modal-scrollbar-measure",t[r].appendChild(s),o=s.offsetWidth-s.clientWidth,t[r].removeChild(s),v=o},q=function(){(_=N(".modal-backdrop"))&&null!==_&&"object"==typeof _&&(S=0,t[r].removeChild(_),_=null)},U=function(){j(c),c.isAnimating=!1,F.call(c,"shown","modal",A),I(e,"resize",E.update,P),I(c,"click",W),I(t,"keydown",$)},H=function(){c[m].display="",n&&j(n),F.call(c,"hidden","modal"),T(t,"modal show")[0]||(function(){if(t[r][m].paddingRight="",c[m].paddingRight="",M[g])for(var e=0;e<M[g];e++)M[e][m].paddingRight=""}(),k(t[r],"modal-open"),_&&O(_,"fade")?(k(_,"show"),z(_,q)):q(),R(e,"resize",E.update,P),R(c,"click",W),R(t,"keydown",$)),c.isAnimating=!1},$=function(e){c.isAnimating||E.keyboard&&27==e.which&&O(c,"show")&&E.hide()},W=function(e){if(!c.isAnimating){var t=e[l];O(c,"show")&&("modal"===t[p][h]("data-dismiss")||"modal"===t[h]("data-dismiss")||t===c&&"static"!==E.backdrop)&&(E.hide(),A=null,e.preventDefault())}};this.toggle=function(){O(c,"show")?this.hide():this.show()},this.show=function(){O(c,"show")||c.isAnimating||(clearTimeout(w),w=setTimeout((function(){c.isAnimating=!0,F.call(c,"show","modal",A);var e,n=T(t,"modal show")[0];n&&n!==c&&("modalTrigger"in n&&n.modalTrigger.Modal.hide(),"Modal"in n&&n.Modal.hide()),E.backdrop&&!S&&!_&&(e=t.createElement("div"),null===(_=N(".modal-backdrop"))&&(e[f]("class","modal-backdrop"+(E[u]?" fade":"")),_=e,t[r].appendChild(_)),S=1),_&&!O(_,"show")&&(_.offsetWidth,y=L(_),C(_,"show")),setTimeout((function(){c[m].display="block",B(),D(),C(t[r],"modal-open"),C(c,"show"),c[f]("aria-hidden",!1),O(c,"fade")?z(c,U):U()}),x&&_&&y?y:1)}),1))},this.hide=function(){!c.isAnimating&&O(c,"show")&&(clearTimeout(w),w=setTimeout((function(){c.isAnimating=!0,F.call(c,"hide","modal"),_=N(".modal-backdrop"),y=_&&L(_),k(c,"show"),c[f]("aria-hidden",!0),setTimeout((function(){O(c,"fade")?z(c,H):H()}),x&&_&&y?y:2)}),2))},this.setContent=function(e){N(".modal-content",c).innerHTML=e},this.update=function(){O(c,"show")&&(B(),D())},n&&!("Modal"in n)&&I(n,"click",(function(e){if(!c.isAnimating){var t=e[l];(t=t.hasAttribute("data-target")||t.hasAttribute("href")?t:t[p])!==n||O(c,"show")||(c.modalTrigger=n,A=n,E.show(),e.preventDefault())}})),E.content&&E.setContent(E.content),n?(n.Modal=E,c.modalTrigger=n):c.Modal=E}};s[v](["Modal",W,"["+a+'="modal"]']);var V=function(n,i){n=N(n),i=i||{};var o=n[h]("data-trigger"),s=n[h]("data-animation"),a=n[h]("data-placement"),p=n[h]("data-dismissible"),g=n[h]("data-delay"),v=n[h]("data-container"),_='<button type="button" class="close">×</button>',b=N(i.container),w=N(v),S=M(n,".modal"),x=M(n,".fixed-top"),E=M(n,".fixed-bottom");this.template=i.template?i.template:null,this.trigger=i.trigger?i.trigger:o||"hover",this[u]=i[u]&&"fade"!==i[u]?i[u]:s||"fade",this.placement=i.placement?i.placement:a||y,this[c]=parseInt(i[c]||g)||200,this.dismissible=!(!i.dismissible&&"true"!==p),this.container=b||w||x||E||S||t[r];var A=this,j=i.title||n[h]("data-title")||null,T=i.content||n[h]("data-content")||null;if(T||this.template){var D=null,L=0,q=this.placement,U=function(e){null!==D&&e[l]===N(".close",D)&&A.hide()},H=function(i){"click"!=A.trigger&&"focus"!=A.trigger||!A.dismissible&&i(n,"blur",A.hide),A.dismissible&&i(t,"click",U),i(e,"resize",A.hide,P)},$=function(){H(I),F.call(n,"shown","popover")},W=function(){H(R),A.container.removeChild(D),L=null,D=null,F.call(n,"hidden","popover")};this.toggle=function(){null===D?A.show():A.hide()},this.show=function(){clearTimeout(L),L=setTimeout((function(){null===D&&(q=A.placement,function(){j=i.title||n[h]("data-title"),T=(T=i.content||n[h]("data-content"))?T.trim():null,D=t.createElement("div");var e=t.createElement("div");if(e[f]("class","arrow"),D.appendChild(e),null!==T&&null===A.template){if(D[f]("role","tooltip"),null!==j){var r=t.createElement("h3");r[f]("class","popover-header"),r.innerHTML=A.dismissible?j+_:j,D.appendChild(r)}var o=t.createElement("div");o[f]("class","popover-body"),o.innerHTML=A.dismissible&&null===j?T+_:T,D.appendChild(o)}else{var s=t.createElement("div");A.template=A.template.trim(),s.innerHTML=A.template,D.innerHTML=s.firstChild.innerHTML}A.container.appendChild(D),D[m].display="block",D[f]("class","popover bs-popover-"+q+" "+A[u])}(),B(n,D,q,A.container),!O(D,"show")&&C(D,"show"),F.call(n,"show","popover"),A[u]?z(D,$):$())}),20)},this.hide=function(){clearTimeout(L),L=setTimeout((function(){D&&null!==D&&O(D,"show")&&(F.call(n,"hide","popover"),k(D,"show"),A[u]?z(D,W):W())}),A[c])},"Popover"in n||("hover"===A.trigger?(I(n,d[0],A.show),A.dismissible||I(n,d[1],A.hide)):"click"!=A.trigger&&"focus"!=A.trigger||I(n,A.trigger,A.toggle)),n.Popover=A}};s[v](["Popover",V,"["+a+'="popover"]']);var G=function(e,t){var n=(e=N(e))[h]("data-height");t=t||{},this.height=!!x&&(t.height||"true"===n);var i,r,o,s,a,c,l,u=this,d=M(e,".nav"),v=!1,y=d&&N(".dropdown-toggle",d),w=function(){v[m].height="",k(v,"collapsing"),d.isAnimating=!1},S=function(){v?c?w():setTimeout((function(){v[m].height=l+"px",v.offsetWidth,z(v,w)}),50):d.isAnimating=!1,F.call(i,"shown","tab",r)},E=function(){v&&(o[m].float=b,s[m].float=b,a=o.scrollHeight),C(s,_),F.call(i,"show","tab",r),k(o,_),F.call(r,"hidden","tab",i),v&&(l=s.scrollHeight,c=l===a,C(v,"collapsing"),v[m].height=a+"px",v.offsetHeight,o[m].float="",s[m].float=""),O(s,"fade")?setTimeout((function(){C(s,"show"),z(s,S)}),20):S()};if(d){d.isAnimating=!1;var A=function(){var e,t=T(d,_);return 1!==t[g]||O(t[0][p],"dropdown")?t[g]>1&&(e=t[t[g]-1]):e=t[0],e},j=function(){return N(A()[h]("href"))};this.show=function(){s=N((i=i||e)[h]("href")),r=A(),o=j(),d.isAnimating=!0,k(r,_),r[f]("aria-selected","false"),C(i,_),i[f]("aria-selected","true"),y&&(O(e[p],"dropdown-menu")?O(y,_)||C(y,_):O(y,_)&&k(y,_)),F.call(r,"hide","tab",i),O(o,"fade")?(k(o,"show"),z(o,E)):E()},"Tab"in e||I(e,"click",(function(e){e.preventDefault(),i=e.currentTarget,!d.isAnimating&&!O(i,_)&&u.show()})),u.height&&(v=j()[p]),e.Tab=u}};s[v](["Tab",G,"["+a+'="tab"]']);var J=function(e,t){t=t||{};var n=(e=N(e))[h]("data-animation"),i=e[h]("data-autohide"),r=e[h]("data-delay");this.animation=!1===t.animation||"false"===n?0:1,this.autohide=!1===t.autohide||"false"===i?0:1,this[c]=parseInt(t[c]||r)||500;var o=this,s=0,a=M(e,".toast"),l=function(){k(a,"showing"),C(a,"show"),F.call(a,"shown","toast"),o.autohide&&o.hide()},u=function(){C(a,"hide"),F.call(a,"hidden","toast")},d=function(){k(a,"show"),o.animation?z(a,u):u()},f=function(){clearTimeout(s),s=null,C(a,"hide"),R(e,"click",o.hide),e.Toast=null,e=null,a=null};this.show=function(){a&&(F.call(a,"show","toast"),o.animation&&C(a,"fade"),k(a,"hide"),C(a,"showing"),o.animation?z(a,l):l())},this.hide=function(e){a&&O(a,"show")&&(F.call(a,"hide","toast"),e?d():s=setTimeout(d,o[c]))},this.dispose=function(){a&&O(a,"show")&&(k(a,"show"),o.animation?z(a,f):f())},"Toast"in e||I(e,"click",o.hide),e.Toast=o};s[v](["Toast",J,'[data-dismiss="toast"]']);var Q=function(n,i){i=i||{};var o=(n=N(n))[h]("data-animation"),s=n[h]("data-placement"),a=n[h]("data-delay"),l=n[h]("data-container"),p=N(i.container),g=N(l),v=M(n,".modal"),_=M(n,".fixed-top"),w=M(n,".fixed-bottom");this[u]=i[u]&&"fade"!==i[u]?i[u]:o||"fade",this.placement=i.placement?i.placement:s||y,this[c]=parseInt(i[c]||a)||200,this.container=p||g||_||w||v||t[r];var S=this,x=0,E=this.placement,A=null,j=n[h]("title")||n[h]("data-title")||n[h]("data-original-title");if(j&&""!=j){var T=function(){I(e,"resize",S.hide,P),F.call(n,"shown","tooltip")},D=function(){R(e,"resize",S.hide,P),S.container.removeChild(A),A=null,x=null,F.call(n,"hidden","tooltip")};this.show=function(){clearTimeout(x),x=setTimeout((function(){null===A&&(E=S.placement,!1!==function(){if((j=n[h]("title")||n[h]("data-title")||n[h]("data-original-title"))&&""!==j){(A=t.createElement("div"))[f]("role","tooltip"),A[m][b]="0",A[m].top="0";var e=t.createElement("div");e[f]("class","arrow"),A.appendChild(e);var i=t.createElement("div");i[f]("class","tooltip-inner"),A.appendChild(i),i.innerHTML=j,S.container.appendChild(A),A[f]("class","tooltip bs-tooltip-"+E+" "+S[u])}}()&&(B(n,A,E,S.container),!O(A,"show")&&C(A,"show"),F.call(n,"show","tooltip"),S[u]?z(A,T):T()))}),20)},this.hide=function(){clearTimeout(x),x=setTimeout((function(){A&&O(A,"show")&&(F.call(n,"hide","tooltip"),k(A,"show"),S[u]?z(A,D):D())}),S[c])},this.toggle=function(){A?S.hide():S.show()},"Tooltip"in n||(n[f]("data-original-title",j),n.removeAttribute("title"),I(n,d[0],S.show),I(n,d[1],S.hide)),n.Tooltip=S}};s[v](["Tooltip",Q,"["+a+'="tooltip"]']);var K=function(e,t){for(var n=0,i=t[g];n<i;n++)new e(t[n])},Y=o.initCallback=function(e){e=e||t;for(var n=0,i=s[g];n<i;n++)K(s[n][1],e.querySelectorAll(s[n][2]))};return t[r]?Y():I(t,"DOMContentLoaded",(function(){Y()})),{Alert:q,Button:U,Collapse:H,Dropdown:$,Modal:W,Popover:V,Tab:G,Toast:J,Tooltip:Q}})?i.apply(t,r):i)||(e.exports=o)}).call(this,n(9))},function(e,t,n){var i=n(28),r=n(289),o=n(290),s=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?r(e):o(e)}},function(e,t,n){var i=n(307),r=n(310);e.exports=function(e,t){var n=r(e,t);return i(n)?n:void 0}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t,n="",r=i.escape;Array.prototype.join;return n+='\x3c!-- src/templates/info.html --\x3e\n<div class="message chat-info '+r(e.extra_classes)+'" data-isodate="'+r(e.isodate)+'" ',e.data_name&&(n+=" data-"+r(e.data_name)+'="'+r(e.data_value)+'"'),n+=">\n",e.render_message?n+="\n    "+(null==(t=e.message)?"":t)+"\n":(n+='\n<div class="chat-info__message">'+r(e.message)+"</div>\n    ",e.reason&&(n+='<q class="reason">'+r(e.reason)+"</q>"),n+="\n"),n+="\n",e.retry&&(n+='\n    <a class="retry">Retry</a>\n'),n+="\n</div>\n"}},function(e,t,n){(function(t){e.exports=function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,(function(e){var n=t[s][1][e];return r(n||e)}),l,l.exports,e,t,n,i)}return n[s].exports}for(var o=!1,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,n,i){(function(e){"use strict";var t,i,r=e.MutationObserver||e.WebKitMutationObserver;if(r){var o=0,s=new r(u),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),t=function(){a.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)t="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var c=new e.MessageChannel;c.port1.onmessage=u,t=function(){c.port2.postMessage(0)}}var l=[];function u(){var e,t;i=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}i=!1}n.exports=function(e){1!==l.push(e)||i||t()}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var i=e(1);function r(){}var o={},s=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==r&&f(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){i((function(){var i;try{i=t(n)}catch(t){return o.reject(e,t)}i===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,i)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function i(t){n||(n=!0,o.reject(e,t))}function r(t){n||(n=!0,o.resolve(e,t))}var s=p((function(){t(r,i)}));"error"===s.status&&i(s.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===s)return this;var n=new this.constructor(r);return this.state!==c?d(n,this.state===a?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){o.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=p(h,t);if("error"===n.status)return o.reject(e,n.value);var i=n.value;if(i)f(e,i);else{e.state=a,e.outcome=t;for(var r=-1,s=e.queue.length;++r<s;)e.queue[r].callFulfilled(t)}return e},o.reject=function(e,t){e.state=s,e.outcome=t;for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:o.resolve(new this(r),e)},l.reject=function(e){var t=new this(r);return o.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var s=new Array(n),a=0,c=-1,l=new this(r);++c<n;)u(e[c],c);return l;function u(e,r){t.resolve(e).then((function(e){s[r]=e,++a!==n||i||(i=!0,o.resolve(l,s))}),(function(e){i||(i=!0,o.reject(l,e))}))}},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var s,a=-1,c=new this(r);++a<n;)s=e[a],t.resolve(s).then((function(e){i||(i=!0,o.resolve(c,e))}),(function(e){i||(i=!0,o.reject(c,e))}));return c}},{1:1}],3:[function(e,n,i){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(r){if("TypeError"!==r.name)throw r;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),i=0;i<e.length;i+=1)n.append(e[i]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var s=Promise;function a(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function c(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var d=void 0,h={},f=Object.prototype.toString;function p(e){return"boolean"==typeof d?s.resolve(d):function(e){return new s((function(t){var n=e.transaction("local-forage-detect-blob-support","readwrite"),i=o([""]);n.objectStore("local-forage-detect-blob-support").put(i,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return d=e}))}function g(e){var t=h[e.name],n={};n.promise=new s((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function m(e){var t=h[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function v(e,t){var n=h[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function _(e,t){return new s((function(n,i){if(h[e.name]=h[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);g(e),e.db.close()}var o=[e.name];t&&o.push(e.version);var s=r.open.apply(r,o);t&&(s.onupgradeneeded=function(t){var n=s.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore("local-forage-detect-blob-support")}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),s.onerror=function(e){e.preventDefault(),i(s.error)},s.onsuccess=function(){n(s.result),m(e)}}))}function b(e){return _(e,!1)}function y(e){return _(e,!0)}function w(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),i=e.version<e.db.version,r=e.version>e.db.version;if(i&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),r||n){if(n){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function S(e){return o([function(e){for(var t=e.length,n=new ArrayBuffer(t),i=new Uint8Array(n),r=0;r<t;r++)i[r]=e.charCodeAt(r);return n}(atob(e.data))],{type:e.type})}function x(e){return e&&e.__local_forage_encoded_blob}function E(e){var t=this,n=t._initReady().then((function(){var e=h[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return c(n,e,e),n}function A(e,t,n,i){void 0===i&&(i=1);try{var r=e.db.transaction(e.storeName,t);n(null,r)}catch(r){if(i>0&&(!e.db||"InvalidStateError"===r.name||"NotFoundError"===r.name))return s.resolve().then((function(){if(!e.db||"NotFoundError"===r.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),y(e)})).then((function(){return function(e){g(e);for(var t=h[e.name],n=t.forages,i=0;i<n.length;i++){var r=n[i];r._dbInfo.db&&(r._dbInfo.db.close(),r._dbInfo.db=null)}return e.db=null,b(e).then((function(t){return e.db=t,w(e)?y(e):t})).then((function(i){e.db=t.db=i;for(var r=0;r<n.length;r++)n[r]._dbInfo.db=i})).catch((function(t){throw v(e,t),t}))}(e).then((function(){A(e,t,n,i-1)}))})).catch(n);n(r)}}var j={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var i in e)n[i]=e[i];var r=h[n.name];r||(r={forages:[],db:null,dbReady:null,deferredOperations:[]},h[n.name]=r),r.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=E);var o=[];function a(){return s.resolve()}for(var c=0;c<r.forages.length;c++){var l=r.forages[c];l!==t&&o.push(l._initReady().catch(a))}var u=r.forages.slice(0);return s.all(o).then((function(){return n.db=r.db,b(n)})).then((function(e){return n.db=e,w(n,t._defaultConfig.version)?y(n):e})).then((function(e){n.db=r.db=e,t._dbInfo=n;for(var i=0;i<u.length;i++){var o=u[i];o!==t&&(o._dbInfo.db=n.db,o._dbInfo.version=n.version)}}))},_support:function(){try{if(!r)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,i=new s((function(t,i){n.ready().then((function(){A(n._dbInfo,"readonly",(function(r,o){if(r)return i(r);try{var s=o.objectStore(n._dbInfo.storeName).openCursor(),a=1;s.onsuccess=function(){var n=s.result;if(n){var i=n.value;x(i)&&(i=S(i));var r=e(i,n.key,a++);void 0!==r?t(r):n.continue()}else t()},s.onerror=function(){i(s.error)}}catch(e){i(e)}}))})).catch(i)}));return a(i,t),i},getItem:function(e,t){var n=this;e=l(e);var i=new s((function(t,i){n.ready().then((function(){A(n._dbInfo,"readonly",(function(r,o){if(r)return i(r);try{var s=o.objectStore(n._dbInfo.storeName).get(e);s.onsuccess=function(){var e=s.result;void 0===e&&(e=null),x(e)&&(e=S(e)),t(e)},s.onerror=function(){i(s.error)}}catch(e){i(e)}}))})).catch(i)}));return a(i,t),i},setItem:function(e,t,n){var i=this;e=l(e);var r=new s((function(n,r){var o;i.ready().then((function(){return o=i._dbInfo,"[object Blob]"===f.call(t)?p(o.db).then((function(e){return e?t:(n=t,new s((function(e,t){var i=new FileReader;i.onerror=t,i.onloadend=function(t){var i=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:i,type:n.type})},i.readAsBinaryString(n)})));var n})):t})).then((function(t){A(i._dbInfo,"readwrite",(function(o,s){if(o)return r(o);try{var a=s.objectStore(i._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);s.oncomplete=function(){void 0===t&&(t=null),n(t)},s.onabort=s.onerror=function(){var e=c.error?c.error:c.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return a(r,n),r},removeItem:function(e,t){var n=this;e=l(e);var i=new s((function(t,i){n.ready().then((function(){A(n._dbInfo,"readwrite",(function(r,o){if(r)return i(r);try{var s=o.objectStore(n._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){i(s.error)},o.onabort=function(){var e=s.error?s.error:s.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return a(i,t),i},clear:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){A(t._dbInfo,"readwrite",(function(i,r){if(i)return n(i);try{var o=r.objectStore(t._dbInfo.storeName).clear();r.oncomplete=function(){e()},r.onabort=r.onerror=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},length:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){A(t._dbInfo,"readonly",(function(i,r){if(i)return n(i);try{var o=r.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},key:function(e,t){var n=this,i=new s((function(t,i){e<0?t(null):n.ready().then((function(){A(n._dbInfo,"readonly",(function(r,o){if(r)return i(r);try{var s=o.objectStore(n._dbInfo.storeName),a=!1,c=s.openCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){i(c.error)}}catch(e){i(e)}}))})).catch(i)}));return a(i,t),i},keys:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){A(t._dbInfo,"readonly",(function(i,r){if(i)return n(i);try{var o=r.objectStore(t._dbInfo.storeName).openCursor(),s=[];o.onsuccess=function(){var t=o.result;t?(s.push(t.key),t.continue()):e(s)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var i,o=this;if(e.name){var c=e.name===n.name&&o._dbInfo.db,l=c?s.resolve(o._dbInfo.db):b(e).then((function(t){var n=h[e.name],i=n.forages;n.db=t;for(var r=0;r<i.length;r++)i[r]._dbInfo.db=t;return t}));i=e.storeName?l.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;g(e);var i=h[e.name],o=i.forages;t.close();for(var a=0;a<o.length;a++){var c=o[a];c._dbInfo.db=null,c._dbInfo.version=n}return new s((function(t,i){var o=r.open(e.name,n);o.onerror=function(e){o.result.close(),i(e)},o.onupgradeneeded=function(){o.result.deleteObjectStore(e.storeName)},o.onsuccess=function(){var e=o.result;e.close(),t(e)}})).then((function(e){i.db=e;for(var t=0;t<o.length;t++){var n=o[t];n._dbInfo.db=e,m(n._dbInfo)}})).catch((function(t){throw(v(e,t)||s.resolve()).catch((function(){})),t}))}})):l.then((function(t){g(e);var n=h[e.name],i=n.forages;t.close();for(var o=0;o<i.length;o++)i[o]._dbInfo.db=null;return new s((function(t,n){var i=r.deleteDatabase(e.name);i.onerror=i.onblocked=function(e){var t=i.result;t&&t.close(),n(e)},i.onsuccess=function(){var e=i.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<i.length;t++)m(i[t]._dbInfo)})).catch((function(t){throw(v(e,t)||s.resolve()).catch((function(){})),t}))}))}else i=s.reject("Invalid arguments");return a(i,t),i}},C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",k=/^~~local_forage_type~([^~]+)~/,O="__lfsc__:".length,T=O+"arbf".length,N=Object.prototype.toString;function M(e){var t,n,i,r,o,s=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var l=new ArrayBuffer(s),u=new Uint8Array(l);for(t=0;t<a;t+=4)n=C.indexOf(e[t]),i=C.indexOf(e[t+1]),r=C.indexOf(e[t+2]),o=C.indexOf(e[t+3]),u[c++]=n<<2|i>>4,u[c++]=(15&i)<<4|r>>2,u[c++]=(3&r)<<6|63&o;return l}function I(e){var t,n=new Uint8Array(e),i="";for(t=0;t<n.length;t+=3)i+=C[n[t]>>2],i+=C[(3&n[t])<<4|n[t+1]>>4],i+=C[(15&n[t+1])<<2|n[t+2]>>6],i+=C[63&n[t+2]];return n.length%3==2?i=i.substring(0,i.length-1)+"=":n.length%3==1&&(i=i.substring(0,i.length-2)+"=="),i}var R={serialize:function(e,t){var n="";if(e&&(n=N.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===N.call(e.buffer))){var i,r="__lfsc__:";e instanceof ArrayBuffer?(i=e,r+="arbf"):(i=e.buffer,"[object Int8Array]"===n?r+="si08":"[object Uint8Array]"===n?r+="ui08":"[object Uint8ClampedArray]"===n?r+="uic8":"[object Int16Array]"===n?r+="si16":"[object Uint16Array]"===n?r+="ur16":"[object Int32Array]"===n?r+="si32":"[object Uint32Array]"===n?r+="ui32":"[object Float32Array]"===n?r+="fl32":"[object Float64Array]"===n?r+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(r+I(i))}else if("[object Blob]"===n){var o=new FileReader;o.onload=function(){var n="~~local_forage_type~"+e.type+"~"+I(this.result);t("__lfsc__:blob"+n)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if("__lfsc__:"!==e.substring(0,O))return JSON.parse(e);var t,n=e.substring(T),i=e.substring(O,T);if("blob"===i&&k.test(n)){var r=n.match(k);t=r[1],n=n.substring(r[0].length)}var s=M(n);switch(i){case"arbf":return s;case"blob":return o([s],{type:t});case"si08":return new Int8Array(s);case"ui08":return new Uint8Array(s);case"uic8":return new Uint8ClampedArray(s);case"si16":return new Int16Array(s);case"ur16":return new Uint16Array(s);case"si32":return new Int32Array(s);case"ui32":return new Uint32Array(s);case"fl32":return new Float32Array(s);case"fl64":return new Float64Array(s);default:throw new Error("Unkown type: "+i)}},stringToBuffer:M,bufferToString:I};function D(e,t,n,i){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,i)}function P(e,t,n,i,r,o){e.executeSql(n,i,r,(function(e,s){s.code===s.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?o(e,s):D(e,t,(function(){e.executeSql(n,i,r,o)}),o)}),o):o(e,s)}),o)}function L(e,t,n,i){var r=this;e=l(e);var o=new s((function(o,s){r.ready().then((function(){void 0===t&&(t=null);var a=t,c=r._dbInfo;c.serializer.serialize(t,(function(t,l){l?s(l):c.db.transaction((function(n){P(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){o(a)}),(function(e,t){s(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(i>0)return void o(L.apply(r,[e,a,n,i-1]));s(t)}}))}))})).catch(s)}));return a(o,n),o}function z(e){return new s((function(t,n){e.transaction((function(i){i.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,i){for(var r=[],o=0;o<i.rows.length;o++)r.push(i.rows.item(o).name);t({db:e,storeNames:r})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}var F={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var i in e)n[i]="string"!=typeof e[i]?e[i].toString():e[i];var r=new s((function(e,i){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return i(e)}n.db.transaction((function(r){D(r,n,(function(){t._dbInfo=n,e()}),(function(e,t){i(t)}))}),i)}));return n.serializer=R,r},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,i=new s((function(t,i){n.ready().then((function(){var r=n._dbInfo;r.db.transaction((function(n){P(n,r,"SELECT * FROM "+r.storeName,[],(function(n,i){for(var o=i.rows,s=o.length,a=0;a<s;a++){var c=o.item(a),l=c.value;if(l&&(l=r.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){i(t)}))}))})).catch(i)}));return a(i,t),i},getItem:function(e,t){var n=this;e=l(e);var i=new s((function(t,i){n.ready().then((function(){var r=n._dbInfo;r.db.transaction((function(n){P(n,r,"SELECT * FROM "+r.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var i=n.rows.length?n.rows.item(0).value:null;i&&(i=r.serializer.deserialize(i)),t(i)}),(function(e,t){i(t)}))}))})).catch(i)}));return a(i,t),i},setItem:function(e,t,n){return L.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=l(e);var i=new s((function(t,i){n.ready().then((function(){var r=n._dbInfo;r.db.transaction((function(n){P(n,r,"DELETE FROM "+r.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){i(t)}))}))})).catch(i)}));return a(i,t),i},clear:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){var i=t._dbInfo;i.db.transaction((function(t){P(t,i,"DELETE FROM "+i.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},length:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){var i=t._dbInfo;i.db.transaction((function(t){P(t,i,"SELECT COUNT(key) as c FROM "+i.storeName,[],(function(t,n){var i=n.rows.item(0).c;e(i)}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},key:function(e,t){var n=this,i=new s((function(t,i){n.ready().then((function(){var r=n._dbInfo;r.db.transaction((function(n){P(n,r,"SELECT key FROM "+r.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var i=n.rows.length?n.rows.item(0).key:null;t(i)}),(function(e,t){i(t)}))}))})).catch(i)}));return a(i,t),i},keys:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){var i=t._dbInfo;i.db.transaction((function(t){P(t,i,"SELECT key FROM "+i.storeName,[],(function(t,n){for(var i=[],r=0;r<n.rows.length;r++)i.push(n.rows.item(r).key);e(i)}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var i,r=this;return a(i=e.name?new s((function(t){var i;i=e.name===n.name?r._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:i,storeNames:[e.storeName]}):t(z(i))})).then((function(e){return new s((function(t,n){e.db.transaction((function(i){function r(e){return new s((function(t,n){i.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var o=[],a=0,c=e.storeNames.length;a<c;a++)o.push(r(e.storeNames[a]));s.all(o).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):s.reject("Invalid arguments"),t),i}};function B(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function q(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0}var U={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=B(e,this._defaultConfig),q()?(this._dbInfo=t,t.serializer=R,s.resolve()):s.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,i=n.ready().then((function(){for(var t=n._dbInfo,i=t.keyPrefix,r=i.length,o=localStorage.length,s=1,a=0;a<o;a++){var c=localStorage.key(a);if(0===c.indexOf(i)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(r),s++)))return l}}}));return a(i,t),i},getItem:function(e,t){var n=this;e=l(e);var i=n.ready().then((function(){var t=n._dbInfo,i=localStorage.getItem(t.keyPrefix+e);return i&&(i=t.serializer.deserialize(i)),i}));return a(i,t),i},setItem:function(e,t,n){var i=this;e=l(e);var r=i.ready().then((function(){void 0===t&&(t=null);var n=t;return new s((function(r,o){var s=i._dbInfo;s.serializer.serialize(t,(function(t,i){if(i)o(i);else try{localStorage.setItem(s.keyPrefix+e,t),r(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}}))}))}));return a(r,n),r},removeItem:function(e,t){var n=this;e=l(e);var i=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return a(i,t),i},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var i=localStorage.key(n);0===i.indexOf(e)&&localStorage.removeItem(i)}}));return a(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return a(t,e),t},key:function(e,t){var n=this,i=n.ready().then((function(){var t,i=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(i.keyPrefix.length)),t}));return a(i,t),i},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,i=[],r=0;r<n;r++){var o=localStorage.key(r);0===o.indexOf(e.keyPrefix)&&i.push(o.substring(e.keyPrefix.length))}return i}));return a(n,e),n},dropInstance:function(e,t){if(t=u.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var i,r=this;return a(i=e.name?new s((function(t){e.storeName?t(B(e,r._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):s.reject("Invalid arguments"),t),i}},H=function(e,t){for(var n,i,r=e.length,o=0;o<r;){if((n=e[o])===(i=t)||"number"==typeof n&&"number"==typeof i&&isNaN(n)&&isNaN(i))return!0;o++}return!1},$=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},W={},V={},G={INDEXEDDB:j,WEBSQL:F,LOCALSTORAGE:U},J=[G.INDEXEDDB._driver,G.WEBSQL._driver,G.LOCALSTORAGE._driver],Q=["dropInstance"],K=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Q),Y={description:"",driver:J.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function X(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function Z(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&($(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ee=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),G)if(G.hasOwnProperty(n)){var i=G[n],r=i._driver;this[n]=r,W[r]||this.defineDriver(i)}this._defaultConfig=Z({},Y),this._config=Z({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":i(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var i=new s((function(t,n){try{var i=e._driver,r=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(r);for(var o=K.concat("_initStorage"),c=0,l=o.length;c<l;c++){var u=o[c];if((!H(Q,u)||e[u])&&"function"!=typeof e[u])return void n(r)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=s.reject(t);return a(n,arguments[arguments.length-1]),n}},n=0,i=Q.length;n<i;n++){var r=Q[n];e[r]||(e[r]=t(r))}}();var d=function(n){W[i]&&console.info("Redefining LocalForage driver: "+i),W[i]=e,V[i]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(d,n):d(!!e._support):d(!0)}catch(e){n(e)}}));return c(i,t,n),i},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var i=W[e]?s.resolve(W[e]):s.reject(new Error("Driver not found."));return c(i,t,n),i},e.prototype.getSerializer=function(e){var t=s.resolve(R);return c(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return c(n,e,e),n},e.prototype.setDriver=function(e,t,n){var i=this;$(e)||(e=[e]);var r=this._getSupportedDrivers(e);function o(){i._config.driver=i.driver()}function a(e){return i._extend(e),o(),i._ready=i._initStorage(i._config),i._ready}var l=null!==this._driverSet?this._driverSet.catch((function(){return s.resolve()})):s.resolve();return this._driverSet=l.then((function(){var e=r[0];return i._dbInfo=null,i._ready=null,i.getDriver(e).then((function(e){i._driver=e._driver,o(),i._wrapLibraryMethodsWithReady(),i._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var r=e[t];return t++,i._dbInfo=null,i._ready=null,i.getDriver(r).then(a).catch(n)}o();var c=new Error("No available storage method found.");return i._driverSet=s.reject(c),i._driverSet}()}}(r)}))})).catch((function(){o();var e=new Error("No available storage method found.");return i._driverSet=s.reject(e),i._driverSet})),c(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!V[e]},e.prototype._extend=function(e){Z(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];this.supports(r)&&t.push(r)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=K.length;e<t;e++)X(this,K[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=ee},{3:3}]},{},[4])(4)}).call(this,n(9))},function(e,t,n){var i=n(37),r=n(43);e.exports=function(e){return null!=e&&r(e.length)&&!i(e)}},function(e,t,n){var i=n(60),r=n(64),o=n(17);e.exports=function(e){return o(e)?i(e):r(e)}},function(e,t,n){var i,r,o;
/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.2
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */!function(s,a){"use strict";e.exports?e.exports=a(n(100),n(101),n(102)):(r=[n(100),n(101),n(102)],void 0===(o="function"==typeof(i=a)?i.apply(t,r):i)||(e.exports=o))}(0,(function(e,t,n,i){"use strict";var r=i&&i.URI;function o(e,t){var n=arguments.length>=1,i=arguments.length>=2;if(!(this instanceof o))return n?i?new o(e,t):new o(e):new o;if(void 0===e){if(n)throw new TypeError("undefined is not a valid argument for URI");e="undefined"!=typeof location?location.href+"":""}if(null===e&&n)throw new TypeError("null is not a valid argument for URI");return this.href(e),void 0!==t?this.absoluteTo(t):this}o.version="1.19.2";var s=o.prototype,a=Object.prototype.hasOwnProperty;function c(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function l(e){return void 0===e?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function u(e){return"Array"===l(e)}function d(e,t){var n,i,r={};if("RegExp"===l(t))r=null;else if(u(t))for(n=0,i=t.length;n<i;n++)r[t[n]]=!0;else r[t]=!0;for(n=0,i=e.length;n<i;n++){(r&&void 0!==r[e[n]]||!r&&t.test(e[n]))&&(e.splice(n,1),i--,n--)}return e}function h(e,t){var n,i;if(u(t)){for(n=0,i=t.length;n<i;n++)if(!h(e,t[n]))return!1;return!0}var r=l(t);for(n=0,i=e.length;n<i;n++)if("RegExp"===r){if("string"==typeof e[n]&&e[n].match(t))return!0}else if(e[n]===t)return!0;return!1}function f(e,t){if(!u(e)||!u(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function p(e){return e.replace(/^\/+|\/+$/g,"")}function g(e){return escape(e)}function m(e){return encodeURIComponent(e).replace(/[!'()*]/g,g).replace(/\*/g,"%2A")}o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:o.preventInvalidHostname,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.preventInvalidHostname=!1,o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\._-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.hostProtocols=["http","https"],o.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(e){if(e&&e.nodeName){var t=e.nodeName.toLowerCase();if("input"!==t||"image"===e.type)return o.domAttributes[t]}},o.encode=m,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=m,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(e,t){var n=o.encode(e+"");return void 0===t&&(t=o.escapeQuerySpace),t?n.replace(/%20/g,"+"):n},o.decodeQuery=function(e,t){e+="",void 0===t&&(t=o.escapeQuerySpace);try{return o.decode(t?e.replace(/\+/g,"%20"):e)}catch(t){return e}};var v,_={encode:"encode",decode:"decode"},b=function(e,t){return function(n){try{return o[t](n+"").replace(o.characters[e][t].expression,(function(n){return o.characters[e][t].map[n]}))}catch(e){return n}}};for(v in _)o[v+"PathSegment"]=b("pathname",_[v]),o[v+"UrnPathSegment"]=b("urnpath",_[v]);var y=function(e,t,n){return function(i){var r;r=n?function(e){return o[t](o[n](e))}:o[t];for(var s=(i+"").split(e),a=0,c=s.length;a<c;a++)s[a]=r(s[a]);return s.join(e)}};function w(e){return function(t,n){return void 0===t?this._parts[e]||"":(this._parts[e]=t||null,this.build(!n),this)}}function S(e,t){return function(n,i){return void 0===n?this._parts[e]||"":(null!==n&&(n+="").charAt(0)===t&&(n=n.substring(1)),this._parts[e]=n,this.build(!i),this)}}o.decodePath=y("/","decodePathSegment"),o.decodeUrnPath=y(":","decodeUrnPathSegment"),o.recodePath=y("/","encodePathSegment","decode"),o.recodeUrnPath=y(":","encodeUrnPathSegment","decode"),o.encodeReserved=b("reserved","encode"),o.parse=function(e,t){var n;return t||(t={preventInvalidHostname:o.preventInvalidHostname}),(n=e.indexOf("#"))>-1&&(t.fragment=e.substring(n+1)||null,e=e.substring(0,n)),(n=e.indexOf("?"))>-1&&(t.query=e.substring(n+1)||null,e=e.substring(0,n)),"//"===e.substring(0,2)?(t.protocol=null,e=e.substring(2),e=o.parseAuthority(e,t)):(n=e.indexOf(":"))>-1&&(t.protocol=e.substring(0,n)||null,t.protocol&&!t.protocol.match(o.protocol_expression)?t.protocol=void 0:"//"===e.substring(n+1,n+3)?(e=e.substring(n+3),e=o.parseAuthority(e,t)):(e=e.substring(n+1),t.urn=!0)),t.path=e,t},o.parseHost=function(e,t){e||(e="");var n,i,r=(e=e.replace(/\\/g,"/")).indexOf("/");if(-1===r&&(r=e.length),"["===e.charAt(0))n=e.indexOf("]"),t.hostname=e.substring(1,n)||null,t.port=e.substring(n+2,r)||null,"/"===t.port&&(t.port=null);else{var s=e.indexOf(":"),a=e.indexOf("/"),c=e.indexOf(":",s+1);-1!==c&&(-1===a||c<a)?(t.hostname=e.substring(0,r)||null,t.port=null):(i=e.substring(0,r).split(":"),t.hostname=i[0]||null,t.port=i[1]||null)}return t.hostname&&"/"!==e.substring(r).charAt(0)&&(r++,e="/"+e),t.preventInvalidHostname&&o.ensureValidHostname(t.hostname,t.protocol),t.port&&o.ensureValidPort(t.port),e.substring(r)||"/"},o.parseAuthority=function(e,t){return e=o.parseUserinfo(e,t),o.parseHost(e,t)},o.parseUserinfo=function(e,t){var n,i=e.indexOf("/"),r=e.lastIndexOf("@",i>-1?i:e.length-1);return r>-1&&(-1===i||r<i)?(n=e.substring(0,r).split(":"),t.username=n[0]?o.decode(n[0]):null,n.shift(),t.password=n[0]?o.decode(n.join(":")):null,e=e.substring(r+1)):(t.username=null,t.password=null),e},o.parseQuery=function(e,t){if(!e)return{};if(!(e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var n,i,r,s={},c=e.split("&"),l=c.length,u=0;u<l;u++)n=c[u].split("="),i=o.decodeQuery(n.shift(),t),r=n.length?o.decodeQuery(n.join("="),t):null,a.call(s,i)?("string"!=typeof s[i]&&null!==s[i]||(s[i]=[s[i]]),s[i].push(r)):s[i]=r;return s},o.build=function(e){var t="",n=!1;return e.protocol&&(t+=e.protocol+":"),e.urn||!t&&!e.hostname||(t+="//",n=!0),t+=o.buildAuthority(e)||"","string"==typeof e.path&&("/"!==e.path.charAt(0)&&n&&(t+="/"),t+=e.path),"string"==typeof e.query&&e.query&&(t+="?"+e.query),"string"==typeof e.fragment&&e.fragment&&(t+="#"+e.fragment),t},o.buildHost=function(e){var t="";return e.hostname?(o.ip6_expression.test(e.hostname)?t+="["+e.hostname+"]":t+=e.hostname,e.port&&(t+=":"+e.port),t):""},o.buildAuthority=function(e){return o.buildUserinfo(e)+o.buildHost(e)},o.buildUserinfo=function(e){var t="";return e.username&&(t+=o.encode(e.username)),e.password&&(t+=":"+o.encode(e.password)),t&&(t+="@"),t},o.buildQuery=function(e,t,n){var i,r,s,c,l="";for(r in e)if(a.call(e,r))if(u(e[r]))for(i={},s=0,c=e[r].length;s<c;s++)void 0!==e[r][s]&&void 0===i[e[r][s]+""]&&(l+="&"+o.buildQueryParameter(r,e[r][s],n),!0!==t&&(i[e[r][s]+""]=!0));else void 0!==e[r]&&(l+="&"+o.buildQueryParameter(r,e[r],n));return l.substring(1)},o.buildQueryParameter=function(e,t,n){return o.encodeQuery(e,n)+(null!==t?"="+o.encodeQuery(t,n):"")},o.addQuery=function(e,t,n){if("object"==typeof t)for(var i in t)a.call(t,i)&&o.addQuery(e,i,t[i]);else{if("string"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===e[t])return void(e[t]=n);"string"==typeof e[t]&&(e[t]=[e[t]]),u(n)||(n=[n]),e[t]=(e[t]||[]).concat(n)}},o.setQuery=function(e,t,n){if("object"==typeof t)for(var i in t)a.call(t,i)&&o.setQuery(e,i,t[i]);else{if("string"!=typeof t)throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");e[t]=void 0===n?null:n}},o.removeQuery=function(e,t,n){var i,r,s;if(u(t))for(i=0,r=t.length;i<r;i++)e[t[i]]=void 0;else if("RegExp"===l(t))for(s in e)t.test(s)&&(e[s]=void 0);else if("object"==typeof t)for(s in t)a.call(t,s)&&o.removeQuery(e,s,t[s]);else{if("string"!=typeof t)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==n?"RegExp"===l(n)?!u(e[t])&&n.test(e[t])?e[t]=void 0:e[t]=d(e[t],n):e[t]!==String(n)||u(n)&&1!==n.length?u(e[t])&&(e[t]=d(e[t],n)):e[t]=void 0:e[t]=void 0}},o.hasQuery=function(e,t,n,i){switch(l(t)){case"String":break;case"RegExp":for(var r in e)if(a.call(e,r)&&t.test(r)&&(void 0===n||o.hasQuery(e,r,n)))return!0;return!1;case"Object":for(var s in t)if(a.call(t,s)&&!o.hasQuery(e,s,t[s]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(l(n)){case"Undefined":return t in e;case"Boolean":return n===Boolean(u(e[t])?e[t].length:e[t]);case"Function":return!!n(e[t],t,e);case"Array":return!!u(e[t])&&(i?h:f)(e[t],n);case"RegExp":return u(e[t])?!!i&&h(e[t],n):Boolean(e[t]&&e[t].match(n));case"Number":n=String(n);case"String":return u(e[t])?!!i&&h(e[t],n):e[t]===n;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.joinPaths=function(){for(var e=[],t=[],n=0,i=0;i<arguments.length;i++){var r=new o(arguments[i]);e.push(r);for(var s=r.segment(),a=0;a<s.length;a++)"string"==typeof s[a]&&t.push(s[a]),s[a]&&n++}if(!t.length||!n)return new o("");var c=new o("").segment(t);return""!==e[0].path()&&"/"!==e[0].path().slice(0,1)||c.path("/"+c.path()),c.normalize()},o.commonPath=function(e,t){var n,i=Math.min(e.length,t.length);for(n=0;n<i;n++)if(e.charAt(n)!==t.charAt(n)){n--;break}return n<1?e.charAt(0)===t.charAt(0)&&"/"===e.charAt(0)?"/":"":("/"===e.charAt(n)&&"/"===t.charAt(n)||(n=e.substring(0,n).lastIndexOf("/")),e.substring(0,n+1))},o.withinString=function(e,t,n){n||(n={});var i=n.start||o.findUri.start,r=n.end||o.findUri.end,s=n.trim||o.findUri.trim,a=n.parens||o.findUri.parens,c=/[a-z0-9-]=["']?$/i;for(i.lastIndex=0;;){var l=i.exec(e);if(!l)break;var u=l.index;if(n.ignoreHtml){var d=e.slice(Math.max(u-3,0),u);if(d&&c.test(d))continue}for(var h=u+e.slice(u).search(r),f=e.slice(u,h),p=-1;;){var g=a.exec(f);if(!g)break;var m=g.index+g[0].length;p=Math.max(p,m)}if(!((f=p>-1?f.slice(0,p)+f.slice(p).replace(s,""):f.replace(s,"")).length<=l[0].length||n.ignore&&n.ignore.test(f))){var v=t(f,u,h=u+f.length,e);void 0!==v?(v=String(v),e=e.slice(0,u)+v+e.slice(h),i.lastIndex=u+v.length):i.lastIndex=h}}return i.lastIndex=0,e},o.ensureValidHostname=function(t,n){var i=!!t,r=!1;if(!!n&&(r=h(o.hostProtocols,n)),r&&!i)throw new TypeError("Hostname cannot be empty, if protocol is "+n);if(t&&t.match(o.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(t).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_]')}},o.ensureValidPort=function(e){if(e){var t=Number(e);if(!(/^[0-9]+$/.test(t)&&t>0&&t<65536))throw new TypeError('Port "'+e+'" is not a valid port')}},o.noConflict=function(e){if(e){var t={URI:this.noConflict()};return i.URITemplate&&"function"==typeof i.URITemplate.noConflict&&(t.URITemplate=i.URITemplate.noConflict()),i.IPv6&&"function"==typeof i.IPv6.noConflict&&(t.IPv6=i.IPv6.noConflict()),i.SecondLevelDomains&&"function"==typeof i.SecondLevelDomains.noConflict&&(t.SecondLevelDomains=i.SecondLevelDomains.noConflict()),t}return i.URI===this&&(i.URI=r),this},s.build=function(e){return!0===e?this._deferred_build=!0:(void 0===e||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},s.clone=function(){return new o(this)},s.valueOf=s.toString=function(){return this.build(!1)._string},s.protocol=w("protocol"),s.username=w("username"),s.password=w("password"),s.hostname=w("hostname"),s.port=w("port"),s.query=S("query","?"),s.fragment=S("fragment","#"),s.search=function(e,t){var n=this.query(e,t);return"string"==typeof n&&n.length?"?"+n:n},s.hash=function(e,t){var n=this.fragment(e,t);return"string"==typeof n&&n.length?"#"+n:n},s.pathname=function(e,t){if(void 0===e||!0===e){var n=this._parts.path||(this._parts.hostname?"/":"");return e?(this._parts.urn?o.decodeUrnPath:o.decodePath)(n):n}return this._parts.urn?this._parts.path=e?o.recodeUrnPath(e):"":this._parts.path=e?o.recodePath(e):"/",this.build(!t),this},s.path=s.pathname,s.href=function(e,t){var n;if(void 0===e)return this.toString();this._string="",this._parts=o._parts();var i=e instanceof o,r="object"==typeof e&&(e.hostname||e.path||e.pathname);e.nodeName&&(e=e[o.getDomAttribute(e)]||"",r=!1);if(!i&&r&&void 0!==e.pathname&&(e=e.toString()),"string"==typeof e||e instanceof String)this._parts=o.parse(String(e),this._parts);else{if(!i&&!r)throw new TypeError("invalid input");var s=i?e._parts:e;for(n in s)"query"!==n&&a.call(this._parts,n)&&(this._parts[n]=s[n]);s.query&&this.query(s.query,!1)}return this.build(!t),this},s.is=function(e){var t=!1,i=!1,r=!1,s=!1,a=!1,c=!1,l=!1,u=!this._parts.urn;switch(this._parts.hostname&&(u=!1,i=o.ip4_expression.test(this._parts.hostname),r=o.ip6_expression.test(this._parts.hostname),a=(s=!(t=i||r))&&n&&n.has(this._parts.hostname),c=s&&o.idn_expression.test(this._parts.hostname),l=s&&o.punycode_expression.test(this._parts.hostname)),e.toLowerCase()){case"relative":return u;case"absolute":return!u;case"domain":case"name":return s;case"sld":return a;case"ip":return t;case"ip4":case"ipv4":case"inet4":return i;case"ip6":case"ipv6":case"inet6":return r;case"idn":return c;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return l}return null};var x=s.protocol,E=s.port,A=s.hostname;s.protocol=function(e,t){if(e&&!(e=e.replace(/:(\/\/)?$/,"")).match(o.protocol_expression))throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return x.call(this,e,t)},s.scheme=s.protocol,s.port=function(e,t){return this._parts.urn?void 0===e?"":this:(void 0!==e&&(0===e&&(e=null),e&&(":"===(e+="").charAt(0)&&(e=e.substring(1)),o.ensureValidPort(e))),E.call(this,e,t))},s.hostname=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e){var n={preventInvalidHostname:this._parts.preventInvalidHostname};if("/"!==o.parseHost(e,n))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');e=n.hostname,this._parts.preventInvalidHostname&&o.ensureValidHostname(e,this._parts.protocol)}return A.call(this,e,t)},s.origin=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var n=this.protocol();return this.authority()?(n?n+"://":"")+this.authority():""}var i=o(e);return this.protocol(i.protocol()).authority(i.authority()).build(!t),this},s.host=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?o.buildHost(this._parts):"";if("/"!==o.parseHost(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},s.authority=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?o.buildAuthority(this._parts):"";if("/"!==o.parseAuthority(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},s.userinfo=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var n=o.buildUserinfo(this._parts);return n?n.substring(0,n.length-1):n}return"@"!==e[e.length-1]&&(e+="@"),o.parseUserinfo(e,this._parts),this.build(!t),this},s.resource=function(e,t){var n;return void 0===e?this.path()+this.search()+this.hash():(n=o.parse(e),this._parts.path=n.path,this._parts.query=n.query,this._parts.fragment=n.fragment,this.build(!t),this)},s.subdomain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,n)||""}var i=this._parts.hostname.length-this.domain().length,r=this._parts.hostname.substring(0,i),s=new RegExp("^"+c(r));if(e&&"."!==e.charAt(e.length-1)&&(e+="."),-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");return e&&o.ensureValidHostname(e,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(s,e),this.build(!t),this},s.domain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.match(/\./g);if(n&&n.length<2)return this._parts.hostname;var i=this._parts.hostname.length-this.tld(t).length-1;return i=this._parts.hostname.lastIndexOf(".",i-1)+1,this._parts.hostname.substring(i)||""}if(!e)throw new TypeError("cannot set domain empty");if(-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");if(o.ensureValidHostname(e,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=e;else{var r=new RegExp(c(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(r,e)}return this.build(!t),this},s.tld=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.lastIndexOf("."),r=this._parts.hostname.substring(i+1);return!0!==t&&n&&n.list[r.toLowerCase()]&&n.get(this._parts.hostname)||r}var o;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!n||!n.is(e))throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');o=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(o,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");o=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(o,e)}return this.build(!t),this},s.directory=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var n=this._parts.path.length-this.filename().length-1,i=this._parts.path.substring(0,n)||(this._parts.hostname?"/":"");return e?o.decodePath(i):i}var r=this._parts.path.length-this.filename().length,s=this._parts.path.substring(0,r),a=new RegExp("^"+c(s));return this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e)),e&&"/"!==e.charAt(e.length-1)&&(e+="/"),e=o.recodePath(e),this._parts.path=this._parts.path.replace(a,e),this.build(!t),this},s.filename=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("string"!=typeof e){if(!this._parts.path||"/"===this._parts.path)return"";var n=this._parts.path.lastIndexOf("/"),i=this._parts.path.substring(n+1);return e?o.decodePathSegment(i):i}var r=!1;"/"===e.charAt(0)&&(e=e.substring(1)),e.match(/\.?\//)&&(r=!0);var s=new RegExp(c(this.filename())+"$");return e=o.recodePath(e),this._parts.path=this._parts.path.replace(s,e),r?this.normalizePath(t):this.build(!t),this},s.suffix=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path)return"";var n,i,r=this.filename(),s=r.lastIndexOf(".");return-1===s?"":(n=r.substring(s+1),i=/^[a-z0-9%]+$/i.test(n)?n:"",e?o.decodePathSegment(i):i)}"."===e.charAt(0)&&(e=e.substring(1));var a,l=this.suffix();if(l)a=e?new RegExp(c(l)+"$"):new RegExp(c("."+l)+"$");else{if(!e)return this;this._parts.path+="."+o.recodePath(e)}return a&&(e=o.recodePath(e),this._parts.path=this._parts.path.replace(a,e)),this.build(!t),this},s.segment=function(e,t,n){var i=this._parts.urn?":":"/",r=this.path(),o="/"===r.substring(0,1),s=r.split(i);if(void 0!==e&&"number"!=typeof e&&(n=t,t=e,e=void 0),void 0!==e&&"number"!=typeof e)throw new Error('Bad segment "'+e+'", must be 0-based integer');if(o&&s.shift(),e<0&&(e=Math.max(s.length+e,0)),void 0===t)return void 0===e?s:s[e];if(null===e||void 0===s[e])if(u(t)){s=[];for(var a=0,c=t.length;a<c;a++)(t[a].length||s.length&&s[s.length-1].length)&&(s.length&&!s[s.length-1].length&&s.pop(),s.push(p(t[a])))}else(t||"string"==typeof t)&&(t=p(t),""===s[s.length-1]?s[s.length-1]=t:s.push(t));else t?s[e]=p(t):s.splice(e,1);return o&&s.unshift(""),this.path(s.join(i),n)},s.segmentCoded=function(e,t,n){var i,r,s;if("number"!=typeof e&&(n=t,t=e,e=void 0),void 0===t){if(u(i=this.segment(e,t,n)))for(r=0,s=i.length;r<s;r++)i[r]=o.decode(i[r]);else i=void 0!==i?o.decode(i):void 0;return i}if(u(t))for(r=0,s=t.length;r<s;r++)t[r]=o.encode(t[r]);else t="string"==typeof t||t instanceof String?o.encode(t):t;return this.segment(e,t,n)};var j=s.query;return s.query=function(e,t){if(!0===e)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof e){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),i=e.call(this,n);return this._parts.query=o.buildQuery(i||n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return void 0!==e&&"string"!=typeof e?(this._parts.query=o.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):j.call(this,e,t)},s.setQuery=function(e,t,n){var i=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof e||e instanceof String)i[e]=void 0!==t?t:null;else{if("object"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var r in e)a.call(e,r)&&(i[r]=e[r])}return this._parts.query=o.buildQuery(i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},s.addQuery=function(e,t,n){var i=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(i,e,void 0===t?null:t),this._parts.query=o.buildQuery(i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},s.removeQuery=function(e,t,n){var i=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(i,e,t),this._parts.query=o.buildQuery(i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},s.hasQuery=function(e,t,n){var i=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(i,e,t,n)},s.setSearch=s.setQuery,s.addSearch=s.addQuery,s.removeSearch=s.removeQuery,s.hasSearch=s.hasQuery,s.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},s.normalizeProtocol=function(e){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},s.normalizeHostname=function(n){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!n)),this},s.normalizePort=function(e){return"string"==typeof this._parts.protocol&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},s.normalizePath=function(e){var t,n=this._parts.path;if(!n)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!e),this;if("/"===this._parts.path)return this;var i,r,s="";for("/"!==(n=o.recodePath(n)).charAt(0)&&(t=!0,n="/"+n),"/.."!==n.slice(-3)&&"/."!==n.slice(-2)||(n+="/"),n=n.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),t&&(s=n.substring(1).match(/^(\.\.\/)+/)||"")&&(s=s[0]);-1!==(i=n.search(/\/\.\.(\/|$)/));)0!==i?(-1===(r=n.substring(0,i).lastIndexOf("/"))&&(r=i),n=n.substring(0,r)+n.substring(i+3)):n=n.substring(3);return t&&this.is("relative")&&(n=s+n.substring(1)),this._parts.path=n,this.build(!e),this},s.normalizePathname=s.normalizePath,s.normalizeQuery=function(e){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},s.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},s.normalizeSearch=s.normalizeQuery,s.normalizeHash=s.normalizeFragment,s.iso8859=function(){var e=o.encode,t=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=e,o.decode=t}return this},s.unicode=function(){var e=o.encode,t=o.decode;o.encode=m,o.decode=unescape;try{this.normalize()}finally{o.encode=e,o.decode=t}return this},s.readable=function(){var t=this.clone();t.username("").password("").normalize();var n="";if(t._parts.protocol&&(n+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(n+=e.toUnicode(t._parts.hostname),t._parts.port&&(n+=":"+t._parts.port)):n+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(n+="/"),n+=t.path(!0),t._parts.query){for(var i="",r=0,s=t._parts.query.split("&"),a=s.length;r<a;r++){var c=(s[r]||"").split("=");i+="&"+o.decodeQuery(c[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==c[1]&&(i+="="+o.decodeQuery(c[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}n+="?"+i.substring(1)}return n+=o.decodeQuery(t.hash(),!0)},s.absoluteTo=function(e){var t,n,i,r=this.clone(),s=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e instanceof o||(e=new o(e)),r._parts.protocol)return r;if(r._parts.protocol=e._parts.protocol,this._parts.hostname)return r;for(n=0;i=s[n];n++)r._parts[i]=e._parts[i];return r._parts.path?(".."===r._parts.path.substring(-2)&&(r._parts.path+="/"),"/"!==r.path().charAt(0)&&(t=(t=e.directory())||(0===e.path().indexOf("/")?"/":""),r._parts.path=(t?t+"/":"")+r._parts.path,r.normalizePath())):(r._parts.path=e._parts.path,r._parts.query||(r._parts.query=e._parts.query)),r.build(),r},s.relativeTo=function(e){var t,n,i,r,s,a=this.clone().normalize();if(a._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e=new o(e).normalize(),t=a._parts,n=e._parts,r=a.path(),s=e.path(),"/"!==r.charAt(0))throw new Error("URI is already relative");if("/"!==s.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(t.protocol===n.protocol&&(t.protocol=null),t.username!==n.username||t.password!==n.password)return a.build();if(null!==t.protocol||null!==t.username||null!==t.password)return a.build();if(t.hostname!==n.hostname||t.port!==n.port)return a.build();if(t.hostname=null,t.port=null,r===s)return t.path="",a.build();if(!(i=o.commonPath(r,s)))return a.build();var c=n.path.substring(i.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return t.path=c+t.path.substring(i.length)||"./",a.build()},s.equals=function(e){var t,n,i,r,s,c=this.clone(),l=new o(e),d={};if(c.normalize(),l.normalize(),c.toString()===l.toString())return!0;if(i=c.query(),r=l.query(),c.query(""),l.query(""),c.toString()!==l.toString())return!1;if(i.length!==r.length)return!1;for(s in t=o.parseQuery(i,this._parts.escapeQuerySpace),n=o.parseQuery(r,this._parts.escapeQuerySpace),t)if(a.call(t,s)){if(u(t[s])){if(!f(t[s],n[s]))return!1}else if(t[s]!==n[s])return!1;d[s]=!0}for(s in n)if(a.call(n,s)&&!d[s])return!1;return!0},s.preventInvalidHostname=function(e){return this._parts.preventInvalidHostname=!!e,this},s.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},s.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},o}))},function(e,t,n){var i=n(75),r=n(17),o=n(76),s=n(42),a=n(55),c=Math.max;e.exports=function(e,t,n,l){e=r(e)?e:a(e),n=n&&!l?s(n):0;var u=e.length;return n<0&&(n=c(u+n,0)),o(e)?n<=u&&e.indexOf(t,n)>-1:!!u&&i(e,t,n)>-1}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){var n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var i=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==i||"symbol"!=i&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t){e.exports=function(e){return e}},function(e,t,n){var i=n(27);e.exports=function(e){if("string"==typeof e||i(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},function(e,t,n){e.exports=n(291)},function(e,t,n){e.exports=n(305)},function(e,t,n){var i=n(13),r=n(11);e.exports=function(e){return"symbol"==typeof e||r(e)&&"[object Symbol]"==i(e)}},function(e,t,n){var i=n(6).Symbol;e.exports=i},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){var i=n(46),r=n(10);e.exports=function(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=i(e.prototype),o=e.apply(n,t);return r(o)?o:n}}},function(e,t){e.exports=function(e,t){for(var n=-1,i=e.length,r=0,o=[];++n<i;){var s=e[n];s!==t&&"__lodash_placeholder__"!==s||(e[n]="__lodash_placeholder__",o[r++]=n)}return o}},function(e,t,n){var i=n(342),r=n(343),o=n(344),s=n(345),a=n(346);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}c.prototype.clear=i,c.prototype.delete=r,c.prototype.get=o,c.prototype.has=s,c.prototype.set=a,e.exports=c},function(e,t,n){var i=n(29);e.exports=function(e,t){for(var n=e.length;n--;)if(i(e[n][0],t))return n;return-1}},function(e,t,n){var i=n(14)(Object,"create");e.exports=i},function(e,t,n){var i=n(360);e.exports=function(e,t){var n=e.__data__;return i(t)?n["string"==typeof t?"string":"hash"]:n.map}},function(e,t,n){var i=n(7),r=n(53),o=n(383),s=n(386);e.exports=function(e,t){return i(e)?e:r(e,t)?[e]:o(s(e))}},function(e,t,n){var i=n(13),r=n(10);e.exports=function(e){if(!r(e))return!1;var t=i(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/form_input.html --\x3e\n<div class="form-group">\n    ',"hidden"!==e.type&&(t+='\n        <label for="'+n(e.id)+'">'+n(e.label)+"</label>\n    "),t+="\n    ","password"===e.type&&e.fixed_username&&(t+='\n        \x3c!-- This is a hack to prevent Chrome from auto-filling the username in\n            any of the other input fields in the MUC configuration form. --\x3e\n        <input class="hidden-username" type="text" autocomplete="username" value="'+n(e.fixed_username)+'"></input>\n    '),t+='\n    <input \n        class="form-control" name="'+n(e.name)+'" type="'+n(e.type)+'" id="'+n(e.id)+'"\n        ',e.autocomplete&&(t+=' autocomplete="'+n(e.autocomplete)+'" '),t+="\n        ",e.placeholder&&(t+=' placeholder="'+n(e.placeholder)+'" '),t+="\n        ",e.value&&(t+=' value="'+n(e.value)+'" '),t+="\n        ",e.required&&(t+=' required="required" '),t+=" />\n</div>\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/form_username.html --\x3e\n<div class="form-group">\n    ',e.label&&(t+="\n    <label>\n        "+n(e.label)+"\n    </label>\n    "),t+='\n    <div class="input-group">\n        <div class="input-group-prepend">\n            <input name="'+n(e.name)+'" type="'+n(e.type)+'"\n                ',e.value&&(t+=' value="'+n(e.value)+'" '),t+="\n                ",e.required&&(t+=' required="required" '),t+=' />\n            <div class="input-group-text col" title="'+n(e.domain)+'">'+n(e.domain)+"</div>\n        </div>\n    </div>\n</div>\n"}},function(e,t,n){
/**
 * @preserve jed.js https://github.com/SlexAxton/Jed
 */
!function(n,i){var r=Array.prototype,o=Object.prototype,s=r.slice,a=o.hasOwnProperty,c=r.forEach,l={},u={forEach:function(e,t,n){var i,r,o;if(null!==e)if(c&&e.forEach===c)e.forEach(t,n);else if(e.length===+e.length){for(i=0,r=e.length;i<r;i++)if(i in e&&t.call(n,e[i],i,e)===l)return}else for(o in e)if(a.call(e,o)&&t.call(n,e[o],o,e)===l)return},extend:function(e){return this.forEach(s.call(arguments,1),(function(t){for(var n in t)e[n]=t[n]})),e}},d=function(e){if(this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages",debug:!1},this.options=u.extend({},this.defaults,e),this.textdomain(this.options.domain),e.domain&&!this.options.locale_data[this.options.domain])throw new Error("Text domain set to non-existent domain: `"+e.domain+"`")};function h(e){return d.PF.compile(e||"nplurals=2; plural=(n != 1);")}function f(e,t){this._key=e,this._i18n=t}d.context_delimiter=String.fromCharCode(4),u.extend(f.prototype,{onDomain:function(e){return this._domain=e,this},withContext:function(e){return this._context=e,this},ifPlural:function(e,t){return this._val=e,this._pkey=t,this},fetch:function(e){return"[object Array]"!={}.toString.call(e)&&(e=[].slice.call(arguments,0)),(e&&e.length?d.sprintf:function(e){return e})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),e)}}),u.extend(d.prototype,{translate:function(e){return new f(e,this)},textdomain:function(e){if(!e)return this._textdomain;this._textdomain=e},gettext:function(e){return this.dcnpgettext.call(this,void 0,void 0,e)},dgettext:function(e,t){return this.dcnpgettext.call(this,e,void 0,t)},dcgettext:function(e,t){return this.dcnpgettext.call(this,e,void 0,t)},ngettext:function(e,t,n){return this.dcnpgettext.call(this,void 0,void 0,e,t,n)},dngettext:function(e,t,n,i){return this.dcnpgettext.call(this,e,void 0,t,n,i)},dcngettext:function(e,t,n,i){return this.dcnpgettext.call(this,e,void 0,t,n,i)},pgettext:function(e,t){return this.dcnpgettext.call(this,void 0,e,t)},dpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},dcpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},npgettext:function(e,t,n,i){return this.dcnpgettext.call(this,void 0,e,t,n,i)},dnpgettext:function(e,t,n,i,r){return this.dcnpgettext.call(this,e,t,n,i,r)},dcnpgettext:function(e,t,n,i,r){var o;if(i=i||n,e=e||this._textdomain,!this.options)return(o=new d).dcnpgettext.call(o,void 0,void 0,n,i,r);if(!this.options.locale_data)throw new Error("No locale data provided.");if(!this.options.locale_data[e])throw new Error("Domain `"+e+"` was not found.");if(!this.options.locale_data[e][""])throw new Error("No locale meta information provided.");if(!n)throw new Error("No translation key found.");var s,a,c,l=t?t+d.context_delimiter+n:n,u=this.options.locale_data,f=u[e],p=(u.messages||this.defaults.locale_data.messages)[""],g=f[""].plural_forms||f[""]["Plural-Forms"]||f[""]["plural-forms"]||p.plural_forms||p["Plural-Forms"]||p["plural-forms"];if(void 0===r)c=0;else{if("number"!=typeof r&&(r=parseInt(r,10),isNaN(r)))throw new Error("The number that was passed in is not a number.");c=h(g)(r)}if(!f)throw new Error("No domain named `"+e+"` could be found.");return!(s=f[l])||c>s.length?(this.options.missing_key_callback&&this.options.missing_key_callback(l,e),a=[n,i],!0===this.options.debug&&console.log(a[h(g)(r)]),a[h()(r)]):(a=s[c])||(a=[n,i])[h()(r)]}});var p,g,m=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.format=function(n,i){var r,o,s,a,c,l,u,d=1,h=n.length,f="",p=[];for(o=0;o<h;o++)if("string"===(f=e(n[o])))p.push(n[o]);else if("array"===f){if((a=n[o])[2])for(r=i[d],s=0;s<a[2].length;s++){if(!r.hasOwnProperty(a[2][s]))throw m('[sprintf] property "%s" does not exist',a[2][s]);r=r[a[2][s]]}else r=a[1]?i[a[1]]:i[d++];if(/[^s]/.test(a[8])&&"number"!=e(r))throw m("[sprintf] expecting number but found %s",e(r));switch(null==r&&(r=""),a[8]){case"b":r=r.toString(2);break;case"c":r=String.fromCharCode(r);break;case"d":r=parseInt(r,10);break;case"e":r=a[7]?r.toExponential(a[7]):r.toExponential();break;case"f":r=a[7]?parseFloat(r).toFixed(a[7]):parseFloat(r);break;case"o":r=r.toString(8);break;case"s":r=(r=String(r))&&a[7]?r.substring(0,a[7]):r;break;case"u":r=Math.abs(r);break;case"x":r=r.toString(16);break;case"X":r=r.toString(16).toUpperCase()}r=/[def]/.test(a[8])&&a[3]&&r>=0?"+"+r:r,l=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",u=a[6]-String(r).length,c=a[6]?t(l,u):"",p.push(a[5]?r+c:c+r)}return p.join("")},n.cache={},n.parse=function(e){for(var t=e,n=[],i=[],r=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))i.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))i.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(n[2]){r|=1;var o=[],s=n[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(s)))throw"[sprintf] huh?";for(o.push(a[1]);""!==(s=s.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(s)))o.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(s)))throw"[sprintf] huh?";o.push(a[1])}n[2]=o}else r|=2;if(3===r)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";i.push(n)}t=t.substring(n[0].length)}return i},n}(),v=function(e,t){return t.unshift(e),m.apply(null,t)};d.parse_plural=function(e,t){return e=e.replace(/n/g,t),d.parse_expression(e)},d.sprintf=function(e,t){return"[object Array]"=={}.toString.call(t)?v(e,[].slice.call(t)):m.apply(this,[].slice.call(arguments))},d.prototype.sprintf=function(){return d.sprintf.apply(this,arguments)},(d.PF={}).parse=function(e){var t=d.PF.extractPluralExpr(e);return d.PF.parser.parse.call(d.PF.parser,t)},d.PF.compile=function(e){var t=d.PF.parse(e);return function(e){return!0===(n=d.PF.interpreter(t)(e))?1:n||0;var n}},d.PF.interpreter=function(e){return function(t){switch(e.type){case"GROUP":return d.PF.interpreter(e.expr)(t);case"TERNARY":return d.PF.interpreter(e.expr)(t)?d.PF.interpreter(e.truthy)(t):d.PF.interpreter(e.falsey)(t);case"OR":return d.PF.interpreter(e.left)(t)||d.PF.interpreter(e.right)(t);case"AND":return d.PF.interpreter(e.left)(t)&&d.PF.interpreter(e.right)(t);case"LT":return d.PF.interpreter(e.left)(t)<d.PF.interpreter(e.right)(t);case"GT":return d.PF.interpreter(e.left)(t)>d.PF.interpreter(e.right)(t);case"LTE":return d.PF.interpreter(e.left)(t)<=d.PF.interpreter(e.right)(t);case"GTE":return d.PF.interpreter(e.left)(t)>=d.PF.interpreter(e.right)(t);case"EQ":return d.PF.interpreter(e.left)(t)==d.PF.interpreter(e.right)(t);case"NEQ":return d.PF.interpreter(e.left)(t)!=d.PF.interpreter(e.right)(t);case"MOD":return d.PF.interpreter(e.left)(t)%d.PF.interpreter(e.right)(t);case"VAR":return t;case"NUM":return e.val;default:throw new Error("Invalid Token found.")}}},d.PF.extractPluralExpr=function(e){e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(e)||(e=e.concat(";"));var t,n=/nplurals\=(\d+);/,i=e.match(n);if(!(i.length>1))throw new Error("nplurals not found in plural_forms string: "+e);if(i[1],!((t=(e=e.replace(n,"")).match(/plural\=(.*);/))&&t.length>1))throw new Error("`plural` expression not found: "+e);return t[1]},d.PF.parser=(p={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(e,t,n,i,r,o,s){var a=o.length-1;switch(r){case 1:return{type:"GROUP",expr:o[a-1]};case 2:this.$={type:"TERNARY",expr:o[a-4],truthy:o[a-2],falsey:o[a]};break;case 3:this.$={type:"OR",left:o[a-2],right:o[a]};break;case 4:this.$={type:"AND",left:o[a-2],right:o[a]};break;case 5:this.$={type:"LT",left:o[a-2],right:o[a]};break;case 6:this.$={type:"LTE",left:o[a-2],right:o[a]};break;case 7:this.$={type:"GT",left:o[a-2],right:o[a]};break;case 8:this.$={type:"GTE",left:o[a-2],right:o[a]};break;case 9:this.$={type:"NEQ",left:o[a-2],right:o[a]};break;case 10:this.$={type:"EQ",left:o[a-2],right:o[a]};break;case 11:this.$={type:"MOD",left:o[a-2],right:o[a]};break;case 12:this.$={type:"GROUP",expr:o[a-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(e)}}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,n=[0],i=[null],r=[],o=this.table,s="",a=0,c=0,l=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;function d(){var e;return"number"!=typeof(e=t.lexer.lex()||1)&&(e=t.symbols_[e]||e),e}r.push(u),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,f,p,g,m,v,_,b,y,w,S={};;){if(p=n[n.length-1],this.defaultActions[p]?g=this.defaultActions[p]:(null==h&&(h=d()),g=o[p]&&o[p][h]),void 0===g||!g.length||!g[0]){if(!l){for(v in y=[],o[p])this.terminals_[v]&&v>2&&y.push("'"+this.terminals_[v]+"'");var x="";x=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+y.join(", ")+", got '"+this.terminals_[h]+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(x,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:u,expected:y})}if(3==l){if(1==h)throw new Error(x||"Parsing halted.");c=this.lexer.yyleng,s=this.lexer.yytext,a=this.lexer.yylineno,u=this.lexer.yylloc,h=d()}for(;!(2..toString()in o[p]);){if(0==p)throw new Error(x||"Parsing halted.");w=1,n.length=n.length-2*w,i.length=i.length-w,r.length=r.length-w,p=n[n.length-1]}f=h,h=2,g=o[p=n[n.length-1]]&&o[p][2],l=3}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+h);switch(g[0]){case 1:n.push(h),i.push(this.lexer.yytext),r.push(this.lexer.yylloc),n.push(g[1]),h=null,f?(h=f,f=null):(c=this.lexer.yyleng,s=this.lexer.yytext,a=this.lexer.yylineno,u=this.lexer.yylloc,l>0&&l--);break;case 2:if(_=this.productions_[g[1]][1],S.$=i[i.length-_],S._$={first_line:r[r.length-(_||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(_||1)].first_column,last_column:r[r.length-1].last_column},void 0!==(m=this.performAction.call(S,s,c,a,this.yy,g[1],i,r)))return m;_&&(n=n.slice(0,-1*_*2),i=i.slice(0,-1*_),r=r.slice(0,-1*_)),n.push(this.productions_[g[1]][0]),i.push(S.$),r.push(S._$),b=o[n[n.length-2]][n[n.length-1]],n.push(b);break;case 3:return!0}}return!0}},g=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parseError)throw new Error(e);this.yy.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.match+=e,this.matched+=e,e.match(/\n/)&&this.yylineno++,this._input=this._input.slice(1),e},unput:function(e){return this._input=e+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),i=0;i<n.length;i++)if(e=this._input.match(this.rules[n[i]]))return(t=e[0].match(/\n.*/g))&&(this.yylineno+=t.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:t?t[t.length-1].length-1:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],this.performAction.call(this,this.yy,this,n[i],this.conditionStack[this.conditionStack.length-1])||void 0;if(""===this._input)return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},performAction:function(e,t,n,i){switch(n){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return"INVALID"}},rules:[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}}};return e}(),p.lexer=g,p),e.exports&&(t=e.exports=d),t.Jed=d}()},function(e,t,n){var i,r;i=[n(0)],void 0===(r=function(e){return e.noConflict()}.apply(t,i))||(e.exports=r)},function(e,t,n){var i=n(287);e.exports=function(e){var t=i(e),n=t%1;return t==t?n?t-n:t:0}},function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},function(e,t){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},function(e,t){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r}},function(e,t,n){var i=n(10),r=Object.create,o=function(){function e(){}return function(t){if(!i(t))return{};if(r)return r(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=o},function(e,t,n){var i=n(46),r=n(48);function o(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}o.prototype=i(r.prototype),o.prototype.constructor=o,e.exports=o},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e){return e.placeholder}},function(e,t,n){var i=n(14)(n(6),"Map");e.exports=i},function(e,t,n){var i=n(352),r=n(359),o=n(361),s=n(362),a=n(363);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}c.prototype.clear=i,c.prototype.delete=r,c.prototype.get=o,c.prototype.has=s,c.prototype.set=a,e.exports=c},function(e,t,n){var i=n(36),r=n(24);e.exports=function(e,t){for(var n=0,o=(t=i(t,e)).length;null!=e&&n<o;)e=e[r(t[n++])];return n&&n==o?e:void 0}},function(e,t,n){var i=n(7),r=n(27),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;e.exports=function(e,t){if(i(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!r(e))||(s.test(e)||!o.test(e)||null!=t&&e in Object(t))}},function(e,t,n){var i=n(406).Symbol;e.exports=i},function(e,t,n){var i=n(321),r=n(18);e.exports=function(e){return null==e?[]:i(e,r(e))}},function(e,t,n){var i=n(71),r=n(322),o=n(49),s=n(31),a=i((function(e,t){var n=s(t,o(a));return r(e,32,void 0,t,n)}));a.placeholder={},e.exports=a},function(e,t,n){n(3);e.exports=function(e){return'\x3c!-- src/templates/chatboxes.html --\x3e\n<div class="converse-chatboxes row no-gutters"></div>\n<div id="converse-modals" class="modals"></div>\n','\x3c!-- src/templates/chatboxes.html --\x3e\n<div class="converse-chatboxes row no-gutters"></div>\n<div id="converse-modals" class="modals"></div>\n'}},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(9))},function(e,t){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e}},function(e,t,n){var i=n(296),r=n(61),o=n(7),s=n(62),a=n(22),c=n(63),l=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),u=!n&&r(e),d=!n&&!u&&s(e),h=!n&&!u&&!d&&c(e),f=n||u||d||h,p=f?i(e.length,String):[],g=p.length;for(var m in e)!t&&!l.call(e,m)||f&&("length"==m||d&&("offset"==m||"parent"==m)||h&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||a(m,g))||p.push(m);return p}},function(e,t,n){var i=n(297),r=n(11),o=Object.prototype,s=o.hasOwnProperty,a=o.propertyIsEnumerable,c=i(function(){return arguments}())?i:function(e){return r(e)&&s.call(e,"callee")&&!a.call(e,"callee")};e.exports=c},function(e,t,n){(function(e){var i=n(6),r=n(298),o=t&&!t.nodeType&&t,s=o&&"object"==typeof e&&e&&!e.nodeType&&e,a=s&&s.exports===o?i.Buffer:void 0,c=(a?a.isBuffer:void 0)||r;e.exports=c}).call(this,n(21)(e))},function(e,t,n){var i=n(299),r=n(300),o=n(301),s=o&&o.isTypedArray,a=s?r(s):i;e.exports=a},function(e,t,n){var i=n(65),r=n(302),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return r(e);var t=[];for(var n in Object(e))o.call(e,n)&&"constructor"!=n&&t.push(n);return t}},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t){e.exports=function(e,t){return function(n){return e(t(n))}}},function(e,t,n){var i=n(68),r=n(29),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var s=e[t];o.call(e,t)&&r(s,n)&&(void 0!==n||t in e)||i(e,t,n)}},function(e,t,n){var i=n(69);e.exports=function(e,t,n){"__proto__"==t&&i?i(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},function(e,t,n){var i=n(14),r=function(){try{var e=i(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=r},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,n){var i=n(23),r=n(312),o=n(72);e.exports=function(e,t){return o(r(e,t,i),e+"")}},function(e,t,n){var i=n(313),r=n(73)(i);e.exports=r},function(e,t){var n=Date.now;e.exports=function(e){var t=0,i=0;return function(){var r=n(),o=16-(r-i);if(i=r,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},function(e,t,n){var i=n(60),r=n(316),o=n(17);e.exports=function(e){return o(e)?i(e,!0):r(e)}},function(e,t,n){var i=n(318),r=n(319),o=n(320);e.exports=function(e,t,n){return t==t?o(e,t,n):i(e,r,n)}},function(e,t,n){var i=n(13),r=n(7),o=n(11);e.exports=function(e){return"string"==typeof e||!r(e)&&o(e)&&"[object String]"==i(e)}},function(e,t,n){var i=n(23),r=n(78),o=r?function(e,t){return r.set(e,t),e}:i;e.exports=o},function(e,t,n){var i=n(79),r=i&&new i;e.exports=r},function(e,t,n){var i=n(14)(n(6),"WeakMap");e.exports=i},function(e,t,n){var i=n(81),r=n(82),o=n(325),s=n(30),a=n(83),c=n(49),l=n(336),u=n(31),d=n(6);e.exports=function e(t,n,h,f,p,g,m,v,_,b){var y=128&n,w=1&n,S=2&n,x=24&n,E=512&n,A=S?void 0:s(t);return function j(){for(var C=arguments.length,k=Array(C),O=C;O--;)k[O]=arguments[O];if(x)var T=c(j),N=o(k,T);if(f&&(k=i(k,f,p,x)),g&&(k=r(k,g,m,x)),C-=N,x&&C<b){var M=u(k,T);return a(t,n,e,j.placeholder,h,k,M,v,_,b-C)}var I=w?h:this,R=S?I[t]:t;return C=k.length,v?k=l(k,v):E&&C>1&&k.reverse(),y&&_<C&&(k.length=_),this&&this!==d&&this instanceof j&&(R=A||s(R)),R.apply(I,k)}}},function(e,t){var n=Math.max;e.exports=function(e,t,i,r){for(var o=-1,s=e.length,a=i.length,c=-1,l=t.length,u=n(s-a,0),d=Array(l+u),h=!r;++c<l;)d[c]=t[c];for(;++o<a;)(h||o<s)&&(d[i[o]]=e[o]);for(;u--;)d[c++]=e[o++];return d}},function(e,t){var n=Math.max;e.exports=function(e,t,i,r){for(var o=-1,s=e.length,a=-1,c=i.length,l=-1,u=t.length,d=n(s-c,0),h=Array(d+u),f=!r;++o<d;)h[o]=e[o];for(var p=o;++l<u;)h[p+l]=t[l];for(;++a<c;)(f||o<s)&&(h[p+i[a]]=e[o++]);return h}},function(e,t,n){var i=n(326),r=n(87),o=n(88);e.exports=function(e,t,n,s,a,c,l,u,d,h){var f=8&t;t|=f?32:64,4&(t&=~(f?64:32))||(t&=-4);var p=[e,t,a,f?c:void 0,f?l:void 0,f?void 0:c,f?void 0:l,u,d,h],g=n.apply(void 0,p);return i(e)&&r(g,p),g.placeholder=s,o(g,e,t)}},function(e,t,n){var i=n(78),r=n(327),o=i?function(e){return i.get(e)}:r;e.exports=o},function(e,t,n){var i=n(46),r=n(48);function o(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}o.prototype=i(r.prototype),o.prototype.constructor=o,e.exports=o},function(e,t){e.exports=function(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t}},function(e,t,n){var i=n(77),r=n(73)(i);e.exports=r},function(e,t,n){var i=n(332),r=n(333),o=n(72),s=n(334);e.exports=function(e,t,n){var a=t+"";return o(e,r(a,s(i(a),n)))}},function(e,t,n){var i=n(32),r=n(347),o=n(348),s=n(349),a=n(350),c=n(351);function l(e){var t=this.__data__=new i(e);this.size=t.size}l.prototype.clear=r,l.prototype.delete=o,l.prototype.get=s,l.prototype.has=a,l.prototype.set=c,e.exports=l},function(e,t,n){var i=n(364),r=n(11);e.exports=function e(t,n,o,s,a){return t===n||(null==t||null==n||!r(t)&&!r(n)?t!=t&&n!=n:i(t,n,o,s,e,a))}},function(e,t,n){var i=n(365),r=n(368),o=n(369);e.exports=function(e,t,n,s,a,c){var l=1&n,u=e.length,d=t.length;if(u!=d&&!(l&&d>u))return!1;var h=c.get(e);if(h&&c.get(t))return h==t;var f=-1,p=!0,g=2&n?new i:void 0;for(c.set(e,t),c.set(t,e);++f<u;){var m=e[f],v=t[f];if(s)var _=l?s(v,m,f,t,e,c):s(m,v,f,e,t,c);if(void 0!==_){if(_)continue;p=!1;break}if(g){if(!r(t,(function(e,t){if(!o(g,t)&&(m===e||a(m,e,n,s,c)))return g.push(t)}))){p=!1;break}}else if(m!==v&&!a(m,v,n,s,c)){p=!1;break}}return c.delete(e),c.delete(t),p}},function(e,t,n){var i=n(93),r=n(7);e.exports=function(e,t,n){var o=t(e);return r(e)?o:i(o,n(e))}},function(e,t){e.exports=function(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}},function(e,t,n){var i=n(376),r=n(95),o=Object.prototype.propertyIsEnumerable,s=Object.getOwnPropertySymbols,a=s?function(e){return null==e?[]:(e=Object(e),i(s(e),(function(t){return o.call(e,t)})))}:r;e.exports=a},function(e,t){e.exports=function(){return[]}},function(e,t,n){var i=n(377),r=n(50),o=n(378),s=n(379),a=n(79),c=n(13),l=n(70),u=l(i),d=l(r),h=l(o),f=l(s),p=l(a),g=c;(i&&"[object DataView]"!=g(new i(new ArrayBuffer(1)))||r&&"[object Map]"!=g(new r)||o&&"[object Promise]"!=g(o.resolve())||s&&"[object Set]"!=g(new s)||a&&"[object WeakMap]"!=g(new a))&&(g=function(e){var t=c(e),n="[object Object]"==t?e.constructor:void 0,i=n?l(n):"";if(i)switch(i){case u:return"[object DataView]";case d:return"[object Map]";case h:return"[object Promise]";case f:return"[object Set]";case p:return"[object WeakMap]"}return t}),e.exports=g},function(e,t,n){var i=n(10);e.exports=function(e){return e==e&&!i(e)}},function(e,t){e.exports=function(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}}},function(e,t){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},function(e,t,n){(function(e,i){var r;/*! https://mths.be/punycode v1.4.0 by @mathias */!function(o){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof i&&i;s.global!==s&&s.window!==s&&s.self;var a,c=2147483647,l=/^xn--/,u=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,h={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,p=String.fromCharCode;function g(e){throw new RangeError(h[e])}function m(e,t){for(var n=e.length,i=[];n--;)i[n]=t(e[n]);return i}function v(e,t){var n=e.split("@"),i="";return n.length>1&&(i=n[0]+"@",e=n[1]),i+m((e=e.replace(d,".")).split("."),t).join(".")}function _(e){for(var t,n,i=[],r=0,o=e.length;r<o;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<o?56320==(64512&(n=e.charCodeAt(r++)))?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),r--):i.push(t);return i}function b(e){return m(e,(function(e){var t="";return e>65535&&(t+=p((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=p(e)})).join("")}function y(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function w(e,t,n){var i=0;for(e=n?f(e/700):e>>1,e+=f(e/t);e>455;i+=36)e=f(e/35);return f(i+36*e/(e+38))}function S(e){var t,n,i,r,o,s,a,l,u,d,h,p=[],m=e.length,v=0,_=128,y=72;for((n=e.lastIndexOf("-"))<0&&(n=0),i=0;i<n;++i)e.charCodeAt(i)>=128&&g("not-basic"),p.push(e.charCodeAt(i));for(r=n>0?n+1:0;r<m;){for(o=v,s=1,a=36;r>=m&&g("invalid-input"),((l=(h=e.charCodeAt(r++))-48<10?h-22:h-65<26?h-65:h-97<26?h-97:36)>=36||l>f((c-v)/s))&&g("overflow"),v+=l*s,!(l<(u=a<=y?1:a>=y+26?26:a-y));a+=36)s>f(c/(d=36-u))&&g("overflow"),s*=d;y=w(v-o,t=p.length+1,0==o),f(v/t)>c-_&&g("overflow"),_+=f(v/t),v%=t,p.splice(v++,0,_)}return b(p)}function x(e){var t,n,i,r,o,s,a,l,u,d,h,m,v,b,S,x=[];for(m=(e=_(e)).length,t=128,n=0,o=72,s=0;s<m;++s)(h=e[s])<128&&x.push(p(h));for(i=r=x.length,r&&x.push("-");i<m;){for(a=c,s=0;s<m;++s)(h=e[s])>=t&&h<a&&(a=h);for(a-t>f((c-n)/(v=i+1))&&g("overflow"),n+=(a-t)*v,t=a,s=0;s<m;++s)if((h=e[s])<t&&++n>c&&g("overflow"),h==t){for(l=n,u=36;!(l<(d=u<=o?1:u>=o+26?26:u-o));u+=36)S=l-d,b=36-d,x.push(p(y(d+S%b,0))),l=f(S/b);x.push(p(y(l,0))),o=w(n,v,i==r),n=0,++i}++n,++t}return x.join("")}a={version:"1.3.2",ucs2:{decode:_,encode:b},decode:S,encode:x,toASCII:function(e){return v(e,(function(e){return u.test(e)?"xn--"+x(e):e}))},toUnicode:function(e){return v(e,(function(e){return l.test(e)?S(e.slice(4).toLowerCase()):e}))}},void 0===(r=function(){return a}.call(t,n,t,e))||(e.exports=r)}()}).call(this,n(21)(e),n(9))},function(e,t,n){var i,r;
/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.2
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */!function(o,s){"use strict";e.exports?e.exports=s():void 0===(r="function"==typeof(i=s)?i.call(t,n,t,e):i)||(e.exports=r)}(0,(function(e){"use strict";var t=e&&e.IPv6;return{best:function(e){var t,n,i=e.toLowerCase().split(":"),r=i.length,o=8;for(""===i[0]&&""===i[1]&&""===i[2]?(i.shift(),i.shift()):""===i[0]&&""===i[1]?i.shift():""===i[r-1]&&""===i[r-2]&&i.pop(),-1!==i[(r=i.length)-1].indexOf(".")&&(o=7),t=0;t<r&&""!==i[t];t++);if(t<o)for(i.splice(t,1,"0000");i.length<o;)i.splice(t,0,"0000");for(var s=0;s<o;s++){n=i[s].split("");for(var a=0;a<3&&("0"===n[0]&&n.length>1);a++)n.splice(0,1);i[s]=n.join("")}var c=-1,l=0,u=0,d=-1,h=!1;for(s=0;s<o;s++)h?"0"===i[s]?u+=1:(h=!1,u>l&&(c=d,l=u)):"0"===i[s]&&(h=!0,d=s,u=1);u>l&&(c=d,l=u),l>1&&i.splice(c,l,""),r=i.length;var f="";for(""===i[0]&&(f=":"),s=0;s<r&&(f+=i[s],s!==r-1);s++)f+=":";return""===i[r-1]&&(f+=":"),f},noConflict:function(){return e.IPv6===this&&(e.IPv6=t),this}}}))},function(e,t,n){var i,r;
/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.2
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */!function(o,s){"use strict";e.exports?e.exports=s():void 0===(r="function"==typeof(i=s)?i.call(t,n,t,e):i)||(e.exports=r)}(0,(function(e){"use strict";var t=e&&e.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;var i=e.lastIndexOf(".",t-1);if(i<=0||i>=t-1)return!1;var r=n.list[e.slice(t+1)];return!!r&&r.indexOf(" "+e.slice(i+1,t)+" ")>=0},is:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;if(e.lastIndexOf(".",t-1)>=0)return!1;var i=n.list[e.slice(t+1)];return!!i&&i.indexOf(" "+e.slice(0,t)+" ")>=0},get:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return null;var i=e.lastIndexOf(".",t-1);if(i<=0||i>=t-1)return null;var r=n.list[e.slice(t+1)];return r?r.indexOf(" "+e.slice(i+1,t)+" ")<0?null:e.slice(i+1):null},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return n}))},function(e,t,n){e.exports=function(){"use strict";return function(e,t,n){var i=t.prototype,r=i.format;n.en.ordinal=function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"},i.format=function(e){var t=this,n=this.$locale(),i=this.$utils(),o=(e||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|gggg|Do|X|x|k{1,2}|S/g,(function(e){switch(e){case"Q":return Math.ceil((t.$M+1)/3);case"Do":return n.ordinal(t.$D);case"gggg":return t.weekYear();case"wo":return n.ordinal(t.week(),"W");case"k":case"kk":return i.s(String(0===t.$H?24:t.$H),"k"===e?1:2,"0");case"X":return Math.floor(t.$d.getTime()/1e3);case"x":return t.$d.getTime();default:return e}}));return r.bind(this)(o)}}}()},function(e,t,n){var i=n(286),r=n(42);e.exports=function(e,t,n){var o=null==e?0:e.length;return o?(t=n||void 0===t?1:r(t),i(e,t<0?0:t,o)):[]}},function(e,t,n){var i=n(13),r=n(11);e.exports=function(e){return!0===e||!1===e||r(e)&&"[object Boolean]"==i(e)}},function(e,t){e.exports=function(e){return null==e}},function(e,t,n){var i=n(45),r=n(339),o=n(393),s=n(395);e.exports=function(e,t){if(null==e)return{};var n=i(s(e),(function(e){return[e]}));return t=r(t),o(e,n,(function(e,n){return t(e,n[0])}))}},function(e,t,n){var i=n(64),r=n(96),o=n(17),s=n(76),a=n(398);e.exports=function(e){if(null==e)return 0;if(o(e))return s(e)?a(e):e.length;var t=r(e);return"[object Map]"==t||"[object Set]"==t?e.size:i(e).length}},function(e,t,n){"use strict";(function(t){!function(t){var n=/^(b|B)$/,i={iec:{bits:["b","Kib","Mib","Gib","Tib","Pib","Eib","Zib","Yib"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},r={iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]};function o(e){var t,o,s,a,c,l,u,d,h,f,p,g,m,v,_,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},y=[],w=0,S=void 0,x=void 0;if(isNaN(e))throw new TypeError("Invalid number");return o=!0===b.bits,p=!0===b.unix,t=b.base||2,f=void 0!==b.round?b.round:p?1:2,l=void 0!==b.locale?b.locale:"",u=b.localeOptions||{},g=void 0!==b.separator?b.separator:"",m=void 0!==b.spacer?b.spacer:p?"":" ",_=b.symbols||{},v=2===t&&b.standard||"jedec",h=b.output||"string",a=!0===b.fullform,c=b.fullforms instanceof Array?b.fullforms:[],S=void 0!==b.exponent?b.exponent:-1,s=2<t?1e3:1024,(d=(x=Number(e))<0)&&(x=-x),(-1===S||isNaN(S))&&(S=Math.floor(Math.log(x)/Math.log(s)))<0&&(S=0),8<S&&(S=8),"exponent"===h?S:(0===x?(y[0]=0,y[1]=p?"":i[v][o?"bits":"bytes"][S]):(w=x/(2===t?Math.pow(2,10*S):Math.pow(1e3,S)),o&&s<=(w*=8)&&S<8&&(w/=s,S++),y[0]=Number(w.toFixed(0<S?f:0)),y[0]===s&&S<8&&void 0===b.exponent&&(y[0]=1,S++),y[1]=10===t&&1===S?o?"kb":"kB":i[v][o?"bits":"bytes"][S],p&&(y[1]="jedec"===v?y[1].charAt(0):0<S?y[1].replace(/B$/,""):y[1],n.test(y[1])&&(y[0]=Math.floor(y[0]),y[1]=""))),d&&(y[0]=-y[0]),y[1]=_[y[1]]||y[1],!0===l?y[0]=y[0].toLocaleString():0<l.length?y[0]=y[0].toLocaleString(l,u):0<g.length&&(y[0]=y[0].toString().replace(".",g)),"array"===h?y:(a&&(y[1]=c[S]?c[S]:r[v][S]+(o?"bit":"byte")+(1===y[0]?"":"s")),"object"===h?{value:y[0],symbol:y[1],exponent:S}:y.join(m)))}o.partial=function(e){return function(t){return o(t,e)}},e.exports=o}("undefined"!=typeof window&&window)}).call(this,n(9))},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/headless/templates/field.html --\x3e\n<field var="'+n(e.name)+'">\n',e.value.constructor===Array?(t+="\n    ",e.value.forEach((function(e){t+="<value>"+n(e)+"</value>"})),t+="\n"):t+="\n    <value>"+n(e.value)+"</value>\n",t+="</field>\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;return t+='\x3c!-- src/headless/templates/vcard.html --\x3e\n<vCard xmlns="vcard-temp">\n    <FN>'+n(e.fn)+"</FN>\n    <NICKNAME>"+n(e.nickname)+"</NICKNAME>\n    <URL>"+n(e.url)+"</URL>\n    <ROLE>"+n(e.role)+"</ROLE>\n    <EMAIL><INTERNET/><PREF/><USERID>"+n(e.email)+"</USERID></EMAIL>\n    <PHOTO>\n      <TYPE>"+n(e.image_type)+"</TYPE>\n      <BINVAL>"+n(e.image)+"</BINVAL>\n    </PHOTO>\n</vCard>\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;return t+='\x3c!-- src/templates/avatar.svg --\x3e\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="'+n(e.classes)+'" width="'+n(e.width)+'" height="'+n(e.height)+'">\n    <image width="'+n(e.width)+'" height="'+n(e.height)+'" preserveAspectRatio="xMidYMid meet" xlink:href="'+n(e.image)+'"/>\n</svg>\n'}},function(e,t,n){n(3);e.exports=function(e){return'\x3c!-- src/templates/background_logo.html --\x3e\n<div class="inner-content converse-brand row">\n    <div class="converse-brand__padding"></div>\n    <div class="converse-brand__heading">\n        <svg height="200px"\n            xmlns="http://www.w3.org/2000/svg"\n            xmlns:xlink="http://www.w3.org/1999/xlink"\n            viewBox="0 0 364 364"\n            version="1.1">\n            <title>Logo Converse</title>\n            <defs>\n                <linearGradient id="gradient" x1="92.14" y1="27.64" x2="267.65" y2="331.62" gradientUnits="userSpaceOnUse">\n                    <stop offset="0" stop-color="#fff1d1"/>\n                    <stop offset="0.05" stop-color="#fae8c1"/>\n                    <stop offset="0.15" stop-color="#f0d5a1"/>\n                    <stop offset="0.27" stop-color="#e7c687"/>\n                    <stop offset="0.4" stop-color="#e1bb72"/>\n                    <stop offset="0.54" stop-color="#dcb264"/>\n                    <stop offset="0.71" stop-color="#daad5c"/>\n                    <stop offset="1" stop-color="#d9ac59"/>\n                </linearGradient>\n                <filter id="shadow">\n                    <feGaussianBlur in="SourceAlpha" stdDeviation="2.3" result="blur1"/>\n                    <feOffset in="blur1" dx="3" dy="3" result="blur2"/>\n                    <feColorMatrix in="blur2" type="matrix" result="blur3"\n                        values="1 0 0 0 0.1\n                                0 1 0 0 0.1\n                                0 0 1 0 0.1\n                                0 0 0 1 0"/>\n                    <feMerge>\n                        <feMergeNode in="blur3"/>\n                        <feMergeNode in="SourceGraphic"/>\n                    </feMerge>\n                </filter>\n            </defs>\n            <g filter="url(#shadow)">\n                <path d="M221.46,103.71c0,18.83-29.36,18.83-29.12,0C192.1,84.88,221.46,84.88,221.46,103.71Z" fill="#d9ac59"/>\n                <path d="M179.9,4.15A175.48,175.48,0,1,0,355.38,179.63,175.48,175.48,0,0,0,179.9,4.15Zm-40.79,264.5c-.23-17.82,27.58-17.82,27.58,0S138.88,286.48,139.11,268.65ZM218.6,168.24A79.65,79.65,0,0,1,205.15,174a12.76,12.76,0,0,0-6.29,4.65L167.54,222a1.36,1.36,0,0,1-2.46-.8v-35.8a2.58,2.58,0,0,0-3.06-2.53c-15.43,3-30.23,7.7-42.73,19.94-38.8,38-29.42,105.69,16.09,133.16a162.25,162.25,0,0,1-91.47-67.27C-3.86,182.26,34.5,47.25,138.37,25.66c46.89-9.75,118.25,5.16,123.73,62.83C265.15,120.64,246.56,152.89,218.6,168.24Z" fill="url(#gradient)"/>\n            </g>\n        </svg>\n        <span class="converse-brand__text">\n            <span>converse<span class="subdued">.js</span></span>\n            <p class="byline">messaging freedom</p>\n        </span>\n    </div>\n</div>\n','\x3c!-- src/templates/background_logo.html --\x3e\n<div class="inner-content converse-brand row">\n    <div class="converse-brand__padding"></div>\n    <div class="converse-brand__heading">\n        <svg height="200px"\n            xmlns="http://www.w3.org/2000/svg"\n            xmlns:xlink="http://www.w3.org/1999/xlink"\n            viewBox="0 0 364 364"\n            version="1.1">\n            <title>Logo Converse</title>\n            <defs>\n                <linearGradient id="gradient" x1="92.14" y1="27.64" x2="267.65" y2="331.62" gradientUnits="userSpaceOnUse">\n                    <stop offset="0" stop-color="#fff1d1"/>\n                    <stop offset="0.05" stop-color="#fae8c1"/>\n                    <stop offset="0.15" stop-color="#f0d5a1"/>\n                    <stop offset="0.27" stop-color="#e7c687"/>\n                    <stop offset="0.4" stop-color="#e1bb72"/>\n                    <stop offset="0.54" stop-color="#dcb264"/>\n                    <stop offset="0.71" stop-color="#daad5c"/>\n                    <stop offset="1" stop-color="#d9ac59"/>\n                </linearGradient>\n                <filter id="shadow">\n                    <feGaussianBlur in="SourceAlpha" stdDeviation="2.3" result="blur1"/>\n                    <feOffset in="blur1" dx="3" dy="3" result="blur2"/>\n                    <feColorMatrix in="blur2" type="matrix" result="blur3"\n                        values="1 0 0 0 0.1\n                                0 1 0 0 0.1\n                                0 0 1 0 0.1\n                                0 0 0 1 0"/>\n                    <feMerge>\n                        <feMergeNode in="blur3"/>\n                        <feMergeNode in="SourceGraphic"/>\n                    </feMerge>\n                </filter>\n            </defs>\n            <g filter="url(#shadow)">\n                <path d="M221.46,103.71c0,18.83-29.36,18.83-29.12,0C192.1,84.88,221.46,84.88,221.46,103.71Z" fill="#d9ac59"/>\n                <path d="M179.9,4.15A175.48,175.48,0,1,0,355.38,179.63,175.48,175.48,0,0,0,179.9,4.15Zm-40.79,264.5c-.23-17.82,27.58-17.82,27.58,0S138.88,286.48,139.11,268.65ZM218.6,168.24A79.65,79.65,0,0,1,205.15,174a12.76,12.76,0,0,0-6.29,4.65L167.54,222a1.36,1.36,0,0,1-2.46-.8v-35.8a2.58,2.58,0,0,0-3.06-2.53c-15.43,3-30.23,7.7-42.73,19.94-38.8,38-29.42,105.69,16.09,133.16a162.25,162.25,0,0,1-91.47-67.27C-3.86,182.26,34.5,47.25,138.37,25.66c46.89-9.75,118.25,5.16,123.73,62.83C265.15,120.64,246.56,152.89,218.6,168.24Z" fill="url(#gradient)"/>\n            </g>\n        </svg>\n        <span class="converse-brand__text">\n            <span>converse<span class="subdued">.js</span></span>\n            <p class="byline">messaging freedom</p>\n        </span>\n    </div>\n</div>\n'}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+="\x3c!-- src/templates/form_captcha.html --\x3e\n",e.label&&(t+="\n<label>\n    "+n(e.label)+"\n</label>\n"),t+='\n<img src="data:'+n(e.type)+";base64,"+n(e.data)+'">\n<input name="'+n(e.name)+'" type="text" ',e.required&&(t+=' required="required" '),t+=" />\n\n\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/form_checkbox.html --\x3e\n<div class="form-group">\n    <input id="'+n(e.id)+'" name="'+n(e.name)+'" type="checkbox" '+n(e.checked)+" ",e.required&&(t+=" required "),t+=' />\n    <label class="form-check-label" for="'+n(e.id)+'">'+n(e.label)+"</label>\n</div>\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t,n="",r=i.escape;Array.prototype.join;return n+='\x3c!-- src/templates/form_select.html --\x3e\n<div class="form-group">\n    <label for="'+r(e.id)+'">'+r(e.label)+'</label>\n    <select class="form-control" id="'+r(e.id)+'" name="'+r(e.name)+'" ',e.multiple&&(n+=' multiple="multiple" '),n+=">"+(null==(t=e.options)?"":t)+"</select>\n</div>\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;return t+='\x3c!-- src/templates/form_textarea.html --\x3e\n<label class="label-ta">'+n(e.label)+'</label>\n<textarea name="'+n(e.name)+'">'+n(e.value)+"</textarea>\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;return t+="\x3c!-- src/templates/form_url.html --\x3e\n<label>\n    "+n(e.label)+'\n    <a class="form-url" target="_blank" rel="noopener" href="'+n(e.value)+'">'+n(e.value)+"</a>\n</label>\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/select_option.html --\x3e\n<option value="'+n(e.value)+'" ',e.selected&&(t+=' selected="selected" '),t+=" >"+n(e.label)+"</option>\n"}},function(e,t,n){"use strict";(function(t){!function(t){var n=/^(b|B)$/,i={iec:{bits:["b","Kib","Mib","Gib","Tib","Pib","Eib","Zib","Yib"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},r={iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]};function o(e){var t,o,s,a,c,l,u,d,h,f,p,g,m,v,_,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},y=[],w=0,S=void 0,x=void 0;if(isNaN(e))throw new TypeError("Invalid number");return o=!0===b.bits,p=!0===b.unix,t=b.base||2,f=void 0!==b.round?b.round:p?1:2,l=void 0!==b.locale?b.locale:"",u=b.localeOptions||{},g=void 0!==b.separator?b.separator:"",m=void 0!==b.spacer?b.spacer:p?"":" ",_=b.symbols||{},v=2===t&&b.standard||"jedec",h=b.output||"string",a=!0===b.fullform,c=b.fullforms instanceof Array?b.fullforms:[],S=void 0!==b.exponent?b.exponent:-1,s=2<t?1e3:1024,(d=(x=Number(e))<0)&&(x=-x),(-1===S||isNaN(S))&&(S=Math.floor(Math.log(x)/Math.log(s)))<0&&(S=0),8<S&&(S=8),"exponent"===h?S:(0===x?(y[0]=0,y[1]=p?"":i[v][o?"bits":"bytes"][S]):(w=x/(2===t?Math.pow(2,10*S):Math.pow(1e3,S)),o&&s<=(w*=8)&&S<8&&(w/=s,S++),y[0]=Number(w.toFixed(0<S?f:0)),y[0]===s&&S<8&&void 0===b.exponent&&(y[0]=1,S++),y[1]=10===t&&1===S?o?"kb":"kB":i[v][o?"bits":"bytes"][S],p&&(y[1]="jedec"===v?y[1].charAt(0):0<S?y[1].replace(/B$/,""):y[1],n.test(y[1])&&(y[0]=Math.floor(y[0]),y[1]=""))),d&&(y[0]=-y[0]),y[1]=_[y[1]]||y[1],!0===l?y[0]=y[0].toLocaleString():0<l.length?y[0]=y[0].toLocaleString(l,u):0<g.length&&(y[0]=y[0].toString().replace(".",g)),"array"===h?y:(a&&(y[1]=c[S]?c[S]:r[v][S]+(o?"bit":"byte")+(1===y[0]?"":"s")),"object"===h?{value:y[0],symbol:y[1],exponent:S}:y.join(m)))}o.partial=function(e){return function(t){return o(t,e)}},e.exports=o}("undefined"!=typeof window&&window)}).call(this,n(9))},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;return t+='\x3c!-- src/templates/file_progress.html --\x3e\n<div class="message chat-msg" data-isodate="'+n(e.time)+'" data-msgid="'+n(e.msgid)+'">\n    <canvas class="avatar chat-msg__avatar" height="36" width="36"></canvas>\n    <div class="chat-msg__content">\n        <span class="chat-msg__text">'+n(e.__("Uploading file:"))+" <strong>"+n(e.filename)+"</strong>, "+n(e.filesize)+'</span>\n        <progress value="'+n(e.progress)+'"/>\n    </div>\n</div>\n'}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/message.html --\x3e\n<div class="message chat-msg '+n(e.type)+" "+n(e.extra_classes)+" ",e.is_me_message&&(t+=" chat-msg--action "),t+='"\n        data-isodate="'+n(e.time)+'" data-msgid="'+n(e.msgid)+'" data-from="'+n(e.from)+'" data-encrypted="'+n(e.is_encrypted)+'">\n    ',"headline"===e.type||e.is_me_message||(t+='\n    <canvas class="avatar chat-msg__avatar" height="36" width="36"></canvas>\n    '),t+='\n    <div class="chat-msg__content chat-msg__content--'+n(e.sender)+" "+n(e.is_me_message?"chat-msg__content--action":"")+'">\n        ',e.first_unread&&(t+='\n            <div class="message date-separator"><hr class="separator"><span class="separator-text">'+n(e.__("unread messages"))+"</span></div>\n        "),t+='\n        <span class="chat-msg__heading">',e.is_me_message&&(t+='\n            <time timestamp="'+n(e.isodate)+'" class="chat-msg__time">'+n(e.pretty_time)+"</time>\n            "),t+='<span class="chat-msg__author">',e.is_me_message&&(t+="**"),t+=n(e.username)+"</span>\n            ",e.is_me_message||(e.hats.forEach((function(e){t+='<span class="badge badge-secondary">'+n(e.title)+"</span>\n            "})),t+='<time timestamp="'+n(e.isodate)+'" class="chat-msg__time">'+n(e.pretty_time)+"</time>"),e.is_encrypted&&(t+='\n            <span class="fa fa-lock"></span>\n        '),t+='</span>\n        <div class="chat-msg__body chat-msg__body--'+n(e.type)+" "+n(e.received?"chat-msg__body--received":"")+" "+n(e.is_delayed?"chat-msg__body--delayed":"")+'">\n            <div class="chat-msg__message">\n                ',e.is_retracted?(t+="\n                    <div>"+n(e.retraction_text)+"</div>\n                    ",e.moderation_reason&&(t+='<q class="chat-msg--retracted__reason">'+n(e.moderation_reason)+"</q>"),t+="\n                "):(t+="\n                    ",e.is_spoiler&&(t+='\n                        <div class="chat-msg__spoiler-hint">\n                            <span class="spoiler-hint">'+n(e.spoiler_hint)+'</span>\n                            <a class="badge badge-info spoiler-toggle" data-toggle-state="closed" href="#"><i class="fa fa-eye"></i>'+n(e.label_show)+"</a>\n                        </div>\n                    "),t+="\n\n                    ",e.subject&&(t+='\n                        <div class="chat-msg__subject">'+n(e.subject)+"</div>\n                    "),t+='\n                    <div class="chat-msg__text\n                        ',e.is_only_emojis&&(t+=" chat-msg__text--larger"),t+="\n                        ",e.is_spoiler&&(t+=" spoiler collapsed"),t+='">\x3c!-- message gets added here via renderMessage --\x3e</div>\n                    <div class="chat-msg__media"></div>\n                    <div class="chat-msg__error">'+n(e.error)+"</div>\n                "),t+="\n            </div>\n            ",!e.received||e.is_me_message||e.is_groupchat_message||(t+=' <span class="fa fa-check chat-msg__receipt"></span> '),t+="\n            ",e.edited&&(t+=' <i title="'+n(e.__("This message has been edited"))+'" class="fa fa-edit chat-msg__edit-modal"></i> '),t+='\n            <div class="chat-msg__actions">\n                ',e.editable&&(t+='\n                    <button class="chat-msg__action chat-msg__action-edit fa fa-pencil-alt" title="'+n(e.__("Edit this message"))+'"></button>\n                '),t+="\n                ",e.retractable&&(t+='\n                    <button class="chat-msg__action chat-msg__action-retract fa fa-trash-alt" title="'+n(e.__("Retract this message"))+'"></button>\n                '),t+="\n            </div>\n        </div>\n    </div>\n</div>\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t,n="",r=i.escape;Array.prototype.join;return n+='\x3c!-- src/templates/chatbox_message_form.html --\x3e\n<div class="new-msgs-indicator hidden">▼ '+r(e.unread_msgs)+' ▼</div>\n<form class="setNicknameButtonForm hidden">\n    <input type="submit" class="btn btn-primary" name="join" value="Join"/>\n</form>\n<form class="sendXMPPMessage">\n    ',(e.show_toolbar||e.show_send_button)&&(n+='\n    <div class="chat-toolbar--container">\n    ',e.show_toolbar&&(n+='\n        <ul class="chat-toolbar no-text-select"></ul>\n    '),n+="\n    ",e.show_send_button&&(n+='\n        <button type="submit" class="btn send-button fa fa-paper-plane" title="'+r(e.__("Send the message"))+'"></button>\n    '),n+="\n    </div>\n    "),n+='\n    <input type="text" placeholder="'+(null==(t=e.label_spoiler_hint)?"":t)+'" value="'+(null==(t=e.hint_value)?"":t)+'"\n           class="',e.composing_spoiler||(n+=" hidden "),n+=' spoiler-hint"/>\n\n    <div class="suggestion-box">\n        <ul class="suggestion-box__results suggestion-box__results--above" hidden=""></ul>\n        <textarea\n            type="text"\n            class="chat-textarea suggestion-box__input\n                ',e.show_send_button&&(n+=" chat-textarea-send-button "),n+="\n                ",e.composing_spoiler&&(n+=" spoiler "),n+='"\n            placeholder="'+r(e.label_message)+'">'+(null==(t=e.message_value)?"":t)+'</textarea>\n        <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span>\n    </div>\n</form>\n'}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t,n="",r=i.escape;Array.prototype.join;return n+='\x3c!-- src/templates/help_message.html --\x3e\n<div class="message chat-info ',"info"!==e.type&&(n+=" chat-"+r(e.type)+" "),n+='" data-isodate="'+r(e.isodate)+'">'+(null==(t=e.message)?"":t)+"</div>\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;return t+='\x3c!-- src/templates/new_day.html --\x3e\n<div class="message date-separator" data-isodate="'+n(e.isodate)+'">\n    <hr class="separator"/>\n    <time class="separator-text" datetime="'+n(e.isodate)+'"><span>'+n(e.datestring)+"</span></time>\n</div>\n"}},function(e,t,n){n(3);e.exports=function(e){var t,n="";Array.prototype.join;return n+='\x3c!-- src/templates/spoiler_button.html --\x3e\n<li class="toggle-compose-spoiler fa ',e.composing_spoiler&&(n+=" fa-eye-slash "),n+=" ",e.composing_spoiler||(n+=" fa-eye "),n+='"\n    title="'+(null==(t=e.label_toggle_spoiler)?"":t)+'">\n</li>\n'}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+="\x3c!-- src/templates/toolbar.html --\x3e\n",e.show_call_button&&(t+='\n<li class="toggle-call fa fa-phone" title="'+n(e.label_start_call)+'"></li>\n'),t+="\n",e.show_occupants_toggle&&(t+='\n<li class="toggle-occupants float-right fa ',e.hidden_occupants?t+=" fa-angle-double-left ":t+=" fa-angle-double-right ",t+='"\n    title="'+n(e.label_hide_occupants)+'"></li>\n'),t+="\n",e.message_limit&&(t+='\n<li class="message-limit font-weight-bold float-right" title="'+n(e.label_message_limit)+'">'+n(e.message_limit)+"</li>\n"),t+="\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="";return t+='\x3c!-- src/templates/toolbar_fileupload.html --\x3e\n<li class="upload-file">\n    <a class="fa fa-paperclip" title="'+(0,i.escape)(e.tooltip_upload_file)+'"></a>\n    <input type="file" accept="image/*" class="fileupload" multiple="" style="display:none"/>\n</li> \n'}},function(e,t,n){n(3);e.exports=function(e){return'\x3c!-- src/templates/converse_brand_heading.html --\x3e\n<span class="brand-heading-container">\n    <a class="brand-heading" href="https://conversejs.org" target="_blank" rel="noopener">\n        <svg class="converse-svg-logo"\n            xmlns:svg="http://www.w3.org/2000/svg"\n            xmlns="http://www.w3.org/2000/svg"\n            xmlns:xlink="http://www.w3.org/1999/xlink"\n            viewBox="0 0 364 364">\n            <title>Converse</title>\n            <g class="cls-1" id="g904">\n                <g data-name="Layer 2">\n                    <g data-name="Layer 7">\n                        <path\n                            class="cls-3"\n                            d="M221.46,103.71c0,18.83-29.36,18.83-29.12,0C192.1,84.88,221.46,84.88,221.46,103.71Z" />\n                        <path\n                            class="cls-4"\n                            d="M179.9,4.15A175.48,175.48,0,1,0,355.38,179.63,175.48,175.48,0,0,0,179.9,4.15Zm-40.79,264.5c-.23-17.82,27.58-17.82,27.58,0S138.88,286.48,139.11,268.65ZM218.6,168.24A79.65,79.65,0,0,1,205.15,174a12.76,12.76,0,0,0-6.29,4.65L167.54,222a1.36,1.36,0,0,1-2.46-.8v-35.8a2.58,2.58,0,0,0-3.06-2.53c-15.43,3-30.23,7.7-42.73,19.94-38.8,38-29.42,105.69,16.09,133.16a162.25,162.25,0,0,1-91.47-67.27C-3.86,182.26,34.5,47.25,138.37,25.66c46.89-9.75,118.25,5.16,123.73,62.83C265.15,120.64,246.56,152.89,218.6,168.24Z" />\n                    </g>\n                </g>\n            </g>\n        </svg>\n        <span class="brand-name">\n            <span class="brand-name__text">converse<span class="subdued">.js</span></span>\n        </span>\n    </a>\n</span>\n','\x3c!-- src/templates/converse_brand_heading.html --\x3e\n<span class="brand-heading-container">\n    <a class="brand-heading" href="https://conversejs.org" target="_blank" rel="noopener">\n        <svg class="converse-svg-logo"\n            xmlns:svg="http://www.w3.org/2000/svg"\n            xmlns="http://www.w3.org/2000/svg"\n            xmlns:xlink="http://www.w3.org/1999/xlink"\n            viewBox="0 0 364 364">\n            <title>Converse</title>\n            <g class="cls-1" id="g904">\n                <g data-name="Layer 2">\n                    <g data-name="Layer 7">\n                        <path\n                            class="cls-3"\n                            d="M221.46,103.71c0,18.83-29.36,18.83-29.12,0C192.1,84.88,221.46,84.88,221.46,103.71Z" />\n                        <path\n                            class="cls-4"\n                            d="M179.9,4.15A175.48,175.48,0,1,0,355.38,179.63,175.48,175.48,0,0,0,179.9,4.15Zm-40.79,264.5c-.23-17.82,27.58-17.82,27.58,0S138.88,286.48,139.11,268.65ZM218.6,168.24A79.65,79.65,0,0,1,205.15,174a12.76,12.76,0,0,0-6.29,4.65L167.54,222a1.36,1.36,0,0,1-2.46-.8v-35.8a2.58,2.58,0,0,0-3.06-2.53c-15.43,3-30.23,7.7-42.73,19.94-38.8,38-29.42,105.69,16.09,133.16a162.25,162.25,0,0,1-91.47-67.27C-3.86,182.26,34.5,47.25,138.37,25.66c46.89-9.75,118.25,5.16,123.73,62.83C265.15,120.64,246.56,152.89,218.6,168.24Z" />\n                    </g>\n                </g>\n            </g>\n        </svg>\n        <span class="brand-name">\n            <span class="brand-name__text">converse<span class="subdued">.js</span></span>\n        </span>\n    </a>\n</span>\n'}},function(e,t,n){n(3);e.exports=function(e){var t="";Array.prototype.join;return t+='\x3c!-- src/templates/controlbox.html --\x3e\n<div class="flyout box-flyout">\n    <div class="chat-head controlbox-head">\n        ',e.sticky_controlbox||(t+='\n            <a class="chatbox-btn close-chatbox-button fa fa-times"></a>\n        '),t+='\n    </div>\n    <div class="controlbox-panes"></div>\n</div>\n'}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="";return t+='\x3c!-- src/templates/controlbox_toggle.html --\x3e\n<span class="toggle-feedback">'+(0,i.escape)(e.label_toggle)+"</span>\n"}},function(e,t,n){n(3);e.exports=function(e){return'\x3c!-- src/templates/dragresize.html --\x3e\n<div class="dragresize dragresize-top"></div>\n<div class="dragresize dragresize-topleft"></div>\n<div class="dragresize dragresize-left"></div>\n','\x3c!-- src/templates/dragresize.html --\x3e\n<div class="dragresize dragresize-top"></div>\n<div class="dragresize dragresize-topleft"></div>\n<div class="dragresize dragresize-left"></div>\n'}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="";return t+='\x3c!-- src/templates/emoji_button.html --\x3e\n<li class="toggle-toolbar-menu toggle-smiley__container">\n    <a class="toggle-smiley far fa-smile"\n       title="'+(0,i.escape)(e.tooltip_insert_smiley)+'"\n       data-toggle="dropdown"\n       aria-haspopup="true"\n       aria-expanded="false"></a>\n</li>\n'}},function(e,t,n){n(3);e.exports=function(e){return'\x3c!-- src/templates/inverse_brand_heading.html --\x3e\n<div>\n    <div class="container brand-heading-container">\n        \n    </div>\n</div>\n','\x3c!-- src/templates/inverse_brand_heading.html --\x3e\n<div>\n    <div class="container brand-heading-container">\n        \n    </div>\n</div>\n'}},function(e,t,n){n(3);e.exports=function(e){return'\x3c!-- src/templates/chats_panel.html --\x3e\n<a id="toggle-minimized-chats" href="#" class="row no-gutters"></a>\n<div class="flyout minimized-chats-flyout row no-gutters"></div>\n','\x3c!-- src/templates/chats_panel.html --\x3e\n<a id="toggle-minimized-chats" href="#" class="row no-gutters"></a>\n<div class="flyout minimized-chats-flyout row no-gutters"></div>\n'}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+="\x3c!-- src/templates/toggle_chats.html --\x3e\n"+n(e.num_minimized)+" "+n(e.Minimized)+'\n<span class="unread-message-count ',e.num_unread||(t+=" unread-message-count-hidden "),t+='" href="#">'+n(e.num_unread)+"</span>\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/trimmed_chat.html --\x3e\n<div class="chat-head-'+n(e.type)+' chat-head row no-gutters">\n    <a class="restore-chat w-100 align-self-center" title="'+n(e.tooltip)+'">\n        ',e.num_unread&&(t+='\n            <span class="message-count badge badge-light">'+n(e.num_unread)+"</span>\n        "),t+="\n        "+n(e.title)+'\n    </a>\n    <a class="chatbox-btn close-chatbox-button fa fa-times"></a>\n</div>\n'}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+="\x3c!-- src/templates/chatroom_bottom_panel.html --\x3e\n",e.entered?(t+="\n    ",e.can_edit?t+='\n        <div class="emoji-picker__container dropup"></div>\n        <div class="message-form-container">\n    ':t+='\n        <div class="muc-bottom-panel">'+n(e.__("You're not allowed to send messages in this room"))+"</div>\n    ",t+="\n"):t+='\n    <div class="muc-bottom-panel"></div>\n',t+="\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/chatroom_destroyed.html --\x3e\n<div class="alert alert-danger">\n    <h3 class="alert-heading disconnect-msg">'+n(e.__("This groupchat no longer exists"))+'</h3>\n    <p class="destroyed-reason">'+n(e.reason)+"</p>\n    ",e.jid&&(t+='\n        <p class="moved-label">'+n(e.__("The conversation has moved. Click below to enter."))+'</p>\n        <p class="moved-link"><a class="switch-chat" href="#">'+n(e.jid)+"</a></p>\n    "),t+="\n</div>\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/chatroom_disconnect.html --\x3e\n<div class="alert alert-danger">\n    <h3 class="alert-heading disconnect-msg">'+n(e.messages[0])+"</h3>\n    ",e.messages.slice(1).forEach((function(e){t+='\n        <p class="disconnect-msg">'+n(e)+"</p>\n    "})),t+="\n</div>\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t,n="",r=i.escape;return n+='\x3c!-- src/templates/chatroom_nickname_form.html --\x3e\n<div class="chatroom-form-container muc-nickname-form">\n    <form class="converse-form chatroom-form converse-centered-form">\n        <fieldset class="form-group">\n            <label>'+r(e.heading)+'</label>\n            <input type="text" required="required" name="nick" value="'+r(e.nickname)+'"\n                   class="form-control '+(null==(t=e.error_class)?"":t)+'" placeholder="'+r(e.label_nickname)+'"/>\n        </fieldset>\n        <fieldset class="form-group">\n            <input type="submit" class="btn btn-primary" name="join" value="'+r(e.label_join)+'"/>\n        </fieldset>\n    </form>\n</div>\n'}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/room_description.html --\x3e\n\x3c!-- FIXME: check markup in mockup --\x3e\n<div class="room-info">\n<p class="room-info"><strong>'+n(e.label_jid)+"</strong> "+n(e.jid)+'</p>\n<p class="room-info"><strong>'+n(e.label_desc)+"</strong> "+n(e.desc)+'</p>\n<p class="room-info"><strong>'+n(e.label_occ)+"</strong> "+n(e.occ)+'</p>\n<p class="room-info"><strong>'+n(e.label_features)+"</strong>\n    <ul>\n        ",e.passwordprotected&&(t+='\n        <li class="room-info locked">'+n(e.label_requires_auth)+"</li>\n        "),t+="\n        ",e.hidden&&(t+='\n        <li class="room-info">'+n(e.label_hidden)+"</li>\n        "),t+="\n        ",e.membersonly&&(t+='\n        <li class="room-info">'+n(e.label_requires_invite)+"</li>\n        "),t+="\n        ",e.moderated&&(t+='\n        <li class="room-info">'+n(e.label_moderated)+"</li>\n        "),t+="\n        ",e.nonanonymous&&(t+='\n        <li class="room-info">'+n(e.label_non_anon)+"</li>\n        "),t+="\n        ",e.open&&(t+='\n        <li class="room-info">'+n(e.label_open_room)+"</li>\n        "),t+="\n        ",e.persistent&&(t+='\n        <li class="room-info">'+n(e.label_permanent_room)+"</li>\n        "),t+="\n        ",e.publicroom&&(t+='\n        <li class="room-info">'+n(e.label_public)+"</li>\n        "),t+="\n        ",e.semianonymous&&(t+='\n        <li class="room-info">'+n(e.label_semi_anon)+"</li>\n        "),t+="\n        ",e.temporary&&(t+='\n        <li class="room-info">'+n(e.label_temp_room)+"</li>\n        "),t+="\n        ",e.unmoderated&&(t+='\n        <li class="room-info">'+n(e.label_unmoderated)+"</li>\n        "),t+="\n    </ul>\n</p>\n</div>\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;return t+='\x3c!-- src/templates/room_panel.html --\x3e\n\x3c!-- <div id="chatrooms"> --\x3e\n<div class="d-flex controlbox-padded">\n    <span class="w-100 controlbox-heading controlbox-heading--groupchats">'+n(e.heading_chatrooms)+'</span>\n    <a class="controlbox-heading__btn show-list-muc-modal fa fa-list-ul" title="'+n(e.title_list_rooms)+'" data-toggle="modal" data-target="#list-chatrooms-modal"></a>\n    <a class="controlbox-heading__btn show-add-muc-modal fa fa-plus" title="'+n(e.title_new_room)+'" data-toggle="modal" data-target="#add-chatrooms-modal"></a>\n</div>\n<div class="list-container list-container--openrooms hidden"></div>\n<div class="list-container list-container--bookmarks hidden"></div>\n\x3c!-- </div> --\x3e\n'}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/toolbar_omemo.html --\x3e\n<li class="toggle-omemo fa \n        ',e.omemo_supported||(t+=" disabled "),t+="\n        ",e.omemo_active?t+=" fa-lock ":t+=" fa-unlock ",t+='"\n    title="'+n(e.__("Messages are being sent in plaintext"))+'"></li>\n'}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/register_panel.html --\x3e\n<div>\n    <form id="converse-register" class="converse-form">\n        <legend class="col-form-label">'+n(e.__("Create your account"))+'</legend>\n\n        <div class="form-group">\n            <label>'+n(e.__("Please enter the XMPP provider to register with:"))+'</label>\n            <div class="form-errors hidden"></div>\n\n            ',e.default_domain?t+="\n                "+n(e.default_domain)+"\n            </div>\n            ":t+='\n                <input class="form-control" required="required" type="text" name="domain" placeholder="'+n(e.domain_placeholder)+'"/>\n                <p class="form-text text-muted">'+n(e.help_providers)+' <a href="'+n(e.href_providers)+'" class="url" target="_blank" rel="noopener">'+n(e.help_providers_link)+'</a>.</p>\n            </div>\n            <fieldset class="buttons">\n                <input class="btn btn-primary" type="submit" value="'+n(e.label_register)+'"/>\n                <div class="switch-form">\n                    <p>'+n(e.__("Already have a chat account?"))+'</p>\n                    <p><a class="login-here toggle-register-login" href="#converse/login">'+n(e.__("Log in here"))+"</a></p>\n                </div>\n            </fieldset>\n            ",t+="\n        \x3c!--</div>--\x3e\n    </form>\n</div>\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/registration_form.html --\x3e\n<legend class="col-form-label">'+n(e.__("Account Registration:"))+" "+n(e.domain)+'</legend>\n<p class="title">'+n(e.title)+'</p>\n<p class="form-help instructions">'+n(e.instructions)+'</p>\n<div class="form-errors hidden"></div>\n\n<fieldset class="buttons">\n    <input type="submit" class="btn btn-primary" value="'+n(e.__("Register"))+'"/>\n    ',e.registration_domain||(t+='\n        <input type="button" class="btn btn-secondary button-cancel" value="'+n(e.__("Choose a different provider"))+'"/>\n    '),t+='\n    <div class="switch-form">\n        <p>'+n(e.__("Already have a chat account?"))+'</p>\n        <p><a class="login-here toggle-register-login" href="#converse/login">'+n(e.__("Log in here"))+"</a></p>\n    </div>\n</fieldset>\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/registration_request.html --\x3e\n<span class="spinner login-submit fa fa-spinner"></span>\n<p class="info">'+n(e.__("Hold tight, we're fetching the registration form…"))+"</p>\n",e.cancel&&(t+='\n    <button class="btn btn-secondary button-cancel hor_centered">'+n(e.__("Cancel"))+"</button>\n"),t+="\n"}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/group_header.html --\x3e\n<a href="#" class="list-toggle group-toggle controlbox-padded" title="'+n(e.desc_group_toggle)+'">\n    <span class="fa ',e.toggle_state===e._converse.OPENED?t+=" fa-caret-down ":t+=" fa-caret-right ",t+='">\n    </span> '+n(e.label_group)+'</a>\n<ul class="items-list roster-group-contacts ',e.toggle_state===e._converse.CLOSED&&(t+=" collapsed "),t+='"></ul>\n'}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+="\x3c!-- src/templates/pending_contact.html --\x3e\n",e.allow_chat_pending_contacts&&(t+='\n<a class="list-item-link open-chat w-100" href="#">\n'),t+='\n<span class="pending-contact-name" title="JID: '+n(e.jid)+'">'+n(e.display_name)+"</span> \n",e.allow_chat_pending_contacts&&(t+="</a>"),t+='\n<a class="list-item-action remove-xmpp-contact far fa-trash-alt" title="'+n(e.desc_remove)+'" href="#"></a>\n'}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+="\x3c!-- src/templates/requesting_contact.html --\x3e\n",e.allow_chat_pending_contacts&&(t+='\n<a class="open-chat w-100"href="#">\n'),t+='\n<span class="req-contact-name w-100" title="JID: '+n(e.jid)+'">'+n(e.display_name)+"</span>\n",e.allow_chat_pending_contacts&&(t+="\n</a>\n"),t+='\n<a class="accept-xmpp-request list-item-action list-item-action--visible fa fa-check"\n   aria-label="'+n(e.desc_accept)+'" title="'+n(e.desc_accept)+'" href="#"></a>\n<a class="decline-xmpp-request list-item-action list-item-action--visible  fa fa-times"\n   aria-label="'+n(e.desc_decline)+'" title="'+n(e.desc_decline)+'" href="#"></a>\n'}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/roster.html --\x3e\n<div class="d-flex controlbox-padded">\n    <span class="w-100 controlbox-heading controlbox-heading--contacts">'+n(e.heading_contacts)+'</span>\n    <a class="controlbox-heading__btn sync-contacts fa fa-sync" title="'+n(e.title_sync_contacts)+'"></a>\n    ',e.allow_contact_requests&&(t+='\n        <a class="controlbox-heading__btn add-contact fa fa-user-plus"\n           title="'+n(e.title_add_contact)+'"\n           data-toggle="modal"\n           data-target="#add-contact-modal"></a>\n    '),t+='\n</div>\n\n<form class="roster-filter-form"></form>\n\n<div class="list-container roster-contacts"></div>\n'}},function(e,t,n){var i={escape:n(3)};e.exports=function(e){var t="",n=i.escape;Array.prototype.join;return t+='\x3c!-- src/templates/roster_item.html --\x3e\n<a class="list-item-link cbox-list-item open-chat w-100 ',e.num_unread&&(t+=" unread-msgs "),t+='"\n   title="'+n(e.desc_chat)+'" href="#">\n\n    <canvas class="avatar" height="30" width="30"></canvas>\n    <span class="'+n(e.status_icon)+'" title="'+n(e.desc_status)+'"></span>\n    ',e.num_unread&&(t+=' <span class="msgs-indicator">'+n(e.num_unread)+"</span> "),t+='\n    <span class="contact-name contact-name--'+n(e.show)+" ",e.num_unread&&(t+=" unread-msgs "),t+='">'+n(e.display_name)+"</span>\n</a>\n",e.allow_contact_removal&&(t+='\n<a class="list-item-action remove-xmpp-contact far fa-trash-alt" title="'+n(e.desc_remove)+'" href="#"></a>\n'),t+="\n"}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t);const i={},r={plugins:{add(e,t){if(void 0!==i[e])throw new TypeError('Error: plugin with name "'.concat(e,'" has already been ')+"registered!");i[e]=t}},initialize(e={}){r.load(e).initialize(e)},load:(e={})=>(e.assets_path&&(n.p=e.assets_path),n(420),Object.keys(i).forEach(e=>r.plugins.add(e,i[e])),r)};void 0!==window.dialog&&(window.confirm=r.confirm),window.converse=r,t.default=r},function(e,t,n){var i={"./af/LC_MESSAGES/converse.po":[421,130],"./ar/LC_MESSAGES/converse.po":[422,131],"./bg/LC_MESSAGES/converse.po":[423,132],"./ca/LC_MESSAGES/converse.po":[424,133],"./cs/LC_MESSAGES/converse.po":[425,134],"./de/LC_MESSAGES/converse.po":[426,135],"./eo/LC_MESSAGES/converse.po":[427,136],"./es/LC_MESSAGES/converse.po":[428,137],"./eu/LC_MESSAGES/converse.po":[429,138],"./fi/LC_MESSAGES/converse.po":[430,139],"./fr/LC_MESSAGES/converse.po":[431,140],"./gl/LC_MESSAGES/converse.po":[432,141],"./he/LC_MESSAGES/converse.po":[433,142],"./hi/LC_MESSAGES/converse.po":[434,143],"./hu/LC_MESSAGES/converse.po":[435,144],"./id/LC_MESSAGES/converse.po":[436,145],"./it/LC_MESSAGES/converse.po":[437,146],"./ja/LC_MESSAGES/converse.po":[438,147],"./lt/LC_MESSAGES/converse.po":[439,148],"./mr/LC_MESSAGES/converse.po":[440,149],"./nb/LC_MESSAGES/converse.po":[441,150],"./nl/LC_MESSAGES/converse.po":[442,151],"./nl_BE/LC_MESSAGES/converse.po":[443,152],"./oc/LC_MESSAGES/converse.po":[444,153],"./pl/LC_MESSAGES/converse.po":[445,154],"./pt/LC_MESSAGES/converse.po":[446,155],"./pt_BR/LC_MESSAGES/converse.po":[447,156],"./ro/LC_MESSAGES/converse.po":[448,157],"./ru/LC_MESSAGES/converse.po":[449,158],"./th/LC_MESSAGES/converse.po":[450,159],"./tr/LC_MESSAGES/converse.po":[451,160],"./uk/LC_MESSAGES/converse.po":[452,161],"./vi/LC_MESSAGES/converse.po":[453,162],"./zh_CN/LC_MESSAGES/converse.po":[454,163],"./zh_TW/LC_MESSAGES/converse.po":[455,164]};function r(e){if(!n.o(i,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],r=t[0];return n.e(t[1]).then((function(){return n.t(r,3)}))}r.keys=function(){return Object.keys(i)},r.id=283,e.exports=r},function(e,t,n){var i={"./af":[153,0],"./af.js":[153,0],"./ar":[160,1],"./ar-dz":[154,2],"./ar-dz.js":[154,2],"./ar-kw":[155,3],"./ar-kw.js":[155,3],"./ar-ly":[156,4],"./ar-ly.js":[156,4],"./ar-ma":[157,5],"./ar-ma.js":[157,5],"./ar-sa":[158,6],"./ar-sa.js":[158,6],"./ar-tn":[159,7],"./ar-tn.js":[159,7],"./ar.js":[160,1],"./az":[161,8],"./az.js":[161,8],"./be":[162,9],"./be.js":[162,9],"./bg":[163,10],"./bg.js":[163,10],"./bm":[164,11],"./bm.js":[164,11],"./bn":[165,12],"./bn.js":[165,12],"./bo":[166,13],"./bo.js":[166,13],"./br":[167,14],"./br.js":[167,14],"./bs":[168,15],"./bs.js":[168,15],"./ca":[169,16],"./ca.js":[169,16],"./cs":[170,17],"./cs.js":[170,17],"./cv":[171,18],"./cv.js":[171,18],"./cy":[172,19],"./cy.js":[172,19],"./da":[173,20],"./da.js":[173,20],"./de":[176,21],"./de-at":[174,22],"./de-at.js":[174,22],"./de-ch":[175,23],"./de-ch.js":[175,23],"./de.js":[176,21],"./dv":[177,24],"./dv.js":[177,24],"./el":[178,25],"./el.js":[178,25],"./en":[186,26],"./en-SG":[179,27],"./en-SG.js":[179,27],"./en-au":[180,28],"./en-au.js":[180,28],"./en-ca":[181,29],"./en-ca.js":[181,29],"./en-gb":[182,30],"./en-gb.js":[182,30],"./en-ie":[183,31],"./en-ie.js":[183,31],"./en-il":[184,32],"./en-il.js":[184,32],"./en-nz":[185,33],"./en-nz.js":[185,33],"./en.js":[186,26],"./eo":[187,34],"./eo.js":[187,34],"./es":[190,35],"./es-do":[188,36],"./es-do.js":[188,36],"./es-us":[189,37],"./es-us.js":[189,37],"./es.js":[190,35],"./et":[191,38],"./et.js":[191,38],"./eu":[192,39],"./eu.js":[192,39],"./fa":[193,40],"./fa.js":[193,40],"./fi":[194,41],"./fi.js":[194,41],"./fo":[195,42],"./fo.js":[195,42],"./fr":[198,43],"./fr-ca":[196,44],"./fr-ca.js":[196,44],"./fr-ch":[197,45],"./fr-ch.js":[197,45],"./fr.js":[198,43],"./fy":[199,46],"./fy.js":[199,46],"./ga":[200,47],"./ga.js":[200,47],"./gd":[201,48],"./gd.js":[201,48],"./gl":[202,49],"./gl.js":[202,49],"./gom-latn":[203,50],"./gom-latn.js":[203,50],"./gu":[204,51],"./gu.js":[204,51],"./he":[205,52],"./he.js":[205,52],"./hi":[206,53],"./hi.js":[206,53],"./hr":[207,54],"./hr.js":[207,54],"./hu":[208,55],"./hu.js":[208,55],"./hy-am":[209,56],"./hy-am.js":[209,56],"./id":[210,57],"./id.js":[210,57],"./is":[211,58],"./is.js":[211,58],"./it":[213,59],"./it-ch":[212,60],"./it-ch.js":[212,60],"./it.js":[213,59],"./ja":[214,61],"./ja.js":[214,61],"./jv":[215,62],"./jv.js":[215,62],"./ka":[216,63],"./ka.js":[216,63],"./kk":[217,64],"./kk.js":[217,64],"./km":[218,65],"./km.js":[218,65],"./kn":[219,66],"./kn.js":[219,66],"./ko":[220,67],"./ko.js":[220,67],"./ku":[221,68],"./ku.js":[221,68],"./ky":[222,69],"./ky.js":[222,69],"./lb":[223,70],"./lb.js":[223,70],"./lo":[224,71],"./lo.js":[224,71],"./lt":[225,72],"./lt.js":[225,72],"./lv":[226,73],"./lv.js":[226,73],"./me":[227,74],"./me.js":[227,74],"./mi":[228,75],"./mi.js":[228,75],"./mk":[229,76],"./mk.js":[229,76],"./ml":[230,77],"./ml.js":[230,77],"./mn":[231,78],"./mn.js":[231,78],"./mr":[232,79],"./mr.js":[232,79],"./ms":[234,80],"./ms-my":[233,81],"./ms-my.js":[233,81],"./ms.js":[234,80],"./mt":[235,82],"./mt.js":[235,82],"./my":[236,83],"./my.js":[236,83],"./nb":[237,84],"./nb.js":[237,84],"./ne":[238,85],"./ne.js":[238,85],"./nl":[240,86],"./nl-be":[239,87],"./nl-be.js":[239,87],"./nl.js":[240,86],"./nn":[241,88],"./nn.js":[241,88],"./oc-lnc":[242,89],"./oc-lnc.js":[242,89],"./pa-in":[243,90],"./pa-in.js":[243,90],"./pl":[244,91],"./pl.js":[244,91],"./pt":[246,92],"./pt-br":[245,93],"./pt-br.js":[245,93],"./pt.js":[246,92],"./ro":[247,94],"./ro.js":[247,94],"./ru":[248,95],"./ru.js":[248,95],"./sd":[249,96],"./sd.js":[249,96],"./se":[250,97],"./se.js":[250,97],"./si":[251,98],"./si.js":[251,98],"./sk":[252,99],"./sk.js":[252,99],"./sl":[253,100],"./sl.js":[253,100],"./sq":[254,101],"./sq.js":[254,101],"./sr":[256,102],"./sr-cyrl":[255,103],"./sr-cyrl.js":[255,103],"./sr.js":[256,102],"./ss":[257,104],"./ss.js":[257,104],"./sv":[258,105],"./sv.js":[258,105],"./sw":[259,106],"./sw.js":[259,106],"./ta":[260,107],"./ta.js":[260,107],"./te":[261,108],"./te.js":[261,108],"./tet":[262,109],"./tet.js":[262,109],"./tg":[263,110],"./tg.js":[263,110],"./th":[264,111],"./th.js":[264,111],"./tl-ph":[265,112],"./tl-ph.js":[265,112],"./tlh":[266,113],"./tlh.js":[266,113],"./tr":[267,114],"./tr.js":[267,114],"./tzl":[268,115],"./tzl.js":[268,115],"./tzm":[270,116],"./tzm-latn":[269,117],"./tzm-latn.js":[269,117],"./tzm.js":[270,116],"./ug-cn":[271,118],"./ug-cn.js":[271,118],"./uk":[272,119],"./uk.js":[272,119],"./ur":[273,120],"./ur.js":[273,120],"./uz":[275,121],"./uz-latn":[274,122],"./uz-latn.js":[274,122],"./uz.js":[275,121],"./vi":[276,123],"./vi.js":[276,123],"./x-pseudo":[277,124],"./x-pseudo.js":[277,124],"./yo":[278,125],"./yo.js":[278,125],"./zh-cn":[279,126],"./zh-cn.js":[279,126],"./zh-hk":[280,127],"./zh-hk.js":[280,127],"./zh-tw":[281,128],"./zh-tw.js":[281,128]};function r(e){if(!n.o(i,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],r=t[0];return n.e(t[1]).then((function(){return n.t(r,7)}))}r.keys=function(){return Object.keys(i)},r.id=284,e.exports=r},function(e,t){function n(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}"function"!=typeof window.CustomEvent&&(n.prototype=window.Event.prototype,window.CustomEvent=n),String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){const n=this.toString();(void 0===t||t>n.length)&&(t=n.length),t-=e.length;const i=n.indexOf(e,t);return-1!==i&&i===t}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e}),String.prototype.splitOnce||(String.prototype.splitOnce=function(e){const t=this.split(e);return[t.shift(),t.join(e)]}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")})},function(e,t){e.exports=function(e,t,n){var i=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(n=n>r?r:n)<0&&(n+=r),r=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(r);++i<r;)o[i]=e[i+t];return o}},function(e,t,n){var i=n(288);e.exports=function(e){return e?(e=i(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},function(e,t,n){var i=n(10),r=n(27),o=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(r(e))return NaN;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(o,"");var n=a.test(e);return n||c.test(e)?l(e.slice(2),n?2:8):s.test(e)?NaN:+e}},function(e,t,n){var i=n(28),r=Object.prototype,o=r.hasOwnProperty,s=r.toString,a=i?i.toStringTag:void 0;e.exports=function(e){var t=o.call(e,a),n=e[a];try{e[a]=void 0;var i=!0}catch(e){}var r=s.call(e);return i&&(t?e[a]=n:delete e[a]),r}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t,n){var i=n(59),r=n(292),o=n(304),s=n(7);e.exports=function(e,t){return(s(e)?i:r)(e,o(t))}},function(e,t,n){var i=n(293),r=n(303)(i);e.exports=r},function(e,t,n){var i=n(294),r=n(18);e.exports=function(e,t){return e&&i(e,t,r)}},function(e,t,n){var i=n(295)();e.exports=i},function(e,t){e.exports=function(e){return function(t,n,i){for(var r=-1,o=Object(t),s=i(t),a=s.length;a--;){var c=s[e?a:++r];if(!1===n(o[c],c,o))break}return t}}},function(e,t){e.exports=function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}},function(e,t,n){var i=n(13),r=n(11);e.exports=function(e){return r(e)&&"[object Arguments]"==i(e)}},function(e,t){e.exports=function(){return!1}},function(e,t,n){var i=n(13),r=n(43),o=n(11),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&r(e.length)&&!!s[i(e)]}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,n){(function(e){var i=n(58),r=t&&!t.nodeType&&t,o=r&&"object"==typeof e&&e&&!e.nodeType&&e,s=o&&o.exports===r&&i.process,a=function(){try{var e=o&&o.require&&o.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=a}).call(this,n(21)(e))},function(e,t,n){var i=n(66)(Object.keys,Object);e.exports=i},function(e,t,n){var i=n(17);e.exports=function(e,t){return function(n,r){if(null==n)return n;if(!i(n))return e(n,r);for(var o=n.length,s=t?o:-1,a=Object(n);(t?s--:++s<o)&&!1!==r(a[s],s,a););return n}}},function(e,t,n){var i=n(23);e.exports=function(e){return"function"==typeof e?e:i}},function(e,t,n){var i=n(306),r=n(311),o=n(74),s=r((function(e,t){i(t,o(t),e)}));e.exports=s},function(e,t,n){var i=n(67),r=n(68);e.exports=function(e,t,n,o){var s=!n;n||(n={});for(var a=-1,c=t.length;++a<c;){var l=t[a],u=o?o(n[l],e[l],l,n,e):void 0;void 0===u&&(u=e[l]),s?r(n,l,u):i(n,l,u)}return n}},function(e,t,n){var i=n(37),r=n(308),o=n(10),s=n(70),a=/^\[object .+?Constructor\]$/,c=Function.prototype,l=Object.prototype,u=c.toString,d=l.hasOwnProperty,h=RegExp("^"+u.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||r(e))&&(i(e)?h:a).test(s(e))}},function(e,t,n){var i,r=n(309),o=(i=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"";e.exports=function(e){return!!o&&o in e}},function(e,t,n){var i=n(6)["__core-js_shared__"];e.exports=i},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,n){var i=n(71),r=n(315);e.exports=function(e){return i((function(t,n){var i=-1,o=n.length,s=o>1?n[o-1]:void 0,a=o>2?n[2]:void 0;for(s=e.length>3&&"function"==typeof s?(o--,s):void 0,a&&r(n[0],n[1],a)&&(s=o<3?void 0:s,o=1),t=Object(t);++i<o;){var c=n[i];c&&e(t,c,i,s)}return t}))}},function(e,t,n){var i=n(44),r=Math.max;e.exports=function(e,t,n){return t=r(void 0===t?e.length-1:t,0),function(){for(var o=arguments,s=-1,a=r(o.length-t,0),c=Array(a);++s<a;)c[s]=o[t+s];s=-1;for(var l=Array(t+1);++s<t;)l[s]=o[s];return l[t]=n(c),i(e,this,l)}}},function(e,t,n){var i=n(314),r=n(69),o=n(23),s=r?function(e,t){return r(e,"toString",{configurable:!0,enumerable:!1,value:i(t),writable:!0})}:o;e.exports=s},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t,n){var i=n(29),r=n(17),o=n(22),s=n(10);e.exports=function(e,t,n){if(!s(n))return!1;var a=typeof t;return!!("number"==a?r(n)&&o(t,n.length):"string"==a&&t in n)&&i(n[t],e)}},function(e,t,n){var i=n(10),r=n(65),o=n(317),s=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return o(e);var t=r(e),n=[];for(var a in e)("constructor"!=a||!t&&s.call(e,a))&&n.push(a);return n}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},function(e,t){e.exports=function(e,t,n,i){for(var r=e.length,o=n+(i?1:-1);i?o--:++o<r;)if(t(e[o],o,e))return o;return-1}},function(e,t){e.exports=function(e){return e!=e}},function(e,t){e.exports=function(e,t,n){for(var i=n-1,r=e.length;++i<r;)if(e[i]===t)return i;return-1}},function(e,t,n){var i=n(45);e.exports=function(e,t){return i(t,(function(t){return e[t]}))}},function(e,t,n){var i=n(77),r=n(323),o=n(324),s=n(80),a=n(337),c=n(84),l=n(338),u=n(87),d=n(88),h=n(42),f=Math.max;e.exports=function(e,t,n,p,g,m,v,_){var b=2&t;if(!b&&"function"!=typeof e)throw new TypeError("Expected a function");var y=p?p.length:0;if(y||(t&=-97,p=g=void 0),v=void 0===v?v:f(h(v),0),_=void 0===_?_:h(_),y-=g?g.length:0,64&t){var w=p,S=g;p=g=void 0}var x=b?void 0:c(e),E=[e,t,n,p,g,w,S,m,v,_];if(x&&l(E,x),e=E[0],t=E[1],n=E[2],p=E[3],g=E[4],!(_=E[9]=void 0===E[9]?b?0:e.length:f(E[9]-y,0))&&24&t&&(t&=-25),t&&1!=t)A=8==t||16==t?o(e,t,_):32!=t&&33!=t||g.length?s.apply(void 0,E):a(e,t,n,p);else var A=r(e,t,n);return d((x?i:u)(A,E),e,t)}},function(e,t,n){var i=n(30),r=n(6);e.exports=function(e,t,n){var o=1&t,s=i(e);return function t(){var i=this&&this!==r&&this instanceof t?s:e;return i.apply(o?n:this,arguments)}}},function(e,t,n){var i=n(44),r=n(30),o=n(80),s=n(83),a=n(49),c=n(31),l=n(6);e.exports=function(e,t,n){var u=r(e);return function r(){for(var d=arguments.length,h=Array(d),f=d,p=a(r);f--;)h[f]=arguments[f];var g=d<3&&h[0]!==p&&h[d-1]!==p?[]:c(h,p);if((d-=g.length)<n)return s(e,t,o,r.placeholder,void 0,h,g,void 0,void 0,n-d);var m=this&&this!==l&&this instanceof r?u:e;return i(m,this,h)}}},function(e,t){e.exports=function(e,t){for(var n=e.length,i=0;n--;)e[n]===t&&++i;return i}},function(e,t,n){var i=n(47),r=n(84),o=n(328),s=n(330);e.exports=function(e){var t=o(e),n=s[t];if("function"!=typeof n||!(t in i.prototype))return!1;if(e===n)return!0;var a=r(n);return!!a&&e===a[0]}},function(e,t){e.exports=function(){}},function(e,t,n){var i=n(329),r=Object.prototype.hasOwnProperty;e.exports=function(e){for(var t=e.name+"",n=i[t],o=r.call(i,t)?n.length:0;o--;){var s=n[o],a=s.func;if(null==a||a==e)return s.name}return t}},function(e,t){e.exports={}},function(e,t,n){var i=n(47),r=n(85),o=n(48),s=n(7),a=n(11),c=n(331),l=Object.prototype.hasOwnProperty;function u(e){if(a(e)&&!s(e)&&!(e instanceof i)){if(e instanceof r)return e;if(l.call(e,"__wrapped__"))return c(e)}return new r(e)}u.prototype=o.prototype,u.prototype.constructor=u,e.exports=u},function(e,t,n){var i=n(47),r=n(85),o=n(86);e.exports=function(e){if(e instanceof i)return e.clone();var t=new r(e.__wrapped__,e.__chain__);return t.__actions__=o(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}},function(e,t){var n=/\{\n\/\* \[wrapped with (.+)\] \*/,i=/,? & /;e.exports=function(e){var t=e.match(n);return t?t[1].split(i):[]}},function(e,t){var n=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;e.exports=function(e,t){var i=t.length;if(!i)return e;var r=i-1;return t[r]=(i>1?"& ":"")+t[r],t=t.join(i>2?", ":" "),e.replace(n,"{\n/* [wrapped with "+t+"] */\n")}},function(e,t,n){var i=n(59),r=n(335),o=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]];e.exports=function(e,t){return i(o,(function(n){var i="_."+n[0];t&n[1]&&!r(e,i)&&e.push(i)})),e.sort()}},function(e,t,n){var i=n(75);e.exports=function(e,t){return!!(null==e?0:e.length)&&i(e,t,0)>-1}},function(e,t,n){var i=n(86),r=n(22),o=Math.min;e.exports=function(e,t){for(var n=e.length,s=o(t.length,n),a=i(e);s--;){var c=t[s];e[s]=r(c,n)?a[c]:void 0}return e}},function(e,t,n){var i=n(44),r=n(30),o=n(6);e.exports=function(e,t,n,s){var a=1&t,c=r(e);return function t(){for(var r=-1,l=arguments.length,u=-1,d=s.length,h=Array(d+l),f=this&&this!==o&&this instanceof t?c:e;++u<d;)h[u]=s[u];for(;l--;)h[u++]=arguments[++r];return i(f,a?n:this,h)}}},function(e,t,n){var i=n(81),r=n(82),o=n(31),s=Math.min;e.exports=function(e,t){var n=e[1],a=t[1],c=n|a,l=c<131,u=128==a&&8==n||128==a&&256==n&&e[7].length<=t[8]||384==a&&t[7].length<=t[8]&&8==n;if(!l&&!u)return e;1&a&&(e[2]=t[2],c|=1&n?0:4);var d=t[3];if(d){var h=e[3];e[3]=h?i(h,d,t[4]):d,e[4]=h?o(e[3],"__lodash_placeholder__"):t[4]}return(d=t[5])&&(h=e[5],e[5]=h?r(h,d,t[6]):d,e[6]=h?o(e[5],"__lodash_placeholder__"):t[6]),(d=t[7])&&(e[7]=d),128&a&&(e[8]=null==e[8]?t[8]:s(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=c,e}},function(e,t,n){var i=n(340),r=n(381),o=n(23),s=n(7),a=n(391);e.exports=function(e){return"function"==typeof e?e:null==e?o:"object"==typeof e?s(e)?r(e[0],e[1]):i(e):a(e)}},function(e,t,n){var i=n(341),r=n(380),o=n(98);e.exports=function(e){var t=r(e);return 1==t.length&&t[0][2]?o(t[0][0],t[0][1]):function(n){return n===e||i(n,e,t)}}},function(e,t,n){var i=n(89),r=n(90);e.exports=function(e,t,n,o){var s=n.length,a=s,c=!o;if(null==e)return!a;for(e=Object(e);s--;){var l=n[s];if(c&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++s<a;){var u=(l=n[s])[0],d=e[u],h=l[1];if(c&&l[2]){if(void 0===d&&!(u in e))return!1}else{var f=new i;if(o)var p=o(d,h,u,e,t,f);if(!(void 0===p?r(h,d,3,o,f):p))return!1}}return!0}},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){var i=n(33),r=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=i(t,e);return!(n<0)&&(n==t.length-1?t.pop():r.call(t,n,1),--this.size,!0)}},function(e,t,n){var i=n(33);e.exports=function(e){var t=this.__data__,n=i(t,e);return n<0?void 0:t[n][1]}},function(e,t,n){var i=n(33);e.exports=function(e){return i(this.__data__,e)>-1}},function(e,t,n){var i=n(33);e.exports=function(e,t){var n=this.__data__,r=i(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}},function(e,t,n){var i=n(32);e.exports=function(){this.__data__=new i,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){var i=n(32),r=n(50),o=n(51);e.exports=function(e,t){var n=this.__data__;if(n instanceof i){var s=n.__data__;if(!r||s.length<199)return s.push([e,t]),this.size=++n.size,this;n=this.__data__=new o(s)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){var i=n(353),r=n(32),o=n(50);e.exports=function(){this.size=0,this.__data__={hash:new i,map:new(o||r),string:new i}}},function(e,t,n){var i=n(354),r=n(355),o=n(356),s=n(357),a=n(358);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}c.prototype.clear=i,c.prototype.delete=r,c.prototype.get=o,c.prototype.has=s,c.prototype.set=a,e.exports=c},function(e,t,n){var i=n(34);e.exports=function(){this.__data__=i?i(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,n){var i=n(34),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(i){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return r.call(t,e)?t[e]:void 0}},function(e,t,n){var i=n(34),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return i?void 0!==t[e]:r.call(t,e)}},function(e,t,n){var i=n(34);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=i&&void 0===t?"__lodash_hash_undefined__":t,this}},function(e,t,n){var i=n(35);e.exports=function(e){var t=i(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){var i=n(35);e.exports=function(e){return i(this,e).get(e)}},function(e,t,n){var i=n(35);e.exports=function(e){return i(this,e).has(e)}},function(e,t,n){var i=n(35);e.exports=function(e,t){var n=i(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}},function(e,t,n){var i=n(89),r=n(91),o=n(370),s=n(374),a=n(96),c=n(7),l=n(62),u=n(63),d="[object Object]",h=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,f,p,g){var m=c(e),v=c(t),_=m?"[object Array]":a(e),b=v?"[object Array]":a(t),y=(_="[object Arguments]"==_?d:_)==d,w=(b="[object Arguments]"==b?d:b)==d,S=_==b;if(S&&l(e)){if(!l(t))return!1;m=!0,y=!1}if(S&&!y)return g||(g=new i),m||u(e)?r(e,t,n,f,p,g):o(e,t,_,n,f,p,g);if(!(1&n)){var x=y&&h.call(e,"__wrapped__"),E=w&&h.call(t,"__wrapped__");if(x||E){var A=x?e.value():e,j=E?t.value():t;return g||(g=new i),p(A,j,n,f,g)}}return!!S&&(g||(g=new i),s(e,t,n,f,p,g))}},function(e,t,n){var i=n(51),r=n(366),o=n(367);function s(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new i;++t<n;)this.add(e[t])}s.prototype.add=s.prototype.push=r,s.prototype.has=o,e.exports=s},function(e,t){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,n){var i=n(28),r=n(371),o=n(29),s=n(91),a=n(372),c=n(373),l=i?i.prototype:void 0,u=l?l.valueOf:void 0;e.exports=function(e,t,n,i,l,d,h){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!d(new r(e),new r(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var f=a;case"[object Set]":var p=1&i;if(f||(f=c),e.size!=t.size&&!p)return!1;var g=h.get(e);if(g)return g==t;i|=2,h.set(e,t);var m=s(f(e),f(t),i,l,d,h);return h.delete(e),m;case"[object Symbol]":if(u)return u.call(e)==u.call(t)}return!1}},function(e,t,n){var i=n(6).Uint8Array;e.exports=i},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},function(e,t,n){var i=n(375),r=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,o,s,a){var c=1&n,l=i(e),u=l.length;if(u!=i(t).length&&!c)return!1;for(var d=u;d--;){var h=l[d];if(!(c?h in t:r.call(t,h)))return!1}var f=a.get(e);if(f&&a.get(t))return f==t;var p=!0;a.set(e,t),a.set(t,e);for(var g=c;++d<u;){var m=e[h=l[d]],v=t[h];if(o)var _=c?o(v,m,h,t,e,a):o(m,v,h,e,t,a);if(!(void 0===_?m===v||s(m,v,n,o,a):_)){p=!1;break}g||(g="constructor"==h)}if(p&&!g){var b=e.constructor,y=t.constructor;b==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof y&&y instanceof y||(p=!1)}return a.delete(e),a.delete(t),p}},function(e,t,n){var i=n(92),r=n(94),o=n(18);e.exports=function(e){return i(e,o,r)}},function(e,t){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length,r=0,o=[];++n<i;){var s=e[n];t(s,n,e)&&(o[r++]=s)}return o}},function(e,t,n){var i=n(14)(n(6),"DataView");e.exports=i},function(e,t,n){var i=n(14)(n(6),"Promise");e.exports=i},function(e,t,n){var i=n(14)(n(6),"Set");e.exports=i},function(e,t,n){var i=n(97),r=n(18);e.exports=function(e){for(var t=r(e),n=t.length;n--;){var o=t[n],s=e[o];t[n]=[o,s,i(s)]}return t}},function(e,t,n){var i=n(90),r=n(382),o=n(388),s=n(53),a=n(97),c=n(98),l=n(24);e.exports=function(e,t){return s(e)&&a(t)?c(l(e),t):function(n){var s=r(n,e);return void 0===s&&s===t?o(n,e):i(t,s,3)}}},function(e,t,n){var i=n(52);e.exports=function(e,t,n){var r=null==e?void 0:i(e,t);return void 0===r?n:r}},function(e,t,n){var i=n(384),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,s=i((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(r,(function(e,n,i,r){t.push(i?r.replace(o,"$1"):n||e)})),t}));e.exports=s},function(e,t,n){var i=n(385);e.exports=function(e){var t=i(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}},function(e,t,n){var i=n(51);function r(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var i=arguments,r=t?t.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var s=e.apply(this,i);return n.cache=o.set(r,s)||o,s};return n.cache=new(r.Cache||i),n}r.Cache=i,e.exports=r},function(e,t,n){var i=n(387);e.exports=function(e){return null==e?"":i(e)}},function(e,t,n){var i=n(28),r=n(45),o=n(7),s=n(27),a=i?i.prototype:void 0,c=a?a.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return r(t,e)+"";if(s(t))return c?c.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}},function(e,t,n){var i=n(389),r=n(390);e.exports=function(e,t){return null!=e&&r(e,t,i)}},function(e,t){e.exports=function(e,t){return null!=e&&t in Object(e)}},function(e,t,n){var i=n(36),r=n(61),o=n(7),s=n(22),a=n(43),c=n(24);e.exports=function(e,t,n){for(var l=-1,u=(t=i(t,e)).length,d=!1;++l<u;){var h=c(t[l]);if(!(d=null!=e&&n(e,h)))break;e=e[h]}return d||++l!=u?d:!!(u=null==e?0:e.length)&&a(u)&&s(h,u)&&(o(e)||r(e))}},function(e,t,n){var i=n(99),r=n(392),o=n(53),s=n(24);e.exports=function(e){return o(e)?i(s(e)):r(e)}},function(e,t,n){var i=n(52);e.exports=function(e){return function(t){return i(t,e)}}},function(e,t,n){var i=n(52),r=n(394),o=n(36);e.exports=function(e,t,n){for(var s=-1,a=t.length,c={};++s<a;){var l=t[s],u=i(e,l);n(u,l)&&r(c,o(l,e),u)}return c}},function(e,t,n){var i=n(67),r=n(36),o=n(22),s=n(10),a=n(24);e.exports=function(e,t,n,c){if(!s(e))return e;for(var l=-1,u=(t=r(t,e)).length,d=u-1,h=e;null!=h&&++l<u;){var f=a(t[l]),p=n;if(l!=d){var g=h[f];void 0===(p=c?c(g,f,h):void 0)&&(p=s(g)?g:o(t[l+1])?[]:{})}i(h,f,p),h=h[f]}return e}},function(e,t,n){var i=n(92),r=n(396),o=n(74);e.exports=function(e){return i(e,o,r)}},function(e,t,n){var i=n(93),r=n(397),o=n(94),s=n(95),a=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)i(t,o(e)),e=r(e);return t}:s;e.exports=a},function(e,t,n){var i=n(66)(Object.getPrototypeOf,Object);e.exports=i},function(e,t,n){var i=n(399),r=n(400),o=n(401);e.exports=function(e){return r(e)?o(e):i(e)}},function(e,t,n){var i=n(99)("length");e.exports=i},function(e,t){var n=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return n.test(e)}},function(e,t){var n="[\\ud800-\\udfff]",i="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",r="\\ud83c[\\udffb-\\udfff]",o="[^\\ud800-\\udfff]",s="(?:\\ud83c[\\udde6-\\uddff]){2}",a="[\\ud800-\\udbff][\\udc00-\\udfff]",c="(?:"+i+"|"+r+")"+"?",l="[\\ufe0e\\ufe0f]?"+c+("(?:\\u200d(?:"+[o,s,a].join("|")+")[\\ufe0e\\ufe0f]?"+c+")*"),u="(?:"+[o+i+"?",i,s,a,n].join("|")+")",d=RegExp(r+"(?="+r+")|"+u+l,"g");e.exports=function(e){for(var t=d.lastIndex=0;d.test(e);)++t;return t}},function(e,t,n){var i=n(403)({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});e.exports=i},function(e,t){e.exports=function(e){return function(t){return null==e?void 0:e[t]}}},function(e,t,n){var i=n(405);e.exports=function(e){return null==e?"":i(e)}},function(e,t,n){var i=n(54),r=n(408),o=n(409),s=n(410),a=i?i.prototype:void 0,c=a?a.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return r(t,e)+"";if(s(t))return c?c.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}},function(e,t,n){var i=n(407),r="object"==typeof self&&self&&self.Object===Object&&self,o=i||r||Function("return this")();e.exports=o},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(9))},function(e,t){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r}},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){var i=n(411),r=n(414);e.exports=function(e){return"symbol"==typeof e||r(e)&&"[object Symbol]"==i(e)}},function(e,t,n){var i=n(54),r=n(412),o=n(413),s=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?r(e):o(e)}},function(e,t,n){var i=n(54),r=Object.prototype,o=r.hasOwnProperty,s=r.toString,a=i?i.toStringTag:void 0;e.exports=function(e){var t=o.call(e,a),n=e[a];try{e[a]=void 0;var i=!0}catch(e){}var r=s.call(e);return i&&(t?e[a]=n:delete e[a]),r}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){var i=n(416);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(418)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(t=n(417)(!0)).push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"converse.scss"}]),e.exports=t},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var r=(s=i,a=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(c," */")),o=i.sources.map((function(e){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(e," */")}));return[n].concat(o).concat([r]).join("\n")}var s,a,c;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,i){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(i)for(var o=0;o<this.length;o++){var s=this[o][0];null!=s&&(r[s]=!0)}for(var a=0;a<e.length;a++){var c=[].concat(e[a]);i&&r[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},function(e,t,n){var i,r,o={},s=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=i.apply(this,arguments)),r}),a=function(e,t){return t?t.querySelector(e):document.querySelector(e)},c=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var i=a.call(this,e,n);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}}(),l=null,u=0,d=[],h=n(419);function f(e,t){for(var n=0;n<e.length;n++){var i=e[n],r=o[i.id];if(r){r.refs++;for(var s=0;s<r.parts.length;s++)r.parts[s](i.parts[s]);for(;s<i.parts.length;s++)r.parts.push(b(i.parts[s],t))}else{var a=[];for(s=0;s<i.parts.length;s++)a.push(b(i.parts[s],t));o[i.id]={id:i.id,refs:1,parts:a}}}}function p(e,t){for(var n=[],i={},r=0;r<e.length;r++){var o=e[r],s=t.base?o[0]+t.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};i[s]?i[s].parts.push(a):n.push(i[s]={id:s,parts:[a]})}return n}function g(e,t){var n=c(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=d[d.length-1];if("top"===e.insertAt)i?i.nextSibling?n.insertBefore(t,i.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),d.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=c(e.insertAt.before,n);n.insertBefore(t,r)}}function m(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function v(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var i=function(){0;return n.nc}();i&&(e.attrs.nonce=i)}return _(t,e.attrs),g(e,t),t}function _(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function b(e,t){var n,i,r,o;if(t.transform&&e.css){if(!(o="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=o}if(t.singleton){var s=u++;n=l||(l=v(t)),i=S.bind(null,n,s,!1),r=S.bind(null,n,s,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",_(t,e.attrs),g(e,t),t}(t),i=E.bind(null,n,t),r=function(){m(n),n.href&&URL.revokeObjectURL(n.href)}):(n=v(t),i=x.bind(null,n),r=function(){m(n)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else r()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=p(e,t);return f(n,t),function(e){for(var i=[],r=0;r<n.length;r++){var s=n[r];(a=o[s.id]).refs--,i.push(a)}e&&f(p(e,t),t);for(r=0;r<i.length;r++){var a;if(0===(a=i[r]).refs){for(var c=0;c<a.parts.length;c++)a.parts[c]();delete o[a.id]}}}};var y,w=(y=[],function(e,t){return y[e]=t,y.filter(Boolean).join("\n")});function S(e,t,n,i){var r=n?"":i.css;if(e.styleSheet)e.styleSheet.cssText=w(t,r);else{var o=document.createTextNode(r),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(o,s[t]):e.appendChild(o)}}function x(e,t){var n=t.css,i=t.media;if(i&&e.setAttribute("media",i),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function E(e,t,n){var i=n.css,r=n.sourceMap,o=void 0===t.convertToAbsoluteUrls&&r;(t.convertToAbsoluteUrls||o)&&(i=h(i)),r&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var s=new Blob([i],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,i=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var r,o=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?e:(r=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:i+o.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")}))}},function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i);function o(e,t){const n=this;let i;return i=e&&r.a.has(e,"constructor")?e.constructor:function(){return n.apply(this,arguments)},r.a.extend(i,n,t),i.prototype=r.a.create(n.prototype,e),i.prototype.constructor=i,i.__super__=n.prototype,i}function s(){const e={isResolved:!1,isPending:!0,isRejected:!1},t=new Promise((t,n)=>{e.resolve=t,e.reject=n});return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}function a(){throw new Error('A "url" property or function must be specified')}function c(e,t){const n=t.error;t.error=function(i){n&&n.call(t.context,e,i,t),e.trigger("error",e,i,t)}}const l={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};function u(e){const t=r.a.result(e,"browserStorage")||r.a.result(e.collection,"browserStorage");return t?t.sync():d}function d(e,t,n={}){const i={type:l[e],dataType:"json"};n.url||(i.url=r.a.result(t,"url")||a()),null!=n.data||!t||"create"!==e&&"update"!==e&&"patch"!==e||(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),"GET"!==i.type&&(i.processData=!1);const o=n.error;n.error=function(e,t,i){n.textStatus=t,n.errorThrown=i,o&&o.call(n.context,e,t,i)};const s=n.xhr=function(){return fetch.apply(this,arguments)}(r.a.extend(i,n));return t.trigger("request",t,s,n),s}Array.prototype.slice;const h={},f=/\s+/;let p;const g=function(e,t,n,i,o){let s,a=0;if(n&&"object"==typeof n){void 0!==i&&"context"in o&&void 0===o.context&&(o.context=i);for(s=r.a.keys(n);a<s.length;a++)t=g(e,t,s[a],n[s[a]],o)}else if(n&&f.test(n))for(s=n.split(f);a<s.length;a++)t=e(t,s[a],i,o);else t=e(t,n,i,o);return t};h.on=function(e,t,n){if(this._events=g(m,this._events||{},e,t,{context:n,ctx:this,listening:p}),p){(this._listeners||(this._listeners={}))[p.id]=p,p.interop=!1}return this},h.listenTo=function(e,t,n){if(!e)return this;const i=e._listenId||(e._listenId=r.a.uniqueId("l")),o=this._listeningTo||(this._listeningTo={});let s=p=o[i];s||(this._listenId||(this._listenId=r.a.uniqueId("l")),s=p=o[i]=new S(this,e));const a=v(e,t,n,this);if(p=void 0,a)throw a;return s.interop&&s.on(t,n),this};const m=function(e,t,n,i){if(n){const r=e[t]||(e[t]=[]),o=i.context,s=i.ctx,a=i.listening;a&&a.count++,r.push({callback:n,context:o,ctx:o||s,listening:a})}return e},v=function(e,t,n,i){try{e.on(t,n,i)}catch(e){return e}};h.off=function(e,t,n){return this._events?(this._events=g(_,this._events,e,t,{context:n,listeners:this._listeners}),this):this},h.stopListening=function(e,t,n){const i=this._listeningTo;if(!i)return this;const o=e?[e._listenId]:r.a.keys(i);for(let e=0;e<o.length;e++){const r=i[o[e]];if(!r)break;r.obj.off(t,n,this),r.interop&&r.off(t,n)}return r.a.isEmpty(i)&&(this._listeningTo=void 0),this};const _=function(e,t,n,i){if(!e)return;const o=i.context,s=i.listeners;let a,c=0;if(t||o||n){for(a=t?[t]:r.a.keys(e);c<a.length;c++){const i=e[t=a[c]];if(!i)break;const r=[];for(let e=0;e<i.length;e++){const s=i[e];if(n&&n!==s.callback&&n!==s.callback._callback||o&&o!==s.context)r.push(s);else{const e=s.listening;e&&e.off(t,n)}}r.length?e[t]=r:delete e[t]}return e}for(a=r.a.keys(s);c<a.length;c++)s[a[c]].cleanup()};h.once=function(e,t,n){const i=g(b,{},e,t,this.off.bind(this));return"string"==typeof e&&null==n&&(t=void 0),this.on(i,t,n)},h.listenToOnce=function(e,t,n){const i=g(b,{},t,n,this.stopListening.bind(this,e));return this.listenTo(e,i)};const b=function(e,t,n,i){if(n){const o=e[t]=r.a.once((function(){i(t,o),n.apply(this,arguments)}));o._callback=n}return e};h.trigger=function(e){if(!this._events)return this;const t=Math.max(0,arguments.length-1),n=Array(t);for(let e=0;e<t;e++)n[e]=arguments[e+1];return g(y,this._events,e,void 0,n),this};const y=function(e,t,n,i){if(e){const n=e[t];let r=e.all;n&&r&&(r=r.slice()),n&&w(n,i),r&&w(r,[t].concat(i))}return e},w=function(e,t){let n,i=-1;const r=e.length,o=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++i<r;)(n=e[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=e[i]).callback.call(n.ctx,o);return;case 2:for(;++i<r;)(n=e[i]).callback.call(n.ctx,o,s);return;case 3:for(;++i<r;)(n=e[i]).callback.call(n.ctx,o,s,a);return;default:for(;++i<r;)(n=e[i]).callback.apply(n.ctx,t);return}},S=function(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0};S.prototype.on=h.on,S.prototype.off=function(e,t){let n;this.interop?(this._events=g(_,this._events,e,t,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=0===this.count),n&&this.cleanup()},S.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},h.bind=h.on,h.unbind=h.off;const x=function(e,t){let n=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=Object(i.uniqueId)(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});const r=Object(i.result)(this,"defaults");n=Object(i.defaults)(Object(i.extend)({},r,n),r),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};x.extend=o,Object(i.extend)(x.prototype,h,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(e){return Object(i.clone)(this.attributes)},sync:function(e,t,n){return u(this)(e,t,n)},get:function(e){return this.attributes[e]},escape:function(e){return Object(i.escape)(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!Object(i.iteratee)(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;let r;if("object"==typeof e?(r=e,n=t):(r={})[e]=t,n||(n={}),!this._validate(r,n))return!1;const o=n.unset,s=n.silent,a=[],c=this._changing;this._changing=!0,c||(this._previousAttributes=Object(i.clone)(this.attributes),this.changed={});const l=this.attributes,u=this.changed,d=this._previousAttributes;for(const e in r)t=r[e],Object(i.isEqual)(l[e],t)||a.push(e),Object(i.isEqual)(d[e],t)?delete u[e]:u[e]=t,o?delete l[e]:l[e]=t;if(this.idAttribute in r&&(this.id=this.get(this.idAttribute)),!s){a.length&&(this._pending=n);for(let e=0;e<a.length;e++)this.trigger("change:"+a[e],this,l[a[e]],n)}if(c)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,Object(i.extend)({},t,{unset:!0}))},clear:function(e){const t={};for(const e in this.attributes)t[e]=void 0;return this.set(t,Object(i.extend)({},e,{unset:!0}))},hasChanged:function(e){return null==e?!Object(i.isEmpty)(this.changed):Object(i.has)(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&Object(i.clone)(this.changed);const t=this._changing?this._previousAttributes:this.attributes,n={};let r;for(const o in e){const s=e[o];Object(i.isEqual)(t[o],s)||(n[o]=s,r=!0)}return!!r&&n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return Object(i.clone)(this._previousAttributes)},fetch:function(e){e=Object(i.extend)({parse:!0},e);const t=this,n=e.success;return e.success=function(i){const r=e.parse?t.parse(i,e):i;if(!t.set(r,e))return!1;n&&n.call(e.context,t,i,e),t.trigger("sync",t,i,e)},c(this,e),this.sync("read",this,e)},save:function(e,t,n){let r;null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t;const o=(n=Object(i.extend)({validate:!0,parse:!0},n)).wait,a=n.promise,l=a&&s();if(r&&!o){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;const u=this,d=n.success,h=this.attributes;n.success=function(e){u.attributes=h;let t=n.parse?u.parse(e,n):e;if(o&&(t=Object(i.extend)({},r,t)),t&&!u.set(t,n))return!1;d&&d.call(n.context,u,e,n),u.trigger("sync",u,e,n),a&&l.resolve()},c(this,n),r&&o&&(this.attributes=Object(i.extend)({},h,r));const f=this.isNew()?"create":n.patch?"patch":"update";"patch"!==f||n.attrs||(n.attrs=r);const p=this.sync(f,this,n);return this.attributes=h,a?l:p},destroy:function(e){e=e?Object(i.clone)(e):{};const t=this,n=e.success,r=e.wait,o=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(i){r&&o(),n&&n.call(e.context,t,i,e),t.isNew()||t.trigger("sync",t,i,e)};let s=!1;return this.isNew()?Object(i.defer)(e.success):(c(this,e),s=this.sync("delete",this,e)),r||o(),s},url:function(){const e=Object(i.result)(this,"urlRoot")||Object(i.result)(this.collection,"url")||a();if(this.isNew())return e;const t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},Object(i.extend)({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=Object(i.extend)({},this.attributes,e);const n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,Object(i.extend)(t,{validationError:n})),!1)}});const E=Array.prototype.slice,A=function(e,t){t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,r.a.extend({silent:!0},t))};A.extend=o;const j={add:!0,remove:!0,merge:!0},C={add:!0,remove:!1},k=function(e,t,n){n=Math.min(Math.max(n,0),e.length);const i=Array(e.length-n),r=t.length;let o;for(o=0;o<i.length;o++)i[o]=e[o+n];for(o=0;o<r;o++)e[o+n]=t[o];for(o=0;o<i.length;o++)e[o+r+n]=i[o]};r.a.extend(A.prototype,h,{model:x,preinitialize:function(){},initialize:function(){},toJSON:function(e){return this.map((function(t){return t.toJSON(e)}))},sync:function(e,t,n){return u(this)(e,t,n)},add:function(e,t){return this.set(e,r.a.extend({merge:!1},t,C))},remove:function(e,t){t=r.a.extend({},t);const n=!r.a.isArray(e);e=n?[e]:e.slice();const i=this._removeModels(e,t);return!t.silent&&i.length&&(t.changes={added:[],merged:[],removed:i},this.trigger("update",this,t)),n?i[0]:i},set:function(e,t){if(null==e)return;(t=r.a.extend({},j,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);const n=!r.a.isArray(e);e=n?[e]:e.slice();let i=t.at;null!=i&&(i=+i),i>this.length&&(i=this.length),i<0&&(i+=this.length+1);const o=[],s=[],a=[],c=[],l={},u=t.add,d=t.merge,h=t.remove;let f=!1;const p=this.comparator&&null==i&&!1!==t.sort,g=r.a.isString(this.comparator)?this.comparator:null;let m,v;for(v=0;v<e.length;v++){m=e[v];const n=this.get(m);if(n){if(d&&m!==n){let e=this._isModel(m)?m.attributes:m;t.parse&&(e=n.parse(e,t)),n.set(e,t),a.push(n),p&&!f&&(f=n.hasChanged(g))}l[n.cid]||(l[n.cid]=!0,o.push(n)),e[v]=n}else u&&(m=e[v]=this._prepareModel(m,t),m&&(s.push(m),this._addReference(m,t),l[m.cid]=!0,o.push(m)))}if(h){for(v=0;v<this.length;v++)m=this.models[v],l[m.cid]||c.push(m);c.length&&this._removeModels(c,t)}let _=!1;const b=!p&&u&&h;if(o.length&&b?(_=this.length!==o.length||r.a.some(this.models,(function(e,t){return e!==o[t]})),this.models.length=0,k(this.models,o,0),this.length=this.models.length):s.length&&(p&&(f=!0),k(this.models,s,null==i?this.length:i),this.length=this.models.length),f&&this.sort({silent:!0}),!t.silent){for(v=0;v<s.length;v++)null!=i&&(t.index=i+v),m=s[v],m.trigger("add",m,this,t);(f||_)&&this.trigger("sort",this,t),(s.length||c.length||a.length)&&(t.changes={added:s,removed:c,merged:a},this.trigger("update",this,t))}return n?e[0]:e},clearStore:async function(e={}){await Promise.all(Array.from(this.models).map(t=>new Promise(n=>{t.destroy(Object.assign(e,{success:n,error:(e,t)=>{console.error(t),n()}}))}))),await this.browserStorage.clear(),this.reset()},reset:function(e,t){t=t?r.a.clone(t):{};for(let e=0;e<this.models.length;e++)this._removeReference(this.models[e],t);return t.previousModels=this.models,this._reset(),e=this.add(e,r.a.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,r.a.extend({at:this.length},t))},pop:function(e){const t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,r.a.extend({at:0},t))},shift:function(e){const t=this.at(0);return this.remove(t,e)},slice:function(){return E.apply(this.models,arguments)},filter:function(e,t){return this.models.filter(r.a.isFunction(e)?e:t=>t.matches(e),t)},each:function(e,t){return this.forEach(e,t)},forEach:function(e,t){return this.models.forEach(e,t)},includes:function(e,t){return this.models.includes(e,t)},map:function(e,t){return this.models.map(r.a.isFunction(e)?e:t=>r.a.isString(e)?t.get(e):t.matches(e),t)},reduce:function(e,t){return this.models.reduce(e,t||this.models[0])},reduceRight:function(e,t){return this.models.reduceRight(e,t||this.models[0])},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){let t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});const n=t.length;return r.a.isFunction(t)&&(t=t.bind(this)),1===n||r.a.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){const t=(e=r.a.extend({parse:!0},e)).success,n=this;return e.success=function(i){const r=e.reset?"reset":"set";n[r](i,e),t&&t.call(e.context,n,i,e),n.trigger("sync",n,i,e)},c(this,e),this.sync("read",this,e)},create:function(e,t){const n=(t=t?r.a.clone(t):{}).wait,i=t.promise,o=i&&s();if(!(e=this._prepareModel(e,t)))return!1;n||this.add(e,t);const a=this,c=t.success;return t.success=function(e,t,r){n&&a.add(e,r),c&&c.call(r.context,e,t,r),i&&o.resolve(e)},e.save(null,t),i?o:e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},values:function(){return new T(this,N)},keys:function(){return new T(this,M)},entries:function(){return new T(this,I)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;(t=t?r.a.clone(t):{}).collection=this;const n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeModels:function(e,t){const n=[];for(let i=0;i<e.length;i++){const r=this.get(e[i]);if(!r)continue;const o=this.indexOf(r);this.models.splice(o,1),this.length--,delete this._byId[r.cid];const s=this.modelId(r.attributes);null!=s&&delete this._byId[s],t.silent||(t.index=o,r.trigger("remove",r,this,t)),n.push(r),this._removeReference(r,t)}return n},_isModel:function(e){return e instanceof x},_addReference:function(e,t){this._byId[e.cid]=e;const n=this.modelId(e.attributes);null!=n&&(this._byId[n]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];const n=this.modelId(e.attributes);null!=n&&delete this._byId[n],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){if(t){if(("add"===e||"remove"===e)&&n!==this)return;if("destroy"===e&&this.remove(t,i),"change"===e){const e=this.modelId(t.previousAttributes()),n=this.modelId(t.attributes);e!==n&&(null!=e&&delete this._byId[e],null!=n&&(this._byId[n]=t))}}this.trigger.apply(this,arguments)}});const O="function"==typeof Symbol&&Symbol.iterator;O&&(A.prototype[O]=A.prototype.values);const T=function(e,t){this._collection=e,this._kind=t,this._index=0},N=1,M=2,I=3;O&&(T.prototype[O]=function(){return this}),T.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){const e=this._collection.at(this._index);let t;if(this._index++,this._kind===N)t=e;else{const n=this._collection.modelId(e.attributes);t=this._kind===M?n:[n,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};const R=function(e,t,n,i){r.a.each(n,(function(n,r){t[r]&&(e.prototype[r]=function(e,t,n,i){switch(t){case 1:return function(){return e[n](this[i])};case 2:return function(t){return e[n](this[i],t)};case 3:return function(t,r){return e[n](this[i],D(t,this),r)};case 4:return function(t,r,o){return e[n](this[i],D(t,this),r,o)};default:return function(){const t=E.call(arguments);return t.unshift(this[i]),e[n].apply(e,t)}}}(t,n,r,i))}))},D=function(e,t){return r.a.isFunction(e)?e:r.a.isObject(e)&&!t._isModel(e)?P(e):r.a.isString(e)?function(t){return t.get(e)}:e},P=function(e){const t=r.a.matches(e);return function(e){return t(e.attributes)}};r.a.each([[A,{all:3,any:3,chain:1,collect:3,contains:3,countBy:3,detect:3,difference:0,drop:3,each:3,every:3,find:3,findIndex:3,findLastIndex:3,first:3,foldl:0,foldr:0,groupBy:3,head:3,include:3,includes:3,keyBy:3,indexOf:3,initial:3,inject:0,invokeMap:0,isEmpty:1,last:3,lastIndexOf:3,max:3,min:3,partition:3,reject:3,sample:3,select:3,shuffle:1,size:1,some:3,sortBy:3,tail:3,take:3,toArray:1,without:0},"models"],[x,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],(function(e){const t=e[0],n=e[1],i=e[2];t.mixin=function(e){const n=r.a.reduce(r.a.functions(e),(function(e,t){return e[t]=0,e}),{});R(t,e,n,i)},R(t,r.a,n,i)}));const L=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)};L.extend=o;const z=/^[#\/]|\s+$/g,F=/^\/+|\/+$/g,B=/#.*$/;L.started=!1,r.a.extend(L.prototype,h,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){const e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){const t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){const e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(z,"")},start:function(e){if(L.started)throw new Error("history has already been started");if(L.started=!0,this.options=r.a.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(F,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){const e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;const e=document.body,t=e.insertBefore(this.iframe,e.firstChild).contentWindow;t.document.open(),t.document.close(),t.location.hash="#"+this.fragment}if(this._usePushState?addEventListener("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?addEventListener("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){this._usePushState?removeEventListener("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&removeEventListener("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),L.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){let t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),r.a.some(this.handlers,(function(t){if(t.route.test(e))return t.callback(e),!0})))},navigate:function(e,t){if(!L.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");let n=this.root;""!==e&&"?"!==e.charAt(0)||(n=n.slice(0,-1)||"/");const i=n+e;e=e.replace(B,"");const r=this.decodeFragment(e);if(this.fragment!==r){if(this.fragment=r,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){const n=this.iframe.contentWindow;t.replace||(n.document.open(),n.document.close()),this._updateHash(n.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){const n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}});var q=L;const U=function(e={}){this.history=e.history||new q,this.preinitialize.apply(this,arguments),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};U.extend=o;const H=/\((.*?)\)/g,$=/(\(\?)?:\w+/g,W=/\*\w+/g,V=/[\-{}\[\]+?.,\\\^$|#\s]/g;r.a.extend(U.prototype,h,{preinitialize:function(){},initialize:function(){},route:function(e,t,n){return r.a.isRegExp(e)||(e=this._routeToRegExp(e)),r.a.isFunction(t)&&(n=t,t=""),n||(n=this[t]),this.history.route(e,i=>{const r=this._extractParameters(e,i);!1!==this.execute(n,r,t)&&(this.trigger.apply(this,["route:"+t].concat(r)),this.trigger("route",t,r),this.history.trigger("route",this,t,r))}),this},execute:function(e,t,n){e&&e.apply(this,t)},navigate:function(e,t){return this.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;let e;this.routes=r.a.result(this,"routes");const t=r.a.keys(this.routes);for(;null!=(e=t.pop());)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(V,"\\$&").replace(H,"(?:$1)?").replace($,(function(e,t){return t?e:"([^/?]+)"})).replace(W,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){const n=e.exec(t).slice(1);return r.a.map(n,(function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null}))}});var G=n(40),J=n.n(G),Q=n(5),K=n.n(Q);function Y(e,t){return"string"==typeof e&&t.includes(e)}function X(e,t){return"string"!=typeof e||"en"!==e&&!t(e)?
/**
 * @module i18n
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 * @description This is the internationalization module
 */
function(e){var t,n;if(window.navigator.userLanguage&&(t=Z(window.navigator.userLanguage,e)),window.navigator.languages&&!t)for(n=0;n<window.navigator.languages.length&&!t;n++)t=Z(window.navigator.languages[n],e);return window.navigator.browserLanguage&&!t&&(t=Z(window.navigator.browserLanguage,e)),window.navigator.language&&!t&&(t=Z(window.navigator.language,e)),window.navigator.systemLanguage&&!t&&(t=Z(window.navigator.systemLanguage,e)),t||"en"}(t)||"en":e}function Z(e,t){if(t(e))return e;var n=e.split("-")[0];return n!==e&&t(n)?n:void 0}let ee;const te={getLocale:(e,t)=>X(e,e=>Y(e,t)),translate(e){if(!ee)return J.a.sprintf.apply(J.a,arguments);const t=ee.translate(e);return arguments.length>1?t.fetch.apply(t,[].slice.call(arguments,1)):t.fetch()},async fetchTranslations(e){const t=e.locale;if(!Y(t,e.api.settings.get("locales"))||"en"===t)return;const{default:i}=await n(283)("./".concat(t,"/LC_MESSAGES/converse.po"));await n(284)("./".concat(t.toLowerCase().replace("_","-"))),K.a.locale(X(e.locale,e=>K.a.locale(e))),ee=new J.a(i)}},ne=function(){return te.translate.apply(te,arguments)},ie=function(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},re=function(e){if("string"!=typeof e)throw new Error("str2binl was passed a non-string");const t=[];for(let n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},oe=function(e,t,n,i,r,o){return ie((s=ie(ie(t,e),ie(i,o)))<<(a=r)|s>>>32-a,n);var s,a},se=function(e,t,n,i,r,o,s){return oe(t&n|~t&i,e,t,r,o,s)},ae=function(e,t,n,i,r,o,s){return oe(t&i|n&~i,e,t,r,o,s)},ce=function(e,t,n,i,r,o,s){return oe(t^n^i,e,t,r,o,s)},le=function(e,t,n,i,r,o,s){return oe(n^(t|~i),e,t,r,o,s)},ue=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let n,i,r,o,s=1732584193,a=-271733879,c=-1732584194,l=271733878;for(let t=0;t<e.length;t+=16)n=s,i=a,r=c,o=l,s=se(s,a,c,l,e[t+0],7,-680876936),l=se(l,s,a,c,e[t+1],12,-389564586),c=se(c,l,s,a,e[t+2],17,606105819),a=se(a,c,l,s,e[t+3],22,-1044525330),s=se(s,a,c,l,e[t+4],7,-176418897),l=se(l,s,a,c,e[t+5],12,1200080426),c=se(c,l,s,a,e[t+6],17,-1473231341),a=se(a,c,l,s,e[t+7],22,-45705983),s=se(s,a,c,l,e[t+8],7,1770035416),l=se(l,s,a,c,e[t+9],12,-1958414417),c=se(c,l,s,a,e[t+10],17,-42063),a=se(a,c,l,s,e[t+11],22,-1990404162),s=se(s,a,c,l,e[t+12],7,1804603682),l=se(l,s,a,c,e[t+13],12,-40341101),c=se(c,l,s,a,e[t+14],17,-1502002290),a=se(a,c,l,s,e[t+15],22,1236535329),s=ae(s,a,c,l,e[t+1],5,-165796510),l=ae(l,s,a,c,e[t+6],9,-1069501632),c=ae(c,l,s,a,e[t+11],14,643717713),a=ae(a,c,l,s,e[t+0],20,-373897302),s=ae(s,a,c,l,e[t+5],5,-701558691),l=ae(l,s,a,c,e[t+10],9,38016083),c=ae(c,l,s,a,e[t+15],14,-660478335),a=ae(a,c,l,s,e[t+4],20,-405537848),s=ae(s,a,c,l,e[t+9],5,568446438),l=ae(l,s,a,c,e[t+14],9,-1019803690),c=ae(c,l,s,a,e[t+3],14,-187363961),a=ae(a,c,l,s,e[t+8],20,1163531501),s=ae(s,a,c,l,e[t+13],5,-1444681467),l=ae(l,s,a,c,e[t+2],9,-51403784),c=ae(c,l,s,a,e[t+7],14,1735328473),a=ae(a,c,l,s,e[t+12],20,-1926607734),s=ce(s,a,c,l,e[t+5],4,-378558),l=ce(l,s,a,c,e[t+8],11,-2022574463),c=ce(c,l,s,a,e[t+11],16,1839030562),a=ce(a,c,l,s,e[t+14],23,-35309556),s=ce(s,a,c,l,e[t+1],4,-1530992060),l=ce(l,s,a,c,e[t+4],11,1272893353),c=ce(c,l,s,a,e[t+7],16,-155497632),a=ce(a,c,l,s,e[t+10],23,-1094730640),s=ce(s,a,c,l,e[t+13],4,681279174),l=ce(l,s,a,c,e[t+0],11,-358537222),c=ce(c,l,s,a,e[t+3],16,-722521979),a=ce(a,c,l,s,e[t+6],23,76029189),s=ce(s,a,c,l,e[t+9],4,-640364487),l=ce(l,s,a,c,e[t+12],11,-421815835),c=ce(c,l,s,a,e[t+15],16,530742520),a=ce(a,c,l,s,e[t+2],23,-995338651),s=le(s,a,c,l,e[t+0],6,-198630844),l=le(l,s,a,c,e[t+7],10,1126891415),c=le(c,l,s,a,e[t+14],15,-1416354905),a=le(a,c,l,s,e[t+5],21,-57434055),s=le(s,a,c,l,e[t+12],6,1700485571),l=le(l,s,a,c,e[t+3],10,-1894986606),c=le(c,l,s,a,e[t+10],15,-1051523),a=le(a,c,l,s,e[t+1],21,-2054922799),s=le(s,a,c,l,e[t+8],6,1873313359),l=le(l,s,a,c,e[t+15],10,-30611744),c=le(c,l,s,a,e[t+6],15,-1560198380),a=le(a,c,l,s,e[t+13],21,1309151649),s=le(s,a,c,l,e[t+4],6,-145523070),l=le(l,s,a,c,e[t+11],10,-1120210379),c=le(c,l,s,a,e[t+2],15,718787259),a=le(a,c,l,s,e[t+9],21,-343485551),s=ie(s,n),a=ie(a,i),c=ie(c,r),l=ie(l,o);return[s,a,c,l]},de={hexdigest:function(e){return function(e){let t="";for(let n=0;n<4*e.length;n++)t+="0123456789abcdef".charAt(e[n>>2]>>n%4*8+4&15)+"0123456789abcdef".charAt(e[n>>2]>>n%4*8&15);return t}(ue(re(e),8*e.length))},hash:function(e){return function(e){let t="";for(let n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(ue(re(e),8*e.length))}};function he(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;var n,i,r,o,s,a,c,l,u=new Array(80),d=1732584193,h=-271733879,f=-1732584194,p=271733878,g=-1009589776;for(n=0;n<e.length;n+=16){for(o=d,s=h,a=f,c=p,l=g,i=0;i<80;i++)u[i]=i<16?e[n+i]:ve(u[i-3]^u[i-8]^u[i-14]^u[i-16],1),r=me(me(ve(d,5),fe(i,h,f,p)),me(me(g,u[i]),pe(i))),g=p,p=f,f=ve(h,30),h=d,d=r;d=me(d,o),h=me(h,s),f=me(f,a),p=me(p,c),g=me(g,l)}return[d,h,f,p,g]}function fe(e,t,n,i){return e<20?t&n|~t&i:e<40?t^n^i:e<60?t&n|t&i|n&i:t^n^i}function pe(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function ge(e,t){var n=_e(e);n.length>16&&(n=he(n,8*e.length));for(var i=new Array(16),r=new Array(16),o=0;o<16;o++)i[o]=909522486^n[o],r[o]=1549556828^n[o];var s=he(i.concat(_e(t)),512+8*t.length);return he(r.concat(s),672)}function me(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function ve(e,t){return e<<t|e>>>32-t}function _e(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function be(e){for(var t,n,i="",r=0;r<4*e.length;r+=3)for(t=(e[r>>2]>>8*(3-r%4)&255)<<16|(e[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|e[r+2>>2]>>8*(3-(r+2)%4)&255,n=0;n<4;n++)8*r+6*n>32*e.length?i+="=":i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>6*(3-n)&63);return i}function ye(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}const we={b64_hmac_sha1:function(e,t){return be(ge(e,t))},b64_sha1:function(e){return be(he(_e(e),8*e.length))},binb2str:ye,core_hmac_sha1:ge,str_hmac_sha1:function(e,t){return ye(ge(e,t))},str_sha1:function(e){return ye(he(_e(e),8*e.length))}},Se=function(e){var t,n,i="",r=e.length;for(t=0;t<r;t++)(n=e.charCodeAt(t))>=0&&n<=127?i+=e.charAt(t):n>2047?(i+=String.fromCharCode(224|n>>12&15),i+=String.fromCharCode(128|n>>6&63),i+=String.fromCharCode(128|n>>0&63)):(i+=String.fromCharCode(192|n>>6&31),i+=String.fromCharCode(128|n>>0&63));return i},xe=function(e){e=e||{};for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let n="",i="",r="";const o=e[t],s="object"==typeof o,a=escape(unescape(s?o.value:o));s&&(n=o.expires?";expires="+o.expires:"",i=o.domain?";domain="+o.domain:"",r=o.path?";path="+o.path:""),document.cookie=t+"="+a+n+i+r}};function Ee(e,t){return new Ce.Builder(e,t)}function Ae(e){return new Ce.Builder("iq",e)}function je(e){return new Ce.Builder("presence",e)}const Ce={VERSION:"@VERSION@",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(let t=0;t<Ce.XHTML.tags.length;t++)if(e===Ce.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if(void 0!==Ce.XHTML.attributes[e]&&Ce.XHTML.attributes[e].length>0)for(let n=0;n<Ce.XHTML.attributes[e].length;n++)if(t===Ce.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(let t=0;t<Ce.XHTML.css.length;t++)if(e===Ce.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10,BINDREQUIRED:11},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){Ce.NS[e]=t},forEachChild:function(e,t,n){for(let i=0;i<e.childNodes.length;i++){const r=e.childNodes[i];r.nodeType!==Ce.ElementType.NORMAL||t&&!this.isTagEqual(r,t)||n(r)}},isTagEqual:function(e,t){return e.tagName===t},_xmlGenerator:null,_makeGenerator:function(){let e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom(),e.appendChild(e.createElement("strophe"))):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return Ce._xmlGenerator||(Ce._xmlGenerator=Ce._makeGenerator()),Ce._xmlGenerator},_getIEXmlDom:function(){let e=null;const t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"];for(let n=0;n<t.length&&null===e;n++)try{e=new ActiveXObject(t[n])}catch(t){e=null}return e},xmlElement:function(e){if(!e)return null;const t=Ce.xmlGenerator().createElement(e);for(let e=1;e<arguments.length;e++){const n=arguments[e];if(n)if("string"==typeof n||"number"==typeof n)t.appendChild(Ce.xmlTextNode(n));else if("object"==typeof n&&"function"==typeof n.sort)for(let e=0;e<n.length;e++){const i=n[e];"object"==typeof i&&"function"==typeof i.sort&&void 0!==i[1]&&null!==i[1]&&t.setAttribute(i[0],i[1])}else if("object"==typeof n)for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&void 0!==n[e]&&null!==n[e]&&t.setAttribute(e,n[e])}return t},xmlescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(e){return Ce.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){let t;if(DOMParser){t=(new DOMParser).parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t},getText:function(e){if(!e)return null;let t="";0===e.childNodes.length&&e.nodeType===Ce.ElementType.TEXT&&(t+=e.nodeValue);for(let n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===Ce.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return Ce.xmlescape(t)},copyElement:function(e){let t;if(e.nodeType===Ce.ElementType.NORMAL){t=Ce.xmlElement(e.tagName);for(let n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].nodeName,e.attributes[n].value);for(let n=0;n<e.childNodes.length;n++)t.appendChild(Ce.copyElement(e.childNodes[n]))}else e.nodeType===Ce.ElementType.TEXT&&(t=Ce.xmlGenerator().createTextNode(e.nodeValue));return t},createHtml:function(e){let t;if(e.nodeType===Ce.ElementType.NORMAL){const n=e.nodeName.toLowerCase();if(Ce.XHTML.validTag(n))try{t=Ce.xmlElement(n);for(let i=0;i<Ce.XHTML.attributes[n].length;i++){const r=Ce.XHTML.attributes[n][i];let o=e.getAttribute(r);if(null!=o&&""!==o&&!1!==o&&0!==o)if("style"===r&&"object"==typeof o&&void 0!==o.cssText&&(o=o.cssText),"style"===r){const e=[],n=o.split(";");for(let t=0;t<n.length;t++){const i=n[t].split(":"),r=i[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(Ce.XHTML.validCSS(r)){const t=i[1].replace(/^\s*/,"").replace(/\s*$/,"");e.push(r+": "+t)}}e.length>0&&(o=e.join("; "),t.setAttribute(r,o))}else t.setAttribute(r,o)}for(let n=0;n<e.childNodes.length;n++)t.appendChild(Ce.createHtml(e.childNodes[n]))}catch(e){t=Ce.xmlTextNode("")}else{t=Ce.xmlGenerator().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(Ce.createHtml(e.childNodes[n]))}}else if(e.nodeType===Ce.ElementType.FRAGMENT){t=Ce.xmlGenerator().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(Ce.createHtml(e.childNodes[n]))}else e.nodeType===Ce.ElementType.TEXT&&(t=Ce.xmlTextNode(e.nodeValue));return t},escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){const t=Ce.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;{const e=t.split("@");return e.splice(0,1),e.join("@")}},getResourceFromJid:function(e){if(!e)return null;const t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(e){void 0!==e.stack&&Ce.fatal(e.stack),e.sourceURL?Ce.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?Ce.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):Ce.fatal("error: "+e.message)},log:function(e,t){e===this.LogLevel.FATAL&&"object"==typeof window.console&&"function"==typeof window.console.error&&window.console.error(t)},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){if(!e)return null;"function"==typeof e.tree&&(e=e.tree());const t=[...Array(e.attributes.length).keys()].map(t=>e.attributes[t].nodeName);t.sort();let n=t.reduce((t,n)=>`${t} ${n}="${Ce.xmlescape(e.attributes.getNamedItem(n).value)}"`,"<"+e.nodeName);if(e.childNodes.length>0){n+=">";for(let t=0;t<e.childNodes.length;t++){const i=e.childNodes[t];switch(i.nodeType){case Ce.ElementType.NORMAL:n+=Ce.serialize(i);break;case Ce.ElementType.TEXT:n+=Ce.xmlescape(i.nodeValue);break;case Ce.ElementType.CDATA:n+="<![CDATA["+i.nodeValue+"]]>"}}n+="</"+e.nodeName+">"}else n+="/>";return n},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){Ce._connectionPlugins[e]=t},Builder:function(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=Ce.NS.CLIENT:t||(t={xmlns:Ce.NS.CLIENT})),this.nodeTree=Ce.xmlElement(e,t),this.node=this.nodeTree}};Ce.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return Ce.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,n){const i=Ce.xmlElement(e,t,n);return this.node.appendChild(i),"string"!=typeof n&&"number"!=typeof n&&(this.node=i),this},cnode:function(e){let t;const n=Ce.xmlGenerator();try{t=void 0!==n.importNode}catch(e){t=!1}const i=t?n.importNode(e,!0):Ce.copyElement(e);return this.node.appendChild(i),this.node=i,this},t:function(e){const t=Ce.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){const t=document.createElement("body");t.innerHTML=e;const n=Ce.createHtml(t);for(;n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},Ce.Handler=function(e,t,n,i,r,o,s){this.handler=e,this.ns=t,this.name=n,this.type=i,this.id=r,this.options=s||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(Ce.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=o?Ce.getBareJidFromJid(o):null:this.from=o,this.user=!0},Ce.Handler.prototype={getNamespace:function(e){let t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){let t=!1;return!this.ns||(Ce.forEachChild(e,null,e=>{this.getNamespace(e)===this.ns&&(t=!0)}),t||this.getNamespace(e)===this.ns)},isMatch:function(e){let t=e.getAttribute("from");this.options.matchBareFromJid&&(t=Ce.getBareJidFromJid(t));const n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!Ce.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run:function(e){let t=null;try{t=this.handler(e)}catch(e){throw Ce._handleError(e),e}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},Ce.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},Ce.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},Ce.Connection=function(e,t){this.service=e,this.options=t||{};const n=this.options.protocol||"";0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===n.indexOf("ws")?this._proto=new Ce.Websocket(this):this._proto=new Ce.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(()=>this._onIdle(),100),xe(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms);for(const e in Ce._connectionPlugins)if(Object.prototype.hasOwnProperty.call(Ce._connectionPlugins,e)){const t=function(){};t.prototype=Ce._connectionPlugins[e],this[e]=new t,this[e].init(this)}},Ce.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},addProtocolErrorHandler:function(e,t,n){this.protocolErrorHandlers[e][t]=n},connect:function(e,t,n,i,r,o,s){this.jid=e,this.authzid=Ce.getBareJidFromJid(this.jid),this.authcid=s||Ce.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=Ce.getDomainFromJid(this.jid),this._changeConnectStatus(Ce.Status.CONNECTING,null),this._proto._connect(i,r,o)},attach:function(e,t,n,i,r,o,s){if(!(this._proto instanceof Ce.Bosh)){const e=new Error('The "attach" method can only be used with a BOSH connection.');throw e.name="StropheSessionError",e}this._proto._attach(e,t,n,i,r,o,s)},restore:function(e,t,n,i,r){if(!this._sessionCachingSupported()){const e=new Error('The "restore" method can only be used with a BOSH connection.');throw e.name="StropheSessionError",e}this._proto._restore(e,t,n,i,r)},_sessionCachingSupported:function(){if(this._proto instanceof Ce.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},nextValidRid:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(let t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(e,t,n,i){let r=null;"function"==typeof e.tree&&(e=e.tree());let o=e.getAttribute("id");if(o||(o=this.getUniqueId("sendPresence"),e.setAttribute("id",o)),"function"==typeof t||"function"==typeof n){const e=this.addHandler(e=>{r&&this.deleteTimedHandler(r),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)},null,"presence",null,o);i&&(r=this.addTimedHandler(i,()=>(this.deleteHandler(e),n&&n(null),!1)))}return this.send(e),o},sendIQ:function(e,t,n,i){let r=null;"function"==typeof e.tree&&(e=e.tree());let o=e.getAttribute("id");if(o||(o=this.getUniqueId("sendIQ"),e.setAttribute("id",o)),"function"==typeof t||"function"==typeof n){const e=this.addHandler(e=>{r&&this.deleteTimedHandler(r);const i=e.getAttribute("type");if("result"===i)t&&t(e);else{if("error"!==i){const e=new Error("Got bad IQ type of "+i);throw e.name="StropheError",e}n&&n(e)}},null,"iq",["error","result"],o);i&&(r=this.addTimedHandler(i,()=>(this.deleteHandler(e),n&&n(null),!1)))}return this.send(e),o},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes){const e=new Error("Cannot queue non-DOMElement.");throw e.name="StropheError",e}this._data.push(e)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(()=>this._onIdle(),100)},addTimedHandler:function(e,t){const n=new Ce.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,i,r,o,s){const a=new Ce.Handler(e,t,n,i,r,o,s);return this.addHandlers.push(a),a},deleteHandler:function(e){this.removeHandlers.push(e);const t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)},registerSASLMechanisms:function(e){this.mechanisms={},(e=e||[Ce.SASLAnonymous,Ce.SASLExternal,Ce.SASLMD5,Ce.SASLOAuthBearer,Ce.SASLXOAuth2,Ce.SASLPlain,Ce.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(e){this.mechanisms[e.prototype.name]=e},disconnect:function(e){if(this._changeConnectStatus(Ce.Status.DISCONNECTING,e),Ce.warn("Disconnect was called because: "+e),this.connected){let e=!1;this.disconnecting=!0,this.authenticated&&(e=je({xmlns:Ce.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else Ce.warn("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(e,t,n){for(const n in Ce._connectionPlugins)if(Object.prototype.hasOwnProperty.call(Ce._connectionPlugins,n)){const i=this[n];if(i.statusChanged)try{i.statusChanged(e,t)}catch(e){Ce.error(`${n} plugin caused an exception changing status: ${e}`)}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){Ce._handleError(e),Ce.error("User connection callback caused an exception: "+e)}},_doDisconnect:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),Ce.debug("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(Ce.Status.DISCONNECTED,e),this.connected=!1},_dataRecv:function(e,t){Ce.debug("_dataRecv called");const n=this._proto._reqToData(e);if(null===n)return;for(this.xmlInput!==Ce.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==Ce.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(Ce.serialize(n)));this.removeHandlers.length>0;){const e=this.removeHandlers.pop(),t=this.handlers.indexOf(e);t>=0&&this.handlers.splice(t,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();const i=n.getAttribute("type");if(null!==i&&"terminate"===i){if(this.disconnecting)return;let e=n.getAttribute("condition");const t=n.getElementsByTagName("conflict");return null!==e?("remote-stream-error"===e&&t.length>0&&(e="conflict"),this._changeConnectStatus(Ce.Status.CONNFAIL,e)):this._changeConnectStatus(Ce.Status.CONNFAIL,Ce.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(e)}Ce.forEachChild(n,null,e=>{const t=this.handlers;this.handlers=[];for(let n=0;n<t.length;n++){const i=t[n];try{(!i.isMatch(e)||!this.authenticated&&i.user||i.run(e))&&this.handlers.push(i)}catch(e){Ce.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})},mechanisms:{},_connect_cb:function(e,t,n){let i;Ce.debug("_connect_cb was called"),this.connected=!0;try{i=this._proto._reqToData(e)}catch(e){if(e.name!==Ce.ErrorCondition.BAD_FORMAT)throw e;this._changeConnectStatus(Ce.Status.CONNFAIL,Ce.ErrorCondition.BAD_FORMAT),this._doDisconnect(Ce.ErrorCondition.BAD_FORMAT)}if(!i)return;if(this.xmlInput!==Ce.Connection.prototype.xmlInput&&(i.nodeName===this._proto.strip&&i.childNodes.length?this.xmlInput(i.childNodes[0]):this.xmlInput(i)),this.rawInput!==Ce.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(Ce.serialize(i))),this._proto._connect_cb(i)===Ce.Status.CONNFAIL)return;let r;if(r=i.getElementsByTagNameNS?i.getElementsByTagNameNS(Ce.NS.STREAM,"features").length>0:i.getElementsByTagName("stream:features").length>0||i.getElementsByTagName("features").length>0,!r)return void this._proto._no_auth_received(t);const o=[],s=i.getElementsByTagName("mechanism");if(s.length>0)for(let e=0;e<s.length;e++){const t=Ce.getText(s[e]);this.mechanisms[t]&&o.push(this.mechanisms[t])}0!==o.length||0!==i.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(o):this._proto._no_auth_received(t)},sortMechanismsByPriority:function(e){for(let t=0;t<e.length-1;++t){let n=t;for(let i=t+1;i<e.length;++i)e[i].prototype.priority>e[n].prototype.priority&&(n=i);if(n!==t){const i=e[t];e[t]=e[n],e[n]=i}}return e},authenticate:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()},_attemptSASLAuth:function(e){e=this.sortMechanismsByPriority(e||[]);let t=!1;for(let n=0;n<e.length;++n){if(!e[n].prototype.test(this))continue;this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[n],this._sasl_mechanism.onStart(this);const i=Ee("auth",{xmlns:Ce.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){const e=this._sasl_mechanism.onChallenge(this,null);i.t(btoa(e))}this.send(i.tree()),t=!0;break}return t},_sasl_challenge_cb:function(e){const t=atob(Ce.getText(e)),n=this._sasl_mechanism.onChallenge(this,t),i=Ee("response",{xmlns:Ce.NS.SASL});return""!==n&&i.t(btoa(n)),this.send(i.tree()),!0},_attemptLegacyAuth:function(){null===Ce.getNodeFromJid(this.jid)?(this._changeConnectStatus(Ce.Status.CONNFAIL,Ce.ErrorCondition.MISSING_JID_NODE),this.disconnect(Ce.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(Ce.Status.AUTHENTICATING,null),this._addSysHandler(this._onLegacyAuthIQResult.bind(this),null,null,null,"_auth_1"),this.send(Ae({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:Ce.NS.AUTH}).c("username",{}).t(Ce.getNodeFromJid(this.jid)).tree()))},_onLegacyAuthIQResult:function(e){const t=Ae({type:"set",id:"_auth_2"}).c("query",{xmlns:Ce.NS.AUTH}).c("username",{}).t(Ce.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return Ce.getResourceFromJid(this.jid)||(this.jid=Ce.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(Ce.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1},_sasl_success_cb:function(e){if(this._sasl_data["server-signature"]){let t;const n=/([a-z]+)=([^,]+)(,|$)/,i=atob(Ce.getText(e)).match(n);if("v"===i[1]&&(t=i[2]),t!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}Ce.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);const t=[],n=(e,t)=>{for(;e.length;)this.deleteHandler(e.pop());return this._onStreamFeaturesAfterSASL(t),!1};return t.push(this._addSysHandler(e=>n(t,e),null,"stream:features",null,null)),t.push(this._addSysHandler(e=>n(t,e),Ce.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_onStreamFeaturesAfterSASL:function(e){this.features=e;for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}return this.do_bind?(this.options.explicitResourceBinding?this._changeConnectStatus(Ce.Status.BINDREQUIRED,null):this.bind(),!1):(this._changeConnectStatus(Ce.Status.AUTHFAIL,null),!1)},bind:function(){if(!this.do_bind)return void Ce.log(Ce.LogLevel.INFO,'Strophe.Connection.prototype.bind called but "do_bind" is false');this._addSysHandler(this._onResourceBindResultIQ.bind(this),null,null,null,"_bind_auth_2");const e=Ce.getResourceFromJid(this.jid);e?this.send(Ae({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:Ce.NS.BIND}).c("resource",{}).t(e).tree()):this.send(Ae({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:Ce.NS.BIND}).tree())},_onResourceBindResultIQ:function(e){if("error"===e.getAttribute("type")){let t;return Ce.warn("Resource binding failed."),e.getElementsByTagName("conflict").length>0&&(t=Ce.ErrorCondition.CONFLICT),this._changeConnectStatus(Ce.Status.AUTHFAIL,t,e),!1}const t=e.getElementsByTagName("bind");if(!(t.length>0))return Ce.warn("Resource binding failed."),this._changeConnectStatus(Ce.Status.AUTHFAIL,null,e),!1;{const e=t[0].getElementsByTagName("jid");e.length>0&&(this.jid=Ce.getText(e[0]),this.do_session?this._establishSession():(this.authenticated=!0,this._changeConnectStatus(Ce.Status.CONNECTED,null)))}},_establishSession:function(){if(!this.do_session)throw new Error(`Strophe.Connection.prototype._establishSession called but apparently ${Ce.NS.SESSION} wasn't advertised by the server`);this._addSysHandler(this._onSessionResultIQ.bind(this),null,null,null,"_session_auth_2"),this.send(Ae({type:"set",id:"_session_auth_2"}).c("session",{xmlns:Ce.NS.SESSION}).tree())},_onSessionResultIQ:function(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(Ce.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return Ce.warn("Session creation failed."),this._changeConnectStatus(Ce.Status.AUTHFAIL,null,e),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(Ce.Status.AUTHFAIL,null,e),!1},_auth2_cb:function(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(Ce.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(Ce.Status.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){const n=new Ce.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,i,r){const o=new Ce.Handler(e,t,n,i,r);return o.user=!1,this.addHandlers.push(o),o},_onDisconnectTimeout:function(){return Ce.debug("_onDisconnectTimeout was called"),this._changeConnectStatus(Ce.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){const e=this.removeTimeds.pop(),t=this.timedHandlers.indexOf(e);t>=0&&this.timedHandlers.splice(t,1)}const e=(new Date).getTime(),t=[];for(let n=0;n<this.timedHandlers.length;n++){const i=this.timedHandlers[n];if(this.authenticated||!i.user){i.lastCalled+i.period-e<=0?i.run()&&t.push(i):t.push(i)}}this.timedHandlers=t,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(()=>this._onIdle(),100))}},Ce.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},Ce.SASLMechanism.prototype={test:function(e){return!0},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},Ce.SASLAnonymous=function(){},Ce.SASLAnonymous.prototype=new Ce.SASLMechanism("ANONYMOUS",!1,20),Ce.SASLAnonymous.prototype.test=function(e){return null===e.authcid},Ce.SASLPlain=function(){},Ce.SASLPlain.prototype=new Ce.SASLMechanism("PLAIN",!0,50),Ce.SASLPlain.prototype.test=function(e){return null!==e.authcid},Ce.SASLPlain.prototype.onChallenge=function(e){let t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass,Se(t)},Ce.SASLSHA1=function(){},Ce.SASLSHA1.prototype=new Ce.SASLMechanism("SCRAM-SHA-1",!0,70),Ce.SASLSHA1.prototype.test=function(e){return null!==e.authcid},Ce.SASLSHA1.prototype.onChallenge=function(e,t,n){const i=n||de.hexdigest(""+1234567890*Math.random());let r="n="+Se(e.authcid);return r+=",r=",r+=i,e._sasl_data.cnonce=i,e._sasl_data["client-first-message-bare"]=r,r="n,,"+r,this.onChallenge=(e,t)=>{let n,i,r,o,s,a,c,l,u="c=biws,",d=`${e._sasl_data["client-first-message-bare"]},${t},`;const h=e._sasl_data.cnonce,f=/([a-z]+)=([^,]+)(,|$)/;for(;t.match(f);){const e=t.match(f);switch(t=t.replace(e[0],""),e[1]){case"r":n=e[2];break;case"s":i=e[2];break;case"i":r=e[2]}}if(n.substr(0,h.length)!==h)return e._sasl_data={},e._sasl_failure_cb();u+="r="+n,d+=u,i=atob(i),i+="\0\0\0";const p=Se(e.pass);for(o=a=we.core_hmac_sha1(p,i),c=1;c<r;c++){for(s=we.core_hmac_sha1(p,we.binb2str(a)),l=0;l<5;l++)o[l]^=s[l];a=s}o=we.binb2str(o);const g=we.core_hmac_sha1(o,"Client Key"),m=we.str_hmac_sha1(o,"Server Key"),v=we.core_hmac_sha1(we.str_sha1(we.binb2str(g)),d);for(e._sasl_data["server-signature"]=we.b64_hmac_sha1(m,d),l=0;l<5;l++)g[l]^=v[l];return u+=",p="+btoa(we.binb2str(g)),u},r},Ce.SASLMD5=function(){},Ce.SASLMD5.prototype=new Ce.SASLMechanism("DIGEST-MD5",!1,60),Ce.SASLMD5.prototype.test=function(e){return null!==e.authcid},Ce.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},Ce.SASLMD5.prototype.onChallenge=function(e,t,n){const i=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,r=n||de.hexdigest(""+1234567890*Math.random());let o="",s=null,a="",c="";for(;t.match(i);){const e=t.match(i);switch(t=t.replace(e[0],""),e[2]=e[2].replace(/^"(.+)"$/,"$1"),e[1]){case"realm":o=e[2];break;case"nonce":a=e[2];break;case"qop":c=e[2];break;case"host":s=e[2]}}let l=e.servtype+"/"+e.domain;null!==s&&(l=l+"/"+s);const u=Se(e.authcid+":"+o+":"+this._connection.pass),d=de.hash(u)+":"+a+":"+r,h="AUTHENTICATE:"+l;let f="";return f+="charset=utf-8,",f+="username="+this._quote(Se(e.authcid))+",",f+="realm="+this._quote(o)+",",f+="nonce="+this._quote(a)+",",f+="nc=00000001,",f+="cnonce="+this._quote(r)+",",f+="digest-uri="+this._quote(l)+",",f+="response="+de.hexdigest(de.hexdigest(d)+":"+a+":00000001:"+r+":auth:"+de.hexdigest(h))+",",f+="qop=auth",this.onChallenge=()=>"",f},Ce.SASLOAuthBearer=function(){},Ce.SASLOAuthBearer.prototype=new Ce.SASLMechanism("OAUTHBEARER",!0,40),Ce.SASLOAuthBearer.prototype.test=function(e){return null!==e.pass},Ce.SASLOAuthBearer.prototype.onChallenge=function(e){let t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",Se(t)},Ce.SASLExternal=function(){},Ce.SASLExternal.prototype=new Ce.SASLMechanism("EXTERNAL",!0,10),Ce.SASLExternal.prototype.onChallenge=function(e){return e.authcid===e.authzid?"":e.authzid},Ce.SASLXOAuth2=function(){},Ce.SASLXOAuth2.prototype=new Ce.SASLMechanism("X-OAUTH2",!0,30),Ce.SASLXOAuth2.prototype.test=function(e){return null!==e.pass},Ce.SASLXOAuth2.prototype.onChallenge=function(e){let t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,Se(t)};var ke={Strophe:Ce,$build:Ee,$iq:Ae,$msg:function(e){return new Ce.Builder("message",e)},$pres:je,SHA1:we,MD5:de,b64_hmac_sha1:we.b64_hmac_sha1,b64_sha1:we.b64_sha1,str_hmac_sha1:we.str_hmac_sha1,str_sha1:we.str_sha1};const Oe=ke.Strophe,Te=ke.$build;Oe.Websocket=function(e){this._conn=e,this.strip="wrapper";const t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){let n="";"ws"===e.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==t.indexOf("/")?n+=window.location.pathname+t:n+=t,e.service=n}},Oe.Websocket.prototype={_buildStream:function(){return Te("open",{xmlns:Oe.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,t){let n;if(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(Oe.NS.STREAM,"error"):e.getElementsByTagName("stream:error"),0===n.length)return!1;const i=n[0];let r="",o="";for(let e=0;e<i.childNodes.length;e++){const t=i.childNodes[e];if("urn:ietf:params:xml:ns:xmpp-streams"!==t.getAttribute("xmlns"))break;"text"===t.nodeName?o=t.textContent:r=t.nodeName}let s="WebSocket stream error: ";return s+=r||"unknown",o&&(s+=" - "+o),Oe.error(s),this._conn._changeConnectStatus(t,r),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){if(this._check_streamerror(e,Oe.Status.CONNFAIL))return Oe.Status.CONNFAIL},_handleStreamStart:function(e){let t=!1;const n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==Oe.NS.FRAMING&&(t="Wrong xmlns in <open />: "+n);const i=e.getAttribute("version");return"string"!=typeof i?t="Missing version in <open />":"1.0"!==i&&(t="Wrong version in <open />: "+i),!t||(this._conn._changeConnectStatus(Oe.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){const t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;const n=(new DOMParser).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){const t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(t),this._conn.rawInput(e.data);const n=t.getAttribute("see-other-uri");if(n){const e=this._conn.service;(e.indexOf("wss:")>=0&&n.indexOf("wss:")>=0||e.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(Oe.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=n,this._connect())}else this._conn._changeConnectStatus(Oe.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{const t=this._streamWrap(e.data),n=(new DOMParser).parseFromString(t,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(n,null,e.data)}},_disconnect:function(e){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);const t=Te("close",{xmlns:Oe.NS.FRAMING});this._conn.xmlOutput(t.tree());const n=Oe.serialize(t);this._conn.rawOutput(n);try{this.socket.send(n)}catch(e){Oe.warn("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){Oe.debug("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return"<wrapper>"+e+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()}catch(e){Oe.debug(e.message)}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(e){this._conn.connected&&!this._conn.disconnecting?(Oe.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(Oe.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(Oe.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):Oe.debug("Websocket closed")},_no_auth_received:function(e){Oe.error("Server did not offer a supported authentication mechanism"),this._conn._changeConnectStatus(Oe.Status.CONNFAIL,Oe.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){Oe.error("Websocket error "+e),this._conn._changeConnectStatus(Oe.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){const e=this._conn._data;if(e.length>0&&!this._conn.paused){for(let t=0;t<e.length;t++)if(null!==e[t]){let n;n="restart"===e[t]?this._buildStream().tree():e[t];const i=Oe.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(i),this.socket.send(i)}this._conn._data=[]}},_onMessage:function(e){let t;const n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{const n=this._streamWrap(e.data);t=(new DOMParser).parseFromString(n,"text/xml").documentElement}return this._check_streamerror(t,Oe.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(Oe.serialize(t))):void this._conn._dataRecv(t,e.data)},_onOpen:function(){Oe.debug("Websocket open");const e=this._buildStream();this._conn.xmlOutput(e.tree());const t=Oe.serialize(e);this._conn.rawOutput(t),this.socket.send(t)},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}};n(285);var Ne=n(41),Me=n.n(Ne),Ie=n(16);var Re=function(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))};function De(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function Pe(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}var Le=function(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(r){if("TypeError"!==r.name)throw r;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),i=0;i<e.length;i+=1)n.append(e[i]);return n.getBlob(t.type)}},ze="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Fe=/^~~local_forage_type~([^~]+)~/,Be="__lfsc__:".length,qe=Be+"arbf".length,Ue=Object.prototype.toString;function He(e){var t,n,i,r,o,s=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var l=new ArrayBuffer(s),u=new Uint8Array(l);for(t=0;t<a;t+=4)n=ze.indexOf(e[t]),i=ze.indexOf(e[t+1]),r=ze.indexOf(e[t+2]),o=ze.indexOf(e[t+3]),u[c++]=n<<2|i>>4,u[c++]=(15&i)<<4|r>>2,u[c++]=(3&r)<<6|63&o;return l}function $e(e){var t,n=new Uint8Array(e),i="";for(t=0;t<n.length;t+=3)i+=ze[n[t]>>2],i+=ze[(3&n[t])<<4|n[t+1]>>4],i+=ze[(15&n[t+1])<<2|n[t+2]>>6],i+=ze[63&n[t+2]];return n.length%3==2?i=i.substring(0,i.length-1)+"=":n.length%3==1&&(i=i.substring(0,i.length-2)+"=="),i}var We={serialize:function(e,t){var n="";if(e&&(n=Ue.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===Ue.call(e.buffer))){var i,r="__lfsc__:";e instanceof ArrayBuffer?(i=e,r+="arbf"):(i=e.buffer,"[object Int8Array]"===n?r+="si08":"[object Uint8Array]"===n?r+="ui08":"[object Uint8ClampedArray]"===n?r+="uic8":"[object Int16Array]"===n?r+="si16":"[object Uint16Array]"===n?r+="ur16":"[object Int32Array]"===n?r+="si32":"[object Uint32Array]"===n?r+="ui32":"[object Float32Array]"===n?r+="fl32":"[object Float64Array]"===n?r+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(r+$e(i))}else if("[object Blob]"===n){var o=new FileReader;o.onload=function(){var n="~~local_forage_type~"+e.type+"~"+$e(this.result);t("__lfsc__:blob"+n)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if("__lfsc__:"!==e.substring(0,Be))return JSON.parse(e);var t,n=e.substring(qe),i=e.substring(Be,qe);if("blob"===i&&Fe.test(n)){var r=n.match(Fe);t=r[1],n=n.substring(r[0].length)}var o=He(n);switch(i){case"arbf":return o;case"blob":return Le([o],{type:t});case"si08":return new Int8Array(o);case"ui08":return new Uint8Array(o);case"uic8":return new Uint8ClampedArray(o);case"si16":return new Int16Array(o);case"ur16":return new Uint16Array(o);case"si32":return new Int32Array(o);case"ui32":return new Uint32Array(o);case"fl32":return new Float32Array(o);case"fl64":return new Float64Array(o);default:throw new Error("Unkown type: "+i)}},stringToBuffer:He,bufferToString:$e};function Ve(e,t){let n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}const Ge={serializer:{serialize:We.serialize,deserialize:We.deserialize}};var Je={_driver:"sessionStorageWrapper",_initStorage:function(e){if(Ge.keyPrefix=Ve(e,this._defaultConfig),e)for(const t in e)Ge[t]=e[t]},_support:function(){try{if(sessionStorage&&"setItem"in sessionStorage)return!0}catch(e){console.log(e)}return!1}(),iterate:function(e,t){const n=this.ready().then((function(){const t=Ge.keyPrefix,n=t.length,i=sessionStorage.length;let r=1;for(let o=0;o<i;o++){const i=sessionStorage.key(o);if(0!==i.indexOf(t))continue;let s=sessionStorage.getItem(i);if(s&&(s=Ge.serializer.deserialize(s)),s=e(s,i.substring(n),r++),void 0!==s)return s}}));return Re(n,t),n},getItem:function(e,t){e=Pe(e);const n=this.ready().then((function(){let t=sessionStorage.getItem(Ge.keyPrefix+e);return t&&(t=Ge.serializer.deserialize(t)),t}));return Re(n,t),n},setItem:function(e,t,n){e=Pe(e);const i=this.ready().then((function(){void 0===t&&(t=null);const n=t;return new Promise((function(i,r){Ge.serializer.serialize(t,(function(t,o){if(o)r(o);else try{sessionStorage.setItem(Ge.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||r(e),r(e)}}))}))}));return Re(i,n),i},removeItem:function(e,t){e=Pe(e);const n=this.ready().then((function(){sessionStorage.removeItem(Ge.keyPrefix+e)}));return Re(n,t),n},clear:function(e){const t=this.ready().then((function(){const e=Ge.keyPrefix;for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}}));return Re(t,e),t},length:function(e){const t=this.keys().then((function(e){return e.length}));return Re(t,e),t},key:function(e,t){const n=this.ready().then((function(){let t;try{t=sessionStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(Ge.keyPrefix.length)),t}));return Re(n,t),n},keys:function(e){const t=this.ready().then((function(){const e=sessionStorage.length,t=[];for(let n=0;n<e;n++){const e=sessionStorage.key(n);0===e.indexOf(Ge.keyPrefix)&&t.push(e.substring(Ge.keyPrefix.length))}return t}));return Re(t,e),t},dropInstance:function(e,t){if(t=De.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){const t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}const n=this;let i;return i=e.name?new Promise((function(t){e.storeName?t(Ve(e,n._defaultConfig)):t(e.name+"/")})).then((function(e){for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}})):Promise.reject(new Error("Invalid arguments")),Re(i,t),i}};function Qe(){return(65536*(1+Math.random())|0).toString(16).substring(1)}class Ke{constructor(e,t){if("local"===t&&!window.localStorage)throw new Error("Skeletor.storage: Environment does not support localStorage.");if("session"===t&&!window.sessionStorage)throw new Error("Skeletor.storage: Environment does not support sessionStorage.");Object(i.isString)(t)?this.storeInitialized=this.initStore(t):(this.store=t,this.storeInitialized=Promise.resolve()),this.name=e}async initStore(e){if("session"===e)Ie.setDriver(Je._driver);else if("local"===e)await Ie.config({driver:Ie.LOCALSTORAGE});else if("indexed"!==e)throw new Error("Skeletor.storage: No storage type was specified");this.store=Ie}async clear(){await this.store.removeItem(this.name).catch(e=>console.error(e));const e=new RegExp(`^${this.name}-`),t=(await this.store.keys()).filter(t=>e.test(t));await Promise.all(t.map(e=>this.store.removeItem(e).catch(e=>console.error(e))))}sync(e){const t=this;async function n(e,n,r){let o,s,a,c;const l=n.collection;["patch","update"].includes(e)&&(c=Object(i.cloneDeep)(n.attributes)),await t.storeInitialized;try{const i=n.attributes;switch(e){case"read":o=void 0!==n.id?await t.find(n):await t.findAll();break;case"create":o=await t.create(n,r);break;case"patch":case"update":r.wait&&(n.attributes=c),a=t.update(n,r),r.wait&&(n.attributes=i),o=await a;break;case"delete":o=await t.destroy(n,l)}}catch(e){s=22===e.code&&0===t.getStorageSize()?"Private browsing is unsupported":e.message}if(o){if(r&&r.success){const t="read"===e?o:null;r.success(t,r)}}else s=s||"Record Not Found",r&&r.error&&r.error(s)}return n.__name__="localSync",n}removeCollectionReference(e,t){if(!t)return;const n=t.filter(t=>t.id!==e.id).map(e=>this.getItemName(e.id));return this.store.setItem(this.name,n)}addCollectionReference(e,t){if(!t)return;const n=t.map(e=>this.getItemName(e.id)),i=this.getItemName(e.id);return n.includes(i)||n.push(i),this.store.setItem(this.name,n)}async save(e,t={}){const n=this.getItemName(e.id),i=await this.store.setItem(n,e.toJSON());return await this.addCollectionReference(e,e.collection),i}create(e,t){return e.id||(e.id=Qe()+Qe()+"-"+Qe()+"-"+Qe()+"-"+Qe()+"-"+Qe()+Qe()+Qe(),e.set(e.idAttribute,e.id,t)),this.save(e)}update(e,t){return this.save(e,t)}find(e){return this.store.getItem(this.getItemName(e.id))}async findAll(){const e=await this.store.getItem(this.name);return e&&e.length?Promise.all(e.map(e=>this.store.getItem(e))):[]}async destroy(e,t){return await this.store.removeItem(this.getItemName(e.id)),await this.removeCollectionReference(e,t),e}getStorageSize(){return this.store.length}getItemName(e){return this.name+"-"+e}}Ke.sessionStorageInitialized=Ie.defineDriver(Je),Ke.localForage=Ie;var Ye,Xe,Ze,et,tt=Ke,nt=n(103),it=n.n(nt);const rt={debug:0,info:1,warn:2,error:3,fatal:4},ot=Object.assign({debug:(null===(Ye=console)||void 0===Ye?void 0:Ye.log)?console.log.bind(console):function(){},error:(null===(Xe=console)||void 0===Xe?void 0:Xe.log)?console.log.bind(console):function(){},info:(null===(Ze=console)||void 0===Ze?void 0:Ze.log)?console.log.bind(console):function(){},warn:(null===(et=console)||void 0===et?void 0:et.log)?console.log.bind(console):function(){}},console);var st={setLogLevel(e){if(!["debug","info","warn","error","fatal"].includes(e))throw new Error("Invalid loglevel: ".concat(e));this.loglevel=e},log(e,t,n=""){if(rt[t]<rt[this.loglevel])return;"error"===t||"fatal"===t?n=n||"color: maroon":"debug"===t&&(n=n||"color: green"),e instanceof Error?e=e.stack:Object(i.isElement)(e)&&(e=e.outerHTML);const r=n?"%c":"";"error"===t?ot.error("".concat(r," ERROR: ").concat(e),n):"warn"===t?ot.warn("".concat(r," ").concat((new Date).toISOString()," WARNING: ").concat(e),n):"fatal"===t?ot.error("".concat(r," FATAL: ").concat(e),n):"debug"===t?ot.debug("".concat(r," ").concat((new Date).toISOString()," DEBUG: ").concat(e),n):ot.info("".concat(r," ").concat((new Date).toISOString()," INFO: ").concat(e),n)},debug(e,t){this.log(e,"debug",t)},error(e,t){this.log(e,"error",t)},info(e,t){this.log(e,"info",t)},warn(e,t){this.log(e,"warn",t)},fatal(e,t){this.log(e,"fatal",t)}},at=n(104),ct=n.n(at),lt=n(25),ut=n.n(lt),dt=n(26),ht=n.n(dt),ft=n(20),pt=n.n(ft),gt=n(105),mt=n.n(gt),vt=n(37),_t=n.n(vt),bt=n(106),yt=n.n(bt),wt=n(18),St=n.n(wt),xt=n(56),Et=n.n(xt),At=n(107),jt=n.n(At),Ct=n(108),kt=n.n(Ct),Ot=n(55),Tt=n.n(Ot);function Nt(e,t){this.name=t,this.plugged=e,void 0===this.plugged.__super__?this.plugged.__super__={}:"string"==typeof this.plugged.__super__&&(this.plugged.__super__={__string__:this.plugged.__super__}),this.plugged.__super__[t]=this.plugged,this.plugins={},this.initialized_plugins=[]}ht()(Nt.prototype,{wrappedOverride:function(e,t,n,i){return"function"==typeof n&&(void 0===this.__super__&&(this.__super__=i),this.__super__[e]=n.bind(this)),t.apply(this,ct()(arguments,4))},_overrideAttribute:function(e,t){let n=t.overrides[e];if("function"==typeof n){let t={};t[this.name]=this.plugged;let i=Et()(this.wrappedOverride,e,n,this.plugged[e],t);this.plugged[e]=i}else this.plugged[e]=n},_extendObject:function(e,t){e.prototype.__super__||(e.prototype.__super__={},e.prototype.__super__[this.name]=this.plugged);let n=this;ut()(t,(function(t,i){if("events"===i)e.prototype[i]=ht()(t,e.prototype[i]);else if("function"==typeof t){let r={};r[n.name]=n.plugged;let o=Et()(n.wrappedOverride,i,t,e.prototype[i],r);e.prototype[i]=o}else e.prototype[i]=t}))},loadPluginDependencies:function(e){ut()(e.dependencies,t=>{let n=this.plugins[t];if(n){if(pt()(n.dependencies,e.__name__))throw'Found a circular dependency between the plugins "'+e.__name__+'" and "'+t+'"';this.initializePlugin(n)}else this.throwUndefinedDependencyError('Could not find dependency "'+t+'" for the plugin "'+e.__name__+"\". If it's needed, make sure it's loaded by require.js")})},throwUndefinedDependencyError:function(e){if(this.plugged.strict_plugin_dependencies)throw e;console.warn?console.warn(e):console.log(e)},applyOverrides:function(e){ut()(Object.keys(e.overrides||{}),t=>{let n=e.overrides[t];"object"==typeof n?void 0===this.plugged[t]?this.throwUndefinedDependencyError(`Plugin "${e.__name__}" tried to override "${t}" but it's not found.`):this._extendObject(this.plugged[t],n):this._overrideAttribute(t,e)})},initializePlugin:function(e){pt()(St()(this.allowed_plugins),e.__name__)&&(pt()(this.initialized_plugins,e.__name__)||(mt()(e.enabled)&&e.enabled||_t()(e.enabled)&&e.enabled(this.plugged)||yt()(e.enabled))&&(ht()(e,this.properties),e.dependencies&&this.loadPluginDependencies(e),this.applyOverrides(e),"function"==typeof e.initialize&&e.initialize.bind(e)(this),this.initialized_plugins.push(e.__name__)))},registerPlugin:function(e,t){if(e in this.plugins)throw new Error("Error: Plugin name "+e+" is already taken");t.__name__=e,this.plugins[e]=t},initializePlugins:function(e={},t=[],n=[]){kt()(this.plugins)&&(this.properties=e,this.allowed_plugins=jt()(this.plugins,(function(e,i){return(!t.length||t.length&&pt()(t,i))&&!pt()(n,i)})),ut()(Tt()(this.allowed_plugins),this.initializePlugin.bind(this)))}});var Mt={enable:function(e,t,n){void 0===n&&(n="pluginSocket"),void 0===t&&(t="plugged");let i={};return i[n]=new Nt(e,t),ht()(e,i)}},It=n(2),Rt=n.n(It);
/**
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 * @description This is the core utilities module.
 */
const Dt=ke.Strophe,Pt={isTagEqual:function(e,t){if(e.nodeTree)return Pt.isTagEqual(e.nodeTree,t);if(e instanceof Element)return Dt.isTagEqual(e,t);throw Error("isTagEqual called with value which isn't an element or Strophe.Builder instance")}},Lt=new DOMParser,zt=Lt.parseFromString("invalid","text/xml").getElementsByTagName("parsererror")[0].namespaceURI;
/**
 * Clears the specified timeout and interval.
 * @method u#clearTimers
 * @param {number} timeout - Id if the timeout to clear.
 * @param {number} interval - Id of the interval to clear.
 * @private
 * @copyright Simen Bekkhus 2016
 * @license MIT
 */
function Ft(e,t){clearTimeout(e),clearInterval(t)}
/**
 * Creates a {@link Promise} that resolves if the passed in function returns a truthy value.
 * Rejects if it throws or does not return truthy within the given max_wait.
 * @method u#waitUntil
 * @param {Function} func - The function called every check_delay,
 *  and the result of which is the resolved value of the promise.
 * @param {number} [max_wait=300] - The time to wait before rejecting the promise.
 * @param {number} [check_delay=3] - The time to wait before each invocation of {func}.
 * @returns {Promise} A promise resolved with the value of func,
 *  or rejected with the exception thrown by it or it times out.
 * @copyright Simen Bekkhus 2016
 * @license MIT
 */Pt.toStanza=function(e){const t=Lt.parseFromString(e,"text/xml");if(t.getElementsByTagNameNS(zt,"parsererror").length)throw new Error("Parser Error: ".concat(e));return t.firstElementChild},Pt.getLongestSubstring=function(e,t){return t.reduce((function(t,n){return e.startsWith(n)&&n.length>t.length?n:t}),"")},Pt.prefixMentions=function(e){let t=e.get("message");return(e.get("references")||[]).sort((e,t)=>t.begin-e.begin).forEach(e=>{t="".concat(t.slice(0,e.begin),"@").concat(t.slice(e.begin))}),t},Pt.isValidJID=function(e){return!!Object(i.isString)(e)&&(2===Object(i.compact)(e.split("@")).length&&!e.startsWith("@")&&!e.endsWith("@"))},Pt.isValidMUCJID=function(e){return!e.startsWith("@")&&!e.endsWith("@")},Pt.isSameBareJID=function(e,t){return!(!Object(i.isString)(e)||!Object(i.isString)(t))&&Dt.getBareJidFromJid(e).toLowerCase()===Dt.getBareJidFromJid(t).toLowerCase()},Pt.isSameDomain=function(e,t){return!(!Object(i.isString)(e)||!Object(i.isString)(t))&&Dt.getDomainFromJid(e).toLowerCase()===Dt.getDomainFromJid(t).toLowerCase()},Pt.isNewMessage=function(e){return e instanceof Element?!(Rt()('result[xmlns="'.concat(Dt.NS.MAM,'"]'),e).length&&Rt()('delay[xmlns="'.concat(Dt.NS.DELAY,'"]'),e).length):(e instanceof x&&(e=e.attributes),!(e.is_delayed&&e.is_archived))},Pt.shouldCreateMessage=function(e){return e.retracted||!Pt.isEmptyMessage(e)},Pt.shouldCreateGroupchatMessage=function(e){return e.nick&&(Pt.shouldCreateMessage(e)||e.is_tombstone)},Pt.isEmptyMessage=function(e){return e instanceof x&&(e=e.attributes),!(e.oob_url||e.file||e.is_encrypted&&e.plaintext||e.message)},Pt.isOnlyChatStateNotification=function(e){return e instanceof Element?null===e.querySelector("body")&&(null!==e.querySelector("active")||null!==e.querySelector("composing")||null!==e.querySelector("inactive")||null!==e.querySelector("paused")||null!==e.querySelector("gone")):(e instanceof x&&(e=e.attributes),e.chat_state&&Pt.isEmptyMessage(e))},Pt.isOnlyMessageDeliveryReceipt=function(e){return e instanceof Element?null===e.querySelector("body")&&null!==e.querySelector("received"):(e instanceof x&&(e=e.attributes),e.received&&Pt.isEmptyMessage(e))},Pt.isChatRoom=function(e){return e&&"chatroom"===e.get("type")},Pt.isErrorObject=function(e){return e instanceof Error},Pt.isErrorStanza=function(e){return!!Object(i.isElement)(e)&&"error"===e.getAttribute("type")},Pt.isForbiddenError=function(e){return!!Object(i.isElement)(e)&&Rt()('error[type="auth"] forbidden[xmlns="'.concat(Dt.NS.STANZAS,'"]'),e).length>0},Pt.isServiceUnavailableError=function(e){return!!Object(i.isElement)(e)&&Rt()('error[type="cancel"] service-unavailable[xmlns="'.concat(Dt.NS.STANZAS,'"]'),e).length>0},Pt.merge=function e(t,n){for(const r in n)Object(i.isObject)(t[r])?e(t[r],n[r]):t[r]=n[r]},Pt.applySiteSettings=function e(t,n,r){for(var o in n)void 0!==r[o]&&(Object(i.isObject)(n[o])&&!Array.isArray(n[o])?e(t[o],n[o],r[o]):t[o]=r[o])},Pt.stringToNode=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},Pt.getOuterWidth=function(e,t=!1){let n=e.offsetWidth;if(!t)return n;const i=window.getComputedStyle(e);return n+=parseInt(i.marginLeft?i.marginLeft:0,10)+parseInt(i.marginRight?i.marginRight:0,10),n},Pt.stringToElement=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},Pt.matchesSelector=function(e,t){const n=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector;return!!n&&n.call(e,t)},Pt.queryChildren=function(e,t){return Array.from(e.childNodes).filter(e=>Pt.matchesSelector(e,t))},Pt.contains=function(e,t){const n=(e,n)=>e.get(n).toLowerCase().includes(t.toLowerCase());return function(t){if("object"==typeof e)return Object.keys(e).reduce((e,i)=>e||n(t,i),!1);if("string"==typeof e)return n(t,e);throw new TypeError("contains: wrong attribute type. Must be string or array.")}},Pt.isOfType=function(e,t){return t.get("type")==e},Pt.isInstance=function(e,t){return t instanceof e},Pt.getAttribute=function(e,t){return t.get(e)},Pt.contains.not=function(e,t){return function(n){return!Pt.contains(e,t)(n)}},Pt.rootContains=function(e,t){return e!==document||e.contains?e.contains?e.contains(t):window.HTMLElement.prototype.contains.call(e,t):document.head.contains(t)||document.body.contains(t)},Pt.createFragmentFromText=function(e){var t,n=document.createDocumentFragment(),i=document.createElement("body");for(i.innerHTML=e;t=i.firstChild;)n.appendChild(t);return n},Pt.isPersistableModel=function(e){return e.collection&&e.collection.browserStorage},Pt.getResolveablePromise=function(){const e={isResolved:!1,isPending:!0,isRejected:!1},t=new Promise((t,n)=>{e.resolve=t,e.reject=n});return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t},Pt.interpolate=function(e,t){return e.replace(/{{{([^{}]*)}}}/g,(e,n)=>{var i=t[n];return"string"==typeof i||"number"==typeof i?i:e})},Pt.onMultipleEvents=function(e=[],t){let n=[];function i(i){n.push(i),e.length===n.length&&(t(n),n=[])}e.forEach(e=>e.object.on(e.event,i))},Pt.safeSave=function(e,t,n){Pt.isPersistableModel(e)?e.save(t,n):e.set(t,n)},Pt.siblingIndex=function(e){for(var t=0;e=e.previousElementSibling;t++);return t},Pt.getCurrentWord=function(e,t,n){t||(t=e.selectionEnd||void 0);let[i]=e.value.slice(0,t).split(" ").slice(-1);return n&&([i]=i.split(n).slice(-1)),i},Pt.replaceCurrentWord=function(e,t){const n=e.selectionEnd||void 0,r=Object(i.last)(e.value.slice(0,n).split(" ")),o=e.value;e.value=o.slice(0,n-r.length)+"".concat(t," ")+o.slice(n),e.selectionEnd=n-r.length+t.length+1},Pt.triggerEvent=function(e,t,n="Event",i=!0,r=!0){const o=document.createEvent(n);o.initEvent(t,i,r),e.dispatchEvent(o)},Pt.geoUriToHttp=function(e,t){return e.replace(/geo:([\-0-9.]+),([\-0-9.]+)(?:,([\-0-9.]+))?(?:\?(.*))?/g,t)},Pt.httpToGeoUri=function(e,t){return e.replace(t.api.settings.get("geouri_regex"),"geo:$1,$2")},Pt.getSelectValues=function(e){const t=[],n=e&&e.options;for(var i=0,r=n.length;i<r;i++){const e=n[i];e.selected&&t.push(e.value||e.text)}return t},Pt.formatFingerprint=function(e){e=e.replace(/^05/,"");for(let t=1;t<8;t++){const n=8*t+t-1;e=e.slice(0,n)+" "+e.slice(n)}return e},Pt.appendArrayBuffer=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer},Pt.arrayBufferToHex=function(e){return Array.prototype.map.call(new Uint8Array(e),e=>("00"+e.toString(16)).slice(-2)).join("")},Pt.arrayBufferToString=function(e){return new TextDecoder("utf-8").decode(e)},Pt.stringToArrayBuffer=function(e){return new TextEncoder("utf-8").encode(e).buffer},Pt.arrayBufferToBase64=function(e){return btoa(new Uint8Array(e).reduce((e,t)=>e+String.fromCharCode(t),""))},Pt.base64ToArrayBuffer=function(e){const t=window.atob(e),n=t.length,i=new Uint8Array(n);for(let e=0;e<n;e++)i[e]=t.charCodeAt(e);return i.buffer},Pt.getRandomInt=function(e){return Math.floor(Math.random()*Math.floor(e))},Pt.placeCaretAtEnd=function(e){e!==document.activeElement&&e.focus();const t=2*e.value.length;setTimeout(()=>e.setSelectionRange(t,t),1),this.scrollTop=999999},Pt.getUniqueId=function(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?"id"+t+":"+e:"id"+t},Pt.waitUntil=function(e,t=300,n=3){try{const t=e();if(t)return Promise.resolve(t)}catch(e){return Promise.reject(e)}const i=Pt.getResolveablePromise();const r=setInterval((function(){try{const t=e();t&&(Ft(o,r),i.resolve(t))}catch(e){Ft(o,r),i.reject(e)}}),n),o=setTimeout(()=>{Ft(o,r);const e="Wait until promise timed out";st.error(e),i.reject(new Error(e))},t);return i};var Bt=Pt;const qt=ke.Strophe,Ut=ke.$msg,{NS:Ht}=qt;function $t(e){const t=Rt()('spoiler[xmlns="'.concat(qt.NS.SPOILER,'"]'),e).pop();return{is_spoiler:!!t,spoiler_hint:null==t?void 0:t.textContent}}function Wt(e){const t=Rt()('x[xmlns="'.concat(qt.NS.OUTOFBAND,'"]'),e).pop();var n,i;return t?{oob_url:null===(n=t.querySelector("url"))||void 0===n?void 0:n.textContent,oob_desc:null===(i=t.querySelector("desc"))||void 0===i?void 0:i.textContent}:{}}function Vt(e,t){const n=Rt()('replace[xmlns="'.concat(qt.NS.MESSAGE_CORRECT,'"]'),e).pop();if(n){const e=n.getAttribute("id"),i=e;if(e){const n=Rt()('delay[xmlns="'.concat(qt.NS.DELAY,'"]'),t).pop();return{msgid:i,replace_id:e,edited:n?K()(n.getAttribute("stamp")).toISOString():(new Date).toISOString()}}}return{}}function Gt(e,t){var n;const i=Rt()('encrypted[xmlns="'.concat(qt.NS.OMEMO,'"]'),e).pop();if(!i||!t.config.get("trusted"))return{};const r=null===(n=t.omemo_store)||void 0===n?void 0:n.get("device_id"),o=r&&Rt()('key[rid="'.concat(r,'"]'),i).pop();if(o){var s;const e=i.querySelector("header");return{is_encrypted:!0,encrypted:{device_id:e.getAttribute("sid"),iv:e.querySelector("iv").textContent,key:o.textContent,payload:(null===(s=i.querySelector("payload"))||void 0===s?void 0:s.textContent)||null,prekey:["true","1"].includes(o.getAttribute("prekey"))}}}return{}}function Jt(e,t){return"me"!==t.sender&&!t.is_carbon&&!t.is_mam&&Rt()('request[xmlns="'.concat(qt.NS.RECEIPTS,'"]'),e).length}function Qt(e){const t=Rt()('received[xmlns="'.concat(qt.NS.RECEIPTS,'"]'),e).pop();return null==t?void 0:t.getAttribute("id")}function Kt(e){var t;return null===(t=Rt()('\n        composing[xmlns="'.concat(Ht.CHATSTATES,'"],\n        paused[xmlns="').concat(Ht.CHATSTATES,'"],\n        inactive[xmlns="').concat(Ht.CHATSTATES,'"],\n        active[xmlns="').concat(Ht.CHATSTATES,'"],\n        gone[xmlns="').concat(Ht.CHATSTATES,'"]'),e).pop())||void 0===t?void 0:t.nodeName}function Yt(e){const t=qt.NS.CARBONS;return Rt()('message > received[xmlns="'.concat(t,'"]'),e).length>0||Rt()('message > sent[xmlns="'.concat(t,'"]'),e).length>0}function Xt(e,t){const n={},i=Rt()('stanza-id[xmlns="'.concat(qt.NS.SID,'"]'),e).reduce((e,t)=>(e["stanza_id ".concat(t.getAttribute("by"))]=t.getAttribute("id"),e),{});Object.assign(n,i);const r=Rt()('message > result[xmlns="'.concat(qt.NS.MAM,'"]'),t).pop();if(r){const e=t.getAttribute("from");e?n["stanza_id ".concat(e)]=r.getAttribute("id"):n.stanza_id=r.getAttribute("id")}const o=Rt()('origin-id[xmlns="'.concat(qt.NS.SID,'"]'),e).pop();return o&&(n.origin_id=o.getAttribute("id")),n}function Zt(e,t){const n=Rt()('> apply-to[xmlns="'.concat(qt.NS.FASTEN,'"]'),e).pop();if(n){const e=n.getAttribute("id");if(Rt()('> retract[xmlns="'.concat(qt.NS.RETRACT,'"]'),n).pop()){const n=Rt()('delay[xmlns="'.concat(qt.NS.DELAY,'"]'),t).pop();return{editable:!1,retracted:n?K()(n.getAttribute("stamp")).toISOString():(new Date).toISOString(),retracted_id:e}}}else{const t=Rt()('> retracted[xmlns="'.concat(qt.NS.RETRACT,'"]'),e).pop();if(t)return{editable:!1,is_tombstone:!0,retracted:t.getAttribute("stamp")}}return{}}function en(e){var t;const n=null===(t=e.querySelector("body"))||void 0===t?void 0:t.textContent;return Rt()('reference[xmlns="'.concat(qt.NS.REFERENCE,'"]'),e).map(e=>{const t=e.getAttribute("begin"),i=e.getAttribute("end");return{begin:t,end:i,type:e.getAttribute("type"),value:n.slice(t,i),uri:e.getAttribute("uri")}})}function tn(e){if("error"===e.getAttribute("type")){var t;const n=e.querySelector("error");return(null===(t=n.querySelector("text"))||void 0===t?void 0:t.textContent)||ne("Sorry, an error occurred:")+" "+n.innerHTML}}function nn(e,t){xn.send(Ut({to:e.getAttribute("from"),type:"error",id:e.getAttribute("id")}).c("error",{type:"cancel"}).c("not-allowed",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("text",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).t(t)),st.warn("Rejecting message stanza with the following reason: ".concat(t)),st.warn(e)}function rn(e){if("error"===e.getAttribute("type")){const t=Rt()('error forbidden[xmlns="'.concat(qt.NS.STANZAS,'"]'),e).pop(),n=Rt()('error text[xmlns="'.concat(qt.NS.STANZAS,'"]'),e).pop();if(t){const e=ne("Your message was not delivered because you weren't allowed to send it."),t=n?ne('The message from the server is: "%1$s"',n.textContent):"";return t?"".concat(e," ").concat(t):e}return Rt()('not-acceptable[xmlns="'.concat(qt.NS.STANZAS,'"]'),e).length?ne("Your message was not delivered because you're not present in the groupchat."):null==n?void 0:n.textContent}}class on extends Error{constructor(e,t){super(e,t),this.name="StanzaParseError",this.stanza=t}}function sn(e){if(Rt()('message > forwarded[xmlns="'.concat(qt.NS.FORWARD,'"]'),e).length){nn(e,"Forwarded messages not part of an encapsulating protocol are not supported");const t=e.getAttribute("from");return new on("Ignoring unencapsulated forwarded message from ".concat(t),e)}}const an={isHeadline:e=>"headline"===e.getAttribute("type"),isServerMessage(e){const t=e.getAttribute("from");return!("error"===e.getAttribute("type")||!t||t.includes("@"))},getChatMarker:e=>Rt()('\n            acknowledged[xmlns="'.concat(qt.NS.MARKERS,'"],\n            displayed[xmlns="').concat(qt.NS.MARKERS,'"],\n            received[xmlns="').concat(qt.NS.MARKERS,'"]'),e).pop(),isArchived:e=>!!Rt()('message > result[xmlns="'.concat(qt.NS.MAM,'"]'),e).pop(),getAttributes:e=>e.getAttributeNames().reduce((t,n)=>(t[n]=qt.xmlunescape(e.getAttribute(n)),t),{}),async parseMessage(e,t){var n,i,r,o,s,a;const c=sn(e);if(c)return c;let l=e.getAttribute("to");const u=qt.getResourceFromJid(l);if(xn.settings.get("filter_by_resource")&&u&&u!==t.resource)return new on("Ignoring incoming message intended for a different resource: ".concat(l),e);let d=e.getAttribute("from")||t.bare_jid;if(Yt(e)){if(d!==t.bare_jid)return nn(e,"Rejecting carbon from invalid JID"),new on("Rejecting carbon from invalid JID ".concat(l),e);{const t='[xmlns="'.concat(qt.NS.CARBONS,'"] > forwarded[xmlns="').concat(qt.NS.FORWARD,'"] > message');l=(e=Rt()(t,e).pop()).getAttribute("to"),d=e.getAttribute("from")}}if(an.isArchived(e)){if(d!==t.bare_jid)return new on("Invalid Stanza: alleged MAM message from ".concat(e.getAttribute("from")),e);{const t='[xmlns="'.concat(qt.NS.MAM,'"] > forwarded[xmlns="').concat(qt.NS.FORWARD,'"] > message');l=(e=Rt()(t,e).pop()).getAttribute("to"),d=e.getAttribute("from")}}const h=qt.getBareJidFromJid(d),f=h===t.bare_jid;if(f&&null===l)return new on("Don't know how to handle message stanza without 'to' attribute. ".concat(e.outerHTML),e);const p=an.isHeadline(e),g=an.isServerMessage(e);let m,v;if(!p&&!g&&(v=f?qt.getBareJidFromJid(l):h,m=await xn.contacts.get(v),void 0===m&&!xn.settings.get("allow_non_roster_messaging")))return st.error(e),new on("Blocking messaging with a JID not in our roster because allow_non_roster_messaging is false.",e);const _=e,b=Rt()('delay[xmlns="'.concat(qt.NS.DELAY,'"]'),_).pop(),y=an.getChatMarker(e),w=(new Date).toISOString();let S=Object.assign({contact_jid:v,is_headline:p,is_server_message:g,body:null===(n=e.querySelector("body"))||void 0===n||null===(i=n.textContent)||void 0===i?void 0:i.trim(),chat_state:Kt(e),error:tn(e),from:qt.getBareJidFromJid(e.getAttribute("from")),is_archived:an.isArchived(_),is_carbon:Yt(_),is_delayed:!!b,is_markable:!!Rt()('markable[xmlns="'.concat(qt.NS.MARKERS,'"]'),e).length,is_marker:!!y,marker_id:y&&y.getAttribute("id"),msgid:e.getAttribute("id")||_.getAttribute("id"),nick:null===(r=m)||void 0===r||null===(o=r.attributes)||void 0===o?void 0:o.nickname,receipt_id:Qt(e),received:(new Date).toISOString(),references:en(e),sender:f?"me":"them",subject:null===(s=e.querySelector("subject"))||void 0===s?void 0:s.textContent,thread:null===(a=e.querySelector("thread"))||void 0===a?void 0:a.textContent,time:b?K()(b.getAttribute("stamp")).toISOString():w,to:e.getAttribute("to"),type:e.getAttribute("type")},Wt(e),$t(e),Vt(e,_),Xt(e,_),Zt(e,_),Gt(e,t));if(S.is_archived){const t=_.getAttribute("from");if(t&&v&&t!==v)return new on("Invalid Stanza: Forged MAM message from ".concat(t),e)}return S=Object.assign({message:S.body||S.error,is_only_emojis:!!S.body&&Bt.isOnlyEmojis(S.body),is_receipt_request:Jt(e,S)},S),S.id=S.origin_id||S["stanza_id ".concat(S.from)]||Bt.getUniqueId(),S},parseMUCMessage(e,t,n){var i,r,o,s;const a=sn(e);if(a)return a;const c='[xmlns="'.concat(Ht.MAM,'"] > forwarded[xmlns="').concat(Ht.FORWARD,'"] > message'),l=e;if(e=Rt()(c,e).pop()||e,Rt()('message > forwarded[xmlns="'.concat(qt.NS.FORWARD,'"]'),e).length)return new on("Invalid Stanza: Forged MAM groupchat message from ".concat(e.getAttribute("from")),e);const u=Rt()('delay[xmlns="'.concat(qt.NS.DELAY,'"]'),l).pop(),d=e.getAttribute("from"),h=an.getChatMarker(e),f=(new Date).toISOString();let p=Object.assign({from:d,body:null===(i=e.querySelector("body"))||void 0===i||null===(r=i.textContent)||void 0===r?void 0:r.trim(),chat_state:Kt(e),error:rn(e),from_muc:qt.getBareJidFromJid(d),is_archived:an.isArchived(l),is_carbon:Yt(l),is_delayed:!!u,is_headline:an.isHeadline(e),is_markable:!!Rt()('markable[xmlns="'.concat(qt.NS.MARKERS,'"]'),e).length,is_marker:!!h,marker_id:h&&h.getAttribute("id"),msgid:e.getAttribute("id")||l.getAttribute("id"),nick:qt.unescapeNode(qt.getResourceFromJid(d)),receipt_id:Qt(e),received:(new Date).toISOString(),references:en(e),subject:null===(o=e.querySelector("subject"))||void 0===o?void 0:o.textContent,thread:null===(s=e.querySelector("thread"))||void 0===s?void 0:s.textContent,time:u?K()(u.getAttribute("stamp")).toISOString():f,to:e.getAttribute("to"),type:e.getAttribute("type")},Wt(e),$t(e),Vt(e,l),Xt(e,l),Zt(e,l),function(e){const t=Rt()('apply-to[xmlns="'.concat(qt.NS.FASTEN,'"]'),e).pop();if(t){const e=t.getAttribute("id"),i=Rt()('moderated[xmlns="'.concat(qt.NS.MODERATE,'"]'),t).pop();if(i){var n;if(Rt()('retract[xmlns="'.concat(qt.NS.RETRACT,'"]'),i).pop())return{editable:!1,moderated:"retracted",moderated_by:i.getAttribute("by"),moderated_id:e,moderation_reason:null===(n=i.querySelector("reason"))||void 0===n?void 0:n.textContent}}}else{const t=Rt()('> moderated[xmlns="'.concat(qt.NS.MODERATE,'"]'),e).pop();if(t){var i;if(Rt()('retracted[xmlns="'.concat(qt.NS.RETRACT,'"]'),t).pop())return{editable:!1,is_tombstone:!0,moderated_by:t.getAttribute("by"),retracted:t.getAttribute("stamp"),moderation_reason:null===(i=t.querySelector("reason"))||void 0===i?void 0:i.textContent}}}return{}}(e),Gt(e,n));return p=Object.assign({is_only_emojis:!!p.body&&Bt.isOnlyEmojis(p.body),is_receipt_request:Jt(e,p),message:p.body||p.error,sender:p.nick===t.get("nick")?"me":"them"},p),p.is_archived&&l.getAttribute("from")!==p.from_muc?new on("Invalid Stanza: Forged MAM message from ".concat(l.getAttribute("from")),e):p.is_archived&&l.getAttribute("from")!==t.get("jid")?new on("Invalid Stanza: Forged MAM groupchat message from ".concat(e.getAttribute("from")),e):p.is_carbon?new on("Invalid Stanza: MUC messages SHOULD NOT be XEP-0280 carbon copied",e):(p.id=p.origin_id||p["stanza_id ".concat(p.from_muc||p.from)]||Bt.getUniqueId(),p)},parseMUCPresence(e){const t=e.getAttribute("from"),n=e.getAttribute("type"),i={from:t,nick:qt.getResourceFromJid(t),type:n,states:[],hats:[],show:"unavailable"!==n?"online":"offline"};return Array.from(e.children).forEach(e=>{if(e.matches("status"))i.status=e.textContent||null;else if(e.matches("show"))i.show=e.textContent||"online";else if(e.matches("x")&&e.getAttribute("xmlns")===qt.NS.MUC_USER)Array.from(e.children).forEach(e=>{"item"===e.nodeName?(i.affiliation=e.getAttribute("affiliation"),i.role=e.getAttribute("role"),i.jid=e.getAttribute("jid"),i.nick=e.getAttribute("nick")||i.nick):"status"==e.nodeName&&e.getAttribute("code")&&i.states.push(e.getAttribute("code"))});else if(e.matches("x")&&e.getAttribute("xmlns")===qt.NS.VCARDUPDATE){var t;i.image_hash=null===(t=e.querySelector("photo"))||void 0===t?void 0:t.textContent}else e.matches("hats")&&e.getAttribute("xmlns")===qt.NS.MUC_HATS&&(i.hats=Array.from(e.children).map(e=>e.matches("hat")&&{title:e.getAttribute("title"),uri:e.getAttribute("uri")}))}),i}};var cn=an;
/**
 * @module converse-core
 * @copyright The Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */const ln=ke.Strophe,un=ke.$build,dn=ke.$iq,hn=ke.$msg,fn=ke.$pres;K.a.extend(it.a),ln.addNamespace("CARBONS","urn:xmpp:carbons:2"),ln.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates"),ln.addNamespace("CSI","urn:xmpp:csi:0"),ln.addNamespace("DELAY","urn:xmpp:delay"),ln.addNamespace("FASTEN","urn:xmpp:fasten:0"),ln.addNamespace("FORWARD","urn:xmpp:forward:0"),ln.addNamespace("HINTS","urn:xmpp:hints"),ln.addNamespace("HTTPUPLOAD","urn:xmpp:http:upload:0"),ln.addNamespace("IDLE","urn:xmpp:idle:1"),ln.addNamespace("MAM","urn:xmpp:mam:2"),ln.addNamespace("MODERATE","urn:xmpp:message-moderate:0"),ln.addNamespace("NICK","http://jabber.org/protocol/nick"),ln.addNamespace("OMEMO","eu.siacs.conversations.axolotl"),ln.addNamespace("OUTOFBAND","jabber:x:oob"),ln.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),ln.addNamespace("REGISTER","jabber:iq:register"),ln.addNamespace("RETRACT","urn:xmpp:message-retract:0"),ln.addNamespace("ROSTERX","http://jabber.org/protocol/rosterx"),ln.addNamespace("RSM","http://jabber.org/protocol/rsm"),ln.addNamespace("SID","urn:xmpp:sid:0"),ln.addNamespace("SPOILER","urn:xmpp:spoiler:0"),ln.addNamespace("STANZAS","urn:ietf:params:xml:ns:xmpp-stanzas"),ln.addNamespace("VCARD","vcard-temp"),ln.addNamespace("VCARDUPDATE","vcard-temp:x:update"),ln.addNamespace("XFORM","jabber:x:data"),Me.a.templateSettings={escape:/\{\{\{([\s\S]+?)\}\}\}/g,evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g,imports:{_:Me.a}};class pn extends Error{}class gn extends Error{}const mn=["afterResourceBinding","connectionInitialized","initialized","pluginsInitialized"],vn=["converse-adhoc","converse-bookmarks","converse-bosh","converse-caps","converse-chatboxes","converse-chat","converse-disco","converse-emoji","converse-mam","converse-muc","converse-headlines","converse-ping","converse-pubsub","converse-roster","converse-rsm","converse-smacks","converse-status","converse-vcard"],_n={allow_non_roster_messaging:!1,assets_path:"/dist",authentication:"login",auto_login:!1,auto_reconnect:!0,blacklisted_plugins:[],connection_options:{},credentials_url:null,discover_connection_methods:!0,geouri_regex:/https\:\/\/www.openstreetmap.org\/.*#map=[0-9]+\/([\-0-9.]+)\/([\-0-9.]+)\S*/g,geouri_replacement:"https://www.openstreetmap.org/?mlat=$1&mlon=$2#map=18/$1/$2",idle_presence_timeout:300,i18n:"en",jid:void 0,keepalive:!0,loglevel:"info",locales:["af","ar","bg","ca","cs","de","eo","es","eu","en","fi","fr","gl","he","hi","hu","id","it","ja","nb","nl","mr","oc","pl","pt","pt_BR","ro","ru","tr","uk","vi","zh_CN","zh_TW"],message_carbons:!0,nickname:void 0,password:void 0,persistent_store:"localStorage",rid:void 0,root:window.document,sid:void 0,singleton:!1,strict_plugin_dependencies:!1,trusted:!0,view_mode:"overlayed",websocket_url:void 0,whitelisted_plugins:[]},bn={};bn[ln.Status.ATTACHED]="ATTACHED",bn[ln.Status.AUTHENTICATING]="AUTHENTICATING",bn[ln.Status.AUTHFAIL]="AUTHFAIL",bn[ln.Status.CONNECTED]="CONNECTED",bn[ln.Status.CONNECTING]="CONNECTING",bn[ln.Status.CONNFAIL]="CONNFAIL",bn[ln.Status.DISCONNECTED]="DISCONNECTED",bn[ln.Status.DISCONNECTING]="DISCONNECTING",bn[ln.Status.ERROR]="ERROR",bn[ln.Status.RECONNECTING]="RECONNECTING",bn[ln.Status.REDIRECT]="REDIRECT";const yn={log:st,CONNECTION_STATUS:bn,templates:{},promises:{},STATUS_WEIGHTS:{offline:6,unavailable:5,xa:4,away:3,dnd:2,chat:1,online:1},ANONYMOUS:"anonymous",CLOSED:"closed",EXTERNAL:"external",LOGIN:"login",LOGOUT:"logout",OPENED:"opened",PREBIND:"prebind",STANZA_TIMEOUT:1e4,SUCCESS:"success",FAILURE:"failure",DEFAULT_IMAGE_TYPE:"image/svg+xml",DEFAULT_IMAGE:"PD94bWwgdmVyc2lvbj0iMS4wIj8+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCI+CiA8cmVjdCB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgZmlsbD0iIzU1NSIvPgogPGNpcmNsZSBjeD0iNjQiIGN5PSI0MSIgcj0iMjQiIGZpbGw9IiNmZmYiLz4KIDxwYXRoIGQ9Im0yOC41IDExMiB2LTEyIGMwLTEyIDEwLTI0IDI0LTI0IGgyMyBjMTQgMCAyNCAxMiAyNCAyNCB2MTIiIGZpbGw9IiNmZmYiLz4KPC9zdmc+Cg==",TIMEOUTS:{PAUSED:1e4,INACTIVE:9e4},INACTIVE:"inactive",ACTIVE:"active",COMPOSING:"composing",PAUSED:"paused",GONE:"gone",PRIVATE_CHAT_TYPE:"chatbox",CHATROOMS_TYPE:"chatroom",HEADLINES_TYPE:"headline",CONTROLBOX_TYPE:"controlbox",default_connection_options:{explicitResourceBinding:!0},router:new U,TimeoutError:pn,IllegalMessage:gn,isTestEnv:()=>"MockConnection"===ln.Connection.name,__:ne,___:e=>e};let wn;function Sn(){var e;if(!yn.bare_jid){const e="No JID to fetch user settings for";throw st.error(e),Error(e)}if(!(null===(e=wn)||void 0===e?void 0:e.fetched)){const e="converse.user-settings.".concat(yn.bare_jid);wn=new x({id:e}),wn.browserStorage=yn.createStore(e),wn.fetched=wn.fetch({promise:!0})}return wn.fetched}yn.VERSION_NAME="v6.0.1dev",Object.assign(yn,h),Mt.enable(yn,"_converse","pluggable");const xn=yn.api={connection:{connected(){var e;return(null==yn||null===(e=yn.connection)||void 0===e?void 0:e.connected)&&!0},disconnect(){yn.connection&&yn.connection.disconnect()},async reconnect(){const e=yn.connfeedback.get("connection_status");if(xn.settings.get("authentication")===yn.ANONYMOUS&&(await An(),await On()),e===ln.Status.CONNFAIL?xn.connection.isType("websocket")&&xn.settings.get("bosh_service_url")?(await yn.setUserJID(yn.bare_jid),yn.connection._proto._doDisconnect(),yn.connection._proto=new ln.Bosh(yn.connection),yn.connection.service=xn.settings.get("bosh_service_url")):xn.connection.isType("bosh")&&xn.settings.get("websocket_url")&&(xn.settings.get("authentication")===yn.ANONYMOUS?await yn.setUserJID(xn.settings.get("jid")):await yn.setUserJID(yn.bare_jid),yn.connection._proto._doDisconnect(),yn.connection._proto=new ln.Websocket(yn.connection),yn.connection.service=xn.settings.get("websocket_url")):e===ln.Status.AUTHFAIL&&xn.settings.get("authentication")===yn.ANONYMOUS&&await yn.setUserJID(xn.settings.get("jid")),!yn.connection.reconnecting)return Cn();kn()},isType:e=>"websocket"===e.toLowerCase()?yn.connection._proto instanceof ln.Websocket:"bosh"===e.toLowerCase()?ln.BOSH&&yn.connection._proto instanceof ln.Bosh:void 0},async trigger(e){const t=Array.from(arguments),n=t.pop();if(n&&n.synchronous){const n=yn._events[e]||[];await Promise.all(n.map(e=>e.callback.apply(e.ctx,t.splice(1))))}else yn.trigger.apply(yn,arguments);const i=yn.promises[e];void 0!==i&&i.resolve()},hook(e,t,n){const i=yn._events[e]||[];if(i.length){const e=i.reduce((e,n)=>e.then(e=>n.callback(t,e)),Promise.resolve(n));return e.catch(e=>{throw st.error(e),e}),e}return n},user:{jid:()=>yn.connection.jid,async login(e,t,n=!1){(e||yn.jid)&&(e=await yn.setUserJID(e||yn.jid));const i=yn.pluggable.plugins["converse-bosh"];if(i&&i.enabled()){if(await yn.restoreBOSHSession())return;if(xn.settings.get("authentication")===yn.PREBIND&&(!n||xn.settings.get("auto_login")))return yn.startNewPreboundBOSHSession()}t=t||xn.settings.get("password"),async function(e,t){yn.api.settings.get("authentication")===yn.LOGIN?e?jn(e):yn.api.settings.get("credentials_url")?jn(await async function(){let e,t=0;for(;!e;){try{e=await Pn(t)}catch(e){st.error("Could not fetch login credentials"),st.error(e)}t=2e3}return e}()):yn.jid&&(yn.api.settings.get("password")||yn.connection.pass)?jn():!yn.isTestEnv()&&"credentials"in navigator?jn(await async function(){try{const e=await navigator.credentials.get({password:!0});if(e&&"password"==e.type&&Bt.isValidJID(e.id))return await yn.setUserJID(e.id),{jid:e.id,password:e.password}}catch(e){st.error(e)}}()):!yn.isTestEnv()&&st.warn("attemptNonPreboundSession: Couldn't find credentials to log in with"):![yn.ANONYMOUS,yn.EXTERNAL].includes(yn.api.settings.get("authentication"))||t&&!yn.api.settings.get("auto_login")||jn()}(e&&t?{jid:e,password:t}:null,n)},logout(){const e=Bt.getResolveablePromise(),t=()=>{Object.keys(yn.promises).forEach(En),delete yn.jid,xn.trigger("logout"),e.resolve()};return yn.setDisconnectionCause(yn.LOGOUT,void 0,!0),void 0!==yn.connection?(xn.listen.once("disconnected",()=>t()),yn.connection.disconnect()):t(),e},settings:{getModel:async()=>(await Sn(),wn),get:async(e,t)=>(await Sn(),void 0===wn.get(e)?t:wn.get(e)),async set(e,t){if(await Sn(),Object(i.isObject)(e))return wn.save(e,{promise:!0});{const n={};return n[e]=t,wn.save(n,{promise:!0})}},async clear(){await Sn(),wn.clear()}}},settings:{update(e){Bt.merge(_n,e),Bt.merge(yn,e),Bt.applySiteSettings(yn,e,Ln)},get(e){if(Object.keys(_n).includes(e))return yn[e]},set(e,t){const n={};Object(i.isObject)(e)?(Object(i.assignIn)(yn,Object(i.pick)(e,Object.keys(_n))),Object(i.assignIn)(yn.settings,Object(i.pick)(e,Object.keys(_n)))):Object(i.isString)("string")&&(n[e]=t,Object(i.assignIn)(yn,Object(i.pick)(n,Object.keys(_n))),Object(i.assignIn)(yn.settings,Object(i.pick)(n,Object.keys(_n))))}},promises:{add(e,t=!0){(e=Array.isArray(e)?e:[e]).forEach(e=>{const n=Bt.getResolveablePromise();n.replace=t,yn.promises[e]=n})}},listen:{once:yn.once.bind(yn),on:yn.on.bind(yn),not:yn.off.bind(yn),stanza(e,t,n){Object(i.isFunction)(t)?(n=t,t={}):t=t||{},yn.connection.addHandler(n,t.ns,e,t.type,t.id,t.from,t)}},waitUntil(e){if(Object(i.isFunction)(e))return Bt.waitUntil(e);{const t=yn.promises[e];return void 0===t?null:t}},send:e=>xn.connection.connected()?(Object(i.isString)(e)&&(e=Bt.toStanza(e)),"iq"===e.tagName?xn.sendIQ(e):(yn.connection.send(e),void xn.trigger("send",e))):(st.warn("Not sending stanza because we're not connected!"),void st.warn(ln.serialize(e))),sendIQ(e,t,n=!0){let i;return t=t||yn.STANZA_TIMEOUT,n?(i=new Promise((n,i)=>yn.connection.sendIQ(e,n,i,t)),i.catch(n=>{if(null===n)throw new pn("Timeout error after ".concat(t,"ms for the following IQ stanza: ").concat(ln.serialize(e)))})):i=new Promise(n=>yn.connection.sendIQ(e,n,n,t)),xn.trigger("send",e),i}};function En(e){const t=yn.promises[e];if(!t)throw new Error("Tried to replace non-existing promise: ".concat(e));if(t.replace){const n=Bt.getResolveablePromise();n.replace=t.replace,yn.promises[e]=n}else st.debug('Not replacing promise "'.concat(e,'"'))}async function An(){return await yn.api.trigger("beforeTearDown",{synchronous:!0}),window.removeEventListener("click",yn.onUserActivity),window.removeEventListener("focus",yn.onUserActivity),window.removeEventListener("keypress",yn.onUserActivity),window.removeEventListener("mousemove",yn.onUserActivity),window.removeEventListener(yn.unloadevent,yn.onUserActivity),window.clearInterval(yn.everySecondTrigger),yn.api.trigger("afterTearDown"),yn}function jn(e){if([yn.ANONYMOUS,yn.EXTERNAL].includes(yn.api.settings.get("authentication"))){if(!yn.jid)throw new Error("Config Error: when using anonymous login you need to provide the server's domain via the 'jid' option. Either when calling converse.initialize, or when calling _converse.api.user.login.");yn.connection.reconnecting||yn.connection.reset(),yn.connection.connect(yn.jid.toLowerCase(),null,yn.onConnectStatusChanged,59)}else if(yn.api.settings.get("authentication")===yn.LOGIN){var t;const n=e?e.password:(null===(t=yn.connection)||void 0===t?void 0:t.pass)||yn.api.settings.get("password");if(!n){if(yn.api.settings.get("auto_login"))throw new Error("autoLogin: If you use auto_login and authentication='login' then you also need to provide a password.");return yn.setDisconnectionCause(ln.Status.AUTHFAIL,void 0,!0),void yn.api.connection.disconnect()}yn.connection.reconnecting||yn.connection.reset(),yn.connection.connect(yn.jid,n,yn.onConnectStatusChanged,59)}}async function Cn(){return st.debug("RECONNECTING: the connection has dropped, attempting to reconnect."),yn.setConnectionStatus(ln.Status.RECONNECTING,ne("The connection has dropped, attempting to reconnect.")),yn.api.trigger("will-reconnect"),yn.connection.reconnecting=!0,await An(),yn.api.user.login()}yn.haveResumed=function(){return yn.api.connection.isType("bosh")?yn.connfeedback.get("connection_status")===ln.Status.ATTACHED:!yn.connection.do_bind},yn.isUniView=function(){return["mobile","fullscreen","embedded"].includes(xn.settings.get("view_mode"))},yn.createStore=function(e,t){const n=yn.storage[t||yn.config.get("storage")];return new tt(e,n)};const kn=Object(i.debounce)(Cn,2e3);function On(){return void 0!==yn.session&&(yn.session.destroy(),delete yn.session),yn.shouldClearCache()&&yn.api.user.settings.clear(),yn.api.trigger("clearSession",{synchronous:!0})}async function Tn(e){const t={mode:"cors",headers:{Accept:"application/xrd+xml, text/xml"}},n="https://".concat(e,"/.well-known/host-meta");let i;try{i=await fetch(n,t)}catch(e){return st.error("Failed to discover alternative connection methods at ".concat(n)),void st.error(e)}i.status>=200&&i.status<400?await async function(e){const t=await e.text(),n=(new window.DOMParser).parseFromString(t,"text/xml").firstElementChild;if("XRD"!=n.nodeName||"http://docs.oasis-open.org/ns/xri/xrd-1.0"!=n.namespaceURI)return st.warn("Could not discover XEP-0156 connection methods");const i=Rt()('Link[rel="urn:xmpp:alt-connections:xbosh"]',n),r=Rt()('Link[rel="urn:xmpp:alt-connections:websocket"]',n),o=i.map(e=>e.getAttribute("href")),s=r.map(e=>e.getAttribute("href"));yn.api.settings.set("websocket_url",s.pop()),yn.api.settings.set("bosh_service_url",o.pop()),0===o.length&&0===s.length&&st.warn("onDomainDiscovered: neither BOSH nor WebSocket connection methods have been specified with XEP-0156.")}(i):st.warn("Could not discover XEP-0156 connection methods")}async function Nn(e){const t=ln.getBareJidFromJid(e).toLowerCase(),n="converse.session-".concat(t);yn.session&&yn.session.get("id")===n?Mn(e):(yn.session=new x({id:n}),yn.session.browserStorage=yn.createStore(n,"session"),await new Promise(e=>yn.session.fetch({success:e,error:e})),yn.session.get("active")&&(yn.session.clear(),yn.session.save({id:n})),Mn(e),function(){if("persistent"!==yn.config.get("storage"))return;const e={name:yn.isTestEnv()?"converse-test-persistent":"converse-persistent",storeName:yn.bare_jid};"localStorage"===yn.api.settings.get("persistent_store")?(e.description="localStorage instance",e.driver=[tt.localForage.LOCALSTORAGE]):"IndexedDB"===yn.api.settings.get("persistent_store")&&(e.description="indexedDB instance",e.driver=[tt.localForage.INDEXEDDB]),yn.storage.persistent=tt.localForage.createInstance(e)}(),yn.api.trigger("userSessionInitialized"))}function Mn(e){e=yn.session.get("jid")||e,yn.api.settings.get("authentication")===yn.ANONYMOUS||ln.getResourceFromJid(e)||(e=e.toLowerCase()+yn.generateResource()),yn.jid=e,yn.bare_jid=ln.getBareJidFromJid(e),yn.resource=ln.getResourceFromJid(e),yn.domain=ln.getDomainFromJid(e),yn.session.save({jid:e,bare_jid:yn.bare_jid,resource:yn.resource,domain:yn.domain,active:!0}),yn.connection.jid=e}function In(){yn.router.history.stop(),document.removeEventListener("visibilitychange",yn.saveWindowState),xn.trigger("unregisteredGlobalEventHandlers"),delete yn.controlboxtoggle,yn.chatboxviews&&delete yn.chatboxviews,yn.connection&&yn.connection.reset(),yn.stopListening(),yn.off()}async function Rn(e){delete yn.connection.reconnecting,yn.connection.flush(),await yn.setUserJID(yn.connection.jid),await xn.trigger("afterResourceBinding",e,{synchronous:!0}),function(){if(!xn.settings.get("message_carbons")||!yn.session||yn.session.get("carbons_enabled"))return;const e=new ln.Builder("iq",{from:yn.connection.jid,id:"enablecarbons",type:"set"}).c("enable",{xmlns:ln.NS.CARBONS});yn.connection.addHandler(e=>{e.querySelectorAll("error").length>0?st.warn("An error occurred while trying to enable message carbons."):(yn.session.save({carbons_enabled:!0}),st.debug("Message carbons have been enabled."))},null,"iq",null,"enablecarbons"),yn.connection.send(e)}(),e?xn.trigger("reconnected"):(xn.trigger("initialized"),xn.trigger("connected"))}async function Dn(){st.debug("DISCONNECTED"),delete yn.connection.reconnecting,yn.connection.reset(),An(),await On(),delete yn.connection,xn.trigger("disconnected")}function Pn(e=0){return new Promise(Object(i.debounce)((e,t)=>{const n=new XMLHttpRequest;n.open("GET",xn.settings.get("credentials_url"),!0),n.setRequestHeader("Accept","application/json, text/javascript"),n.onload=()=>{if(n.status>=200&&n.status<400){const t=JSON.parse(n.responseText);yn.setUserJID(t.jid).then(()=>{e({jid:t.jid,password:t.password})})}else t(new Error("".concat(n.status,": ").concat(n.responseText)))},n.onerror=t,n.send()},e))}let Ln;yn.shouldClearCache=()=>!yn.config.get("trusted")||yn.isTestEnv(),yn.initConnection=async function(e){if(yn.api.settings.get("discover_connection_methods")&&await Tn(e),!yn.api.settings.get("bosh_service_url")){if(yn.api.settings.get("authentication")===yn.PREBIND)throw new Error("authentication is set to 'prebind' but we don't have a BOSH connection");if(!yn.api.settings.get("websocket_url"))throw new Error("initConnection: you must supply a value for either the bosh_service_url or websocket_url or both.")}if(("WebSocket"in window||"MozWebSocket"in window)&&yn.api.settings.get("websocket_url"))yn.connection=new ln.Connection(yn.api.settings.get("websocket_url"),Object.assign(yn.default_connection_options,yn.api.settings.get("connection_options")));else{if(!yn.api.settings.get("bosh_service_url"))throw new Error("initConnection: this browser does not support websockets and bosh_service_url wasn't specified.");yn.connection=new ln.Connection(yn.api.settings.get("bosh_service_url"),Object.assign(yn.default_connection_options,yn.api.settings.get("connection_options"),{keepalive:yn.api.settings.get("keepalive")}))}!function(){const e={};e[ln.LogLevel.DEBUG]="debug",e[ln.LogLevel.INFO]="info",e[ln.LogLevel.WARN]="warn",e[ln.LogLevel.ERROR]="error",e[ln.LogLevel.FATAL]="fatal",ln.log=(t,n)=>st.log(n,e[t]),ln.error=e=>st.error(e),yn.connection.xmlInput=e=>st.debug(e.outerHTML,"color: darkgoldenrod"),yn.connection.xmlOutput=e=>st.debug(e.outerHTML,"color: darkcyan")}(),yn.api.trigger("connectionInitialized")},yn.setUserJID=async function(e){if(!yn.connection||!Bt.isSameDomain(yn.connection.jid,e)){const t=ln.getDomainFromJid(e);await yn.initConnection(t)}return await Nn(e),yn.api.trigger("setUserJID"),e},yn.generateResource=()=>"/converse.js-".concat(Math.floor(139749528*Math.random()).toString()),yn.onConnectStatusChanged=function(e,t){if(st.debug("Status changed to: ".concat(yn.CONNECTION_STATUS[e])),e===ln.Status.CONNECTED||e===ln.Status.ATTACHED)yn.setConnectionStatus(e),yn.send_initial_presence=!0,yn.setDisconnectionCause(),yn.connection.reconnecting?(st.debug(e===ln.Status.CONNECTED?"Reconnected":"Reattached"),Rn(!0)):(st.debug(e===ln.Status.CONNECTED?"Connected":"Attached"),yn.connection.restored&&(yn.send_initial_presence=!1),Rn());else if(e===ln.Status.DISCONNECTED)yn.setDisconnectionCause(e,t),yn.onDisconnected();else if(e===ln.Status.BINDREQUIRED)yn.bindResource();else if(e===ln.Status.ERROR)yn.setConnectionStatus(e,ne("An error occurred while connecting to the chat server."));else if(e===ln.Status.CONNECTING)yn.setConnectionStatus(e);else if(e===ln.Status.AUTHENTICATING)yn.setConnectionStatus(e);else if(e===ln.Status.AUTHFAIL)t||(t=ne("Your XMPP address and/or password is incorrect. Please try again.")),yn.setConnectionStatus(e,t),yn.setDisconnectionCause(e,t,!0),yn.onDisconnected();else if(e===ln.Status.CONNFAIL){var n;let i=t;"host-unknown"===t||"remote-connection-failed"==t?i=ne("Sorry, we could not connect to the XMPP host with domain: %1$s",'"'.concat(ln.getDomainFromJid(yn.connection.jid),'"')):void 0!==t&&t===(null==ln||null===(n=ln.ErrorCondition)||void 0===n?void 0:n.NO_AUTH_MECH)&&(i=ne("The XMPP server did not offer a supported authentication mechanism")),yn.setConnectionStatus(e,i),yn.setDisconnectionCause(e,t)}else e===ln.Status.DISCONNECTING&&yn.setDisconnectionCause(e,t)},yn.setConnectionStatus=function(e,t){yn.connfeedback.set({connection_status:e,message:t})},yn.setDisconnectionCause=function(e,t,n){void 0===e?(delete yn.disconnection_cause,delete yn.disconnection_reason):(void 0===yn.disconnection_cause||n)&&(yn.disconnection_cause=e,yn.disconnection_reason=t)},yn.saveWindowState=function(e){let t;const n={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};t=(e=e||document.createEvent("Events")).type in n?n[e.type]:document.hidden?"hidden":"visible",yn.windowState=t,xn.trigger("windowStateChanged",{state:t})},yn.onDisconnected=function(){if(!xn.settings.get("auto_reconnect"))return Dn();{const e=yn.disconnection_reason;if(yn.disconnection_cause===ln.Status.AUTHFAIL)return xn.settings.get("credentials_url")||xn.settings.get("authentication")===yn.ANONYMOUS?xn.connection.reconnect():Dn();if(yn.disconnection_cause===yn.LOGOUT||e===ln.ErrorCondition.NO_AUTH_MECH||"host-unknown"===e||"remote-connection-failed"===e)return Dn();xn.connection.reconnect()}},yn.bindResource=async function(){await xn.trigger("beforeResourceBinding",{synchronous:!0}),yn.connection.bind()},yn.ConnectionFeedback=x.extend({defaults:{connection_status:ln.Status.DISCONNECTED,message:""},initialize(){this.on("change",()=>xn.trigger("connfeedback",yn.connfeedback))}});const zn=window.converse||{};Object.assign(zn,{CHAT_STATES:["active","composing","gone","inactive","paused"],keycodes:{TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESCAPE:27,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,FORWARD_SLASH:47,AT:50,META:91,META_RIGHT:93},async initialize(e){if(In(),mn.forEach(e=>xn.promises.add(e)),"onpagehide"in window?yn.unloadevent="pagehide":"onbeforeunload"in window?yn.unloadevent="beforeunload":"onunload"in window&&(yn.unloadevent="unload"),function(e){yn.settings={},Object(i.assignIn)(yn.settings,_n),Object(i.assignIn)(yn.settings,Object(i.pick)(e,Object.keys(_n))),Object(i.assignIn)(yn,yn.settings),Ln=e}(e),yn.strict_plugin_dependencies=e.strict_plugin_dependencies,st.setLogLevel(xn.settings.get("loglevel")),xn.settings.get("authentication")===yn.ANONYMOUS&&xn.settings.get("auto_login")&&!xn.settings.get("jid"))throw new Error("Config Error: you need to provide the server's domain via the 'jid' option when using anonymous authentication with auto_login.");yn.router.route(/^converse\?loglevel=(debug|info|warn|error|fatal)$/,"loglevel",e=>st.setLogLevel(e)),async function(){if(yn.isTestEnv())yn.locale="en";else try{yn.locale=te.getLocale(xn.settings.get("i18n"),xn.settings.get("locales")),await te.fetchTranslations(yn)}catch(e){st.fatal(e.message),yn.locale="en"}}(),yn.connfeedback=new yn.ConnectionFeedback,yn.send_initial_presence=!0,await async function(){await tt.sessionStorageInitialized,yn.storage={session:tt.localForage.createInstance({name:yn.isTestEnv()?"converse-test-session":"converse-session",description:"sessionStorage instance",driver:["sessionStorageWrapper"]})}}(),function(){const e="converse.client-config";yn.config=new x({id:e,trusted:!!yn.api.settings.get("trusted"),storage:yn.api.settings.get("trusted")?"persistent":"session"}),yn.config.browserStorage=yn.createStore(e,"session"),yn.config.fetch(),yn.api.trigger("clientConfigInitialized")}(),function(){yn.pluggable.initialized_plugins=[];const e=vn.concat(yn.api.settings.get("whitelisted_plugins"));yn.api.settings.get("singleton")&&["converse-bookmarks","converse-controlbox","converse-headline","converse-register"].forEach(e=>yn.api.settings.get("blacklisted_plugins").push(e)),yn.pluggable.initializePlugins({_converse:yn},e,yn.api.settings.get("blacklisted_plugins")),yn.api.trigger("pluginsInitialized")}(),document.addEventListener("visibilitychange",yn.saveWindowState),yn.saveWindowState({type:document.hidden?"blur":"focus"}),xn.trigger("registeredGlobalEventHandlers"),!History.started&&yn.router.history.start(),xn.settings.get("idle_presence_timeout")>0&&xn.listen.on("addClientFeatures",()=>xn.disco.own.features.add(ln.NS.IDLE));const t=yn.pluggable.plugins;if((xn.settings.get("auto_login")||xn.settings.get("keepalive")&&Object(i.invoke)(t["converse-bosh"],"enabled"))&&await xn.user.login(null,null,!0),yn.isTestEnv())return yn},plugins:{add(e,t){if(t.__name__=e,void 0!==yn.pluggable.plugins[e])throw new TypeError('Error: plugin with name "'.concat(e,'" has already been ')+"registered!");yn.pluggable.plugins[e]=t}},env:{$build:un,$iq:dn,$msg:hn,$pres:fn,Model:x,Collection:A,Promise:Promise,Strophe:ln,_:Me.a,dayjs:K.a,log:st,sizzle:Rt.a,stanza_utils:cn,u:Bt,utils:Bt}});const Fn=new CustomEvent("converse-loaded");Fn.converse=zn,window.dispatchEvent(Fn);const{Strophe:Bn}=zn.env;let qn,Un;Bn.addNamespace("ADHOC","http://jabber.org/protocol/commands");const Hn={adhoc:{async getCommands(e){let t=[];try{n=await Un.disco.items(e,Bn.NS.ADHOC),t=Rt()('query[xmlns="'.concat(Bn.NS.DISCO_ITEMS,'"][node="').concat(Bn.NS.ADHOC,'"] item'),n).map(cn.getAttributes)}catch(t){null===t?st.error("Error: timeout while fetching ad-hoc commands for ".concat(e)):(st.error("Error while fetching ad-hoc commands for ".concat(e)),st.error(t))}var n;return t}}};zn.plugins.add("converse-adhoc",{dependencies:["converse-disco"],initialize(){qn=this._converse,Un=qn.api,Object.assign(Un,Hn)}});var $n=n(109),Wn=n.n($n);
/**
 * @module converse-chat
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{$msg:Vn,Strophe:Gn,sizzle:Jn,utils:Qn}=zn.env,Kn=zn.env.utils;zn.plugins.add("converse-chat",{dependencies:["converse-chatboxes","converse-disco"],initialize(){const{__:e}=yn;xn.settings.update({allow_message_corrections:"all",allow_message_retraction:"all",auto_join_private_chats:[],clear_messages_on_reconnection:!1,filter_by_resource:!1,send_chat_state_notifications:!0});const t=x.extend({initialize(){this.rosterContactAdded=Kn.getResolveablePromise()},async setRosterContact(e){const t=await xn.contacts.get(e);t&&(this.contact=t,this.set("nickname",t.get("nickname")),this.rosterContactAdded.resolve())}});yn.Message=t.extend({defaults:()=>({msgid:Kn.getUniqueId(),time:(new Date).toISOString(),is_ephemeral:!1}),async initialize(){this.checkValidity()&&(this.initialized=Kn.getResolveablePromise(),"chat"===this.get("type")&&(t.prototype.initialize.apply(this,arguments),this.setRosterContact(Gn.getBareJidFromJid(this.get("from")))),this.get("file")&&this.on("change:put",this.uploadFile,this),this.setTimerForEphemeralMessage(),await xn.trigger("messageInitialized",this,{Synchronous:!0}),this.initialized.resolve())},setTimerForEphemeralMessage(){const e=()=>{this.ephemeral_timer=window.setTimeout(this.safeDestroy.bind(this),1e4)};return this.isEphemeral()?(e(),!0):(this.on("change:is_ephemeral",()=>this.isEphemeral()?e():clearTimeout(this.ephemeral_timer)),!1)},checkValidity(){return 3!==Object.keys(this.attributes).length||(this.validationError="Empty message",this.safeDestroy(),!1)},mayBeRetracted(){return"me"===this.get("sender")&&["all","own"].includes(xn.settings.get("allow_message_retraction"))},safeDestroy(){try{this.destroy()}catch(e){st.error(e)}},isEphemeral(){return this.get("is_ephemeral")},getDisplayName(){let e=this.get("nick");return"groupchat"===this.get("type")||e?this.get("nick"):this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():(t=this.get("from"),console.log({name:t,part:t.split("@")[0]}),t.split("@")[0]);var t},getMessageText(){return this.get("is_encrypted")?this.get("plaintext")||("debug"===yn.loglevel?e("Unencryptable OMEMO message"):null):this.get("message")},isMeCommand(){const e=this.getMessageText();return!!e&&e.startsWith("/me ")},sendSlotRequestStanza(){if(!this.file)return Promise.reject(new Error("file is undefined"));const e=zn.env.$iq({from:yn.jid,to:this.get("slot_request_url"),type:"get"}).c("request",{xmlns:Gn.NS.HTTPUPLOAD,filename:this.file.name,size:this.file.size,"content-type":this.file.type});return xn.sendIQ(e)},async getRequestSlotURL(){let t;try{t=await this.sendSlotRequestStanza()}catch(t){return st.error(t),this.save({type:"error",message:e("Sorry, could not determine upload URL."),is_ephemeral:!0})}const n=t.querySelector("slot");if(!n)return this.save({type:"error",message:e("Sorry, could not determine file upload URL."),is_ephemeral:!0});this.save({get:n.querySelector("get").getAttribute("url"),put:n.querySelector("put").getAttribute("url")})},uploadFile(){const t=new XMLHttpRequest;t.onreadystatechange=()=>{t.readyState===XMLHttpRequest.DONE&&(st.info("Status: "+t.status),200===t.status||201===t.status?this.save({upload:yn.SUCCESS,oob_url:this.get("get"),message:this.get("get")}):t.onerror())},t.upload.addEventListener("progress",e=>{e.lengthComputable&&this.set("progress",e.loaded/e.total)},!1),t.onerror=()=>{let n;n=t.responseText?e('Sorry, could not succesfully upload your file. Your server’s response: "%1$s"',t.responseText):e("Sorry, could not succesfully upload your file."),this.save({type:"error",upload:yn.FAILURE,message:n,is_ephemeral:!0})},t.open("PUT",this.get("put"),!0),t.setRequestHeader("Content-type",this.file.type),t.send(this.file)}}),yn.Messages=A.extend({model:yn.Message,comparator:"time"}),yn.ChatBox=t.extend({messagesCollection:yn.Messages,defaults(){return{bookmarked:!1,chat_state:void 0,hidden:["mobile","fullscreen"].includes(xn.settings.get("view_mode")),message_type:"chat",nickname:void 0,num_unread:0,time_sent:new Date(0).toISOString(),time_opened:this.get("time_opened")||(new Date).getTime(),type:yn.PRIVATE_CHAT_TYPE,url:""}},async initialize(){this.initialized=Kn.getResolveablePromise(),t.prototype.initialize.apply(this,arguments);const e=this.get("jid");e&&(this.set({box_id:"box-".concat(btoa(e))}),this.initMessages(),this.initNotifications(),this.get("type")===yn.PRIVATE_CHAT_TYPE&&(this.presence=yn.presences.findWhere({jid:e})||yn.presences.create({jid:e}),await this.setRosterContact(e)),this.on("change:chat_state",this.sendChatState,this),await this.fetchMessages(),await xn.trigger("chatBoxInitialized",this,{Synchronous:!0}),this.initialized.resolve())},getMessagesCacheKey(){return"converse.messages-".concat(this.get("jid"),"-").concat(yn.bare_jid)},initMessages(){this.messages=new this.messagesCollection,this.messages.chatbox=this,this.messages.browserStorage=yn.createStore(this.getMessagesCacheKey()),this.listenTo(this.messages,"change:upload",e=>{e.get("upload")===yn.SUCCESS&&xn.send(this.createMessageStanza(e))})},initNotifications(){this.notifications=new x},afterMessagesFetched(){xn.trigger("afterMessagesFetched",this)},fetchMessages(){if(this.messages.fetched)return void st.info("Not re-fetching messages for ".concat(this.get("jid")));this.messages.fetched=Kn.getResolveablePromise();const e=this.messages.fetched.resolve;return this.messages.fetch({add:!0,success:()=>{this.afterMessagesFetched(),e()},error:()=>{this.afterMessagesFetched(),e()}}),this.messages.fetched},async handleErrormessageStanza(e){await this.shouldShowErrorMessage(e)&&this.createMessage(await cn.parseMessage(e,yn))},queueMessage(e){return this.msg_chain=this.msg_chain||this.messages.fetched,this.msg_chain=this.msg_chain.then(()=>this.onMessage(e)),this.msg_chain},async onMessage(e){if(e=await e,Kn.isErrorObject(e))return e.stanza&&st.error(e.stanza),st.error(e.message);e=e.encrypted?await this.decrypt(e):e;const t=this.getDuplicateMessage(e);if(t)this.updateMessage(t,e);else if(!this.handleReceipt(e)&&!this.handleChatMarker(e)&&!await this.handleRetraction(e)&&(this.setEditable(e,e.time),e.chat_state&&"them"===e.sender&&this.notifications.set("chat_state",e.chat_state),Kn.shouldCreateMessage(e))){const t=this.handleCorrection(e)||await this.createMessage(e);this.notifications.set({chat_state:null}),this.incrementUnreadMsgCounter(t)}},async clearMessages(){try{await this.messages.clearStore()}catch(e){this.messages.trigger("reset"),st.error(e)}finally{delete this.messages.fetched}},async close(){try{await new Promise((e,t)=>this.destroy({success:e,error:(e,n)=>t(n)}))}catch(e){st.error(e)}finally{xn.settings.get("clear_messages_on_reconnection")&&await this.clearMessages()}},announceReconnection(){xn.trigger("chatReconnected",this)},async onReconnection(){xn.settings.get("clear_messages_on_reconnection")&&await this.clearMessages(),this.announceReconnection()},validate(e){if(!e.jid)return"Ignored ChatBox without JID";const t=yn.auto_join_rooms.map(e=>Object(i.isObject)(e)?e.jid:e),n=xn.settings.get("auto_join_private_chats").concat(t);if(xn.settings.get("singleton")&&!n.includes(e.jid)&&!yn.auto_join_on_invite){const t="".concat(e.jid," is not allowed because singleton is true and it's not being auto_joined");return st.warn(t),t}},getDisplayName(){return this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():this.get("jid")},async createMessageFromError(e){if(e instanceof yn.TimeoutError){(await this.createMessage({type:"error",message:e.message,retry:!0})).error=e}},getOldestMessage(){for(let e=0;e<this.messages.length;e++){const t=this.messages.at(e);if(t.get("type")===this.get("message_type"))return t}},getMostRecentMessage(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages.at(e);if(t.get("type")===this.get("message_type"))return t}},getUpdatedMessageAttributes:(e,t)=>(({is_archived:e})=>({is_archived:e}))(t),updateMessage(e,t){const n=this.getUpdatedMessageAttributes(e,t);t&&e.save(n)},setChatState(e,t){return void 0!==this.chat_state_timeout&&(window.clearTimeout(this.chat_state_timeout),delete this.chat_state_timeout),e===yn.COMPOSING?this.chat_state_timeout=window.setTimeout(this.setChatState.bind(this),yn.TIMEOUTS.PAUSED,yn.PAUSED):e===yn.PAUSED&&(this.chat_state_timeout=window.setTimeout(this.setChatState.bind(this),yn.TIMEOUTS.INACTIVE,yn.INACTIVE)),this.set("chat_state",e,t),this},shouldShowErrorMessage(e){const t=e.getAttribute("id");if(t){const n=this.messages.where({msgid:t});if(!n.filter(e=>"error"!==e.get("type")).length&&null===e.querySelector("body"))return;if(n.filter(e=>"error"===e.get("type")).length)return}return!0},isSameUser:(e,t)=>Kn.isSameBareJID(e,t),findDanglingRetraction(e){if(!e.origin_id||!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models);return t.reverse(),t.find(({attributes:t})=>t.retracted_id===e.origin_id&&t.from===e.from&&!t.moderated_by)}},async handleRetraction(e){const t=["retracted","retracted_id","editable"];if(e.retracted){if(e.is_tombstone)return!1;const n=this.messages.findWhere({origin_id:e.retracted_id,from:e.from});return n?(n.save(Object(i.pick)(e,t)),!0):(e.dangling_retraction=!0,await this.createMessage(e),!0)}{const n=this.findDanglingRetraction(e);if(n){const r=Object(i.pick)(n.attributes,t),o=Object.assign({dangling_retraction:!1},e,r);return delete o.id,n.save(o),!0}}return!1},handleCorrection(e){if(!e.replace_id||!e.from)return;const t=this.messages.findWhere({msgid:e.replace_id,from:e.from});if(!t)return;const n=t.get("older_versions")||{};return e.time<t.get("time")&&t.get("edited")?(n[e.time]=e.message,t.save({older_versions:n})):(n[t.get("time")]=t.get("message"),delete(e=Object.assign(e,{older_versions:n})).id,t.save(e)),t},getDuplicateMessage(e){const t=[...this.getStanzaIdQueryAttrs(e),this.getOriginIdQueryAttrs(e),this.getMessageBodyQueryAttrs(e)].filter(e=>e),n=this.messages.models;return Object(i.find)(n,e=>t.reduce((t,n)=>t||Object(i.isMatch)(e.attributes,n),!1))},getOriginIdQueryAttrs:e=>e.origin_id&&{origin_id:e.origin_id,from:e.from},getStanzaIdQueryAttrs:e=>Object.keys(e).filter(e=>e.startsWith("stanza_id ")).map(t=>{const n=t.replace(/^stanza_id /,""),i={};return i["stanza_id ".concat(n)]=e[t],i}),getMessageBodyQueryAttrs(e){if(e.message&&e.msgid)return{message:e.message,from:e.from,msgid:e.msgid}},retractOwnMessage(e){this.sendRetractionMessage(e),e.save({retracted:(new Date).toISOString(),retracted_id:e.get("origin_id"),is_ephemeral:!0,editable:!1})},sendRetractionMessage(e){const t=e.get("origin_id");if(!t)throw new Error("Can't retract message without a XEP-0359 Origin ID");const n=Vn({id:Kn.getUniqueId(),to:this.get("jid"),type:"chat"}).c("store",{xmlns:Gn.NS.HINTS}).up().c("apply-to",{id:t,xmlns:Gn.NS.FASTEN}).c("retract",{xmlns:Gn.NS.RETRACT});return yn.connection.send(n)},sendMarker(e,t,n){const i=Vn({from:yn.connection.jid,id:Kn.getUniqueId(),to:e,type:"chat"}).c(n,{xmlns:Gn.NS.MARKERS,id:t});xn.send(i)},handleChatMarker(e){if(Gn.getBareJidFromJid(e.to)!==yn.bare_jid)return!1;if(e.is_markable)return!this.contact||e.is_mam||e.is_carbon||this.sendMarker(e.from,e.msgid,"received"),!1;if(e.marker_id){const t=this.messages.findWhere({msgid:e.marker_id}),n="marker_".concat(e.marker);return t&&!t.get(n)&&t.save({field_name:(new Date).toISOString()}),!0}},sendReceiptStanza(e,t){const n=Vn({from:yn.connection.jid,id:Kn.getUniqueId(),to:e,type:"chat"}).c("received",{xmlns:Gn.NS.RECEIPTS,id:t}).up().c("store",{xmlns:Gn.NS.HINTS}).up();xn.send(n)},handleReceipt(e){if("them"===e.sender)if(e.is_receipt_request)this.sendReceiptStanza(e.from,e.msgid);else if(e.receipt_id){const t=this.messages.findWhere({msgid:e.receipt_id});return t&&!t.get("received")&&t.save({received:(new Date).toISOString()}),!0}return!1},createMessageStanza(e){const t=Vn({from:yn.connection.jid,to:this.get("jid"),type:this.get("message_type"),id:e.get("edited")&&Kn.getUniqueId()||e.get("msgid")}).c("body").t(e.get("message")).up().c(yn.ACTIVE,{xmlns:Gn.NS.CHATSTATES}).root();return"chat"===e.get("type")&&t.c("request",{xmlns:Gn.NS.RECEIPTS}).root(),e.get("is_spoiler")&&(e.get("spoiler_hint")?t.c("spoiler",{xmlns:Gn.NS.SPOILER},e.get("spoiler_hint")).root():t.c("spoiler",{xmlns:Gn.NS.SPOILER}).root()),(e.get("references")||[]).forEach(e=>{const n={xmlns:Gn.NS.REFERENCE,begin:e.begin,end:e.end,type:e.type};e.uri&&(n.uri=e.uri),t.c("reference",n).root()}),e.get("oob_url")&&t.c("x",{xmlns:Gn.NS.OUTOFBAND}).c("url").t(e.get("oob_url")).root(),e.get("edited")&&t.c("replace",{xmlns:Gn.NS.MESSAGE_CORRECT,id:e.get("msgid")}).root(),e.get("origin_id")&&t.c("origin-id",{xmlns:Gn.NS.SID,id:e.get("origin_id")}).root(),t},getOutgoingMessageAttributes(e,t){const n=this.get("composing_spoiler"),i=Kn.getUniqueId();return{id:i,jid:this.get("jid"),nickname:this.get("nickname"),msgid:i,origin_id:i,fullname:yn.xmppstatus.get("fullname"),from:yn.bare_jid,is_only_emojis:!!e&&Kn.isOnlyEmojis(e),sender:"me",time:(new Date).toISOString(),message:e?Kn.httpToGeoUri(Kn.shortnameToUnicode(e),yn):void 0,is_spoiler:n,spoiler_hint:n?t:void 0,type:this.get("message_type")}},setEditable(e,t){if(!e.is_headline&&!Kn.isEmptyMessage(e)&&"me"===e.sender)if("all"===xn.settings.get("allow_message_corrections"))e.editable=!(e.file||e.retracted||"oob_url"in e);else if("last"===xn.settings.get("allow_message_corrections")&&t>this.get("time_sent")){this.set({time_sent:t});const n=this.messages.findWhere({editable:!0});n&&n.save({editable:!1}),e.editable=!(e.file||e.retracted||"oob_url"in e)}},createMessage(e,t){return this.messages.create(e,Object.assign({wait:!0,promise:!0},t))},async sendMessage(e,t){const n=this.getOutgoingMessageAttributes(e,t);let i=this.messages.findWhere("correcting");if(i){const e=i.get("older_versions")||{};e[i.get("time")]=i.get("message"),i.save({correcting:!1,edited:(new Date).toISOString(),message:n.message,older_versions:e,references:n.references,is_only_emojis:n.is_only_emojis,origin_id:Kn.getUniqueId(),received:void 0})}else this.setEditable(n,(new Date).toISOString()),i=await this.createMessage(n);return xn.send(this.createMessageStanza(i)),xn.trigger("sendMessage",{chatbox:this,message:i}),i},sendChatState(){if(xn.settings.get("send_chat_state_notifications")&&this.get("chat_state")){const e=xn.settings.get("send_chat_state_notifications");if(Array.isArray(e)&&!e.includes(this.get("chat_state")))return;xn.send(Vn({id:Kn.getUniqueId(),to:this.get("jid"),type:"chat"}).c(this.get("chat_state"),{xmlns:Gn.NS.CHATSTATES}).up().c("no-store",{xmlns:Gn.NS.HINTS}).up().c("no-permanent-store",{xmlns:Gn.NS.HINTS}))}},async sendFiles(t){var n;const i=(await xn.disco.features.get(Gn.NS.HTTPUPLOAD,yn.domain)).pop();if(!i)return void this.createMessage({message:e("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0});const r=i.dataforms.where({FORM_TYPE:{value:Gn.NS.HTTPUPLOAD,type:"hidden"}}).pop(),o=window.parseInt(null===(n=((null==r?void 0:r.attributes)||{})["max-file-size"])||void 0===n?void 0:n.value),s=null==i?void 0:i.id;s?Array.from(t).forEach(async t=>{if(!window.isNaN(o)&&window.parseInt(t.size)>o)return this.createMessage({message:e("The size of your file, %1$s, exceeds the maximum allowed by your server, which is %2$s.",t.name,Wn()(o)),type:"error",is_ephemeral:!0});{const e=Object.assign(this.getOutgoingMessageAttributes(),{file:!0,progress:0,slot_request_url:s});this.setEditable(e,(new Date).toISOString());const n=await this.createMessage(e,{silent:!0});n.file=t,this.messages.trigger("add",n),n.getRequestSlotURL()}}):this.createMessage({message:e("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0})},maybeShow(){return this.trigger("show")},isHidden(){return this.get("hidden")||this.get("minimized")||this.isScrolledUp()||"hidden"===yn.windowState},incrementUnreadMsgCounter(e){e&&e.get("message")&&Qn.isNewMessage(e)&&this.isHidden()&&(this.setFirstUnreadMsgId(e),this.save({num_unread:this.get("num_unread")+1}),yn.incrementMsgCounter())},setFirstUnreadMsgId(e){if(0==this.get("num_unread")){const t=this.get("first_unread_id");if(t){const e=this.messages.get(t);e&&e.save("first_unread",!1)}e.save("first_unread",!0),this.save({first_unread_id:e.get("id")})}},clearUnreadMsgCounter(){Kn.safeSave(this,{num_unread:0})},isScrolledUp(){return this.get("scrolled",!0)}}),yn.handleMessageStanza=async function(e){if(cn.isServerMessage(e)){const t=e.getAttribute("from");return st.info("handleMessageStanza: Ignoring incoming server message from JID: ".concat(t))}const t=await cn.parseMessage(e,yn);if(Kn.isErrorObject(t))return t.stanza&&st.error(t.stanza),st.error(t.message);const n=!!Jn('body, encrypted[xmlns="'.concat(Gn.NS.OMEMO,'"]'),e).length,i=await xn.chats.get(t.contact_jid,{nickname:t.nick},n);i&&await i.queueMessage(t),xn.trigger("message",{stanza:e})},yn.router.route("converse/chat?jid=:jid",(function(e){if(!Qn.isValidJID(e))return st.warn('Invalid JID "'.concat(e,'" provided in URL fragment'));xn.chats.open(e)})),xn.listen.on("chatBoxesFetched",(function(){xn.settings.get("auto_join_private_chats").forEach(e=>{yn.chatboxes.where({jid:e}).length||(Object(i.isString)(e)?xn.chats.open(e):st.error('Invalid jid criteria specified for "auto_join_private_chats"'))}),xn.trigger("privateChatsAutoJoined")})),xn.listen.on("presencesInitialized",(function(){yn.connection.addHandler(e=>Jn('message > result[xmlns="'.concat(Gn.NS.MAM,'"]'),e).pop()?(st.warn('Received a MAM message with type "chat".'),!0):(yn.handleMessageStanza(e),!0),null,"message","chat"),yn.connection.addHandler(e=>(null!==e.getAttribute("type")||yn.handleMessageStanza(e),!0),Gn.NS.RECEIPTS,"message"),yn.connection.addHandler(e=>(async function(e){const t=Gn.getBareJidFromJid(e.getAttribute("from"));if(Qn.isSameBareJID(t,yn.bare_jid))return;const n=await xn.chatboxes.get(t);null==n||n.handleErrormessageStanza(e)}(e),!0),null,"message","error")})),xn.listen.on("clearSession",()=>{if(yn.shouldClearCache())return Promise.all(yn.chatboxes.map(e=>e.messages&&e.messages.clearStore({silent:!0})))}),Object.assign(xn,{chats:{async create(e,t){if(Object(i.isString)(e)){if(t&&!(null==t?void 0:t.fullname)){var n;const i=await xn.contacts.get(e);t.fullname=null==i||null===(n=i.attributes)||void 0===n?void 0:n.fullname}const i=xn.chats.get(e,t,!0);return i||void st.error("Could not open chatbox for JID: "+e)}return Array.isArray(e)?Promise.all(e.forEach(async n=>{var i;const r=await xn.contacts.get(e);return t.fullname=null==r||null===(i=r.attributes)||void 0===i?void 0:i.fullname,xn.chats.get(n,t,!0).maybeShow()})):(st.error("chats.create: You need to provide at least one JID"),null)},async open(e,t,n){if(Object(i.isString)(e)){const i=await xn.chats.get(e,t,!0);return i?i.maybeShow(n):i}if(Array.isArray(e))return Promise.all(e.map(e=>xn.chats.get(e,t,!0).then(e=>e&&e.maybeShow(n))).filter(e=>e));const r="chats.open: You need to provide at least one JID";throw st.error(r),new Error(r)},async get(e,t={},n=!1){async function r(e){let i=await xn.chatboxes.get(e);return!i&&n?i=await xn.chatboxes.create(e,t,yn.ChatBox):(i=i&&i.get("type")===yn.PRIVATE_CHAT_TYPE?i:null,i&&Object.keys(t).length&&i.save(t)),i}if(void 0===e){return(await xn.chatboxes.get()).filter(e=>e.get("type")===yn.PRIVATE_CHAT_TYPE)}return Object(i.isString)(e)?r(e):Promise.all(e.map(e=>r(e)))}}})}});
/**
 * @module converse-disco
 * @copyright The Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 * @description Converse plugin which add support for XEP-0030: Service Discovery
 */
const{Strophe:Yn,$iq:Xn,utils:Zn}=zn.env;zn.plugins.add("converse-disco",{initialize(){function e(){if(!yn.stream_features){const e=Yn.getBareJidFromJid(yn.jid),t="converse.stream-features-".concat(e);xn.promises.add("streamFeaturesAdded"),yn.stream_features=new A,yn.stream_features.browserStorage=yn.createStore(t,"session")}}function t(){xn.trigger("streamFeaturesAdded")}xn.promises.add("discoInitialized"),xn.promises.add("streamFeaturesAdded"),yn.DiscoEntity=x.extend({idAttribute:"jid",initialize(e,t){this.waitUntilFeaturesDiscovered=Zn.getResolveablePromise(),this.dataforms=new A;let n="converse.dataforms-".concat(this.get("jid"));this.dataforms.browserStorage=yn.createStore(n,"session"),this.features=new A,n="converse.features-".concat(this.get("jid")),this.features.browserStorage=yn.createStore(n,"session"),this.listenTo(this.features,"add",this.onFeatureAdded),this.fields=new A,n="converse.fields-".concat(this.get("jid")),this.fields.browserStorage=yn.createStore(n,"session"),this.listenTo(this.fields,"add",this.onFieldAdded),this.identities=new A,n="converse.identities-".concat(this.get("jid")),this.identities.browserStorage=yn.createStore(n,"session"),this.fetchFeatures(t),this.items=new yn.DiscoEntities,n="converse.disco-items-".concat(this.get("jid")),this.items.browserStorage=yn.createStore(n,"session"),this.items.fetch()},async getIdentity(e,t){return await this.waitUntilFeaturesDiscovered,this.identities.findWhere({category:e,type:t})},async hasFeature(e){if(await this.waitUntilFeaturesDiscovered,this.features.findWhere({var:e}))return this},onFeatureAdded(e){e.entity=this,xn.trigger("serviceDiscovered",e)},onFieldAdded(e){e.entity=this,xn.trigger("discoExtensionFieldDiscovered",e)},async fetchFeatures(e){if(e.ignore_cache)this.queryInfo();else{const e=this.features.browserStorage.name,t=await this.features.browserStorage.store.getItem(e);t&&0===t.length||null===t?this.queryInfo():(this.features.fetch({add:!0,success:()=>{this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")}}),this.identities.fetch({add:!0}))}},async queryInfo(){let e;try{e=await xn.disco.info(this.get("jid"),null)}catch(e){return null===e?st.error("Timeout for disco#info query for ".concat(this.get("jid"))):st.error(e),void this.waitUntilFeaturesDiscovered.resolve(this)}this.onInfo(e)},onDiscoItems(e){Rt()('query[xmlns="'.concat(Yn.NS.DISCO_ITEMS,'"] item'),e).forEach(e=>{if(e.getAttribute("node"))return;const t=e.getAttribute("jid");if(void 0===this.items.get(t)){const e=yn.disco_entities.get(t);e?this.items.add(e):this.items.create({jid:t})}})},async queryForItems(){if(Object(i.isEmpty)(this.identities.where({category:"server"})))return;const e=await xn.disco.items(this.get("jid"));this.onDiscoItems(e)},onInfo(e){Array.from(e.querySelectorAll("identity")).forEach(e=>{this.identities.create({category:e.getAttribute("category"),type:e.getAttribute("type"),name:e.getAttribute("name")})}),Rt()('x[type="result"][xmlns="'.concat(Yn.NS.XFORM,'"]'),e).forEach(e=>{const t={};Rt()("field",e).forEach(e=>{var n;t[e.getAttribute("var")]={value:null===(n=e.querySelector("value"))||void 0===n?void 0:n.textContent,type:e.getAttribute("type")}}),this.dataforms.create(t)}),e.querySelector('feature[var="'.concat(Yn.NS.DISCO_ITEMS,'"]'))&&this.queryForItems(),Array.from(e.querySelectorAll("feature")).forEach(t=>{this.features.create({var:t.getAttribute("var"),from:e.getAttribute("from")})}),Rt()('x[type="result"][xmlns="jabber:x:data"] field',e).forEach(t=>{var n;this.fields.create({var:t.getAttribute("var"),value:null===(n=t.querySelector("value"))||void 0===n?void 0:n.textContent,from:e.getAttribute("from")})}),this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")}}),yn.DiscoEntities=A.extend({model:yn.DiscoEntity,fetchEntities(){return new Promise((e,t)=>{this.fetch({add:!0,success:e,error(e,n){st.error(n),t(new Error("Could not fetch disco entities"))}})})}});const n=this;function r(e){const t=e.getElementsByTagName("query")[0].getAttribute("node"),i={xmlns:Yn.NS.DISCO_INFO};t&&(i.node=t);const r=Xn({type:"result",id:e.getAttribute("id")}),o=e.getAttribute("from");return null!==o&&r.attrs({to:o}),r.c("query",i),n._identities.forEach(e=>{const t={category:e.category,type:e.type};e.name&&(t.name=e.name),e.lang&&(t["xml:lang"]=e.lang),r.c("identity",t).up()}),n._features.forEach(e=>r.c("feature",{var:e}).up()),xn.send(r.tree()),!0}async function o(){xn.disco.own.identities.add("client","web","Converse"),xn.disco.own.features.add(Yn.NS.CHATSTATES),xn.disco.own.features.add(Yn.NS.DISCO_INFO),xn.disco.own.features.add(Yn.NS.ROSTERX),xn.settings.get("message_carbons")&&xn.disco.own.features.add(Yn.NS.CARBONS),xn.trigger("addClientFeatures"),yn.connection.addHandler(r,Yn.NS.DISCO_INFO,"iq","get",null,null),yn.disco_entities=new yn.DiscoEntities;const e="converse.disco-entities-".concat(yn.bare_jid);yn.disco_entities.browserStorage=yn.createStore(e,"session");const t=await yn.disco_entities.fetchEntities();0!==t.length&&t.get(yn.domain)||yn.disco_entities.create({jid:yn.domain}),xn.trigger("discoInitialized")}n._identities=[],n._features=[],xn.listen.on("userSessionInitialized",async()=>{e(),yn.connfeedback.get("connection_status")===Yn.Status.ATTACHED&&(await new Promise((e,t)=>yn.stream_features.fetch({success:e,error:t})),t())}),xn.listen.on("beforeResourceBinding",(function(){e(),Array.from(yn.connection.features.childNodes).forEach(e=>{yn.stream_features.create({name:e.nodeName,xmlns:e.getAttribute("xmlns")})}),t()})),xn.listen.on("reconnected",o),xn.listen.on("connected",o),xn.listen.on("beforeTearDown",async()=>{xn.promises.add("streamFeaturesAdded"),yn.stream_features&&(await yn.stream_features.clearStore(),delete yn.stream_features)}),xn.listen.on("clearSession",()=>{yn.shouldClearCache()&&yn.disco_entities&&(Array.from(yn.disco_entities.models).forEach(e=>e.features.clearStore()),Array.from(yn.disco_entities.models).forEach(e=>e.identities.clearStore()),Array.from(yn.disco_entities.models).forEach(e=>e.dataforms.clearStore()),Array.from(yn.disco_entities.models).forEach(e=>e.fields.clearStore()),yn.disco_entities.clearStore(),delete yn.disco_entities)}),Object.assign(xn,{disco:{stream:{async getFeature(e,t){if(await xn.waitUntil("streamFeaturesAdded"),!e||!t)throw new Error("name and xmlns need to be provided when calling disco.stream.getFeature");if(void 0!==yn.stream_features||xn.connection.connected())return yn.stream_features.findWhere({name:e,xmlns:t});{const n="Tried to get feature ".concat(e," ").concat(t," but _converse.stream_features has been torn down");st.warn(n)}}},own:{identities:{add(e,t,i,r){for(var o=0;o<n._identities.length;o++)if(n._identities[o].category==e&&n._identities[o].type==t&&n._identities[o].name==i&&n._identities[o].lang==r)return!1;n._identities.push({category:e,type:t,name:i,lang:r})},clear(){n._identities=[]},get:()=>n._identities},features:{add(e){for(var t=0;t<n._features.length;t++)if(n._features[t]==e)return!1;n._features.push(e)},clear(){n._features=[]},get:()=>n._features}},info(e,t){const n={xmlns:Yn.NS.DISCO_INFO};t&&(n.node=t);const i=Xn({from:yn.connection.jid,to:e,type:"get"}).c("query",n);return xn.sendIQ(i)},items(e,t){const n={xmlns:Yn.NS.DISCO_ITEMS};return t&&(n.node=t),xn.sendIQ(Xn({from:yn.connection.jid,to:e,type:"get"}).c("query",n))},entities:{async get(e,t=!1){if(await xn.waitUntil("discoInitialized"),!e)return yn.disco_entities;if(void 0===yn.disco_entities&&!xn.connection.connected()){const t="Tried to look up entity ".concat(e," but _converse.disco_entities has been torn down");return void st.warn(t)}const n=yn.disco_entities.get(e);return n||!t?n:xn.disco.entities.create(e)},create:(e,t)=>yn.disco_entities.create({jid:e},t)},features:{async get(e,t){if(!t)throw new TypeError("You need to provide an entity JID");await xn.waitUntil("discoInitialized");let n=await xn.disco.entities.get(t,!0);if(void 0===yn.disco_entities&&!xn.connection.connected()){const n="Tried to get feature ".concat(e," for ").concat(t," but _converse.disco_entities has been torn down");return void st.warn(n)}n=await n.waitUntilFeaturesDiscovered;const r=[...n.items.map(t=>t.hasFeature(e)),n.hasFeature(e)];return(await Promise.all(r)).filter(i.isObject)}},supports:async(e,t)=>(await xn.disco.features.get(e,t)).length>0,async refresh(e){if(!e)throw new TypeError("api.disco.refresh: You need to provide an entity JID");await xn.waitUntil("discoInitialized");let t=await xn.disco.entities.get(e);return t?(t.features.reset(),t.fields.reset(),t.identities.reset(),t.waitUntilFeaturesDiscovered.isPending||(t.waitUntilFeaturesDiscovered=Zn.getResolveablePromise()),t.queryInfo()):t=await xn.disco.entities.create(e,{ignore_cache:!0}),t.waitUntilFeaturesDiscovered},refreshFeatures:e=>xn.refresh(e),async getFeatures(e){if(!e)throw new TypeError("api.disco.getFeatures: You need to provide an entity JID");await xn.waitUntil("discoInitialized");let t=await xn.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.features},async getFields(e){if(!e)throw new TypeError("api.disco.getFields: You need to provide an entity JID");await xn.waitUntil("discoInitialized");let t=await xn.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.fields},async getIdentity(e,t,n){const i=await xn.disco.entities.get(n,!0);if(void 0!==i||xn.connection.connected())return i.getIdentity(e,t);{const t="Tried to look up category ".concat(e," for ").concat(n," but _converse.disco_entities has been torn down");st.warn(t)}}}})}});
/*! Copyright Twitter Inc. and other contributors. Licensed under MIT */
var ei=function(){var e={base:"https://twemoji.maxcdn.com/v/12.1.5/",ext:".png",size:"72x72",className:"emoji",convert:{fromCodePoint:function(e){var t="string"==typeof e?parseInt(e,16):e;if(t<65536)return a(t);return a(55296+((t-=65536)>>10),56320+(1023&t))},toCodePoint:m},onerror:function(){this.parentNode&&this.parentNode.replaceChild(c(this.alt,!1),this)},parse:function(t,n){n&&"function"!=typeof n||(n={callback:n});return("string"==typeof t?h:d)(t,{callback:n.callback||l,attributes:"function"==typeof n.attributes?n.attributes:p,base:"string"==typeof n.base?n.base:e.base,ext:n.ext||e.ext,size:n.folder||(i=n.size||e.size,"number"==typeof i?i+"x"+i:i),className:n.className||e.className,onerror:n.onerror||e.onerror});var i},replace:g,test:function(e){n.lastIndex=0;var t=n.test(e);return n.lastIndex=0,t}},t={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},n=/(?:\ud83d\udc68\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69]|\ud83e\uddd1)(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[©®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,i=/\uFE0F/g,r=String.fromCharCode(8205),o=/[&<>'"]/g,s=/^(?:iframe|noframes|noscript|script|select|style|textarea)$/,a=String.fromCharCode;return e;function c(e,t){return document.createTextNode(t?e.replace(i,""):e)}function l(e,t){return"".concat(t.base,t.size,"/",e,t.ext)}function u(e){return m(e.indexOf(r)<0?e.replace(i,""):e)}function d(e,t){for(var i,r,o,a,l,d,h,f,p,g,m,v,_,b=function e(t,n){for(var i,r,o=t.childNodes,a=o.length;a--;)3===(r=(i=o[a]).nodeType)?n.push(i):1!==r||"ownerSVGElement"in i||s.test(i.nodeName.toLowerCase())||e(i,n);return n}(e,[]),y=b.length;y--;){for(o=!1,a=document.createDocumentFragment(),d=(l=b[y]).nodeValue,f=0;h=n.exec(d);){if((p=h.index)!==f&&a.appendChild(c(d.slice(f,p),!0)),v=u(m=h[0]),f=p+m.length,_=t.callback(v,t),v&&_){for(r in(g=new Image).onerror=t.onerror,g.setAttribute("draggable","false"),i=t.attributes(m,v))i.hasOwnProperty(r)&&0!==r.indexOf("on")&&!g.hasAttribute(r)&&g.setAttribute(r,i[r]);g.className=t.className,g.alt=m,g.src=_,o=!0,a.appendChild(g)}g||a.appendChild(c(m,!1)),g=null}o&&(f<d.length&&a.appendChild(c(d.slice(f),!0)),l.parentNode.replaceChild(a,l))}return e}function h(e,t){return g(e,(function(e){var n,i,r=e,s=u(e),a=t.callback(s,t);if(s&&a){for(i in r="<img ".concat('class="',t.className,'" ','draggable="false" ','alt="',e,'"',' src="',a,'"'),n=t.attributes(e,s))n.hasOwnProperty(i)&&0!==i.indexOf("on")&&-1===r.indexOf(" "+i+"=")&&(r=r.concat(" ",i,'="',n[i].replace(o,f),'"'));r=r.concat("/>")}return r}))}function f(e){return t[e]}function p(){return null}function g(e,t){return String(e).replace(n,t)}function m(e,t){for(var n=[],i=0,r=0,o=0;o<e.length;)i=e.charCodeAt(o++),r?(n.push((65536+(r-55296<<10)+(i-56320)).toString(16)),r=0):55296<=i&&i<=56319?r=i:n.push(i.toString(16));return n.join(t||"-")}}();
/**
 * @module converse-emoji
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const ti=zn.env.utils,ni={"*\\0/*":"1f646","*\\O/*":"1f646","-___-":"1f611",":'-)":"1f602","':-)":"1f605","':-D":"1f605",">:-)":"1f606","':-(":"1f613",">:-(":"1f620",":'-(":"1f622","O:-)":"1f607","0:-3":"1f607","0:-)":"1f607","0;^)":"1f607","O;-)":"1f607","0;-)":"1f607","O:-3":"1f607","-__-":"1f611",":-Þ":"1f61b","</3":"1f494",":')":"1f602",":-D":"1f603","':)":"1f605","'=)":"1f605","':D":"1f605","'=D":"1f605",">:)":"1f606",">;)":"1f606",">=)":"1f606",";-)":"1f609","*-)":"1f609",";-]":"1f609",";^)":"1f609","':(":"1f613","'=(":"1f613",":-*":"1f618",":^*":"1f618",">:P":"1f61c","X-P":"1f61c",">:[":"1f61e",":-(":"1f61e",":-[":"1f61e",">:(":"1f620",":'(":"1f622",";-(":"1f622",">.<":"1f623","#-)":"1f635","%-)":"1f635","X-)":"1f635","\\0/":"1f646","\\O/":"1f646","0:3":"1f607","0:)":"1f607","O:)":"1f607","O=)":"1f607","O:3":"1f607","B-)":"1f60e","8-)":"1f60e","B-D":"1f60e","8-D":"1f60e","-_-":"1f611",">:\\":"1f615",">:/":"1f615",":-/":"1f615",":-.":"1f615",":-P":"1f61b",":Þ":"1f61b",":-b":"1f61b",":-O":"1f62e",O_O:"1f62e",">:O":"1f62e",":-X":"1f636",":-#":"1f636",":-)":"1f642","(y)":"1f44d","<3":"2764",":D":"1f603","=D":"1f603",";)":"1f609","*)":"1f609",";]":"1f609",";D":"1f609",":*":"1f618","=*":"1f618",":(":"1f61e",":[":"1f61e","=(":"1f61e",":@":"1f620",";(":"1f622","D:":"1f628",":$":"1f633","=$":"1f633","#)":"1f635","%)":"1f635","X)":"1f635","B)":"1f60e","8)":"1f60e",":/":"1f615",":\\":"1f615","=/":"1f615","=\\":"1f615",":L":"1f615","=L":"1f615",":P":"1f61b","=P":"1f61b",":b":"1f61b",":O":"1f62e",":X":"1f636",":#":"1f636","=X":"1f636","=#":"1f636",":)":"1f642","=]":"1f642","=)":"1f642",":]":"1f642"},ii=new RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|((\\s|^)(\\*\\\\0\\/\\*|\\*\\\\O\\/\\*|\\-___\\-|\\:'\\-\\)|'\\:\\-\\)|'\\:\\-D|\\>\\:\\-\\)|>\\:\\-\\)|'\\:\\-\\(|\\>\\:\\-\\(|>\\:\\-\\(|\\:'\\-\\(|O\\:\\-\\)|0\\:\\-3|0\\:\\-\\)|0;\\^\\)|O;\\-\\)|0;\\-\\)|O\\:\\-3|\\-__\\-|\\:\\-Þ|\\:\\-Þ|\\<\\/3|<\\/3|\\:'\\)|\\:\\-D|'\\:\\)|'\\=\\)|'\\:D|'\\=D|\\>\\:\\)|>\\:\\)|\\>;\\)|>;\\)|\\>\\=\\)|>\\=\\)|;\\-\\)|\\*\\-\\)|;\\-\\]|;\\^\\)|'\\:\\(|'\\=\\(|\\:\\-\\*|\\:\\^\\*|\\>\\:P|>\\:P|X\\-P|\\>\\:\\[|>\\:\\[|\\:\\-\\(|\\:\\-\\[|\\>\\:\\(|>\\:\\(|\\:'\\(|;\\-\\(|\\>\\.\\<|>\\.<|#\\-\\)|%\\-\\)|X\\-\\)|\\\\0\\/|\\\\O\\/|0\\:3|0\\:\\)|O\\:\\)|O\\=\\)|O\\:3|B\\-\\)|8\\-\\)|B\\-D|8\\-D|\\-_\\-|\\>\\:\\\\|>\\:\\\\|\\>\\:\\/|>\\:\\/|\\:\\-\\/|\\:\\-\\.|\\:\\-P|\\:Þ|\\:Þ|\\:\\-b|\\:\\-O|O_O|\\>\\:O|>\\:O|\\:\\-X|\\:\\-#|\\:\\-\\)|\\(y\\)|\\<3|<3|\\:D|\\=D|;\\)|\\*\\)|;\\]|;D|\\:\\*|\\=\\*|\\:\\(|\\:\\[|\\=\\(|\\:@|;\\(|D\\:|\\:\\$|\\=\\$|#\\)|%\\)|X\\)|B\\)|8\\)|\\:\\/|\\:\\\\|\\=\\/|\\=\\\\|\\:L|\\=L|\\:P|\\=P|\\:b|\\:O|\\:X|\\:#|\\=X|\\=#|\\:\\)|\\=\\]|\\=\\)|\\:\\])(?=\\s|$|[!,.?]))","gi");function ri(e){if(e.indexOf("-")>-1){const t=[],n=e.split("-");for(let e=0;e<n.length;e++){let i=parseInt(n[e],16);if(i>=65536&&i<=1114111){const e=Math.floor((i-65536)/1024)+55296,t=(i-65536)%1024+56320;i=String.fromCharCode(e)+String.fromCharCode(t)}else i=String.fromCharCode(i);t.push(i)}return t.join("")}return ei.convert.fromCodePoint(e)}zn.plugins.add("converse-emoji",{initialize(){const{___:e}=yn;xn.settings.update({emoji_image_path:ei.base,emoji_categories:{smileys:":grinning:",people:":thumbsup:",activity:":soccer:",travel:":motorcycle:",objects:":bomb:",nature:":rainbow:",food:":hotdog:",symbols:":musical_note:",flags:":flag_ac:",custom:null},emoji_category_labels:{smileys:e("Smileys and emotions"),people:e("People"),activity:e("Activities"),travel:e("Travel"),objects:e("Objects"),nature:e("Animals and nature"),food:e("Food and drink"),symbols:e("Symbols"),flags:e("Flags"),custom:e("Stickers")}}),yn.emojis={},xn.promises.add("emojisInitialized",!1),ei.base=xn.settings.get("emoji_image_path"),yn.EmojiPicker=x.extend({defaults:{current_category:"smileys",current_skintone:"",scroll_position:0}});const t={};Object.assign(ti,{addEmoji:e=>ti.getEmojiRenderer()(e),getEmojiRenderer(){const e={attributes:e=>{const t=ei.convert.toCodePoint(e);return{title:"".concat(ti.getEmojisByAtrribute("cp")[t].sn," ").concat(e)}}},t=ti.shortnamesToEmojis;return xn.settings.get("use_system_emojis")?t:n=>ei.parse(t(n),e)},shortnamesToEmojis:(e,t=!1)=>e=(e=e.replace(yn.emojis.shortnames_regex,e=>{if(void 0===e||""===e||!yn.emoji_shortnames.includes(e))return e;const n=yn.emojis_map[e].cp;return n?ri(n.toUpperCase()):t?e:'<img class="emoji" draggable="false" alt="'.concat(e,'" src="').concat(yn.emojis_map[e].url,'">')})).replace(ii,(e,t,n,i)=>{if(void 0===i||""===i||!(ti.unescapeHTML(i)in ni))return e;return i=ti.unescapeHTML(i),n+ri(ni[i].toUpperCase())}),shortnameToUnicode(e){return this.shortnamesToEmojis(e,!0)},isOnlyEmojis(e){const t=e.trim().split(/\s+/);return!(0===t.length||t.length>3)&&0===t.filter(e=>{const t=ei.parse(ti.shortnameToUnicode(e)).match(/<img class="emoji" draggable="false" alt=".*?" src=".*?\.png"\/>/);return!t||1!==t.length}).length},getEmojisByAtrribute(e){if(t[e])return t[e];if("category"===e)return yn.emojis.json;const n=yn.emojis_list.map(t=>t[e]).filter((e,t,n)=>n.indexOf(e)==t);return t[e]={},n.forEach(n=>t[e][n]=Object(i.find)(yn.emojis_list,t=>t[e]===n)),t[e]}}),Object.assign(xn,{emojis:{async initialize(){if(yn.emojis.initialized)return yn.emojis.initialized;yn.emojis.initialized=ti.getResolveablePromise();const{default:e}=await n.e(129).then(n.t.bind(null,456,3));yn.emojis.json=e,yn.emojis.categories=Object.keys(yn.emojis.json),yn.emojis_map=yn.emojis.categories.reduce((e,t)=>Object.assign(e,yn.emojis.json[t]),{}),yn.emojis_list=Object.values(yn.emojis_map),yn.emojis_list.sort((e,t)=>e.sn<t.sn?-1:e.sn>t.sn?1:0),yn.emoji_shortnames=yn.emojis_list.map(e=>e.sn);yn.emojis.shortnames_regex=new RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|("+yn.emoji_shortnames.map(e=>e.replace(/[+]/g,"\\$&")).join("|")+")","gi"),yn.emojis.toned=(yn.toned_emojis||(yn.toned_emojis=Object(i.uniq)(Object.values(yn.emojis.json.people).filter(e=>e.sn.includes("_tone")).map(e=>e.sn.replace(/_tone[1-5]/,"")))),yn.toned_emojis),yn.emojis.initialized.resolve(),xn.trigger("emojisInitialized")}}})}});
/**
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 * @description This is the MUC utilities module.
 */
const{Strophe:oi,sizzle:si}=zn.env;var ai={computeAffiliationsDelta(e,t,n,r){const o=n.map(e=>e.jid),s=r.map(e=>e.jid);let a=Object(i.difference)(o,s).map(e=>n[Object(i.indexOf)(o,e)]);return e||(a=a.concat(n.filter(e=>{const t=Object(i.indexOf)(s,e.jid);return t>=0&&e.affiliation!==r[t].affiliation}))),t&&(a=a.concat(Object(i.difference)(s,o).map(e=>({jid:e,affiliation:"none"})))),a},parseMemberListIQ:e=>si('query[xmlns="'.concat(oi.NS.MUC_ADMIN,'"] item'),e).map(e=>{const t={affiliation:e.getAttribute("affiliation")},n=e.getAttribute("jid");Bt.isValidJID(n)?t.jid=n:t.nick=n;const i=e.getAttribute("nick");return i&&(t.nick=i),e.getAttribute("role")&&(t.role=i),t})},ci=n(110),li=n.n(ci);
/**
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 * @description This is the form utilities module.
 */
Bt.webForm2xForm=function(e){let t;return t="checkbox"===e.getAttribute("type")?e.checked?1:0:"TEXTAREA"==e.tagName?e.value.split("\n").filter(e=>e.trim()):"SELECT"==e.tagName?Bt.getSelectValues(e):e.value,Bt.stringToNode(li()({name:e.getAttribute("name"),value:t}))};var ui=Bt;
/**
 * @module converse-muc
 * @copyright The Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 * @description Implements the non-view logic for XEP-0045 Multi-User Chat
 */const di=["moderator","participant","visitor"],hi=["owner","admin","member","outcast","none"];zn.MUC_TRAFFIC_STATES=["entered","exited"],zn.MUC_ROLE_CHANGES=["op","deop","voice","mute"];const fi={moderator:1,participant:2,visitor:3,none:2},{Strophe:pi,$iq:gi,$build:mi,$msg:vi,$pres:_i,sizzle:bi}=zn.env;pi.addNamespace("MUC_ADMIN",pi.NS.MUC+"#admin"),pi.addNamespace("MUC_OWNER",pi.NS.MUC+"#owner"),pi.addNamespace("MUC_REGISTER","jabber:iq:register"),pi.addNamespace("MUC_ROOMCONF",pi.NS.MUC+"#roomconfig"),pi.addNamespace("MUC_USER",pi.NS.MUC+"#user"),pi.addNamespace("MUC_HATS","xmpp:prosody.im/protocol/hats:1"),zn.MUC_NICK_CHANGED_CODE="303",zn.ROOM_FEATURES=["passwordprotected","unsecured","hidden","publicroom","membersonly","open","persistent","temporary","nonanonymous","semianonymous","moderated","unmoderated","mam_enabled"],zn.ROOMSTATUS={CONNECTED:0,CONNECTING:1,NICKNAME_REQUIRED:2,PASSWORD_REQUIRED:3,DISCONNECTED:4,ENTERED:5,DESTROYED:6},zn.plugins.add("converse-muc",{dependencies:["converse-chatboxes","converse-chat","converse-disco","converse-controlbox"],overrides:{ChatBoxes:{model(e,t){const{_converse:n}=this.__super__;return e&&e.type==n.CHATROOMS_TYPE?new n.ChatRoom(e,t):this.__super__.model.apply(this,arguments)}}},initialize(){const{__:e,___:t}=yn;if(xn.settings.update({allow_muc:!0,allow_muc_invitations:!0,auto_join_on_invite:!1,auto_join_rooms:[],auto_register_muc_nickname:!1,locked_muc_domain:!1,muc_domain:void 0,muc_fetch_members:!0,muc_history_max_stanzas:void 0,muc_instant_rooms:!0,muc_nickname_from_jid:!1,muc_send_probes:!1,muc_show_join_leave:!0,muc_show_logs_before_join:!1}),xn.promises.add(["roomsAutoJoined"]),xn.settings.get("locked_muc_domain")&&!Object(i.isString)(xn.settings.get("muc_domain")))throw new Error("Config Error: it makes no sense to set locked_muc_domain to true when muc_domain is not set");yn.muc={info_messages:{100:e("This groupchat is not anonymous"),102:e("This groupchat now shows unavailable members"),103:e("This groupchat does not show unavailable members"),104:e("The groupchat configuration has changed"),170:e("Groupchat logging is now enabled"),171:e("Groupchat logging is now disabled"),172:e("This groupchat is now no longer anonymous"),173:e("This groupchat is now semi-anonymous"),174:e("This groupchat is now fully-anonymous"),201:e("A new groupchat has been created")},new_nickname_messages:{210:t("Your nickname has been automatically set to %1$s"),303:t("Your nickname has been changed to %1$s")},disconnect_messages:{301:e("You have been banned from this groupchat"),307:e("You have been kicked from this groupchat"),321:e("You have been removed from this groupchat because of an affiliation change"),322:e("You have been removed from this groupchat because the groupchat has changed to members-only and you're not a member"),332:e("You have been removed from this groupchat because the service hosting it is being shut down")},action_info_codes:["301","303","307","321","322"]},yn.router.route("converse/room?jid=:jid",(async function(e){if(!ui.isValidMUCJID(e))return st.warn('invalid jid "'.concat(e,'" provided in url fragment'));await xn.waitUntil("roomsAutoJoined"),yn.allow_bookmarks&&await xn.waitUntil("bookmarksInitialized"),xn.rooms.open(e)})),yn.getDefaultMUCNickname=function(){if(!yn.xmppstatus)throw new Error("Can't call _converse.getDefaultMUCNickname before the statusInitialized has been fired.");const e=yn.xmppstatus.getNickname();return e||(xn.settings.get("muc_nickname_from_jid")?pi.unescapeNode(pi.getNodeFromJid(yn.bare_jid)):void 0)},yn.ChatRoomMessage=yn.Message.extend({initialize(){this.checkValidity()&&(this.get("file")&&this.on("change:put",this.uploadFile,this),this.setTimerForEphemeralMessage()||this.setOccupant(),xn.trigger("chatRoomMessageInitialized",this))},mayBeModerated(){return["all","moderator"].includes(xn.settings.get("allow_message_retraction"))&&this.collection.chatbox.canModerateMessages()},checkValidity(){const e=yn.Message.prototype.checkValidity.call(this);return!e&&this.collection.chatbox.debouncedRejoin(),e},onOccupantRemoved(){var e;this.stopListening(this.occupant),delete this.occupant;const t=null==this||null===(e=this.collection)||void 0===e?void 0:e.chatbox;if(!t)return st.error("Could not get collection.chatbox for message: ".concat(JSON.stringify(this.toJSON())));this.listenTo(t.occupants,"add",this.onOccupantAdded)},onOccupantAdded(e){if(e.get("nick")===pi.getResourceFromJid(this.get("from"))){var t;this.occupant=e,this.trigger("occupantAdded"),this.listenTo(this.occupant,"destroy",this.onOccupantRemoved);const n=null==this||null===(t=this.collection)||void 0===t?void 0:t.chatbox;if(!n)return st.error("Could not get collection.chatbox for message: ".concat(JSON.stringify(this.toJSON())));this.stopListening(n.occupants,"add",this.onOccupantAdded)}},setOccupant(){var e;if("groupchat"!==this.get("type"))return;const t=null==this||null===(e=this.collection)||void 0===e?void 0:e.chatbox;if(!t)return st.error("Could not get collection.chatbox for message: ".concat(JSON.stringify(this.toJSON())));const n=pi.getResourceFromJid(this.get("from"));if(this.occupant=t.occupants.findWhere({nick:n}),!this.occupant&&xn.settings.get("muc_send_probes")){this.occupant=t.occupants.create({nick:n,type:"unavailable"});const e="".concat(t.get("jid"),"/").concat(n);xn.user.presence.send("probe",e)}this.occupant?this.listenTo(this.occupant,"destroy",this.onOccupantRemoved):this.listenTo(t.occupants,"add",this.onOccupantAdded)}});const n=x.extend({defaults:()=>({connection_status:zn.ROOMSTATUS.DISCONNECTED})});if(yn.ChatRoomMessages=A.extend({model:yn.ChatRoomMessage,comparator:"time"}),yn.ChatRoom=yn.ChatBox.extend({messagesCollection:yn.ChatRoomMessages,defaults(){return{num_unread_general:0,bookmarked:!1,chat_state:void 0,hidden:["mobile","fullscreen"].includes(xn.settings.get("view_mode")),message_type:"groupchat",name:"",num_unread:0,roomconfig:{},time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:yn.CHATROOMS_TYPE}},async initialize(){this.initialized=ui.getResolveablePromise(),this.debouncedRejoin=Object(i.debounce)(this.rejoin,250),this.set("box_id","box-".concat(btoa(this.get("jid")))),this.initMessages(),this.initNotifications(),this.initOccupants(),this.initDiscoModels(),this.registerHandlers(),this.on("change:chat_state",this.sendChatState,this),await this.restoreSession(),this.session.on("change:connection_status",this.onConnectionStatusChanged,this),this.listenTo(this.occupants,"add",this.onOccupantAdded),this.listenTo(this.occupants,"remove",this.onOccupantRemoved),this.listenTo(this.occupants,"change:show",this.onOccupantShowChanged),this.listenTo(this.occupants,"change:affiliation",this.createAffiliationChangeMessage),this.listenTo(this.occupants,"change:role",this.createRoleChangeMessage),await this.restoreFromCache()||this.join(),await xn.trigger("chatRoomInitialized",this,{Synchronous:!0}),this.initialized.resolve()},async restoreFromCache(){return this.session.get("connection_status")===zn.ROOMSTATUS.ENTERED&&await this.isJoined()?(await new Promise(e=>this.features.fetch({success:e,error:e})),await this.fetchOccupants(),await this.fetchMessages(),!0):(await this.clearCache(),!1)},async join(e,t){if(this.session.get("connection_status")===zn.ROOMSTATUS.ENTERED)return this;if(await this.refreshDiscoInfo(),!(e=await this.getAndPersistNickname(e)))return ui.safeSave(this.session,{connection_status:zn.ROOMSTATUS.NICKNAME_REQUIRED}),xn.settings.get("muc_show_logs_before_join")&&await this.fetchMessages(),this;const n=_i({from:yn.connection.jid,to:this.getRoomJIDAndNick()}).c("x",{xmlns:pi.NS.MUC}).c("history",{maxstanzas:this.features.get("mam_enabled")?0:xn.settings.get("muc_history_max_stanzas")}).up();return t&&n.cnode(pi.xmlElement("password",[],t)),this.session.save("connection_status",zn.ROOMSTATUS.CONNECTING),xn.send(n),this},async fetchMessages(){await yn.ChatBox.prototype.fetchMessages.call(this);const e=this.message_queue.map(e=>this.queueMessage(e));return this.message_queue=[],Promise.all(e)},async clearCache(){this.session.save("connection_status",zn.ROOMSTATUS.DISCONNECTED),this.occupants.length?this.occupants.filter(e=>!e.isMember()).forEach(e=>e.destroy()):this.occupants.clearStore(),yn.clear_messages_on_reconnection&&await this.clearMessages()},onOccupantAdded(e){xn.settings.get("muc_show_join_leave")&&this.session.get("connection_status")===zn.ROOMSTATUS.ENTERED&&"online"===e.get("show")&&this.updateNotifications(e.get("nick"),"entered")},onOccupantRemoved(e){xn.settings.get("muc_show_join_leave")&&this.session.get("connection_status")===zn.ROOMSTATUS.ENTERED&&"online"===e.get("show")&&this.updateNotifications(e.get("nick"),"exited")},onOccupantShowChanged(e){!e.get("states").includes("303")&&xn.settings.get("muc_show_join_leave")&&("offline"===e.get("show")?this.updateNotifications(e.get("nick"),"exited"):"online"===e.get("show")&&this.updateNotifications(e.get("nick"),"entered"))},rejoin(){return this.clearCache(),this.join()},initMessages(){this.message_queue=[],yn.ChatBox.prototype.initMessages.call(this)},async onConnectionStatusChanged(){this.session.get("connection_status")===zn.ROOMSTATUS.ENTERED&&(await this.occupants.fetchMembers(),await this.fetchMessages(),xn.trigger("enteredNewRoom",this),xn.settings.get("auto_register_muc_nickname")&&await xn.disco.supports(pi.NS.MUC_REGISTER,this.get("jid"))&&this.registerNickname())},async onReconnection(){this.registerHandlers(),await this.rejoin(),this.announceReconnection()},restoreSession(){const e="muc.session-".concat(yn.bare_jid,"-").concat(this.get("jid"));return this.session=new n({id:e}),this.session.browserStorage=yn.createStore(e,"session"),new Promise(e=>this.session.fetch({success:e,error:e}))},initDiscoModels(){let e="converse.muc-features-".concat(yn.bare_jid,"-").concat(this.get("jid"));this.features=new x(Object.assign({id:e},Object(i.zipObject)(zn.ROOM_FEATURES,zn.ROOM_FEATURES.map(()=>!1)))),this.features.browserStorage=yn.createStore(e,"session"),e="converse.muc-config-{_converse.bare_jid}-".concat(this.get("jid")),this.config=new x,this.config.browserStorage=yn.createStore(e,"session")},initOccupants(){this.occupants=new yn.ChatRoomOccupants;const e="converse.occupants-".concat(yn.bare_jid).concat(this.get("jid"));this.occupants.browserStorage=yn.createStore(e,"session"),this.occupants.chatroom=this},fetchOccupants(){return this.occupants.fetched=new Promise(e=>{this.occupants.fetch({add:!0,silent:!0,success:e,error:e})}),this.occupants.fetched},handleAffiliationChangedMessage(e){const t=bi('x[xmlns="'.concat(pi.NS.MUC_USER,'"] item'),e).pop();if(t){const n=e.getAttribute("from"),i=e.getAttribute("type"),r=t.getAttribute("affiliation"),o=t.getAttribute("jid"),s={from:n,type:i,affiliation:r,nick:pi.getNodeFromJid(o),states:[],show:"unavailable"==i?"offline":"online",role:t.getAttribute("role"),jid:pi.getBareJidFromJid(o),resource:pi.getResourceFromJid(o)},a=this.occupants.findOccupant({jid:s.jid});a?a.save(s):this.occupants.create(s)}},async handleErrormessageStanza(e){if(await this.shouldShowErrorMessage(e)){const t=await cn.parseMUCMessage(e,this,yn),n=t.msgid&&this.messages.findWhere({msgid:t.msgid});n?n.save({error:t.error}):this.createMessage(t)}},async handleMessageStanza(e){if(cn.isArchived(e))return st.warn('Received a MAM message with type "groupchat"');xn.trigger("message",{stanza:e}),this.createInfoMessages(e),this.fetchFeaturesIfConfigurationChanged(e);const t=await cn.parseMUCMessage(e,this,yn);return t&&this.queueMessage(t)},registerHandlers(){const e=this.get("jid");this.removeHandlers(),this.presence_handler=yn.connection.addHandler(e=>this.onPresence(e)||!0,null,"presence",null,null,e,{ignoreNamespaceFragment:!0,matchBareFromJid:!0}),this.message_handler=yn.connection.addHandler(e=>!!this.handleMessageStanza(e)||!0,null,"message","groupchat",null,e,{matchBareFromJid:!0}),this.affiliation_message_handler=yn.connection.addHandler(e=>this.handleAffiliationChangedMessage(e)||!0,pi.NS.MUC_USER,"message",null,null,e)},removeHandlers(){return this.message_handler&&(yn.connection&&yn.connection.deleteHandler(this.message_handler),delete this.message_handler),this.presence_handler&&(yn.connection&&yn.connection.deleteHandler(this.presence_handler),delete this.presence_handler),this.affiliation_message_handler&&(yn.connection&&yn.connection.deleteHandler(this.affiliation_message_handler),delete this.affiliation_message_handler),this},invitesAllowed(){return xn.settings.get("allow_muc_invitations")&&(this.features.get("open")||"owner"===this.getOwnAffiliation())},getDisplayName(){const e=this.get("name");return e||("hidden"===xn.settings.get("locked_muc_domain")?pi.getNodeFromJid(this.get("jid")):this.get("jid"))},sendTimedMessage(e){"function"==typeof e.tree&&(e=e.tree());let t=e.getAttribute("id");t||(t=this.getUniqueId("sendIQ"),e.setAttribute("id",t));const n=ui.getResolveablePromise(),i=yn.connection.addTimedHandler(yn.STANZA_TIMEOUT,()=>(yn.connection.deleteHandler(r),n.reject(new yn.TimeoutError("Timeout Error: No response from server")),!1)),r=yn.connection.addHandler(e=>{i&&yn.connection.deleteTimedHandler(i),"groupchat"===e.getAttribute("type")?n.resolve(e):n.reject(e)},null,"message",["error","groupchat"],t);return xn.send(e),n},async retractOwnMessage(e){const t=e.get("editable");e.save({retracted:(new Date).toISOString(),retracted_id:e.get("origin_id"),editable:!1});try{await this.sendRetractionMessage(e)}catch(n){throw e.save({editable:t,retracted:void 0,retracted_id:void 0}),n}},async retractOtherMessage(e,t){const n=e.get("editable");e.save({moderated:"retracted",moderated_by:yn.bare_jid,moderated_id:e.get("msgid"),moderation_reason:t,editable:!1});const i=await this.sendRetractionIQ(e,t);return(null===i||ui.isErrorStanza(i))&&e.save({editable:n,moderated:void 0,moderated_by:void 0,moderated_id:void 0,moderation_reason:void 0}),i},sendRetractionMessage(e){const t=e.get("origin_id");if(!t)throw new Error("Can't retract message without a XEP-0359 Origin ID");const n=vi({id:ui.getUniqueId(),to:this.get("jid"),type:"groupchat"}).c("store",{xmlns:pi.NS.HINTS}).up().c("apply-to",{id:t,xmlns:pi.NS.FASTEN}).c("retract",{xmlns:pi.NS.RETRACT});return this.sendTimedMessage(n)},sendRetractionIQ(e,t){const n=gi({to:this.get("jid"),type:"set"}).c("apply-to",{id:e.get("stanza_id ".concat(this.get("jid"))),xmlns:pi.NS.FASTEN}).c("moderate",{xmlns:pi.NS.MODERATE}).c("retract",{xmlns:pi.NS.RETRACT}).up().c("reason").t(t||"");return xn.sendIQ(n,null,!1)},sendDestroyIQ(e,t){const n=mi("destroy");t&&n.attrs({jid:t});const i=gi({to:this.get("jid"),type:"set"}).c("query",{xmlns:pi.NS.MUC_OWNER}).cnode(n.node);return e&&e.length>0&&i.c("reason",e),xn.sendIQ(i)},async leave(e){if(this.features.destroy(),this.occupants.clearStore(),yn.disco_entities){const e=yn.disco_entities.get(this.get("jid"));e&&await new Promise((t,n)=>e.destroy({success:t,error:n}))}xn.connection.connected()&&xn.user.presence.send("unavailable",this.getRoomJIDAndNick(),e),ui.safeSave(this.session,{connection_status:zn.ROOMSTATUS.DISCONNECTED}),this.removeHandlers()},async close(){return await new Promise(e=>this.session.destroy({success:e,error:(t,n)=>{st.error(n),e()}})),await new Promise(e=>this.features.destroy({success:e,error:(t,n)=>{st.error(n),e()}})),yn.ChatBox.prototype.close.call(this)},canModerateMessages(){const e=this.getOwnOccupant();return e&&e.isModerator()&&xn.disco.supports(pi.NS.MODERATE,this.get("jid"))},getAllKnownNicknames(){return[...new Set([...this.occupants.map(e=>e.get("nick")),...this.messages.map(e=>e.get("nick"))])].filter(e=>e)},getReferenceForMention(e,t){const n=this.getAllKnownNicknames(),i=ui.getLongestSubstring(e,n);if(!i)return null;if((e[i.length]||"").match(/[A-Za-zäëïöüâêîôûáéíóúàèìòùÄËÏÖÜÂÊÎÔÛÁÉÍÓÚÀÈÌÒÙ0-9]/i))return null;let r;const o=this.occupants.findOccupant({nick:i})||ui.isValidJID(i)&&this.occupants.findOccupant({jid:i});if(o)r=o.get("jid")||"".concat(this.get("jid"),"/").concat(o.get("nick"));else{if(!n.includes(i))return;r="".concat(this.get("jid"),"/").concat(i)}return{begin:t,end:t+i.length,value:i,type:"mention",uri:encodeURI("xmpp:".concat(r))}},extractReference(e,t){for(let n=t;n<e.length;n++)if("@"===e[n]&&(0===n||" "===e[n-1])){const t=e.slice(n+1),i=this.getReferenceForMention(t,n);if(i)return[e.slice(0,n)+t,i,n]}},parseTextForReferences(e){const t=[];let n=0;for(;n<(e||"").length;){const i=this.extractReference(e,n);if(!i)break;e=i[0],t.push(i[1]),n=i[2]}return[e,t]},getOutgoingMessageAttributes(e,t){const n=this.get("composing_spoiler");var i;[e,i]=this.parseTextForReferences(e);const r=ui.getUniqueId(),o=e?ui.httpToGeoUri(ui.shortnameToUnicode(e),yn):void 0;return{body:o,is_spoiler:n,origin_id:r,references:i,id:r,msgid:r,from:"".concat(this.get("jid"),"/").concat(this.get("nick")),fullname:this.get("nick"),is_only_emojis:!!e&&ui.isOnlyEmojis(e),message:o,nick:this.get("nick"),sender:"me",spoiler_hint:n?t:void 0,type:"groupchat"}},getRoomJIDAndNick(){const e=this.get("nick");return pi.getBareJidFromJid(this.get("jid"))+(null!==e?"/".concat(e):"")},sendChatState(){if(!yn.send_chat_state_notifications||!this.get("chat_state")||this.session.get("connection_status")!==zn.ROOMSTATUS.ENTERED||this.features.get("moderated")&&"visitor"===this.getOwnRole())return;const e=yn.send_chat_state_notifications;if(Array.isArray(e)&&!e.includes(this.get("chat_state")))return;const t=this.get("chat_state");t!==yn.GONE&&xn.send(vi({to:this.get("jid"),type:"groupchat"}).c(t,{xmlns:pi.NS.CHATSTATES}).up().c("no-store",{xmlns:pi.NS.HINTS}).up().c("no-permanent-store",{xmlns:pi.NS.HINTS}))},directInvite(e,t){this.features.get("membersonly")&&this.updateMemberLists([{jid:e,affiliation:"member",reason:t}]);const n={xmlns:"jabber:x:conference",jid:this.get("jid")};null!==t&&(n.reason=t),this.get("password")&&(n.password=this.get("password"));const i=vi({from:yn.connection.jid,to:e,id:ui.getUniqueId()}).c("x",n);xn.send(i),xn.trigger("roomInviteSent",{room:this,recipient:e,reason:t})},refreshDiscoInfo(){return xn.disco.refresh(this.get("jid")).then(()=>this.getDiscoInfo()).catch(e=>st.error(e))},getDiscoInfo(){return xn.disco.getIdentity("conference","text",this.get("jid")).then(e=>this.save({name:e&&e.get("name")})).then(()=>this.getDiscoInfoFields()).then(()=>this.getDiscoInfoFeatures()).catch(e=>st.error(e))},async getDiscoInfoFields(){const e=(await xn.disco.getFields(this.get("jid"))).reduce((e,t)=>{const n=t.get("var");return n&&n.startsWith("muc#roominfo_")&&(e[n.replace("muc#roominfo_","")]=t.get("value")),e},{});this.config.save(e)},async getDiscoInfoFeatures(){const e=await xn.disco.getFeatures(this.get("jid")),t=Object.assign(Object(i.zipObject)(zn.ROOM_FEATURES,zn.ROOM_FEATURES.map(()=>!1)),{fetched:(new Date).toISOString()});e.each(e=>{const n=e.get("var");n.startsWith("muc_")?t[n.replace("muc_","")]=!0:n===pi.NS.MAM&&(t.mam_enabled=!0)}),this.features.save(t)},setAffiliation(e,t){return t=t.filter(t=>void 0===t.affiliation||t.affiliation===e),Promise.all(t.map(t=>this.sendAffiliationIQ(e,t)))},addFieldValue(e){const t=e.getAttribute("type");if("fixed"===t)return e;const n=e.getAttribute("var").replace("muc#roomconfig_",""),i=this.get("roomconfig");if(n in i){let r;switch(t){case"boolean":r=[i[n]?1:0];break;case"list-multi":r=i[n];break;default:r=[i[n]]}e.innerHTML=r.map(e=>mi("value").t(e)).join("")}return e},async autoConfigureChatRoom(){const e=await this.fetchRoomConfiguration(),t=bi("field",e).map(e=>this.addFieldValue(e));if(t.length)return this.sendConfiguration(t)},fetchRoomConfiguration(){return xn.sendIQ(gi({to:this.get("jid"),type:"get"}).c("query",{xmlns:pi.NS.MUC_OWNER}))},sendConfiguration(e=[]){const t=gi({to:this.get("jid"),type:"set"}).c("query",{xmlns:pi.NS.MUC_OWNER}).c("x",{xmlns:pi.NS.XFORM,type:"submit"});return e.forEach(e=>t.cnode(e).up()),xn.sendIQ(t)},getOwnRole(){var e,t;return null===(e=this.getOwnOccupant())||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.role},getOwnAffiliation(){var e,t;return null===(e=this.getOwnOccupant())||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.affiliation},getOwnOccupant(){return this.occupants.findWhere({jid:yn.bare_jid})},sendAffiliationIQ(e,t){const n=gi({to:this.get("jid"),type:"set"}).c("query",{xmlns:pi.NS.MUC_ADMIN}).c("item",{affiliation:t.affiliation||e,nick:t.nick,jid:t.jid});return void 0!==t.reason&&n.c("reason",t.reason),xn.sendIQ(n)},setAffiliations(e){const t=Object(i.uniq)(e.map(e=>e.affiliation));return Promise.all(t.map(t=>this.setAffiliation(t,e)))},setRole(e,t,n,i,r){const o=mi("item",{nick:e.get("nick"),role:t}),s=gi({to:this.get("jid"),type:"set"}).c("query",{xmlns:pi.NS.MUC_ADMIN}).cnode(o.node);return null!==n&&s.c("reason",n),xn.sendIQ(s).then(i).catch(r)},getOccupant(e){return ui.isValidJID(e)&&this.occupants.findWhere({jid:e})||this.occupants.findWhere({nick:e})},getOccupantsWithRole(e){return this.getOccupantsSortedBy("nick").filter(t=>t.get("role")===e).map(e=>({jid:e.get("jid"),nick:e.get("nick"),role:e.get("role")}))},getOccupantsWithAffiliation(e){return this.getOccupantsSortedBy("nick").filter(t=>t.get("affiliation")===e).map(e=>({jid:e.get("jid"),nick:e.get("nick"),affiliation:e.get("affiliation")}))},getOccupantsSortedBy(e){return Array.from(this.occupants.models).sort((t,n)=>t.get(e)<n.get(e)?-1:t.get(e)>n.get(e)?1:0)},async getAffiliationList(e){const t=gi({to:this.get("jid"),type:"get"}).c("query",{xmlns:pi.NS.MUC_ADMIN}).c("item",{affiliation:e}),n=await xn.sendIQ(t,null,!1);if(null===n){const t="Error: timeout while fetching ".concat(e," list for MUC ").concat(this.get("jid")),i=new Error(t);return st.warn(t),st.warn(n),i}if(ui.isErrorStanza(n)){const t="Error: not allowed to fetch ".concat(e," list for MUC ").concat(this.get("jid")),i=new Error(t);return st.warn(t),st.warn(n),i}return ai.parseMemberListIQ(n).filter(e=>e).sort((e,t)=>e.nick<t.nick?-1:e.nick>t.nick?1:0)},async updateMemberLists(e){const t=(await Promise.all(["member","admin","owner"].map(e=>this.getAffiliationList(e)))).reduce((e,t)=>ui.isErrorObject(t)?e:[...t,...e],[]);await this.setAffiliations(ai.computeAffiliationsDelta(!0,!1,e,t)),await this.occupants.fetchMembers()},async getAndPersistNickname(e){return(e=e||this.get("nick")||await this.getReservedNick()||yn.getDefaultMUCNickname())&&this.save({nick:e},{silent:!0}),e},async getReservedNick(){const e=gi({to:this.get("jid"),from:yn.connection.jid,type:"get"}).c("query",{xmlns:pi.NS.DISCO_INFO,node:"x-roomuser-item"}),t=await xn.sendIQ(e,null,!1);if(ui.isErrorObject(t))throw t;const n=t.querySelector('query[node="x-roomuser-item"] identity');return n?n.getAttribute("name"):null},async registerNickname(){const t=this.get("nick"),n=this.get("jid");let i,r;try{i=await xn.sendIQ(gi({to:n,from:yn.connection.jid,type:"get"}).c("query",{xmlns:pi.NS.MUC_REGISTER}))}catch(t){return bi('not-allowed[xmlns="'.concat(pi.NS.STANZAS,'"]'),t).length?r=e("You're not allowed to register yourself in this groupchat."):bi('registration-required[xmlns="'.concat(pi.NS.STANZAS,'"]'),t).length&&(r=e("You're not allowed to register in this groupchat because it's members-only.")),st.error(t),r}const o=bi("field required",i).map(e=>e.parentElement);if(o.length>1&&"muc#register_roomnick"!==o[0].getAttribute("var"))return st.error("Can't register the user register in the groupchat ".concat(n," due to the required fields"));try{await xn.sendIQ(gi({to:n,from:yn.connection.jid,type:"set"}).c("query",{xmlns:pi.NS.MUC_REGISTER}).c("x",{xmlns:pi.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#register").up().up().c("field",{var:"muc#register_roomnick"}).c("value").t(t))}catch(t){return bi('service-unavailable[xmlns="'.concat(pi.NS.STANZAS,'"]'),t).length?r=e("Can't register your nickname in this groupchat, it doesn't support registration."):bi('bad-request[xmlns="'.concat(pi.NS.STANZAS,'"]'),t).length&&(r=e("Can't register your nickname in this groupchat, invalid data form supplied.")),st.error(r),st.error(t),r}},updateOccupantsOnPresence(e){var t,n;const i=cn.parseMUCPresence(e);if("error"===i.type||!i.jid&&!i.nick)return!0;const r=this.occupants.findOccupant(i);if("unavailable"===i.type&&r&&!i.states.includes(zn.MUC_NICK_CHANGED_CODE)&&!r.isMember())return r.set(i),void r.destroy();const o=i.jid||"",s=Object.assign(i,{jid:pi.getBareJidFromJid(o)||(null==r||null===(t=r.attributes)||void 0===t?void 0:t.jid),resource:pi.getResourceFromJid(o)||(null==r||null===(n=r.attributes)||void 0===n?void 0:n.resource)});r?r.save(s):this.occupants.create(s)},fetchFeaturesIfConfigurationChanged(e){const t=["104","170","171","172","173","174"];bi("status",e).filter(e=>t.includes(e.getAttribute("status"))).length&&this.refreshDiscoInfo()},isSameUser(e,t){const n=pi.getBareJidFromJid(e),i=pi.getBareJidFromJid(t),r=pi.getResourceFromJid(e),o=pi.getResourceFromJid(t);if(ui.isSameBareJID(e,t))return n!==this.get("jid")||r===o;return(n===this.get("jid")?this.occupants.findOccupant({nick:r}):this.occupants.findOccupant({jid:n}))===(i===this.get("jid")?this.occupants.findOccupant({nick:o}):this.occupants.findOccupant({jid:i}))},async isSubjectHidden(){return(await xn.user.settings.get("mucs_with_hidden_subject",[])).includes(this.get("jid"))},async toggleSubjectHiddenState(){const e=this.get("jid"),t=await xn.user.settings.get("mucs_with_hidden_subject",[]);t.includes(this.get("jid"))?xn.user.settings.set("mucs_with_hidden_subject",t.filter(t=>t!==e)):xn.user.settings.set("mucs_with_hidden_subject",[...t,e])},async handleSubjectChange(t){if(Object(i.isString)(t.subject)&&!t.thread&&!t.message){const n=t.subject,i=t.nick;if(ui.safeSave(this,{subject:{author:i,text:t.subject||""}}),!t.is_delayed&&i){const r=e(n?"Topic set by %1$s":"Topic cleared by %1$s",i),o=this.messages.last();(null==o?void 0:o.get("nick"))===t.nick&&"info"===(null==o?void 0:o.get("type"))&&(null==o?void 0:o.get("message"))===r||this.createMessage({message:r,nick:t.nick,type:"info"}),await this.isSubjectHidden()&&this.toggleSubjectHiddenState()}return!0}return!1},setSubject(e=""){xn.send(vi({to:this.get("jid"),from:yn.connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(e).tree())},ignorableCSN(e){return e.chat_state&&!e.body&&(e.is_delayed||this.isOwnMessage(e))},isOwnMessage(e){let t;return t=Object(i.isElement)(e)?e.getAttribute("from"):e instanceof yn.Message?e.get("from"):e.from,pi.getResourceFromJid(t)==this.get("nick")},getUpdatedMessageAttributes(e,t){const n=yn.ChatBox.prototype.getUpdatedMessageAttributes.call(this,e,t);if(this.isOwnMessage(t)){const r=Object.keys(t).filter(e=>e.startsWith("stanza_id"));Object.assign(n,Object(i.pick)(t,r)),e.get("received")||(n.received=(new Date).toISOString())}return n},async isJoined(){const e=gi({to:"".concat(this.get("jid"),"/").concat(this.get("nick")),type:"get"}).c("ping",{xmlns:pi.NS.PING});try{await xn.sendIQ(e)}catch(e){return null===e?st.error("Timeout error while checking whether we're joined to MUC: ".concat(this.get("jid"))):(st.error("Apparently we're no longer connected to MUC: ".concat(this.get("jid"))),st.error(e)),!1}return!0},async rejoinIfNecessary(){if(!await this.isJoined())return this.rejoin(),!0},async shouldShowErrorMessage(e){return(!bi('not-acceptable[xmlns="'.concat(pi.NS.STANZAS,'"]'),e).length||!await this.rejoinIfNecessary())&&yn.ChatBox.prototype.shouldShowErrorMessage.call(this,e)},findDanglingModeration(e){if(!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models),n=e["stanza_id ".concat(this.get("jid"))];return n?(t.reverse(),t.find(({attributes:e})=>"retracted"===e.moderated&&e.moderated_id===n&&e.moderated_by)):null}},async handleModeration(e){const t=["editable","moderated","moderated_by","moderated_id","moderation_reason"];if("retracted"===e.moderated){const n={};n["stanza_id ".concat(this.get("jid"))]=e.moderated_id;const r=this.messages.findWhere(n);return r?(r.save(Object(i.pick)(e,t)),!0):(e.dangling_moderation=!0,await this.createMessage(e),!0)}{const n=this.findDanglingModeration(e);if(n){const r=Object(i.pick)(n.attributes,t),o=Object.assign({dangling_moderation:!1},e,r);return delete o.id,n.save(o),!0}}return!1},queueMessage(e){var t;return(null===(t=this.messages)||void 0===t?void 0:t.fetched)?(this.msg_chain=this.msg_chain||this.messages.fetched,this.msg_chain=this.msg_chain.then(()=>this.onMessage(e)),this.msg_chain):(this.message_queue.push(e),Promise.resolve())},removeNotification(e,t){const n=this.notifications.toJSON();(t=Array.isArray(t)?t:[t]).forEach(t=>{const i=Array.from(n[t]||[]);if(i.includes(e)){const n=i.indexOf(e);i.splice(n,1),this.notifications.set(t,Array.from(i))}})},updateNotifications(e,t){const n=this.notifications.toJSON(),i=n[t]||[];if(i.includes(e))return;const r=(r,o)=>(r[o]=o===t?[...i,e]:(n[o]||[]).filter(t=>t!==e),r),o=zn.CHAT_STATES.reduce(r,{}),s=zn.MUC_TRAFFIC_STATES.reduce(r,{}),a=zn.MUC_ROLE_CHANGES.reduce(r,{});this.notifications.set(Object.assign(o,s,a)),window.setTimeout(()=>this.removeNotification(e,t),1e4)},async onMessage(e){if(ui.isErrorObject(e))return e.stanza&&st.error(e.stanza),st.error(e.message);e=e.encrypted?await this.decrypt(e):e;const t=this.getDuplicateMessage(e);if(t)return this.updateMessage(t,e);if(!(e.is_receipt_request||e.is_marker||this.ignorableCSN(e))){if(await this.handleRetraction(e)||await this.handleModeration(e)||await this.handleSubjectChange(e))return this.removeNotification(e.nick,["composing","paused"]);if(this.setEditable(e,e.time),e.chat_state&&this.updateNotifications(e.nick,e.chat_state),ui.shouldCreateGroupchatMessage(e)){const t=this.handleCorrection(e)||await this.createMessage(e);this.removeNotification(e.nick,["composing","paused"]),this.incrementUnreadMsgCounter(t)}}},handleModifyError(e){var t;const n=null===(t=e.querySelector("error text"))||void 0===t?void 0:t.textContent;if(n)if(this.session.get("connection_status")===zn.ROOMSTATUS.CONNECTING)this.setDisconnectionMessage(n);else{const e={type:"error",message:n,is_ephemeral:!0};this.createMessage(e)}},handleDisconnection(e){var t;const n=null!==e.querySelector("status[code='110']"),r=bi('x[xmlns="'.concat(pi.NS.MUC_USER,'"]'),e).pop();if(!r)return;const o=bi("status",r).map(e=>e.getAttribute("code")),s=Object(i.intersection)(o,Object.keys(yn.muc.disconnect_messages));if(!(n&&s.length>0))return;const a=r.querySelector("item"),c=a?null===(t=a.querySelector("reason"))||void 0===t?void 0:t.textContent:void 0,l=a?Object(i.invoke)(a.querySelector("actor"),"getAttribute","nick"):void 0,u=yn.muc.disconnect_messages[s[0]];this.setDisconnectionMessage(u,c,l)},getActionInfoMessage:(n,i,r)=>"301"===n?r?e("%1$s has been banned by %2$s",i,r):e("%1$s has been banned",i):"303"===n?t("%1$s's nickname has changed",i):"307"===n?r?e("%1$s has been kicked out by %2$s",i,r):e("%1$s has been kicked out",i):"321"===n?e("%1$s has been removed because of an affiliation change"):"322"===n?t("%1$s has been removed for not being a member"):void 0,createAffiliationChangeMessage(t){const n=t._previousAttributes.affiliation;if(!n)return;const i=t.get("affiliation");"admin"===n?this.createMessage({type:"info",message:e("%1$s is no longer an admin of this groupchat",t.get("nick"))}):"owner"===n?this.createMessage({type:"info",message:e("%1$s is no longer an owner of this groupchat",t.get("nick"))}):"outcast"===n&&this.createMessage({type:"info",message:e("%1$s is no longer banned from this groupchat",t.get("nick"))}),"none"===i&&"member"===n&&this.createMessage({type:"info",message:e("%1$s is no longer a member of this groupchat",t.get("nick"))}),"member"===i?this.createMessage({type:"info",message:e("%1$s is now a member of this groupchat",t.get("nick"))}):"admin"!==i&&"owner"!=i||this.createMessage({type:"info",message:e("%1$s is now an %2$s of this groupchat",t.get("nick"),i)})},createRoleChangeMessage(e,t){if("none"===t||e.changed.affiliation)return;const n=e._previousAttributes.role;"moderator"===n?this.updateNotifications(e.get("nick"),"deop"):"visitor"===n&&this.updateNotifications(e.get("nick"),"voice"),"visitor"===e.get("role")?this.updateNotifications(e.get("nick"),"mute"):"moderator"===e.get("role")&&(["owner","admin"].includes(e.get("affiliation"))||this.updateNotifications(e.get("nick"),"op"))},createInfoMessages(t){const n=null!==t.querySelector("status[code='110']"),r=bi('x[xmlns="'.concat(pi.NS.MUC_USER,'"]'),t).pop();r&&bi("status",r).map(e=>e.getAttribute("code")).forEach(o=>{const s={type:"info"};if("110"!==o&&("100"!==o||n)){if(o in yn.muc.info_messages)s.message=yn.muc.info_messages[o];else if(!n&&yn.muc.action_info_codes.includes(o)){var a;const e=pi.getResourceFromJid(t.getAttribute("from")),n=r.querySelector("item");s.actor=n?Object(i.invoke)(n.querySelector("actor"),"getAttribute","nick"):void 0,s.reason=n?null===(a=n.querySelector("reason"))||void 0===a?void 0:a.textContent:void 0,s.message=this.getActionInfoMessage(o,e,s.actor)}else if(n&&o in yn.muc.new_nickname_messages){let i;n&&"210"===o?i=pi.getResourceFromJid(t.getAttribute("from")):n&&"303"===o&&(i=t.querySelector("x item").getAttribute("nick")),this.save("nick",i),s.message=e(yn.muc.new_nickname_messages[o],i)}if(s.message){if("201"===o&&this.messages.findWhere(s))return;if(o in yn.muc.info_messages&&this.messages.length&&this.messages.pop().get("message")===s.message)return;this.createMessage(s)}}})},setDisconnectionMessage(e,t,n){this.save({disconnection_message:e,disconnection_reason:t,disconnection_actor:n}),this.session.save({connection_status:zn.ROOMSTATUS.DISCONNECTED})},onNicknameClash(t){if(xn.settings.get("muc_nickname_from_jid")){const e=t.getAttribute("from").split("/")[1];if(e===yn.getDefaultMUCNickname())this.join(e+"-2");else{const t=e.lastIndexOf("-"),n=e.substring(t+1,e.length);this.join(e.substring(0,t+1)+String(Number(n)+1))}}else this.save({nickname_validation_message:e("The nickname you chose is reserved or currently in use, please choose a different one.")}),this.session.save({connection_status:zn.ROOMSTATUS.NICKNAME_REQUIRED})},onErrorPresence(t){var n;const i=t.querySelector("error"),r=i.getAttribute("type"),o=null===(n=bi('text[xmlns="'.concat(pi.NS.STANZAS,'"]'),i).pop())||void 0===n?void 0:n.textContent;if("modify"===r)this.handleModifyError(t);else if("auth"===r){if(bi('not-authorized[xmlns="'.concat(pi.NS.STANZAS,'"]'),i).length&&(this.save({password_validation_message:o||e("Password incorrect")}),this.session.save({connection_status:zn.ROOMSTATUS.PASSWORD_REQUIRED})),i.querySelector("registration-required")){const t=e("You are not on the member list of this groupchat.");this.setDisconnectionMessage(t,o)}else if(i.querySelector("forbidden")){const t=e("You have been banned from this groupchat.");this.setDisconnectionMessage(t,o)}}else if("cancel"===r)if(i.querySelector("not-allowed")){const t=e("You are not allowed to create new groupchats.");this.setDisconnectionMessage(t,o)}else if(i.querySelector("not-acceptable")){const t=e("Your nickname doesn't conform to this groupchat's policies.");this.setDisconnectionMessage(t,o)}else if(bi('gone[xmlns="'.concat(pi.NS.STANZAS,'"]'),i).length){var s;const e=null===(s=bi('gone[xmlns="'.concat(pi.NS.STANZAS,'"]'),i).pop())||void 0===s?void 0:s.textContent.replace(/^xmpp:/,"").replace(/\?join$/,"");this.save({moved_jid:e,destroyed_reason:o}),this.session.save({connection_status:zn.ROOMSTATUS.DESTROYED})}else if(i.querySelector("conflict"))this.onNicknameClash(t);else if(i.querySelector("item-not-found")){const t=e("This groupchat does not (yet) exist.");this.setDisconnectionMessage(t,o)}else if(i.querySelector("service-unavailable")){const t=e("This groupchat has reached its maximum number of participants.");this.setDisconnectionMessage(t,o)}else if(i.querySelector("remote-server-not-found")){const t=e("Remote server not found"),n=o?e('The explanation given is: "%1$s".',o):void 0;this.setDisconnectionMessage(t,n)}},onPresence(e){if("error"===e.getAttribute("type"))return this.onErrorPresence(e);this.createInfoMessages(e),e.querySelector("status[code='110']")?(this.onOwnPresence(e),"none"!==this.getOwnRole()&&this.session.get("connection_status")===zn.ROOMSTATUS.CONNECTING&&this.session.save("connection_status",zn.ROOMSTATUS.CONNECTED)):this.updateOccupantsOnPresence(e)},onOwnPresence(e){if("unavailable"!==e.getAttribute("type")&&this.session.save("connection_status",zn.ROOMSTATUS.ENTERED),this.updateOccupantsOnPresence(e),"unavailable"===e.getAttribute("type"))this.handleDisconnection(e);else{if(e.querySelector("status[code='201']"))if(this.get("auto_configure"))this.autoConfigureChatRoom().then(()=>this.refreshDiscoInfo());else{if(!xn.settings.get("muc_instant_rooms"))return void this.trigger("configurationNeeded");this.sendConfiguration().then(()=>this.refreshDiscoInfo())}else this.features.get("fetched")||("owner"===this.getOwnAffiliation()&&this.get("auto_configure")?this.autoConfigureChatRoom().then(()=>this.refreshDiscoInfo()):this.getDiscoInfo())}this.session.save({connection_status:zn.ROOMSTATUS.ENTERED})},isUserMentioned(e){const t=this.get("nick");if(e.get("references").length){return e.get("references").filter(e=>"mention"===e.type).map(e=>e.value).includes(t)}return new RegExp("\\b".concat(t,"\\b")).test(e.get("message"))},incrementUnreadMsgCounter(e){if(!e)return;if(e.get("message")&&ui.isNewMessage(e)&&this.isHidden()){this.setFirstUnreadMsgId(e);const t={num_unread_general:this.get("num_unread_general")+1};this.isUserMentioned(e)&&(t.num_unread=this.get("num_unread")+1,yn.incrementMsgCounter()),this.save(t)}},clearUnreadMsgCounter(){ui.safeSave(this,{num_unread:0,num_unread_general:0})}}),yn.ChatRoomOccupant=x.extend({defaults:{hats:[],show:"offline",states:[]},initialize(e){this.set(Object.assign({id:ui.getUniqueId()},e)),this.on("change:image_hash",this.onAvatarChanged,this)},onAvatarChanged(){const e=this.get("image_hash"),t=[];this.get("jid")&&t.push(yn.vcards.findWhere({jid:this.get("jid")})),t.push(yn.vcards.findWhere({jid:this.get("from")})),t.filter(e=>e).forEach(t=>{e&&t.get("image_hash")!==e&&xn.vcard.update(t,!0)})},getDisplayName(){return this.get("nick")||this.get("jid")},isMember(){return["admin","owner","member"].includes(this.get("affiliation"))},isModerator(){return["admin","owner"].includes(this.get("affiliation"))||"moderator"===this.get("role")},isSelf(){return this.get("states").includes("110")}}),yn.ChatRoomOccupants=A.extend({model:yn.ChatRoomOccupant,comparator(e,t){const n=e.get("role")||"none",i=t.get("role")||"none";if(fi[n]===fi[i]){const n=e.getDisplayName().toLowerCase(),i=t.getDisplayName().toLowerCase();return n<i?-1:n>i?1:0}return fi[n]<fi[i]?-1:1},getAutoFetchedAffiliationLists(){const e=xn.settings.get("muc_fetch_members");return Array.isArray(e)?e:e?["member","admin","owner"]:[]},async fetchMembers(){const e=this.getAutoFetchedAffiliationLists();if(0===e.length)return;const t=await Promise.all(e.map(e=>this.chatroom.getAffiliationList(e))),n=t.reduce((e,t)=>ui.isErrorObject(t)?e:[...t,...e],[]),i=e.filter(n=>!ui.isErrorObject(t[e.indexOf(n)])),r=n.map(e=>e.jid).filter(e=>void 0!==e),o=n.map(e=>!e.jid&&e.nick||void 0).filter(e=>void 0!==e);this.filter(e=>i.includes(e.get("affiliation"))&&!o.includes(e.get("nick"))&&!r.includes(e.get("jid"))).forEach(e=>{e.get("jid")!==yn.bare_jid&&("offline"===e.get("show")?e.destroy():e.save("affiliation",null))}),n.forEach(e=>{const t=e.jid?this.findOccupant({jid:e.jid}):this.findOccupant({nick:e.nick});t?t.save(e):this.create(e)}),xn.trigger("membersFetched")},findOccupant(e){const t=pi.getBareJidFromJid(e.jid);return t&&this.findWhere({jid:t})||this.findWhere({nick:e.nick})}}),yn.RoomsPanelModel=x.extend({defaults:function(){return{muc_domain:xn.settings.get("muc_domain"),nick:yn.getDefaultMUCNickname()}},setDomain(e){xn.settings.get("locked_muc_domain")||this.save("muc_domain",pi.getDomainFromJid(e))}}),yn.onDirectMUCInvitation=async function(t){const n=bi('x[xmlns="jabber:x:conference"]',t).pop(),i=pi.getBareJidFromJid(t.getAttribute("from")),r=n.getAttribute("jid"),o=n.getAttribute("reason");let s;if(xn.settings.get("auto_join_on_invite"))s=!0;else{let t=yn.roster.get(i);t=t?t.getDisplayName():i,s=o?confirm(e('%1$s has invited you to join a groupchat: %2$s, and left the following reason: "%3$s"',t,r,o)):confirm(e("%1$s has invited you to join a groupchat: %2$s",t,r))}if(!0===s){(await async function(e,t){t.type=yn.CHATROOMS_TYPE,t.id=e;const n=await xn.rooms.get(e,t,!0);return n.maybeShow(!0),n}(r,{password:n.getAttribute("password")})).session.get("connection_status")===zn.ROOMSTATUS.DISCONNECTED&&yn.chatboxes.get(r).rejoin()}},xn.settings.get("allow_muc_invitations")){const e=function(){yn.connection.addHandler(e=>(yn.onDirectMUCInvitation(e),!0),"jabber:x:conference","message")};xn.listen.on("connected",e),xn.listen.on("reconnected",e)}const r=function(e,t){return e.startsWith("xmpp:")&&e.endsWith("?join")&&(e=e.replace(/^xmpp:/,"").replace(/\?join$/,"")),xn.rooms.get(e,t,!0)};function o(){return yn.chatboxes.filter(e=>e.get("type")===yn.CHATROOMS_TYPE).forEach(e=>e.session.save({connection_status:zn.ROOMSTATUS.DISCONNECTED}))}xn.listen.on("beforeTearDown",()=>{yn.chatboxes.where({type:yn.CHATROOMS_TYPE}).forEach(e=>ui.safeSave(e.session,{connection_status:zn.ROOMSTATUS.DISCONNECTED}))}),xn.listen.on("windowStateChanged",(async function(e){if("visible"===e.state&&xn.connection.connected()){(await xn.rooms.get()).forEach(e=>e.rejoinIfNecessary())}})),xn.listen.on("addClientFeatures",()=>{xn.settings.get("allow_muc")&&xn.disco.own.features.add(pi.NS.MUC),xn.settings.get("allow_muc_invitations")&&xn.disco.own.features.add("jabber:x:conference")}),xn.listen.on("chatBoxesFetched",(function(){xn.settings.get("auto_join_rooms").forEach(e=>{if(Object(i.isString)(e)){if(yn.chatboxes.where({jid:e}).length)return;xn.rooms.open(e)}else Object(i.isObject)(e)?xn.rooms.open(e.jid,Object(i.clone)(e)):st.error('Invalid groupchat criteria specified for "auto_join_rooms"')}),xn.trigger("roomsAutoJoined")})),xn.listen.on("beforeResourceBinding",()=>{yn.connection.addHandler(e=>{const t=pi.getBareJidFromJid(e.getAttribute("from"));return yn.chatboxes.get(t)||xn.waitUntil("chatBoxesFetched").then(async()=>{const n=yn.chatboxes.get(t);n&&(await n.initialized,await n.messages.fetched,n.message_handler.run(e))}),!0},null,"message","groupchat")}),xn.listen.on("disconnected",o),xn.listen.on("statusInitialized",()=>{window.addEventListener(yn.unloadevent,()=>{!xn.connection.isType("websocket")||yn.enable_smacks&&yn.session.get("smacks_stream_id")||o()})}),zn.env.muc_utils=ai,Object.assign(xn,{rooms:{create(e,t={}){if(!(t=Object(i.isString)(t)?{nick:t}:t||{}).nick&&xn.settings.get("muc_nickname_from_jid")&&(t.nick=pi.getNodeFromJid(yn.bare_jid)),void 0===e)throw new TypeError("rooms.create: You need to provide at least one JID");return Object(i.isString)(e)?r(e,t):e.map(e=>r(e,t))},async open(e,t,n=!1){if(await xn.waitUntil("chatBoxesFetched"),void 0===e){const e="rooms.open: You need to provide at least one JID";throw st.error(e),new TypeError(e)}if(Object(i.isString)(e)){const i=await xn.rooms.create(e,t);return i&&i.maybeShow(n),i}{const i=await Promise.all(e.map(e=>xn.rooms.create(e,t)));return i.forEach(e=>e.maybeShow(n)),i}},async get(e,t={},n=!1){async function r(e){let i=await xn.chatboxes.get(e);return!i&&n?i=await xn.chatboxes.create(e,t,yn.ChatRoom):(i=i&&i.get("type")===yn.CHATROOMS_TYPE?i:null,i&&Object.keys(t).length&&i.save(t)),i}if(void 0===e){return(await xn.chatboxes.get()).filter(e=>e.get("type")===yn.CHATROOMS_TYPE)}return Object(i.isString)(e)?r(e):Promise.all(e.map(e=>r(e)))}}})}});
/**
 * @module converse-bookmarks
 * @description
 * Converse.js plugin which adds views for bookmarks specified in XEP-0048.
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:yi,$iq:wi,sizzle:Si}=zn.env,xi=zn.env.utils;zn.plugins.add("converse-bookmarks",{dependencies:["converse-chatboxes","converse-muc"],overrides:{ChatRoom:{getDisplayName(){const{_converse:e}=this.__super__;if(this.get("bookmarked")&&e.bookmarks){const t=e.bookmarks.findWhere({jid:this.get("jid")});if(t)return t.get("name")}return this.__super__.getDisplayName.apply(this,arguments)},getAndPersistNickname(e){const{_converse:t}=this.__super__;return e=e||t.getNicknameFromBookmark(this.get("jid")),this.__super__.getAndPersistNickname.call(this,e)}}},initialize(){const{__:e}=yn;xn.settings.update({allow_bookmarks:!0,allow_public_bookmarks:!1,muc_respect_autojoin:!0}),xn.promises.add("bookmarksInitialized"),yn.getNicknameFromBookmark=function(e){if(!yn.bookmarks||!xn.settings.get("allow_bookmarks"))return null;const t=yn.bookmarks.findWhere({jid:e});return t?t.get("nick"):void 0},yn.Bookmark=x.extend({getDisplayName(){return yi.xmlunescape(this.get("name"))}}),yn.Bookmarks=A.extend({model:yn.Bookmark,comparator:e=>e.get("name").toLowerCase(),initialize(){this.on("add",e=>this.openBookmarkedRoom(e).then(e=>this.markRoomAsBookmarked(e)).catch(e=>st.fatal(e))),this.on("remove",this.markRoomAsUnbookmarked,this),this.on("remove",this.sendBookmarkStanza,this);const e="converse.room-bookmarks".concat(yn.bare_jid);this.fetched_flag=e+"fetched",this.browserStorage=yn.createStore(e)},async openBookmarkedRoom(e){if(xn.settings.get("muc_respect_autojoin")&&e.get("autojoin")){(await xn.rooms.create(e.get("jid"),e.get("nick"))).maybeShow()}return e},fetchBookmarks(){const e=xi.getResolveablePromise();return window.sessionStorage.getItem(this.fetched_flag)?this.fetch({success:()=>e.resolve(),error:()=>e.resolve()}):this.fetchBookmarksFromServer(e),e},createBookmark(e){this.create(e),this.sendBookmarkStanza().catch(t=>this.onBookmarkError(t,e))},sendBookmarkStanza(){const e=wi({type:"set",from:yn.connection.jid}).c("pubsub",{xmlns:yi.NS.PUBSUB}).c("publish",{node:"storage:bookmarks"}).c("item",{id:"current"}).c("storage",{xmlns:"storage:bookmarks"});return this.forEach(t=>{e.c("conference",{name:t.get("name"),autojoin:t.get("autojoin"),jid:t.get("jid")}).c("nick").t(t.get("nick")).up().up()}),e.up().up().up(),e.c("publish-options").c("x",{xmlns:yi.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("http://jabber.org/protocol/pubsub#publish-options").up().up().c("field",{var:"pubsub#persist_items"}).c("value").t("true").up().up().c("field",{var:"pubsub#access_model"}).c("value").t("whitelist"),xn.sendIQ(e)},onBookmarkError(t,n){st.error("Error while trying to add bookmark"),st.error(t),xn.alert("error",e("Error"),[e("Sorry, something went wrong while trying to save your bookmark.")]),this.findWhere({jid:n.jid}).destroy()},fetchBookmarksFromServer(e){const t=wi({from:yn.connection.jid,type:"get"}).c("pubsub",{xmlns:yi.NS.PUBSUB}).c("items",{node:"storage:bookmarks"});xn.sendIQ(t).then(t=>this.onBookmarksReceived(e,t)).catch(t=>this.onBookmarksReceivedError(e,t))},markRoomAsBookmarked(e){const t=yn.chatboxes.get(e.get("jid"));void 0!==t&&t.save("bookmarked",!0)},markRoomAsUnbookmarked(e){const t=yn.chatboxes.get(e.get("jid"));void 0!==t&&t.save("bookmarked",!1)},createBookmarksFromStanza(e){Si('items[node="storage:bookmarks"] item storage[xmlns="storage:bookmarks"] conference',e).forEach(e=>{var t;const n=e.getAttribute("jid");this.create({jid:n,name:e.getAttribute("name")||n,autojoin:"true"===e.getAttribute("autojoin"),nick:(null===(t=e.querySelector("nick"))||void 0===t?void 0:t.textContent)||""})})},onBookmarksReceived(e,t){if(this.createBookmarksFromStanza(t),window.sessionStorage.setItem(this.fetched_flag,!0),void 0!==e)return e.resolve()},onBookmarksReceivedError(t,n){if(null===n)st.error("Error: timeout while fetching bookmarks"),xn.alert("error",e("Timeout Error"),[e("The server did not return your bookmarks within the allowed time. You can reload the page to request them again.")]);else{if(t)return n.querySelector('error[type="cancel"] item-not-found')?(window.sessionStorage.setItem(this.fetched_flag,!0),t.resolve()):(st.error("Error while fetching bookmarks"),st.error(n),t.reject(new Error("Could not fetch bookmarks")));st.error("Error while fetching bookmarks"),st.error(n)}},getUnopenedBookmarks(){return this.filter(e=>!yn.chatboxes.get(e.get("jid")))}}),yn.BookmarksList=x.extend({defaults:{"toggle-state":yn.OPENED}}),yn.checkBookmarksSupport=async function(){const e=await xn.disco.getIdentity("pubsub","pep",yn.bare_jid);return yn.allow_public_bookmarks?!!e:xn.disco.supports(yi.NS.PUBSUB+"#publish-options",yn.bare_jid)};const t=async function(){xn.settings.get("allow_bookmarks")&&await yn.checkBookmarksSupport()&&(yn.bookmarks=new yn.Bookmarks,await yn.bookmarks.fetchBookmarks(),xn.trigger("bookmarksInitialized"))};xn.listen.on("clearSession",()=>{void 0!==yn.bookmarks&&(yn.bookmarks.clearStore({silent:!0}),window.sessionStorage.removeItem(yn.bookmarks.fetched_flag),delete yn.bookmarks)}),xn.listen.on("reconnected",t),xn.listen.on("connected",async()=>{yn.connection.addHandler(e=>{Si('event[xmlns="'+yi.NS.PUBSUB+'#event"] items[node="storage:bookmarks"]',e).length&&xn.waitUntil("bookmarksInitialized").then(()=>yn.bookmarks.createBookmarksFromStanza(e)).catch(e=>st.fatal(e))},null,"message","headline",null,yn.bare_jid),await Promise.all([xn.waitUntil("chatBoxesFetched")]),t()})}});const Ei=ke.Strophe,Ai=ke.$build;Ei.Request=function(e,t,n,i){this.id=++Ei._requestId,this.xmlData=e,this.data=Ei.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=i||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;return(new Date-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;return(new Date-this.dead)/1e3},this.xhr=this._newXHR()},Ei.Request.prototype={getResponse:function(){let e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"===e.tagName)throw Ei.error("invalid response received"),Ei.error("responseText: "+this.xhr.responseText),Ei.error("responseXML: "+Ei.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(Ei.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),e=(new DOMParser).parseFromString(this.xhr.responseText,"application/xml").documentElement,!e)throw new Error("Parsing produced null node");if(e.querySelector("parsererror")){Ei.error("invalid response received: "+e.querySelector("parsererror").textContent),Ei.error("responseText: "+this.xhr.responseText);const t=new Error;throw t.name=Ei.ErrorCondition.BAD_FORMAT,t}}return e},_newXHR:function(){let e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},Ei.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},Ei.Bosh.prototype={strip:null,_buildBody:function(){const e=Ai("body",{rid:this.rid++,xmlns:Ei.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;const i=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":Ei.NS.BOSH});n&&i.attrs({route:n});const r=this._conn._connect_cb;this._requests.push(new Ei.Request(i.tree(),this._onRequestStateChange.bind(this,r.bind(this._conn)),i.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,t,n,i,r,o,s){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=i,this._conn.domain=Ei.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=r||this.wait,this.hold=o||this.hold,this.window=s||this.window,this._conn._changeConnectStatus(Ei.Status.ATTACHED,null)},_restore:function(e,t,n,i,r){const o=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=o&&o.rid&&o.sid&&o.jid&&(null==e||Ei.getBareJidFromJid(o.jid)===Ei.getBareJidFromJid(e)||null===Ei.getNodeFromJid(e)&&Ei.getDomainFromJid(o.jid)===e))){const e=new Error("_restore: no restoreable session.");throw e.name="StropheSessionError",e}this._conn.restored=!0,this._attach(o.jid,o.sid,o.rid,t,n,i,r)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){const t=e.getAttribute("type");if(null!==t&&"terminate"===t){let t=e.getAttribute("condition");Ei.error("BOSH-Connection failed: "+t);const n=e.getElementsByTagName("conflict");return null!==t?("remote-stream-error"===t&&n.length>0&&(t="conflict"),this._conn._changeConnectStatus(Ei.Status.CONNFAIL,t)):this._conn._changeConnectStatus(Ei.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(t),Ei.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));const n=e.getAttribute("requests");n&&(this.window=parseInt(n,10));const i=e.getAttribute("hold");i&&(this.hold=parseInt(i,10));const r=e.getAttribute("wait");r&&(this.wait=parseInt(r,10));const o=e.getAttribute("inactivity");o&&(this.inactivity=parseInt(o,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(e){const t=this._getRequestStatus(e),n=this._conn.protocolErrorHandlers.HTTP[t];n&&n.call(this,t)},_hitError:function(e){this.errors++,Ei.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){Ei.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);const t=this._buildBody();this._requests.push(new Ei.Request(t.tree(),this._onRequestStateChange.bind(this,e),t.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(;this._requests.length>0;){const e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}},_onIdle:function(){const e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(Ei.debug("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){const t=this._buildBody();for(let n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":Ei.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new Ei.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){const e=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(Ei.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),e>Math.floor(Ei.TIMEOUT*this.wait)&&(Ei.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(Ei.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(e,t){let n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){Ei.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof t?t:0),n},_onRequestStateChange:function(e,t){if(Ei.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)return void(t.abort=!1);if(4!==t.xhr.readyState)return;const n=this._getRequestStatus(t);if(this.lastResponseHeaders=t.xhr.getAllResponseHeaders(),this.disconnecting&&n>=400)return this._hitError(n),void this._callProtocolErrorHandlers(t);const i=n>0&&n<500,r=t.sends>this._conn.maxRetries;if((i||r)&&(this._removeRequest(t),Ei.debug("request id "+t.id+" should now be removed")),200===n){const n=this._requests[0]===t;(this._requests[1]===t||n&&this._requests.length>0&&this._requests[0].age()>Math.floor(Ei.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(t.rid)+1),Ei.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0}else 0===n||n>=400&&n<600||n>=12e3?(Ei.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),this._hitError(n),this._callProtocolErrorHandlers(t),n>=400&&n<500&&(this._conn._changeConnectStatus(Ei.Status.DISCONNECTING,null),this._conn._doDisconnect())):Ei.error("request id "+t.id+"."+t.sends+" error "+n+" happened");i||r?r&&!this._conn.connected&&this._conn._changeConnectStatus(Ei.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()},_processRequest:function(e){let t=this._requests[e];const n=this._getRequestStatus(t,-1);if(t.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();const i=t.age(),r=!isNaN(i)&&i>Math.floor(Ei.TIMEOUT*this.wait),o=null!==t.dead&&t.timeDead()>Math.floor(Ei.SECONDARY_TIMEOUT*this.wait),s=4===t.xhr.readyState&&(n<1||n>=500);if((r||o||s)&&(o&&Ei.error(`Request ${this._requests[e].id} timed out (secondary), restarting`),t.abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){},this._requests[e]=new Ei.Request(t.xmlData,t.origFunc,t.rid,t.sends),t=this._requests[e]),0===t.xhr.readyState){Ei.debug("request id "+t.id+"."+t.sends+" posting");try{const e=this._conn.options.contentType||"text/xml; charset=utf-8";t.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==t.xhr.setRequestHeader&&t.xhr.setRequestHeader("Content-Type",e),this._conn.options.withCredentials&&(t.xhr.withCredentials=!0)}catch(e){return Ei.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(Ei.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}const e=()=>{if(t.date=new Date,this._conn.options.customHeaders){const e=this._conn.options.customHeaders;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.xhr.setRequestHeader(n,e[n])}t.xhr.send(t.data)};if(t.sends>1){const n=1e3*Math.min(Math.floor(Ei.TIMEOUT*this.wait),Math.pow(t.sends,3));setTimeout((function(){e()}),n)}else e();t.sends++,this._conn.xmlOutput!==Ei.Connection.prototype.xmlOutput&&(t.xmlData.nodeName===this.strip&&t.xmlData.childNodes.length?this._conn.xmlOutput(t.xmlData.childNodes[0]):this._conn.xmlOutput(t.xmlData)),this._conn.rawOutput!==Ei.Connection.prototype.rawOutput&&this._conn.rawOutput(t.data)}else Ei.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+t.xhr.readyState)},_removeRequest:function(e){Ei.debug("removing request");for(let t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){const t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){Ei.debug("_sendTerminate was called");const t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());const n=new Ei.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(()=>this._conn._onIdle(),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?Ei.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):Ei.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}};
/**
 * @module converse-bosh
 * @copyright The Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 * @description Converse.js plugin which add support for XEP-0206: XMPP Over BOSH
 */
const{Strophe:ji}=zn.env;zn.plugins.add("converse-bosh",{enabled:()=>!0,initialize(){xn.settings.update({bosh_service_url:void 0,prebind_url:null}),yn.startNewPreboundBOSHSession=function(){if(!xn.settings.get("prebind_url"))throw new Error("startNewPreboundBOSHSession: If you use prebind then you MUST supply a prebind_url");const e=new XMLHttpRequest;e.open("GET",xn.settings.get("prebind_url"),!0),e.setRequestHeader("Accept","application/json, text/javascript"),e.onload=async function(){if(e.status>=200&&e.status<400){const t=JSON.parse(e.responseText),n=await yn.setUserJID(t.jid);yn.connection.attach(n,t.sid,t.rid,yn.onConnectStatusChanged)}else e.onerror()},e.onerror=function(){delete yn.connection,xn.trigger("noResumeableBOSHSession",yn)},e.send()},yn.restoreBOSHSession=async function(){const e=(await async function(){const e="converse.bosh-session";if(yn.bosh_session||(yn.bosh_session=new x({id:e}),yn.bosh_session.browserStorage=yn.createStore(e,"session"),await new Promise(e=>yn.bosh_session.fetch({success:e,error:e}))),yn.jid){if(yn.bosh_session.get("jid")!==yn.jid){const e=await yn.setUserJID(yn.jid);yn.bosh_session.clear({silent:!0}),yn.bosh_session.save({jid:e})}}else{const e=yn.bosh_session.get("jid");e&&await yn.setUserJID(e)}return yn.bosh_session}()).get("jid");if(e&&yn.connection._proto instanceof ji.Bosh)try{return yn.connection.restore(e,yn.onConnectStatusChanged),!0}catch(t){return!yn.isTestEnv()&&st.warn("Could not restore session for jid: "+e+" Error message: "+t.message),!1}return!1},xn.listen.on("clearSession",()=>{if(void 0===yn.bosh_session){const e="converse.bosh-session";sessionStorage.removeItem(e),sessionStorage.removeItem("".concat(e,"-").concat(e))}else yn.bosh_session.destroy(),delete yn.bosh_session}),xn.listen.on("setUserJID",()=>{void 0!==yn.bosh_session&&yn.bosh_session.save({jid:yn.jid})}),xn.listen.on("addClientFeatures",()=>xn.disco.own.features.add(ji.NS.BOSH)),Object.assign(xn,{tokens:{get:e=>void 0===yn.connection?null:"rid"===e.toLowerCase()?yn.connection.rid||yn.connection._proto.rid:"sid"===e.toLowerCase()?yn.connection.sid||yn.connection._proto.sid:void 0}})}});
/**
 * @module converse-caps
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:Ci,$build:ki}=zn.env;function Oi(e,t){return e.sort((e,n)=>e[t]>n[t]?-1:1)}function Ti(e){const t=e.api.disco.own.identities.get(),n=e.api.disco.own.features.get();t.length>1&&(Oi(t,"category"),Oi(t,"type"),Oi(t,"lang"));let r=t.reduce((e,t)=>"".concat(e).concat(t.category,"/").concat(t.type,"/").concat(Object(i.get)(t,"lang",""),"/").concat(t.name,"<"),"");return n.sort(),r=n.reduce((e,t)=>"".concat(e).concat(t,"<"),r),we.b64_sha1(r)}Ci.addNamespace("CAPS","http://jabber.org/protocol/caps"),zn.plugins.add("converse-caps",{overrides:{XMPPStatus:{constructPresence(){const e=this.__super__.constructPresence.apply(this,arguments);var t;return e.root().cnode((t=this.__super__._converse,ki("c",{xmlns:Ci.NS.CAPS,hash:"sha-1",node:"https://conversejs.org",ver:Ti(t)}).nodeTree)),e}}}});
/**
 * @module converse-chatboxes
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:Ni}=zn.env;Ni.addNamespace("MESSAGE_CORRECT","urn:xmpp:message-correct:0"),Ni.addNamespace("RECEIPTS","urn:xmpp:receipts"),Ni.addNamespace("REFERENCE","urn:xmpp:reference:0"),Ni.addNamespace("MARKERS","urn:xmpp:chat-markers:0"),zn.plugins.add("converse-chatboxes",{dependencies:["converse-emoji","converse-roster","converse-vcard"],initialize(){xn.promises.add(["chatBoxesFetched","chatBoxesInitialized","privateChatsAutoJoined"]);let e=0;async function t(e,t,n){let i;e=Ni.getBareJidFromJid(e.toLowerCase()),Object.assign(t,{jid:e,id:e});try{i=new n(t,{collection:yn.chatboxes})}catch(e){return st.error(e),null}return await i.initialized,i.isValid()?(yn.chatboxes.add(i),await i.messages.fetched,i):(i.destroy(),null)}yn.incrementMsgCounter=function(){e+=1;const t=document.title;t&&(-1===t.search(/^Messages \(\d+\) /)?document.title="Messages (".concat(e,") ").concat(t):document.title=t.replace(/^Messages \(\d+\) /,"Messages (".concat(e,") ")))},yn.clearMsgCounter=function(){e=0;const t=document.title;t&&-1!==t.search(/^Messages \(\d+\) /)&&(document.title=t.replace(/^Messages \(\d+\) /,""))},yn.ChatBoxes=A.extend({comparator:"time_opened",model:(e,t)=>new yn.ChatBox(e,t),onChatBoxesFetched(e){e.filter(e=>!e.isValid()).forEach(e=>e.destroy()),xn.trigger("chatBoxesFetched")},onConnected(e){e||(this.browserStorage=yn.createStore("converse.chatboxes-".concat(yn.bare_jid)),this.fetch({add:!0,success:e=>this.onChatBoxesFetched(e)}))}}),xn.listen.on("addClientFeatures",()=>{xn.disco.own.features.add(Ni.NS.MESSAGE_CORRECT),xn.disco.own.features.add(Ni.NS.HTTPUPLOAD),xn.disco.own.features.add(Ni.NS.OUTOFBAND)}),xn.listen.on("pluginsInitialized",()=>{yn.chatboxes=new yn.ChatBoxes,xn.trigger("chatBoxesInitialized")}),xn.listen.on("presencesInitialized",e=>yn.chatboxes.onConnected(e)),xn.listen.on("reconnected",()=>yn.chatboxes.forEach(e=>e.onReconnection())),xn.listen.on("windowStateChanged",e=>"visible"===e.state&&yn.clearMsgCounter()),Object.assign(xn,{chatboxes:{create:async(e=[],n={},r)=>(await xn.waitUntil("chatBoxesFetched"),Object(i.isString)(e)?t(e,n,r):Promise.all(e.map(e=>t(e,n,r)))),get:async e=>(await xn.waitUntil("chatBoxesFetched"),void 0===e?yn.chatboxes.models:Object(i.isString)(e)?yn.chatboxes.get(e.toLowerCase()):(e=e.map(e=>e.toLowerCase()),yn.chatboxes.models.filter(t=>e.includes(t.get("jid")))))}})}});
/**
 * @module converse-rsm
 * @copyright The Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 * @description XEP-0059 Result Set Management
 *   Some code taken from the Strophe RSM plugin, licensed under the MIT License
 *   Copyright 2006-2017 Strophe (https://github.com/strophe/strophejs)
 */
const{Strophe:Mi,$build:Ii}=zn.env;Mi.addNamespace("RSM","http://jabber.org/protocol/rsm"),zn.plugins.add("converse-rsm",{initialize(){const{_converse:e}=this,t=["max","first","last","after","before","index","count"];e.RSM_ATTRIBUTES=t;class n{constructor(e){if(void 0!==e.xml)this.fromXMLElement(e.xml);else for(let n=0;n<t.length;n++){const i=t[n];this[i]=e[i]}}toXML(){let e=Ii("set",{xmlns:Mi.NS.RSM});for(let n=0;n<t.length;n++){const i=t[n];void 0!==this[i]&&(e=e.c(i).t(this[i].toString()).up())}return e.tree()}next(e,t){return new n({max:e,after:this.last,before:t})}previous(e,t){return new n({max:e,before:this.first,after:t})}fromXMLElement(e){for(var n=0;n<t.length;n++){const i=t[n],r=e.getElementsByTagName(i)[0];null!=r&&(this[i]=Mi.getText(r),"first"==i&&(this.index=r.getAttribute("index")))}}}e.RSM=n}});
/**
 * @module converse-mam
 * @description XEP-0313 Message Archive Management
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:Ri,$iq:Di,dayjs:Pi}=zn.env,{NS:Li}=Ri,zi=zn.env.utils,Fi=["with","start","end"],Bi={fetchNewestMessages(){if(this.disable_mam)return;const e=this.getMostRecentMessage();if(e){const t=e.get("stanza_id ".concat(this.get("jid")));t?this.fetchArchivedMessages({after:t},"forwards"):this.fetchArchivedMessages({start:e.get("time")},"forwards")}else this.fetchArchivedMessages({before:""})},async handleMAMResult(e,t,n,i){const r=this.get("type")===yn.CHATROOMS_TYPE;e.messages=e.messages.map(e=>r?cn.parseMUCMessage(e,this,yn):cn.parseMessage(e,yn));const o={query:t,chatbox:this,messages:e.messages};await xn.trigger("MAMResult",o,{synchronous:!0}),e.messages.forEach(e=>this.queueMessage(e)),e.error&&(e.error.retry=()=>this.fetchArchivedMessages(n,i),this.createMessageFromError(e.error))},async fetchArchivedMessages(e={},t){if(this.disable_mam)return;const n=this.get("type")===yn.CHATROOMS_TYPE,i=n?this.get("jid"):yn.bare_jid;if(!await xn.disco.supports(Li.MAM,i))return;const r=Object.assign({groupchat:n,max:xn.settings.get("archived_messages_page_size"),with:this.get("jid")},e),o=await xn.archive.query(r);return await this.handleMAMResult(o,r,e,t),t&&o.rsm?("forwards"===t?e=o.rsm.next(xn.settings.get("archived_messages_page_size"),e.before):"backwards"===t&&(e=o.rsm.previous(xn.settings.get("archived_messages_page_size"),e.after)),this.fetchArchivedMessages(e,t)):void 0}};zn.plugins.add("converse-mam",{dependencies:["converse-rsm","converse-disco","converse-muc"],initialize(){xn.settings.update({archived_messages_page_size:"50",message_archiving:void 0,message_archiving_timeout:2e4}),Object.assign(yn.ChatBox.prototype,Bi),yn.onMAMError=function(e){e&&e.querySelectorAll("feature-not-implemented").length?st.warn("Message Archive Management (XEP-0313) not supported by ".concat(e.getAttribute("from"))):(st.error("Error while trying to set archiving preferences for ".concat(e.getAttribute("from"),".")),st.error(e))},yn.onMAMPreferences=function(e,t){const n=Rt()('prefs[xmlns="'.concat(Li.MAM,'"]'),e).pop();if(n.getAttribute("default")!==xn.settings.get("message_archiving")){const e=Di({type:"set"}).c("prefs",{xmlns:Li.MAM,default:xn.settings.get("message_archiving")});Array.from(n.children).forEach(t=>e.cnode(t).up()),xn.sendIQ(e).then(()=>t.save({preferences:{default:xn.settings.get("message_archiving")}})).catch(yn.onMAMError)}else t.save({preferences:{default:xn.settings.get("message_archiving")}})},xn.listen.on("addClientFeatures",()=>xn.disco.own.features.add(Li.MAM)),xn.listen.on("serviceDiscovered",(function(e){const t=e.get("preferences")||{};e.get("var")===Li.MAM&&void 0!==xn.settings.get("message_archiving")&&t.default!==xn.settings.get("message_archiving")&&xn.sendIQ(Di({type:"get"}).c("prefs",{xmlns:Li.MAM})).then(t=>yn.onMAMPreferences(t,e)).catch(yn.onMAMError)})),xn.listen.on("chatRoomViewInitialized",e=>{var t;yn.muc_show_logs_before_join&&e.model.features.on("change:mam_enabled",(t=e.model,void(yn.muc_show_logs_before_join&&t.features.get("mam_enabled")&&t.session.get("connection_status")===zn.ROOMSTATUS.ENTERED&&!t.get("prejoin_mam_fetched")&&(t.fetchNewestMessages(),t.save({prejoin_mam_fetched:!0})))))}),xn.listen.on("enteredNewRoom",e=>e.features.get("mam_enabled")&&e.fetchNewestMessages()),xn.listen.on("chatReconnected",e=>{e.get("type")===yn.PRIVATE_CHAT_TYPE&&e.fetchNewestMessages()}),xn.listen.on("afterMessagesFetched",e=>{e.get("type")!==yn.PRIVATE_CHAT_TYPE||yn.connection.restored||e.fetchNewestMessages()}),Object.assign(xn,{archive:{async query(e){if(!xn.connection.connected())throw new Error("Can't call `api.archive.query` before having established an XMPP session");const t={type:"set"};if(e&&e.groupchat){if(!e.with)throw new Error('You need to specify a "with" value containing the chat room JID, when querying groupchat messages.');t.to=e.with}const n=t.to||yn.bare_jid;if(!await xn.disco.supports(Li.MAM,n))return st.warn("Did not fetch MAM archive for ".concat(n," because it doesn't support ").concat(Li.MAM)),{messages:[]};const r=zi.getUniqueId(),o=Di(t).c("query",{xmlns:Li.MAM,queryid:r});e&&(o.c("x",{xmlns:Li.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(Li.MAM).up().up(),e.with&&!e.groupchat&&o.c("field",{var:"with"}).c("value").t(e.with).up().up(),["start","end"].forEach(t=>{if(e[t]){const n=Pi(e[t]);if(!n.isValid())throw new TypeError("archive.query: invalid date provided for: ".concat(t));o.c("field",{var:t}).c("value").t(n.toISOString()).up().up()}}),o.up(),e instanceof yn.RSM?o.cnode(e.toXML()):Object(i.intersection)(yn.RSM_ATTRIBUTES,Object.keys(e)).length&&o.cnode(new yn.RSM(e).toXML()));const s=[],a=yn.connection.addHandler(t=>{const n=Rt()('message > result[xmlns="'.concat(Li.MAM,'"]'),t).pop();if(void 0===n||n.getAttribute("queryid")!==r)return!0;const i=t.getAttribute("from")||yn.bare_jid;if(e.groupchat){if(i!==e.with)return st.warn("Ignoring alleged groupchat MAM message from ".concat(t.getAttribute("from"))),!0}else if(i!==yn.bare_jid)return st.warn("Ignoring alleged MAM message from ".concat(t.getAttribute("from"))),!0;return s.push(t),!0},Li.MAM);let c;const l=await xn.sendIQ(o,xn.settings.get("message_archiving_timeout"),!1);if(null===l){const e="Timeout while trying to fetch archived messages.";return st.error(e),c=new yn.TimeoutError(e),{messages:s,error:c}}if(zi.isErrorStanza(l))return st.error("Error stanza received while trying to fetch archived messages"),st.error(l),{messages:s};let u;yn.connection.deleteHandler(a);const d=l&&Rt()('fin[xmlns="'.concat(Li.MAM,'"]'),l).pop();if(d&&[null,"false"].includes(d.getAttribute("complete"))){const t=Rt()('set[xmlns="'.concat(Li.RSM,'"]'),d).pop();t&&(u=new yn.RSM({xml:t}),Object.assign(u,Object.assign(Object(i.pick)(e,[...Fi,...yn.RSM_ATTRIBUTES]),u)))}return{messages:s,rsm:u,error:c}}}})}}),zn.plugins.add("converse-headlines",{dependencies:["converse-chat"],overrides:{ChatBoxes:{model(e,t){const{_converse:n}=this.__super__;return e.type==n.HEADLINES_TYPE?new n.HeadlinesBox(e,t):this.__super__.model.apply(this,arguments)}}},initialize(){function e(){yn.connection.addHandler(e=>async function(e){if(cn.isHeadline(e)||cn.isServerMessage(e)){const t=e.getAttribute("from");if(t.includes("@")&&!yn.roster.get(t)&&!xn.settings.get("allow_non_roster_messaging"))return;if(null===e.querySelector("body"))return;const n=yn.chatboxes.create({id:t,jid:t,type:yn.HEADLINES_TYPE,from:t}),i=await cn.parseMessage(e,yn);await n.createMessage(i),xn.trigger("message",{chatbox:n,stanza:e})}}(e)||!0,null,"message")}yn.HeadlinesBox=yn.ChatBox.extend({defaults(){return{bookmarked:!1,hidden:["mobile","fullscreen"].includes(xn.settings.get("view_mode")),message_type:"headline",num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),type:yn.HEADLINES_TYPE}},initialize(){this.initMessages(),this.set({box_id:"box-".concat(btoa(this.get("jid")))}),xn.trigger("headlinesBoxInitialized",this)}}),xn.listen.on("connected",e),xn.listen.on("reconnected",e),Object.assign(xn,{headlines:{async get(e,t={},n=!1){async function r(e){let i=await xn.chatboxes.get(e);return!i&&n?i=await xn.chatboxes.create(e,t,yn.HeadlinesBox):(i=i&&i.get("type")===yn.HEADLINES_TYPE?i:null,i&&Object.keys(t).length&&i.save(t)),i}if(void 0===e){return(await xn.chatboxes.get()).filter(e=>e.get("type")===yn.HEADLINES_TYPE)}return Object(i.isString)(e)?r(e):Promise.all(e.map(e=>r(e)))}}})}});
/**
 * @module converse-ping
 * @description
 * Converse.js plugin which add support for application-level pings
 * as specified in XEP-0199 XMPP Ping.
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:qi,$iq:Ui}=zn.env,Hi=zn.env.utils;qi.addNamespace("PING","urn:xmpp:ping"),zn.plugins.add("converse-ping",{initialize(){let e;function t(t){e=new Date;const n=t.getAttribute("from"),i=t.getAttribute("id"),r=Ui({type:"result",to:n,id:i});return yn.connection.sendIQ(r),!0}xn.settings.update({ping_interval:60}),setTimeout(()=>{if(xn.settings.get("ping_interval")>0){const t=new Date;return e||(e=t),!((t-e)/1e3>xn.settings.get("ping_interval"))||xn.ping()}},1e3);const n=function(){void 0!==yn.connection.disco&&xn.disco.own.features.add(qi.NS.PING),yn.connection.addHandler(t,qi.NS.PING,"iq","get"),yn.connection.addHandler(()=>{if(xn.settings.get("ping_interval")>0)return e=new Date,!0})};xn.listen.on("connected",n),xn.listen.on("reconnected",n),xn.listen.on("windowStateChanged",(function(e){"visible"===e.state&&xn.connection.connected()&&xn.ping(null,5e3)})),Object.assign(xn,{async ping(t,n){if(e=new Date,t=t||qi.getDomainFromJid(yn.bare_jid),yn.connection){const e=Ui({type:"get",to:t,id:Hi.getUniqueId("ping")}).c("ping",{xmlns:qi.NS.PING}),i=await xn.sendIQ(e,n||1e4,!1);return null===i?(st.warn("Timeout while pinging ".concat(t)),t===qi.getDomainFromJid(yn.bare_jid)&&xn.connection.reconnect()):Hi.isErrorStanza(i)&&(st.error("Error while pinging ".concat(t)),st.error(i)),!0}return!1}})}});
/**
 * @module converse-pubsub
 * @copyright The Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:$i,$iq:Wi}=zn.env;$i.addNamespace("PUBSUB_ERROR",$i.NS.PUBSUB+"#errors"),zn.plugins.add("converse-pubsub",{dependencies:["converse-disco"],initialize(){Object.assign(yn.api,{pubsub:{async publish(e,t,n,i,r=!0){const o=Wi({from:yn.bare_jid,type:"set",to:e}).c("pubsub",{xmlns:$i.NS.PUBSUB}).c("publish",{node:t}).cnode(n.tree()).up().up();i&&(e=e||yn.bare_jid,await xn.disco.supports($i.NS.PUBSUB+"#publish-options",e)?(o.c("publish-options").c("x",{xmlns:$i.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("".concat($i.NS.PUBSUB,"#publish-options")).up().up(),Object.keys(i).forEach(e=>o.c("field",{var:e}).c("value").t(i[e]).up().up())):st.warn("_converse.api.publish: ".concat(e," does not support #publish-options, ")+"so we didn't set them even though they were provided."));try{xn.sendIQ(o)}catch(e){if(!(e instanceof Element&&r&&e.querySelector('precondition-not-met[xmlns="'.concat($i.NS.PUBSUB_ERROR,'"]'))))throw e;{const e=o.nodeTree;e.querySelector("publish-options").outerHTML="",st.warn("PubSub: Republishing without publish options. ".concat(e.outerHTML)),xn.sendIQ(e)}}}}})}});
/**
 * @module converse-status
 * @copyright The Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:Vi,$build:Gi,$pres:Ji}=zn.env;zn.plugins.add("converse-status",{initialize(){function e(e){xn.trigger("statusInitialized",e)}function t(t){if(t=void 0!==yn.xmppstatus&&t)e(t);else{const n="converse.xmppstatus-".concat(yn.bare_jid);yn.xmppstatus=new yn.XMPPStatus({id:n}),yn.xmppstatus.browserStorage=yn.createStore(n,"session"),yn.xmppstatus.fetch({success:()=>e(t),error:()=>e(t),silent:!0})}}xn.settings.update({auto_away:0,auto_xa:0,csi_waiting_time:0,default_state:"online",priority:0}),xn.promises.add(["statusInitialized"]),yn.XMPPStatus=x.extend({defaults:()=>({status:xn.settings.get("default_state")}),initialize(){this.on("change",e=>{Object(i.isObject)(e.changed)&&("status"in e.changed||"status_message"in e.changed)&&xn.user.presence.send(this.get("status"),null,this.get("status_message"))})},getNickname:()=>yn.nickname,getFullname:()=>"",constructPresence(e,t=null,n){let r;e=Object(i.isString)(e)?e:this.get("status")||xn.settings.get("default_state"),n=Object(i.isString)(n)?n:this.get("status_message");const o={to:t};"unavailable"===e||"probe"===e||"error"===e||"unsubscribe"===e||"unsubscribed"===e||"subscribe"===e||"subscribed"===e?(o.type=e,r=Ji(o)):"offline"===e?(o.type="unavailable",r=Ji(o)):r="online"===e?Ji(o):Ji(o).c("show").t(e).up(),n&&r.c("status").t(n).up();const s=xn.settings.get("priority");if(r.c("priority").t(Object(i.isNaN)(Number(s))?0:s).up(),yn.idle){const e=new Date;e.setSeconds(e.getSeconds()-yn.idle_seconds),r.c("idle",{xmlns:Vi.NS.IDLE,since:e.toISOString()})}return r}}),yn.sendCSI=function(e){xn.send(Gi(e,{xmlns:Vi.NS.CSI})),yn.inactive=e===yn.INACTIVE},yn.onUserActivity=function(){var e;yn.idle_seconds>0&&(yn.idle_seconds=0),(null===(e=yn.connection)||void 0===e?void 0:e.authenticated)&&(yn.inactive&&yn.sendCSI(yn.ACTIVE),yn.idle&&(yn.idle=!1,xn.user.presence.send()),!0===yn.auto_changed_status&&(yn.auto_changed_status=!1,yn.xmppstatus.set("status",xn.settings.get("default_state"))))},yn.onEverySecond=function(){var e;if(!(null===(e=yn.connection)||void 0===e?void 0:e.authenticated))return;const t=yn.xmppstatus.get("status");yn.idle_seconds++,xn.settings.get("csi_waiting_time")>0&&yn.idle_seconds>xn.settings.get("csi_waiting_time")&&!yn.inactive&&yn.sendCSI(yn.INACTIVE),xn.settings.get("idle_presence_timeout")>0&&yn.idle_seconds>xn.settings.get("idle_presence_timeout")&&!yn.idle&&(yn.idle=!0,xn.user.presence.send()),xn.settings.get("auto_away")>0&&yn.idle_seconds>xn.settings.get("auto_away")&&"away"!==t&&"xa"!==t&&"dnd"!==t?(yn.auto_changed_status=!0,yn.xmppstatus.set("status","away")):xn.settings.get("auto_xa")>0&&yn.idle_seconds>xn.settings.get("auto_xa")&&"xa"!==t&&"dnd"!==t&&(yn.auto_changed_status=!0,yn.xmppstatus.set("status","xa"))},yn.registerIntervalHandler=function(){if(xn.settings.get("auto_away")<1&&xn.settings.get("auto_xa")<1&&xn.settings.get("csi_waiting_time")<1&&xn.settings.get("idle_presence_timeout")<1)return;yn.idle_seconds=0,yn.auto_changed_status=!1,window.addEventListener("click",yn.onUserActivity),window.addEventListener("focus",yn.onUserActivity),window.addEventListener("keypress",yn.onUserActivity),window.addEventListener("mousemove",yn.onUserActivity);window.addEventListener(yn.unloadevent,yn.onUserActivity,{once:!0,passive:!0}),window.addEventListener(yn.unloadevent,()=>{yn.session&&yn.session.save("active",!1)}),yn.everySecondTrigger=window.setInterval(yn.onEverySecond,1e3)},xn.listen.on("presencesInitialized",e=>{e||yn.registerIntervalHandler()}),xn.listen.on("clearSession",()=>{yn.shouldClearCache()&&yn.xmppstatus&&(yn.xmppstatus.destroy(),delete yn.xmppstatus)}),xn.listen.on("connected",()=>t(!1)),xn.listen.on("reconnected",()=>t(!0)),Object.assign(yn.api.user,{presence:{async send(e,t,n){await xn.waitUntil("statusInitialized"),xn.send(yn.xmppstatus.constructPresence(e,t,n))}},status:{get:()=>yn.xmppstatus.get("status"),set(e,t){const n={status:e};if(!Object.keys(yn.STATUS_WEIGHTS).includes(e))throw new Error("Invalid availability value. See https://xmpp.org/rfcs/rfc3921.html#rfc.section.2.2.2.1");Object(i.isString)(t)&&(n.status_message=t),yn.xmppstatus.save(n)},message:{get:()=>yn.xmppstatus.get("status_message"),set(e){yn.xmppstatus.save({status_message:e})}}}})}});
/**
 * @module converse-roster
 * @copyright The Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:Qi,$iq:Ki,$pres:Yi,dayjs:Xi,sizzle:Zi}=zn.env,er=zn.env.utils;zn.plugins.add("converse-roster",{dependencies:["converse-status"],initialize(){const{__:e}=yn;xn.settings.update({allow_contact_requests:!0,auto_subscribe:!1,synchronize_availability:!0}),xn.promises.add(["cachedRoster","roster","rosterContactsFetched","rosterGroupsFetched","rosterInitialized"]),yn.HEADER_CURRENT_CONTACTS=e("My contacts"),yn.HEADER_PENDING_CONTACTS=e("Pending contacts"),yn.HEADER_REQUESTING_CONTACTS=e("Contact requests"),yn.HEADER_UNGROUPED=e("Ungrouped"),yn.HEADER_UNREAD=e("New messages");const t={};t[yn.HEADER_UNREAD]=0,t[yn.HEADER_REQUESTING_CONTACTS]=1,t[yn.HEADER_CURRENT_CONTACTS]=2,t[yn.HEADER_UNGROUPED]=3,t[yn.HEADER_PENDING_CONTACTS]=4,yn.registerPresenceHandler=function(){yn.unregisterPresenceHandler(),yn.presence_ref=yn.connection.addHandler(e=>(yn.roster.presenceHandler(e),!0),null,"presence",null)},yn.rejectPresenceSubscription=function(e,t){const n=Yi({to:e,type:"unsubscribed"});t&&""!==t&&n.c("status").t(t),xn.send(n)},yn.sendInitialPresence=function(){yn.send_initial_presence&&xn.user.presence.send()},yn.populateRoster=async function(e=!1){e&&(yn.send_initial_presence=!0);try{await yn.rostergroups.fetchRosterGroups(),xn.trigger("rosterGroupsFetched"),await yn.roster.fetchRosterContacts(),xn.trigger("rosterContactsFetched")}catch(e){st.error(e)}finally{yn.sendInitialPresence()}};const n=x.extend({idAttribute:"name"}),r=A.extend({model:n});function o(e){const t=yn.roster&&yn.roster.findWhere({jid:e.get("jid")});void 0!==t&&t.save({num_unread:e.get("num_unread")})}async function s(){yn.presences&&await yn.presences.clearStore()}yn.Presence=x.extend({defaults:{show:"offline"},initialize(){this.resources=new r;const e="converse.identities-".concat(this.get("jid"));this.resources.browserStorage=yn.createStore(e,"session"),this.listenTo(this.resources,"update",this.onResourcesChanged),this.listenTo(this.resources,"change",this.onResourcesChanged)},onResourcesChanged(){var e;const t=this.getHighestPriorityResource(),n=(null==t||null===(e=t.attributes)||void 0===e?void 0:e.show)||"offline";this.get("show")!==n&&this.save({show:n})},getHighestPriorityResource(){return this.resources.sortBy(e=>"".concat(e.get("priority"),"-").concat(e.get("timestamp"))).reverse()[0]},addResource(e){const t=e.getAttribute("from"),n=Qi.getResourceFromJid(t),r=Zi('delay[xmlns="'.concat(Qi.NS.DELAY,'"]'),e).pop(),o=Object(i.propertyOf)(e.querySelector("priority"))("textContent")||0,s=this.resources.get(n),a={name:n,priority:Object(i.isNaN)(parseInt(o,10))?0:parseInt(o,10),show:Object(i.propertyOf)(e.querySelector("show"))("textContent")||"online",timestamp:r?Xi(r.getAttribute("stamp")).toISOString():(new Date).toISOString()};s?s.save(a):this.resources.create(a)},removeResource(e){const t=this.resources.get(e);t&&t.destroy()}}),yn.Presences=A.extend({model:yn.Presence}),yn.RosterContact=x.extend({defaults:{chat_state:void 0,image:yn.DEFAULT_IMAGE,image_type:yn.DEFAULT_IMAGE_TYPE,num_unread:0,status:void 0},async initialize(e){this.initialized=er.getResolveablePromise(),this.setPresence();const{jid:t}=e,n=Qi.getBareJidFromJid(t).toLowerCase();e.jid=n,this.set(Object.assign({groups:[],id:n,jid:n,user_id:Qi.getNodeFromJid(t)},e)),this.listenTo(this.presence,"change:show",()=>xn.trigger("contactPresenceChanged",this)),this.listenTo(this.presence,"change:show",()=>this.trigger("presenceChanged")),await xn.trigger("rosterContactInitialized",this,{Synchronous:!0}),this.initialized.resolve()},setPresence(){const e=this.get("jid");this.presence=yn.presences.findWhere({jid:e})||yn.presences.create({jid:e})},openChat(){const e=this.attributes;xn.chats.open(e.jid,e,!0)},getFilterCriteria(){const e=this.get("nickname"),t=this.get("jid");let n=this.getDisplayName();return n=n.includes(t)?n:n.concat("   ".concat(t)),n=n.includes(e)?n:n.concat("   ".concat(e)),n.toLowerCase()},getDisplayName(){return this.get("nickname")?this.get("nickname"):this.get("jid")},getFullname(){return this.get("jid")},subscribe(e){const t=Yi({to:this.get("jid"),type:"subscribe"});e&&""!==e&&t.c("status").t(e).up();const n=yn.xmppstatus.getNickname()||yn.xmppstatus.getFullname();return n&&t.c("nick",{xmlns:Qi.NS.NICK}).t(n).up(),xn.send(t),this.save("ask","subscribe"),this},ackSubscribe(){xn.send(Yi({type:"subscribe",to:this.get("jid")}))},ackUnsubscribe(){xn.send(Yi({type:"unsubscribe",to:this.get("jid")})),this.removeFromRoster(),this.destroy()},unauthorize(e){return yn.rejectPresenceSubscription(this.get("jid"),e),this},authorize(e){const t=Yi({to:this.get("jid"),type:"subscribed"});return e&&""!==e&&t.c("status").t(e),xn.send(t),this},removeFromRoster(){const e=Ki({type:"set"}).c("query",{xmlns:Qi.NS.ROSTER}).c("item",{jid:this.get("jid"),subscription:"remove"});return xn.sendIQ(e)}}),yn.RosterContacts=A.extend({model:yn.RosterContact,comparator(e,t){const n=e.presence.get("show")||"offline",i=t.presence.get("show")||"offline";if(yn.STATUS_WEIGHTS[n]===yn.STATUS_WEIGHTS[i]){const n=e.getDisplayName().toLowerCase(),i=t.getDisplayName().toLowerCase();return n<i?-1:n>i?1:0}return yn.STATUS_WEIGHTS[n]<yn.STATUS_WEIGHTS[i]?-1:1},onConnected(){this.registerRosterHandler(),this.registerRosterXHandler()},registerRosterHandler(){yn.connection.addHandler(e=>(yn.roster.onRosterPush(e),!0),Qi.NS.ROSTER,"iq","set")},registerRosterXHandler(){let e=0;yn.connection.addHandler((function(t){return window.setTimeout((function(){yn.connection.flush(),yn.roster.subscribeToSuggestedItems.bind(yn.roster)(t)}),e),e+=250*t.querySelectorAll("item").length,!0}),Qi.NS.ROSTERX,"message",null)},async fetchRosterContacts(){const e=await new Promise((e,t)=>{this.fetch({add:!0,silent:!0,success:e,error:(e,n)=>t(n)})});if(er.isErrorObject(e)&&(st.error(e),yn.session.set("roster_cached",!1),this.data.save("version",void 0)),!yn.session.get("roster_cached"))return yn.send_initial_presence=!0,yn.roster.fetchFromServer();xn.trigger("cachedRoster",e)},subscribeToSuggestedItems:e=>(Array.from(e.querySelectorAll("item")).forEach(e=>{"add"===e.getAttribute("action")&&yn.roster.addAndSubscribe(e.getAttribute("jid"),yn.xmppstatus.getNickname()||yn.xmppstatus.getFullname())}),!0),isSelf:e=>er.isSameBareJID(e,yn.connection.jid),async addAndSubscribe(e,t,n,i,r){const o=await this.addContactToRoster(e,t,n,r);o instanceof yn.RosterContact&&o.subscribe(i)},sendContactAddIQ(e,t,n){t=Object(i.isEmpty)(t)?null:t;const r=Ki({type:"set"}).c("query",{xmlns:Qi.NS.ROSTER}).c("item",{jid:e,name:t});return n.forEach(e=>r.c("group").t(e).up()),xn.sendIQ(r)},async addContactToRoster(t,n,i,r){await xn.waitUntil("rosterContactsFetched"),i=i||[];try{await this.sendContactAddIQ(t,n,i)}catch(i){return st.error(i),alert(e("Sorry, there was an error while trying to add %1$s as a contact.",n||t)),i}return this.create(Object.assign({ask:void 0,nickname:n,groups:i,jid:t,requesting:!1,subscription:"none"},r),{sort:!1})},async subscribeBack(e,t){const n=this.get(e);if(n instanceof yn.RosterContact)n.authorize().subscribe();else{var i;const n=(null===(i=Zi('nick[xmlns="'.concat(Qi.NS.NICK,'"]'),t).pop())||void 0===i?void 0:i.textContent)||null,r=await this.addContactToRoster(e,n,[],{subscription:"from"});r instanceof yn.RosterContact&&r.authorize().subscribe()}},getNumOnlineContacts(){const e=["offline","unavailable"];return Object(i.sum)(this.models.filter(t=>!e.includes(t.presence.get("show"))))},onRosterPush(e){const t=e.getAttribute("id"),n=e.getAttribute("from");if(n&&n!==yn.bare_jid)return void st.warn("Ignoring roster illegitimate roster push message from ".concat(e.getAttribute("from")));xn.send(Ki({type:"result",id:t,from:yn.connection.jid}));const i=Zi('query[xmlns="'.concat(Qi.NS.ROSTER,'"]'),e).pop();this.data.save("version",i.getAttribute("ver"));const r=Zi("item",i);if(r.length>1)throw st.error(e),new Error('Roster push query may not contain more than one "item" element.');if(0===r.length)return st.warn(e),void st.warn('Received a roster push stanza without an "item" element.');this.updateContact(r.pop()),xn.trigger("rosterPush",e)},rosterVersioningSupported(){return xn.disco.stream.getFeature("ver","urn:xmpp:features:rosterver")&&this.data.get("version")},async fetchFromServer(){const e=Ki({type:"get",id:er.getUniqueId("roster")}).c("query",{xmlns:Qi.NS.ROSTER});this.rosterVersioningSupported()&&e.attrs({ver:this.data.get("version")});const t=await xn.sendIQ(e,null,!1);if("error"!==t.getAttribute("type")){const e=Zi('query[xmlns="'.concat(Qi.NS.ROSTER,'"]'),t).pop();if(e){Zi("item",e).forEach(e=>this.updateContact(e)),this.data.save("version",e.getAttribute("ver"))}}else if(!er.isServiceUnavailableError(t))return st.error(t),void st.error("Error while trying to fetch roster from the server");yn.session.save("roster_cached",!0),xn.trigger("roster",t)},updateContact(e){const t=e.getAttribute("jid"),n=this.get(t),i=e.getAttribute("subscription"),r=e.getAttribute("ask"),o=Array.from(e.getElementsByTagName("group")).map(e=>e.textContent);if(n){if("remove"===i)return n.destroy();n.save({subscription:i,ask:r,nickname:e.getAttribute("name"),requesting:null,groups:o})}else{if("none"===i&&null===r||"remove"===i)return;this.create({ask:r,nickname:e.getAttribute("name"),groups:o,jid:t,subscription:i},{sort:!1})}},createRequestingContact(e){var t;const n={jid:Qi.getBareJidFromJid(e.getAttribute("from")),subscription:"none",ask:null,requesting:!0,nickname:(null===(t=Zi('nick[xmlns="'.concat(Qi.NS.NICK,'"]'),e).pop())||void 0===t?void 0:t.textContent)||null};xn.trigger("contactRequest",this.create(n))},handleIncomingSubscription(t){const n=t.getAttribute("from"),i=Qi.getBareJidFromJid(n),r=this.get(i);xn.settings.get("allow_contact_requests")||yn.rejectPresenceSubscription(n,e("This client does not allow presence subscriptions")),xn.settings.get("auto_subscribe")?r&&"to"===r.get("subscription")?r.authorize():this.subscribeBack(i,t):r?("none"!==r.get("subscription")||"subscribe"===r.get("ask"))&&r.authorize():this.createRequestingContact(t)},handleOwnPresence(e){const t=e.getAttribute("from"),n=Qi.getResourceFromJid(t),r=e.getAttribute("type");if(yn.connection.jid!==t&&"unavailable"!==r&&(!0===xn.settings.get("synchronize_availability")||xn.settings.get("synchronize_availability")===n)){const t=Object(i.propertyOf)(e.querySelector("show"))("textContent")||"online";yn.xmppstatus.save({status:t},{silent:!0});const n=Object(i.propertyOf)(e.querySelector("status"))("textContent");n&&yn.xmppstatus.save({status_message:n})}yn.jid===t&&"unavailable"===r&&xn.user.presence.send()},presenceHandler(e){const t=e.getAttribute("type");if("error"===t)return!0;const n=e.getAttribute("from"),r=Qi.getBareJidFromJid(n);if(this.isSelf(r))return this.handleOwnPresence(e);if(Zi('query[xmlns="'.concat(Qi.NS.MUC,'"]'),e).length)return;const o=Object(i.propertyOf)(e.querySelector("status"))("textContent"),s=this.get(r);if(s&&o!==s.get("status")&&s.save({status:o}),"subscribed"===t&&s)s.ackSubscribe();else if("unsubscribed"===t&&s)s.ackUnsubscribe();else{if("unsubscribe"===t)return;if("subscribe"===t)this.handleIncomingSubscription(e);else if("unavailable"===t&&s){const e=Qi.getResourceFromJid(n);s.presence.removeResource(e)}else s&&s.presence.addResource(e)}}}),yn.RosterGroup=x.extend({initialize(t){this.set(Object.assign({description:e("Click to hide these contacts"),state:yn.OPENED},t)),this.contacts=new yn.RosterContacts}}),yn.RosterGroups=A.extend({model:yn.RosterGroup,comparator(e,n){e=e.get("name"),n=n.get("name");const i=t,r=Object.keys(t),o=r.includes(e),s=r.includes(n);if(!o&&!s)return e.toLowerCase()<n.toLowerCase()?-1:e.toLowerCase()>n.toLowerCase()?1:0;if(o&&s)return i[e]<i[n]?-1:i[e]>i[n]?1:0;if(!o&&s){const e=yn.HEADER_CURRENT_CONTACTS;return i[e]<i[n]?-1:i[e]>i[n]?1:0}if(o&&!s){const t=yn.HEADER_CURRENT_CONTACTS;return i[e]<i[t]?-1:i[e]>i[t]?1:0}},fetchRosterGroups(){return new Promise(e=>{this.fetch({success:e,silent:!0})})}}),yn.unregisterPresenceHandler=function(){void 0!==yn.presence_ref&&(yn.connection.deleteHandler(yn.presence_ref),delete yn.presence_ref)},xn.listen.on("chatBoxesInitialized",()=>{yn.chatboxes.on("change:num_unread",o),yn.chatboxes.on("add",e=>{e.get("type")===yn.PRIVATE_CHAT_TYPE&&e.setRosterContact(e.get("jid"))})}),xn.listen.on("beforeTearDown",()=>yn.unregisterPresenceHandler()),xn.waitUntil("rosterContactsFetched").then(()=>{yn.roster.on("add",e=>{const t=yn.chatboxes.findWhere({jid:e.get("jid")});t&&t.setRosterContact(e.get("jid"))})}),xn.listen.on("streamResumptionFailed",()=>yn.session.set("roster_cached",!1)),xn.listen.on("clearSession",async()=>{await s(),yn.shouldClearCache()&&(yn.rostergroups&&(await yn.rostergroups.clearStore(),delete yn.rostergroups),yn.roster&&(Object(i.invoke)(yn,"roster.data.destroy"),await yn.roster.clearStore(),delete yn.roster))}),xn.listen.on("statusInitialized",async e=>{if(e)!yn.haveResumed()&&await s();else{yn.presences=new yn.Presences;const e="converse.presences-".concat(yn.bare_jid);yn.presences.browserStorage=yn.createStore(e,"session"),yn.presences.fetch()}xn.trigger("presencesInitialized",e)}),xn.listen.on("presencesInitialized",async e=>{e?xn.trigger("rosterReadyAfterReconnection"):await async function(){await xn.waitUntil("VCardsInitialized"),yn.roster=new yn.RosterContacts;let e="converse.contacts-".concat(yn.bare_jid);yn.roster.browserStorage=yn.createStore(e),yn.roster.data=new x,e="converse-roster-model-".concat(yn.bare_jid),yn.roster.data.id=e,yn.roster.data.browserStorage=yn.createStore(e),yn.roster.data.fetch(),e="converse.roster.groups".concat(yn.bare_jid),yn.rostergroups=new yn.RosterGroups,yn.rostergroups.browserStorage=yn.createStore(e),xn.trigger("rosterInitialized")}(),yn.roster.onConnected(),yn.registerPresenceHandler(),yn.populateRoster(!yn.connection.restored)}),Object.assign(yn.api,{contacts:{async get(e){await xn.waitUntil("rosterContactsFetched");const t=e=>yn.roster.get(Qi.getBareJidFromJid(e));if(void 0===e)e=yn.roster.pluck("jid");else if(Object(i.isString)(e))return t(e);return e.map(t)},async add(e,t){if(await xn.waitUntil("rosterContactsFetched"),!Object(i.isString)(e)||!e.includes("@"))throw new TypeError("contacts.add: invalid jid");return yn.roster.addAndSubscribe(e,Object(i.isEmpty)(t)?e:t)}}})}});
/**
 * @module converse-smacks
 * @copyright The Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 * @description Converse.js plugin which adds support for XEP-0198: Stream Management
 */
const{Strophe:tr}=zn.env,nr=zn.env.utils;tr.addNamespace("SM","urn:xmpp:sm:3"),zn.plugins.add("converse-smacks",{initialize(){function e(){return!(xn.connection.isType("bosh")&&!yn.isTestEnv())&&xn.disco.stream.getFeature("sm",tr.NS.SM)}function t(e){if(!yn.session.get("smacks_enabled"))return!0;const t=parseInt(e.getAttribute("h"),10),n=yn.session.get("num_stanzas_handled_by_server"),i=t-n;if(i<0){const e="New reported stanza count lower than previous. "+"New: ".concat(t," - Previous: ").concat(n);st.error(e)}const r=yn.session.get("unacked_stanzas");if(i>r.length){const e="Higher reported acknowledge count than unacknowledged stanzas. "+"Reported Acknowledged Count: ".concat(i," -")+"Unacknowledged Stanza Count: ".concat(r.length," -")+"New: ".concat(t," - Previous: ").concat(n);st.error(e)}return yn.session.save({num_stanzas_handled_by_server:t,num_stanzas_since_last_ack:0,unacked_stanzas:r.slice(i)}),!0}function n(){if(yn.session.get("smacks_enabled")){const e=yn.session.get("num_stanzas_handled"),t=nr.toStanza('<a xmlns="'.concat(tr.NS.SM,'" h="').concat(e,'"/>'));xn.send(t)}return!0}function i(e){if(yn.session.get("smacks_enabled")&&(nr.isTagEqual(e,"iq")||nr.isTagEqual(e,"presence")||nr.isTagEqual(e,"message"))){const e=yn.session.get("num_stanzas_handled");yn.session.save("num_stanzas_handled",e+1)}return!0}function r(){yn.session&&yn.session.save({smacks_enabled:!1,num_stanzas_handled:0,num_stanzas_handled_by_server:0,num_stanzas_since_last_ack:0,unacked_stanzas:[]})}function o(e){const t={smacks_enabled:!0};return["1","true"].includes(e.getAttribute("resume"))&&(t.smacks_stream_id=e.getAttribute("id")),yn.session.save(t),!0}function s(e){return e.querySelector("item-not-found")?st.warn("Could not resume previous SMACKS session, session id not found. A new session will be established."):(st.error("Failed to enable stream management"),st.error(e.outerHTML)),r(),xn.trigger("streamResumptionFailed"),!0}function a(e){o(e),t(e),function(){const e=yn.session.get("unacked_stanzas");yn.session.save("unacked_stanzas",[]),e.forEach(e=>xn.send(e))}(),yn.connection.do_bind=!1,yn.connection.authenticated=!0,yn.connection.restored=!0,yn.connection._changeConnectStatus(tr.Status.CONNECTED,null)}xn.settings.update({enable_smacks:!0,smacks_max_unacked_stanzas:5}),xn.listen.on("userSessionInitialized",(function(){yn.session.save({smacks_enabled:yn.session.get("smacks_enabled")||!1,num_stanzas_handled:yn.session.get("num_stanzas_handled")||0,num_stanzas_handled_by_server:yn.session.get("num_stanzas_handled_by_server")||0,num_stanzas_since_last_ack:yn.session.get("num_stanzas_since_last_ack")||0,unacked_stanzas:yn.session.get("unacked_stanzas")||[]})})),xn.listen.on("beforeResourceBinding",(async function(){xn.settings.get("enable_smacks")&&await e()&&(yn.connection.addHandler(i),yn.connection.addHandler(n,tr.NS.SM,"r"),yn.connection.addHandler(t,tr.NS.SM,"a"),yn.session.get("smacks_stream_id")?await async function(){const e=nr.getResolveablePromise();yn.connection._addSysHandler(t=>e.resolve(a(t)),tr.NS.SM,"resumed"),yn.connection._addSysHandler(t=>e.resolve(s(t)),tr.NS.SM,"failed");const t=yn.session.get("smacks_stream_id"),n=yn.session.get("num_stanzas_handled"),i=nr.toStanza('<resume xmlns="'.concat(tr.NS.SM,'" h="').concat(n,'" previd="').concat(t,'"/>'));xn.send(i),yn.connection.flush(),await e}():r())})),xn.listen.on("afterResourceBinding",(async function(){if(xn.settings.get("enable_smacks")&&!yn.session.get("smacks_enabled")&&await e()){const e=nr.getResolveablePromise();yn.connection._addSysHandler(t=>e.resolve(o(t)),tr.NS.SM,"enabled"),yn.connection._addSysHandler(t=>e.resolve(s(t)),tr.NS.SM,"failed");const t=xn.connection.isType("websocket")||yn.isTestEnv(),n=nr.toStanza('<enable xmlns="'.concat(tr.NS.SM,'" resume="').concat(t,'"/>'));xn.send(n),yn.connection.flush(),await e}})),xn.listen.on("send",(function(e){if(yn.session){if(yn.session.get("smacks_enabled")&&(nr.isTagEqual(e,"iq")||nr.isTagEqual(e,"presence")||nr.isTagEqual(e,"message"))){const t=tr.serialize(e);yn.session.save("unacked_stanzas",(yn.session.get("unacked_stanzas")||[]).concat([t]));const n=xn.settings.get("smacks_max_unacked_stanzas");if(n>0){const e=yn.session.get("num_stanzas_since_last_ack")+1;e%n==0&&xn.send(nr.toStanza('<r xmlns="'.concat(tr.NS.SM,'"/>'))),yn.session.save({num_stanzas_since_last_ack:e})}}}else st.warn("No _converse.session!")}))}});var ir=n(111),rr=n.n(ir);
/**
 * @module converse-vcard
 * @copyright The Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:or,$iq:sr,dayjs:ar}=zn.env,cr=zn.env.utils;zn.plugins.add("converse-vcard",{dependencies:["converse-status","converse-roster"],overrides:{XMPPStatus:{getNickname(){const{_converse:e}=this.__super__,t=this.__super__.getNickname.apply(this);return!t&&e.xmppstatus.vcard?e.xmppstatus.vcard.get("nickname"):t},getFullname(){const{_converse:e}=this.__super__,t=this.__super__.getFullname.apply(this);return!t&&e.xmppstatus.vcard?e.xmppstatus.vcard.get("fullname"):t}},RosterContact:{getDisplayName(){return!this.get("nickname")&&this.vcard?this.vcard.getDisplayName():this.__super__.getDisplayName.apply(this)},getFullname(){return this.vcard?this.vcard.get("fullname"):this.__super__.getFullname.apply(this)}}},initialize(){function e(e,t,n){const i=sr(t?{type:e,to:t}:{type:e});return n?i.cnode(n):i.c("vCard",{xmlns:or.NS.VCARD}),i}async function t(t,n){const i=or.getBareJidFromJid(n)===t.bare_jid?null:n;let r;try{r=await xn.sendIQ(e("get",i))}catch(r){return{stanza:r,jid:n,vcard_error:(new Date).toISOString()}}return async function(e,t){const n=t.querySelector("vCard");let i={};var r,o,s,a,c,l,u,d,h,f,p,g,m,v;if(null!==n&&(i={stanza:t,fullname:null===(r=n.querySelector("FN"))||void 0===r||null===(o=r.textConte)||void 0===o?void 0:o.t,nickname:null===(s=n.querySelector("NICKNAME"))||void 0===s||null===(a=s.textConte)||void 0===a?void 0:a.t,image:null===(c=n.querySelector("PHOTO BINVAL"))||void 0===c||null===(l=c.textConte)||void 0===l?void 0:l.t,image_type:null===(u=n.querySelector("PHOTO TYPE"))||void 0===u||null===(d=u.textConte)||void 0===d?void 0:d.t,url:null===(h=n.querySelector("URL"))||void 0===h||null===(f=h.textConte)||void 0===f?void 0:f.t,role:null===(p=n.querySelector("ROLE"))||void 0===p||null===(g=p.textConte)||void 0===g?void 0:g.t,email:null===(m=n.querySelector("EMAIL USERID"))||void 0===m||null===(v=m.textConte)||void 0===v?void 0:v.t,vcard_updated:(new Date).toISOString(),vcard_error:void 0}),i.image){const e=cr.base64ToArrayBuffer(i.image),t=await crypto.subtle.digest("SHA-1",e);i.image_hash=cr.arrayBufferToHex(t)}return i}(0,r)}async function n(e){let t;if(e instanceof yn.Message){if("error"===e.get("type"))return;t=e.get("from")}else t=e.get("jid");await xn.waitUntil("VCardsInitialized"),e.vcard=yn.vcards.findWhere({jid:t}),e.vcard||(e.vcard=yn.vcards.create({jid:t})),e.vcard.on("change",()=>e.trigger("vcard:change"))}async function r(e){await xn.waitUntil("VCardsInitialized"),["error","info"].includes(e.get("type"))||(e.vcard=function(e){var t;const n=null==e||null===(t=e.collection)||void 0===t?void 0:t.chatbox,i=or.getResourceFromJid(e.get("from"));if(n&&n.get("nick")===i)return yn.xmppstatus.vcard;{const t=e.occupant&&e.occupant.get("jid")||e.get("from");return t?yn.vcards.findWhere({jid:t})||yn.vcards.create({jid:t}):void st.error("Could not assign VCard for message because no JID found! msgid: ".concat(e.get("msgid")))}}(e))}xn.promises.add("VCardsInitialized"),yn.VCard=x.extend({defaults:{image:yn.DEFAULT_IMAGE,image_type:yn.DEFAULT_IMAGE_TYPE},set(e,t,n){let r;return"object"==typeof e?(r=e,n=t):(r={})[e]=t,Object(i.has)(r,"image")&&!r.image?(r.image=yn.DEFAULT_IMAGE,r.image_type=yn.DEFAULT_IMAGE_TYPE,x.prototype.set.call(this,r,n)):x.prototype.set.apply(this,arguments)},getDisplayName(){return this.get("nickname")||this.get("fullname")||this.get("jid")}}),yn.VCards=A.extend({model:yn.VCard,initialize(){this.on("add",e=>{xn.vcard.update(e)})}}),yn.initVCardCollection=async function(){yn.vcards=new yn.VCards,yn.vcards.browserStorage=yn.createStore("".concat(yn.bare_jid,"-converse.vcards")),await new Promise(e=>{yn.vcards.fetch({success:e,error:e},{silent:!0})});const e=yn.vcards;if(yn.session){const t=yn.session.get("bare_jid");yn.xmppstatus.vcard=e.findWhere({jid:t})||e.create({jid:t})}xn.trigger("VCardsInitialized")},xn.listen.on("chatBoxInitialized",e=>n(e)),xn.listen.on("chatRoomInitialized",e=>n(e)),xn.listen.on("chatRoomMessageInitialized",e=>r(e)),xn.listen.on("addClientFeatures",()=>xn.disco.own.features.add(or.NS.VCARD)),xn.listen.on("clearSession",()=>{yn.shouldClearCache()&&(xn.promises.add("VCardsInitialized"),yn.vcards&&(yn.vcards.clearStore(),delete yn.vcards))}),xn.listen.on("messageInitialized",e=>n(e)),xn.listen.on("rosterContactInitialized",e=>n(e)),xn.listen.on("statusInitialized",yn.initVCardCollection),Object.assign(yn.api,{vcard:{set(t,n){if(!t)throw Error("No jid provided for the VCard data");const i=or.xmlHtmlNode(rr()(n)).firstElementChild;return xn.sendIQ(e("set",t,i))},get(e,n){if(Object(i.isString)(e))return t(yn,e);if(!n&&e.get("vcard_updated")&&ar(e.get("vcard_error")).isSame(new Date,"day"))return Promise.resolve({});{const n=e.get("jid");if(!n)throw new Error("No JID to get vcard for!");return t(yn,n)}},async update(e,t){const n=await this.get(e,t);delete n.stanza,e.save(n)}}})}});var lr=n(1),ur=n.n(lr);const dr={},hr=/\s+/;let fr;const pr=function(e,t,n,i,r){let o,s=0;if(n&&"object"==typeof n){void 0!==i&&"context"in r&&void 0===r.context&&(r.context=i);for(o=ur.a.keys(n);s<o.length;s++)t=pr(e,t,o[s],n[o[s]],r)}else if(n&&hr.test(n))for(o=n.split(hr);s<o.length;s++)t=e(t,o[s],i,r);else t=e(t,n,i,r);return t};dr.on=function(e,t,n){if(this._events=pr(gr,this._events||{},e,t,{context:n,ctx:this,listening:fr}),fr){(this._listeners||(this._listeners={}))[fr.id]=fr,fr.interop=!1}return this},dr.listenTo=function(e,t,n){if(!e)return this;const i=e._listenId||(e._listenId=ur.a.uniqueId("l")),r=this._listeningTo||(this._listeningTo={});let o=fr=r[i];o||(this._listenId||(this._listenId=ur.a.uniqueId("l")),o=fr=r[i]=new wr(this,e));const s=mr(e,t,n,this);if(fr=void 0,s)throw s;return o.interop&&o.on(t,n),this};const gr=function(e,t,n,i){if(n){const r=e[t]||(e[t]=[]),o=i.context,s=i.ctx,a=i.listening;a&&a.count++,r.push({callback:n,context:o,ctx:o||s,listening:a})}return e},mr=function(e,t,n,i){try{e.on(t,n,i)}catch(e){return e}};dr.off=function(e,t,n){return this._events?(this._events=pr(vr,this._events,e,t,{context:n,listeners:this._listeners}),this):this},dr.stopListening=function(e,t,n){const i=this._listeningTo;if(!i)return this;const r=e?[e._listenId]:ur.a.keys(i);for(let e=0;e<r.length;e++){const o=i[r[e]];if(!o)break;o.obj.off(t,n,this),o.interop&&o.off(t,n)}return ur.a.isEmpty(i)&&(this._listeningTo=void 0),this};const vr=function(e,t,n,i){if(!e)return;const r=i.context,o=i.listeners;let s,a=0;if(t||r||n){for(s=t?[t]:ur.a.keys(e);a<s.length;a++){const i=e[t=s[a]];if(!i)break;const o=[];for(let e=0;e<i.length;e++){const s=i[e];if(n&&n!==s.callback&&n!==s.callback._callback||r&&r!==s.context)o.push(s);else{const e=s.listening;e&&e.off(t,n)}}o.length?e[t]=o:delete e[t]}return e}for(s=ur.a.keys(o);a<s.length;a++)o[s[a]].cleanup()};dr.once=function(e,t,n){const i=pr(_r,{},e,t,this.off.bind(this));return"string"==typeof e&&null==n&&(t=void 0),this.on(i,t,n)},dr.listenToOnce=function(e,t,n){const i=pr(_r,{},t,n,this.stopListening.bind(this,e));return this.listenTo(e,i)};const _r=function(e,t,n,i){if(n){const r=e[t]=ur.a.once((function(){i(t,r),n.apply(this,arguments)}));r._callback=n}return e};dr.trigger=function(e){if(!this._events)return this;const t=Math.max(0,arguments.length-1),n=Array(t);for(let e=0;e<t;e++)n[e]=arguments[e+1];return pr(br,this._events,e,void 0,n),this};const br=function(e,t,n,i){if(e){const n=e[t];let r=e.all;n&&r&&(r=r.slice()),n&&yr(n,i),r&&yr(r,[t].concat(i))}return e},yr=function(e,t){let n,i=-1;const r=e.length,o=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++i<r;)(n=e[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=e[i]).callback.call(n.ctx,o);return;case 2:for(;++i<r;)(n=e[i]).callback.call(n.ctx,o,s);return;case 3:for(;++i<r;)(n=e[i]).callback.call(n.ctx,o,s,a);return;default:for(;++i<r;)(n=e[i]).callback.apply(n.ctx,t);return}},wr=function(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0};wr.prototype.on=dr.on,wr.prototype.off=function(e,t){let n;this.interop?(this._events=pr(vr,this._events,e,t,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=0===this.count),n&&this.cleanup()},wr.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},dr.bind=dr.on,dr.unbind=dr.off;
/**
 * @module converse-autocomplete
 * @copyright Lea Verou and the Converse.js contributors
 * @description
 *  Converse.js plugin which started as a fork of Lea Verou's Awesomplete
 *  https://leaverou.github.io/awesomplete/
 * @license Mozilla Public License (MPLv2)
 */
const Sr=zn.env.utils,xr=function(e,t){return RegExp(Cr.regExpEscape(t.trim()),"i").test(e)},Er=function(e,t){return RegExp("^"+Cr.regExpEscape(t.trim()),"i").test(e)},Ar=function(e,t){return e.length!==t.length?e.length-t.length:e<t?-1:1},jr=(e,t)=>{t=t.trim();const n=document.createElement("li");n.setAttribute("aria-selected","false");const i=new RegExp("("+t+")","ig");return(t?e.split(i):[e]).forEach(e=>{if(t&&e.match(i)){const t=document.createElement("mark");t.textContent=e,n.appendChild(t)}else n.appendChild(document.createTextNode(e))}),n},Cr={getElement:(e,t)=>"string"==typeof e?(t||document).querySelector(e):e||null,bind(e,t){if(e)for(var n in t){if(!Object.prototype.hasOwnProperty.call(t,n))continue;const i=t[n];n.split(/\s+/).forEach(t=>e.addEventListener(t,i))}},unbind(e,t){if(e)for(var n in t){if(!Object.prototype.hasOwnProperty.call(t,n))continue;const i=t[n];n.split(/\s+/).forEach(t=>e.removeEventListener(t,i))}},regExpEscape:e=>e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")};class kr extends String{constructor(e){super();const t=Array.isArray(e)?{label:e[0],value:e[1]}:"object"==typeof e&&"label"in e&&"value"in e?e:{label:e,value:e};this.label=t.label||t.value,this.value=t.value}get lenth(){return this.label.length}toString(){return""+this.label}valueOf(){return this.toString()}}class Or{constructor(e,t={}){this.is_opened=!1,Sr.hasClass("suggestion-box",e)?this.container=e:this.container=e.querySelector(".suggestion-box"),this.input=this.container.querySelector(".suggestion-box__input"),this.input.setAttribute("aria-autocomplete","list"),this.ul=this.container.querySelector(".suggestion-box__results"),this.status=this.container.querySelector(".suggestion-box__additions"),Object.assign(this,{match_current_word:!1,ac_triggers:[],include_triggers:[],min_chars:2,max_items:10,auto_evaluate:!0,auto_first:!1,data:e=>e,filter:xr,sort:!1!==t.sort&&Ar,item:jr},t),this.index=-1,this.bindEvents(),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||t.list||[]}bindEvents(){const e={blur:()=>this.close({reason:"blur"})};this.auto_evaluate&&(e.input=()=>this.evaluate()),this._events={input:e,form:{submit:()=>this.close({reason:"submit"})},ul:{mousedown:e=>this.onMouseDown(e),mouseover:e=>this.onMouseOver(e)}},Cr.bind(this.input,this._events.input),Cr.bind(this.input.form,this._events.form),Cr.bind(this.ul,this._events.ul)}set list(e){if(Array.isArray(e)||"function"==typeof e)this._list=e;else if("string"==typeof e&&e.includes(","))this._list=e.split(/\s*,\s*/);else if((e=Cr.getElement(e))&&e.children){const t=[];Array.prototype.slice.apply(e.children).forEach((function(e){if(!e.disabled){const n=e.textContent.trim(),i=e.value||n,r=e.label||n;""!==i&&t.push({label:r,value:i})}})),this._list=t}document.activeElement===this.input&&this.evaluate()}get selected(){return this.index>-1}get opened(){return this.is_opened}close(e){this.opened&&(this.ul.setAttribute("hidden",""),this.is_opened=!1,this.index=-1,this.trigger("suggestion-box-close",e||{}))}insertValue(e){this.match_current_word?Sr.replaceCurrentWord(this.input,e.value):this.input.value=e.value}open(){this.ul.removeAttribute("hidden"),this.is_opened=!0,this.auto_first&&-1===this.index&&this.goto(0),this.trigger("suggestion-box-open")}destroy(){Cr.unbind(this.input,this._events.input),Cr.unbind(this.input.form,this._events.form),this.input.removeAttribute("aria-autocomplete")}next(){const e=this.ul.children.length;this.goto(this.index<e-1?this.index+1:e?0:-1)}previous(){const e=this.ul.children.length,t=this.index-1;this.goto(this.selected&&-1!==t?t:e-1)}goto(e){const t=this.ul.children;this.selected&&t[this.index].setAttribute("aria-selected","false"),this.index=e,e>-1&&t.length>0&&(t[e].setAttribute("aria-selected","true"),t[e].focus(),this.status.textContent=t[e].textContent,this.ul.scrollTop=t[e].offsetTop-this.ul.clientHeight+t[e].clientHeight,this.trigger("suggestion-box-highlight",{text:this.suggestions[this.index]}))}select(e){if(e?this.index=Sr.siblingIndex(e):e=this.ul.children[this.index],e){const e=this.suggestions[this.index];this.insertValue(e),this.close({reason:"select"}),this.auto_completing=!1,this.trigger("suggestion-box-selectcomplete",{text:e})}}onMouseOver(e){const t=Sr.ancestor(e.target,"li");t&&this.goto(Array.prototype.slice.call(this.ul.children).indexOf(t))}onMouseDown(e){if(0!==e.button)return;const t=Sr.ancestor(e.target,"li");t&&(e.preventDefault(),this.select(t,e.target))}onKeyDown(e){if(this.opened){if([zn.keycodes.ENTER,zn.keycodes.TAB].includes(e.keyCode)&&this.selected)return e.preventDefault(),e.stopPropagation(),this.select(),!0;if(e.keyCode===zn.keycodes.ESCAPE)return this.close({reason:"esc"}),!0;if([zn.keycodes.UP_ARROW,zn.keycodes.DOWN_ARROW].includes(e.keyCode))return e.preventDefault(),e.stopPropagation(),this[e.keyCode===zn.keycodes.UP_ARROW?"previous":"next"](),!0}if(![zn.keycodes.SHIFT,zn.keycodes.META,zn.keycodes.META_RIGHT,zn.keycodes.ESCAPE,zn.keycodes.ALT].includes(e.keyCode))if(this.ac_triggers.includes(e.key))"Tab"===e.key&&e.preventDefault(),this.auto_completing=!0;else if("Backspace"===e.key){const t=Sr.getCurrentWord(e.target,e.target.selectionEnd-1);this.ac_triggers.includes(t[0])&&(this.auto_completing=!0)}}async evaluate(e){const t=this.selected&&e&&(e.keyCode===zn.keycodes.UP_ARROW||e.keyCode===zn.keycodes.DOWN_ARROW);if(!this.auto_evaluate&&!this.auto_completing||t)return;const n="function"==typeof this._list?await this._list():this._list;if(0===n.length)return;let i=this.match_current_word?Sr.getCurrentWord(this.input):this.input.value;const r=this.ac_triggers.includes(i[0]);r&&(this.auto_completing=!0,this.include_triggers.includes(e.key)||(i=i.slice("1"))),(r||i.length)&&i.length>=this.min_chars?(this.index=-1,this.ul.innerHTML="",this.suggestions=n.map(e=>new kr(this.data(e,i))).filter(e=>this.filter(e,i)),!1!==this.sort&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.max_items),this.suggestions.forEach(e=>this.ul.appendChild(this.item(e,i))),0===this.ul.children.length?this.close({reason:"nomatches"}):this.open()):(this.close({reason:"nomatches"}),r||(this.auto_completing=!1))}}Object.assign(Or.prototype,dr),zn.plugins.add("converse-autocomplete",{initialize(){const e=this._converse;e.FILTER_CONTAINS=xr,e.FILTER_STARTSWITH=Er,e.AutoComplete=Or}});
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const Tr=new WeakMap,Nr=e=>(...t)=>{const n=e(...t);return Tr.set(n,!0),n},Mr=e=>"function"==typeof e&&Tr.has(e),Ir="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,Rr=(e,t,n=null,i=null)=>{for(;t!==n;){const n=t.nextSibling;e.insertBefore(t,i),t=n}},Dr=(e,t,n=null)=>{for(;t!==n;){const n=t.nextSibling;e.removeChild(t),t=n}},Pr={},Lr={},zr=`{{lit-${String(Math.random()).slice(2)}}}`,Fr=`\x3c!--${zr}--\x3e`,Br=new RegExp(`${zr}|${Fr}`);class qr{constructor(e,t){this.parts=[],this.element=t;const n=[],i=[],r=document.createTreeWalker(t.content,133,null,!1);let o=0,s=-1,a=0;const{strings:c,values:{length:l}}=e;for(;a<l;){const e=r.nextNode();if(null!==e){if(s++,1===e.nodeType){if(e.hasAttributes()){const t=e.attributes,{length:n}=t;let i=0;for(let e=0;e<n;e++)Ur(t[e].name,"$lit$")&&i++;for(;i-- >0;){const t=c[a],n=Wr.exec(t)[2],i=n.toLowerCase()+"$lit$",r=e.getAttribute(i);e.removeAttribute(i);const o=r.split(Br);this.parts.push({type:"attribute",index:s,name:n,strings:o}),a+=o.length-1}}"TEMPLATE"===e.tagName&&(i.push(e),r.currentNode=e.content)}else if(3===e.nodeType){const t=e.data;if(t.indexOf(zr)>=0){const i=e.parentNode,r=t.split(Br),o=r.length-1;for(let t=0;t<o;t++){let n,o=r[t];if(""===o)n=$r();else{const e=Wr.exec(o);null!==e&&Ur(e[2],"$lit$")&&(o=o.slice(0,e.index)+e[1]+e[2].slice(0,-"$lit$".length)+e[3]),n=document.createTextNode(o)}i.insertBefore(n,e),this.parts.push({type:"node",index:++s})}""===r[o]?(i.insertBefore($r(),e),n.push(e)):e.data=r[o],a+=o}}else if(8===e.nodeType)if(e.data===zr){const t=e.parentNode;null!==e.previousSibling&&s!==o||(s++,t.insertBefore($r(),e)),o=s,this.parts.push({type:"node",index:s}),null===e.nextSibling?e.data="":(n.push(e),s--),a++}else{let t=-1;for(;-1!==(t=e.data.indexOf(zr,t+1));)this.parts.push({type:"node",index:-1}),a++}}else r.currentNode=i.pop()}for(const e of n)e.parentNode.removeChild(e)}}const Ur=(e,t)=>{const n=e.length-t.length;return n>=0&&e.slice(n)===t},Hr=e=>-1!==e.index,$r=()=>document.createComment(""),Wr=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Vr{constructor(e,t,n){this.__parts=[],this.template=e,this.processor=t,this.options=n}update(e){let t=0;for(const n of this.__parts)void 0!==n&&n.setValue(e[t]),t++;for(const e of this.__parts)void 0!==e&&e.commit()}_clone(){const e=Ir?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),t=[],n=this.template.parts,i=document.createTreeWalker(e,133,null,!1);let r,o=0,s=0,a=i.nextNode();for(;o<n.length;)if(r=n[o],Hr(r)){for(;s<r.index;)s++,"TEMPLATE"===a.nodeName&&(t.push(a),i.currentNode=a.content),null===(a=i.nextNode())&&(i.currentNode=t.pop(),a=i.nextNode());if("node"===r.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(a.previousSibling),this.__parts.push(e)}else this.__parts.push(...this.processor.handleAttributeExpressions(a,r.name,r.strings,this.options));o++}else this.__parts.push(void 0),o++;return Ir&&(document.adoptNode(e),customElements.upgrade(e)),e}}
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Gr=` ${zr} `;class Jr{constructor(e,t,n,i){this.strings=e,this.values=t,this.type=n,this.processor=i}getHTML(){const e=this.strings.length-1;let t="",n=!1;for(let i=0;i<e;i++){const e=this.strings[i],r=e.lastIndexOf("\x3c!--");n=(r>-1||n)&&-1===e.indexOf("--\x3e",r+1);const o=Wr.exec(e);t+=null===o?e+(n?Gr:Fr):e.substr(0,o.index)+o[1]+o[2]+"$lit$"+o[3]+zr}return t+=this.strings[e],t}getTemplateElement(){const e=document.createElement("template");return e.innerHTML=this.getHTML(),e}}
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const Qr=e=>null===e||!("object"==typeof e||"function"==typeof e),Kr=e=>Array.isArray(e)||!(!e||!e[Symbol.iterator]);class Yr{constructor(e,t,n){this.dirty=!0,this.element=e,this.name=t,this.strings=n,this.parts=[];for(let e=0;e<n.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new Xr(this)}_getValue(){const e=this.strings,t=e.length-1;let n="";for(let i=0;i<t;i++){n+=e[i];const t=this.parts[i];if(void 0!==t){const e=t.value;if(Qr(e)||!Kr(e))n+="string"==typeof e?e:String(e);else for(const t of e)n+="string"==typeof t?t:String(t)}}return n+=e[t],n}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class Xr{constructor(e){this.value=void 0,this.committer=e}setValue(e){e===Pr||Qr(e)&&e===this.value||(this.value=e,Mr(e)||(this.committer.dirty=!0))}commit(){for(;Mr(this.value);){const e=this.value;this.value=Pr,e(this)}this.value!==Pr&&this.committer.commit()}}class Zr{constructor(e){this.value=void 0,this.__pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild($r()),this.endNode=e.appendChild($r())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e.__insert(this.startNode=$r()),e.__insert(this.endNode=$r())}insertAfterPart(e){e.__insert(this.startNode=$r()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this.__pendingValue=e}commit(){if(null===this.startNode.parentNode)return;for(;Mr(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=Pr,e(this)}const e=this.__pendingValue;e!==Pr&&(Qr(e)?e!==this.value&&this.__commitText(e):e instanceof Jr?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):Kr(e)?this.__commitIterable(e):e===Lr?(this.value=Lr,this.clear()):this.__commitText(e))}__insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}__commitNode(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}__commitText(e){const t=this.startNode.nextSibling,n="string"==typeof(e=null==e?"":e)?e:String(e);t===this.endNode.previousSibling&&3===t.nodeType?t.data=n:this.__commitNode(document.createTextNode(n)),this.value=e}__commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value instanceof Vr&&this.value.template===t)this.value.update(e.values);else{const n=new Vr(t,e.processor,this.options),i=n._clone();n.update(e.values),this.__commitNode(i),this.value=n}}__commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let n,i=0;for(const r of e)n=t[i],void 0===n&&(n=new Zr(this.options),t.push(n),0===i?n.appendIntoPart(this):n.insertAfterPart(t[i-1])),n.setValue(r),n.commit(),i++;i<t.length&&(t.length=i,this.clear(n&&n.endNode))}clear(e=this.startNode){Dr(this.startNode.parentNode,e.nextSibling,this.endNode)}}class eo{constructor(e,t,n){if(this.value=void 0,this.__pendingValue=void 0,2!==n.length||""!==n[0]||""!==n[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=n}setValue(e){this.__pendingValue=e}commit(){for(;Mr(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=Pr,e(this)}if(this.__pendingValue===Pr)return;const e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=Pr}}class to extends Yr{constructor(e,t,n){super(e,t,n),this.single=2===n.length&&""===n[0]&&""===n[1]}_createPart(){return new no(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class no extends Xr{}let io=!1;(()=>{try{const e={get capture(){return io=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();class ro{constructor(e,t,n){this.value=void 0,this.__pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=n,this.__boundHandleEvent=e=>this.handleEvent(e)}setValue(e){this.__pendingValue=e}commit(){for(;Mr(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=Pr,e(this)}if(this.__pendingValue===Pr)return;const e=this.__pendingValue,t=this.value,n=null==e||null!=t&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),i=null!=e&&(null==t||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),i&&(this.__options=oo(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=Pr}handleEvent(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}const oo=e=>e&&(io?{capture:e.capture,passive:e.passive,once:e.once}:e.capture)
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */;const so=new class{handleAttributeExpressions(e,t,n,i){const r=t[0];if("."===r){return new to(e,t.slice(1),n).parts}return"@"===r?[new ro(e,t.slice(1),i.eventContext)]:"?"===r?[new eo(e,t.slice(1),n)]:new Yr(e,t,n).parts}handleTextExpression(e){return new Zr(e)}};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function ao(e){let t=co.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},co.set(e.type,t));let n=t.stringsArray.get(e.strings);if(void 0!==n)return n;const i=e.strings.join(zr);return n=t.keyString.get(i),void 0===n&&(n=new qr(e,e.getTemplateElement()),t.keyString.set(i,n)),t.stringsArray.set(e.strings,n),n}const co=new Map,lo=new WeakMap,uo=(e,t,n)=>{let i=lo.get(t);void 0===i&&(Dr(t,t.firstChild),lo.set(t,i=new Zr(Object.assign({templateFactory:ao},n))),i.appendInto(t)),i.setValue(e),i.commit()};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.2.1");const ho=(e,...t)=>new Jr(e,t,"html",so);function fo(){const e=go(['\n    <div class="list-container list-container--bookmarks ','">\n        <a class="list-toggle bookmarks-toggle controlbox-padded"\n           title="','"\n           @click=','>\n\n            <span class="fa ','">\n            </span> ','</a>\n        <div class="items-list bookmarks rooms-list ','">\n        ',"\n        </div>\n    </div>\n"]);return fo=function(){return e},e}function po(){const e=go(['\n    <div class="list-item controlbox-padded room-item available-chatroom d-flex flex-row ','" data-room-jid="','">\n        <a class="list-item-link open-room w-100" data-room-jid="','"\n           title="','"\n           @click=',">",'</a>\n\n        <a class="list-item-action remove-bookmark fa fa-bookmark align-self-center ','"\n           data-room-jid="','"\n           data-bookmark-name="','"\n           title="','"\n           @click=',"></a>\n    </div>\n"]);return po=function(){return e},e}function go(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const mo=ne("Click to toggle the bookmarks list"),vo=ne("Unbookmark this groupchat"),_o=ne("Bookmarks"),bo=ne("Click to open this groupchat");var yo=e=>ho(fo(),e.hidden?"":"hidden",mo,e.toggleBookmarksList,e.toggle_state===e._converse.OPENED?"fa-caret-down":"fa-caret-right",_o,e.toggle_state!==e._converse.OPENED?"hidden":"",e.bookmarks.map(t=>(e=>ho(po(),e.is_hidden(e.bm)?"hidden":"",e.bm.get("jid"),e.bm.get("jid"),bo,e.openRoom,e.bm.getDisplayName(),e.bm.get("bookmarked")?"button-on":"",e.bm.get("jid"),e.bm.getDisplayName(),vo,e.removeBookmark))(Object.assign({bm:t},e))));function wo(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n    <form class="converse-form chatroom-form" @submit=',">\n        <legend>",'</legend>\n        <fieldset class="form-group">\n            <label for="converse_muc_bookmark_name">','</label>\n            <input class="form-control" type="text" value="','" name="name" required="required" id="converse_muc_bookmark_name"/>\n        </fieldset>\n        <fieldset class="form-group">\n            <label for="converse_muc_bookmark_nick">','</label>\n            <input class="form-control" type="text" name="nick" value="','" id="converse_muc_bookmark_nick"/>\n        </fieldset>\n        <fieldset class="form-group form-check">\n            <input class="form-check-input" id="converse_muc_bookmark_autojoin" type="checkbox" name="autojoin"/>\n            <label class="form-check-label" for="converse_muc_bookmark_autojoin">','</label>\n        </fieldset>\n        <fieldset class="form-group">\n            <input class="btn btn-primary" type="submit" value="','">\n            <input class="btn btn-secondary button-cancel" type="button" value="','" @click=',">\n        </fieldset>\n    </form>\n"]);return wo=function(){return e},e}const So=ne("Bookmark this groupchat"),xo=ne("Would you like this groupchat to be automatically joined upon startup?"),Eo=ne("Cancel"),Ao=ne("The name for this bookmark:"),jo=ne("What should your nickname for this groupchat be?"),Co=ne("Save");function ko(e,t){const n=this;let i;return i=e&&ur.a.has(e,"constructor")?e.constructor:function(){return n.apply(this,arguments)},ur.a.extend(i,n,t),i.prototype=ur.a.create(n.prototype,e),i.prototype.constructor=i,i.__super__=n.prototype,i}function Oo(){const e={isResolved:!1,isPending:!0,isRejected:!1},t=new Promise((t,n)=>{e.resolve=t,e.reject=n});return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}function To(){throw new Error('A "url" property or function must be specified')}function No(e,t){const n=t.error;t.error=function(i){n&&n.call(t.context,e,i,t),e.trigger("error",e,i,t)}}const Mo={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};function Io(e){const t=ur.a.result(e,"browserStorage")||ur.a.result(e.collection,"browserStorage");return t?t.sync():Ro}function Ro(e,t,n={}){const i={type:Mo[e],dataType:"json"};n.url||(i.url=ur.a.result(t,"url")||To()),null!=n.data||!t||"create"!==e&&"update"!==e&&"patch"!==e||(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),"GET"!==i.type&&(i.processData=!1);const r=n.error;n.error=function(e,t,i){n.textStatus=t,n.errorThrown=i,r&&r.call(n.context,e,t,i)};const o=n.xhr=function(){return fetch.apply(this,arguments)}(ur.a.extend(i,n));return t.trigger("request",t,o,n),o}Array.prototype.slice;const Do=function(e,t){let n=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=Object(lr.uniqueId)(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});const i=Object(lr.result)(this,"defaults");n=Object(lr.defaults)(Object(lr.extend)({},i,n),i),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};Do.extend=ko,Object(lr.extend)(Do.prototype,dr,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(e){return Object(lr.clone)(this.attributes)},sync:function(e,t,n){return Io(this)(e,t,n)},get:function(e){return this.attributes[e]},escape:function(e){return Object(lr.escape)(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!Object(lr.iteratee)(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;let i;if("object"==typeof e?(i=e,n=t):(i={})[e]=t,n||(n={}),!this._validate(i,n))return!1;const r=n.unset,o=n.silent,s=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=Object(lr.clone)(this.attributes),this.changed={});const c=this.attributes,l=this.changed,u=this._previousAttributes;for(const e in i)t=i[e],Object(lr.isEqual)(c[e],t)||s.push(e),Object(lr.isEqual)(u[e],t)?delete l[e]:l[e]=t,r?delete c[e]:c[e]=t;if(this.idAttribute in i&&(this.id=this.get(this.idAttribute)),!o){s.length&&(this._pending=n);for(let e=0;e<s.length;e++)this.trigger("change:"+s[e],this,c[s[e]],n)}if(a)return this;if(!o)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,Object(lr.extend)({},t,{unset:!0}))},clear:function(e){const t={};for(const e in this.attributes)t[e]=void 0;return this.set(t,Object(lr.extend)({},e,{unset:!0}))},hasChanged:function(e){return null==e?!Object(lr.isEmpty)(this.changed):Object(lr.has)(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&Object(lr.clone)(this.changed);const t=this._changing?this._previousAttributes:this.attributes,n={};let i;for(const r in e){const o=e[r];Object(lr.isEqual)(t[r],o)||(n[r]=o,i=!0)}return!!i&&n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return Object(lr.clone)(this._previousAttributes)},fetch:function(e){e=Object(lr.extend)({parse:!0},e);const t=this,n=e.success;return e.success=function(i){const r=e.parse?t.parse(i,e):i;if(!t.set(r,e))return!1;n&&n.call(e.context,t,i,e),t.trigger("sync",t,i,e)},No(this,e),this.sync("read",this,e)},save:function(e,t,n){let i;null==e||"object"==typeof e?(i=e,n=t):(i={})[e]=t;const r=(n=Object(lr.extend)({validate:!0,parse:!0},n)).wait,o=n.promise,s=o&&Oo();if(i&&!r){if(!this.set(i,n))return!1}else if(!this._validate(i,n))return!1;const a=this,c=n.success,l=this.attributes;n.success=function(e){a.attributes=l;let t=n.parse?a.parse(e,n):e;if(r&&(t=Object(lr.extend)({},i,t)),t&&!a.set(t,n))return!1;c&&c.call(n.context,a,e,n),a.trigger("sync",a,e,n),o&&s.resolve()},No(this,n),i&&r&&(this.attributes=Object(lr.extend)({},l,i));const u=this.isNew()?"create":n.patch?"patch":"update";"patch"!==u||n.attrs||(n.attrs=i);const d=this.sync(u,this,n);return this.attributes=l,o?s:d},destroy:function(e){e=e?Object(lr.clone)(e):{};const t=this,n=e.success,i=e.wait,r=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(o){i&&r(),n&&n.call(e.context,t,o,e),t.isNew()||t.trigger("sync",t,o,e)};let o=!1;return this.isNew()?Object(lr.defer)(e.success):(No(this,e),o=this.sync("delete",this,e)),i||r(),o},url:function(){const e=Object(lr.result)(this,"urlRoot")||Object(lr.result)(this.collection,"url")||To();if(this.isNew())return e;const t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},Object(lr.extend)({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=Object(lr.extend)({},this.attributes,e);const n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,Object(lr.extend)(t,{validationError:n})),!1)}});const Po=/^\s*</,Lo="undefined"!=typeof Element&&Element.prototype||{},zo=Lo.matches||Lo.webkitMatchesSelector||Lo.mozMatchesSelector||Lo.msMatchesSelector||Lo.oMatchesSelector||function(e){return~function(e,t){for(let n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}((this.parentNode||document).querySelectorAll(e)||[],this)},Fo=function(e){this.cid=Object(lr.uniqueId)("view"),this._domEvents=[],this.preinitialize.apply(this,arguments),Object(lr.extend)(this,Object(lr.pick)(e,qo)),this._ensureElement(),this.initialize.apply(this,arguments)};Fo.extend=ko;const Bo=/^(\S+)\s*(.*)$/,qo=["model","collection","el","id","attributes","className","tagName","events"];Object(lr.extend)(Fo.prototype,dr,{tagName:"div",$:function(e){return this.el.querySelectorAll(e)},preinitialize:function(){},initialize:function(){},render:function(){return Object(lr.isFunction)(this.beforeRender)&&this.beforeRender(),Object(lr.isFunction)(this.toHTML)&&uo(this.toHTML(),this.el),Object(lr.isFunction)(this.afterRender)&&this.afterRender(),this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.undelegateEvents(),this.el.parentNode&&this.el.parentNode.removeChild(this.el)},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){if("string"==typeof e)if(Po.test(e)){const t=document.createElement("div");t.innerHTML=e,this.el=t.firstChild}else this.el=document.querySelector(e);else e&&!Object(lr.isElement)(e)&&e.length?this.el=e[0]:this.el=e},delegateEvents:function(e){if(e||(e=Object(lr.result)(this,"events")),!e)return this;this.undelegateEvents();for(const t in e){let n=e[t];if(Object(lr.isFunction)(n)||(n=this[n]),!n)continue;const i=t.match(Bo);this.delegate(i[1],i[2],n.bind(this))}return this},delegate:function(e,t,n){const i=this.el;if(!i)return this;if("function"==typeof t&&(n=t,t=null),-1!==["focus","blur"].indexOf(e)){const i=this.el.querySelectorAll(t);for(let t=0,r=i.length;t<r;t++){const r=i[t];r.addEventListener(e,n,!1),this._domEvents.push({el:r,eventName:e,handler:n})}return n}const r=t?function(e){let r=e.target||e.srcElement;for(;r&&r!=i;r=r.parentNode)zo.call(r,t)&&(e.delegateTarget=r,n(e))}:n;return this.el.addEventListener(e,r,!1),this._domEvents.push({el:this.el,eventName:e,handler:r,listener:n,selector:t}),this},undelegateEvents:function(){if(this.el){for(let e=0,t=this._domEvents.length;e<t;e++){const t=this._domEvents[e];t.el.removeEventListener(t.eventName,t.handler,!1)}this._domEvents.length=0}return this},undelegate:function(e,t,n){if("function"==typeof t&&(n=t,t=null),this.el){const i=this._domEvents.slice();let r=i.length;for(;r--;){const o=i[r];!(o.eventName!==e||n&&o.listener!==n||t&&o.selector!==t)&&(o.el.removeEventListener(o.eventName,o.handler,!1),this._domEvents.splice(r,1))}}return this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(Object(lr.result)(this,"el"));else{const e=Object(lr.extend)({},Object(lr.result)(this,"attributes"));this.id&&(e.id=Object(lr.result)(this,"id")),this.className&&(e.class=Object(lr.result)(this,"className")),this.setElement(this._createElement(Object(lr.result)(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){for(const t in e)t in this.el?this.el[t]=e[t]:this.el.setAttribute(t,e[t])}});
/**
 * @module converse-bookmark-views
 * @description Converse.js plugin which adds views for XEP-0048 bookmarks
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:Uo}=zn.env,Ho=zn.env.utils;zn.plugins.add("converse-bookmark-views",{dependencies:["converse-chatboxes","converse-muc","converse-muc-views"],initialize(){xn.settings.update({hide_open_bookmarks:!0}),Object.assign(yn,{removeBookmarkViaEvent(e){e.preventDefault();const t=e.target.getAttribute("data-bookmark-name"),n=e.target.getAttribute("data-room-jid");confirm(ne('Are you sure you want to remove the bookmark "%1$s"?',t))&&Object(lr.invokeMap)(yn.bookmarks.where({jid:n}),Do.prototype.destroy)},addBookmarkViaEvent(e){e.preventDefault();const t=e.target.getAttribute("data-room-jid");xn.rooms.open(t,{bring_to_foreground:!0}),yn.chatboxviews.get(t).renderBookmarkForm()}});const e={setBookmarkState(){if(void 0!==yn.bookmarks){yn.bookmarks.where({jid:this.model.get("jid")}).length?this.model.save("bookmarked",!0):this.model.save("bookmarked",!1)}},renderBookmarkForm(){if(this.hideChatRoomContents(),!this.bookmark_form){this.bookmark_form=new yn.MUCBookmarkForm({model:this.model,chatroomview:this}),this.el.querySelector(".chatroom-body").insertAdjacentElement("beforeend",this.bookmark_form.el)}Ho.showElement(this.bookmark_form.el)},toggleBookmark(e){e&&(e.preventDefault(),e.stopPropagation());const t=yn.bookmarks.where({jid:this.model.get("jid")});t.length?t.forEach(e=>e.destroy()):this.renderBookmarkForm()}};Object.assign(yn.ChatRoomView.prototype,e),yn.MUCBookmarkForm=Fo.extend({className:"muc-bookmark-form chatroom-form-container",initialize(e){this.chatroomview=e.chatroomview,this.render()},toHTML(){return e=Object.assign(this.model.toJSON(),{onCancel:e=>this.closeBookmarkForm(e),onSubmit:e=>this.onBookmarkFormSubmitted(e)}),ho(wo(),e.onSubmit,So,Ao,e.name,jo,""|e.nick,xo,Co,Eo,e.onCancel);var e},onBookmarkFormSubmitted(e){var t,n,i;e.preventDefault(),yn.bookmarks.createBookmark({jid:this.model.get("jid"),autojoin:(null===(t=e.target.querySelector('input[name="autojoin"]'))||void 0===t?void 0:t.checked)||!1,name:null===(n=e.target.querySelector("input[name=name]"))||void 0===n?void 0:n.value,nick:null===(i=e.target.querySelector("input[name=nick]"))||void 0===i?void 0:i.value}),this.closeBookmarkForm(e)},closeBookmarkForm(e){e.preventDefault(),this.chatroomview.closeForm()}}),yn.BookmarksView=Fo.extend({tagName:"span",initialize(){this.listenTo(this.model,"add",this.render),this.listenTo(this.model,"remove",this.render),this.listenTo(yn.chatboxes,"add",this.render),this.listenTo(yn.chatboxes,"remove",this.render);const e="converse.room-bookmarks".concat(yn.bare_jid,"-list-model");this.list_model=new yn.BookmarksList({id:e}),this.list_model.browserStorage=yn.createStore(e);const t=()=>{this.render(),this.insertIntoControlBox()};this.list_model.fetch({success:t,error:t})},toHTML(){return yo({_converse:yn,bookmarks:this.model,hidden:this.model.getUnopenedBookmarks().length&&!0,is_hidden:e=>!(!xn.settings.get("hide_open_bookmarks")||!yn.chatboxes.get(e.get("jid"))),openRoom:e=>this.openRoom(e),removeBookmark:e=>this.removeBookmark(e),toggleBookmarksList:e=>this.toggleBookmarksList(e),toggle_state:this.list_model.get("toggle-state")})},insertIntoControlBox(){const e=yn.chatboxviews.get("controlbox");if(void 0!==e&&!Ho.rootContains(yn.root,this.el)){const t=e.el.querySelector(".list-container--bookmarks");t&&t.parentNode.replaceChild(this.el,t)}},openRoom(e){e.preventDefault();const t=e.target.textContent,n=e.target.getAttribute("data-room-jid"),i={name:t||Uo.unescapeNode(Uo.getNodeFromJid(n))||n};xn.rooms.open(n,i,!0)},removeBookmark:yn.removeBookmarkViaEvent,toggleBookmarksList(e){e&&e.preventDefault&&e.preventDefault();const t=e.target.matches(".fa")?e.target:e.target.querySelector(".fa");Ho.hasClass("fa-caret-down",t)?(Ho.slideIn(this.el.querySelector(".bookmarks")),this.list_model.save({"toggle-state":yn.CLOSED}),t.classList.remove("fa-caret-down"),t.classList.add("fa-caret-right")):(t.classList.remove("fa-caret-right"),t.classList.add("fa-caret-down"),Ho.slideOut(this.el.querySelector(".bookmarks")),this.list_model.save({"toggle-state":yn.OPENED}))}});xn.listen.on("getHeadingButtons",(e,t)=>{if(yn.allow_bookmarks&&e.model.get("type")===yn.CHATROOMS_TYPE){const n=e.model.get("bookmarked"),i={i18n_title:ne(n?"Unbookmark this groupchat":"Bookmark this groupchat"),i18n_text:ne(n?"Unbookmark":"Bookmark"),handler:t=>e.toggleBookmark(t),a_class:"toggle-bookmark",icon_class:"fa-bookmark",name:"bookmark"},r=t.map(e=>e.name).indexOf("details"),o=yn.checkBookmarksSupport().then(e=>e?i:"");return r>-1?[...t.slice(0,r),o,...t.slice(r)]:[o,...t]}return t}),xn.listen.on("bookmarksInitialized",(async function(){await xn.waitUntil("roomsPanelRendered"),yn.bookmarksview=new yn.BookmarksView({model:yn.bookmarks}),xn.trigger("bookmarkViewsInitialized")})),xn.listen.on("chatRoomViewInitialized",e=>e.setBookmarkState())}});var $o=n(112),Wo=n.n($o),Vo=n(113),Go=n.n(Vo),Jo=n(57),Qo=n.n(Jo);
/*!
 * Copyright (c) JC Brand <jc@opkode.com>
 */
const Ko=function(e){this.views={},this.keys=()=>Object.keys(this.views),this.getAll=()=>this.views,this.get=e=>this.views[e],this.xget=e=>this.keys().filter(t=>t!==e).reduce((e,t)=>(e[t]=this.views[t],e),{}),this.add=(e,t)=>(this.views[e]=t,t),this.remove=e=>{void 0===e&&(new Fo).remove.apply(this);const t=this.views[e];if(t)return delete this.views[e],t.remove(),t},this.removeAll=()=>(this.keys().forEach(e=>this.remove(e)),this),Fo.apply(this,Array.prototype.slice.apply(arguments))},Yo={chain:lr.chain,includes:lr.includes,difference:lr.difference,drop:lr.drop,every:lr.every,filter:lr.filter,find:lr.find,first:lr.first,forEach:lr.forEach,head:lr.head,indexOf:lr.indexOf,initial:lr.initial,invoke:lr.invoke,isEmpty:lr.isEmpty,last:lr.last,lastIndexOf:lr.lastIndexOf,map:lr.map,max:lr.max,min:lr.min,reduce:lr.reduce,reduceRight:lr.reduceRight,reject:lr.reject,rest:lr.rest,sample:lr.sample,shuffle:lr.shuffle,size:lr.size,some:lr.some,sortBy:lr.sortBy,tail:lr.tail,take:lr.take,toArray:lr.toArray,without:lr.without};Object.keys(Yo).forEach(e=>{Ko.prototype[e]=function(){const t=Array.prototype.slice.call(arguments);return t.unshift(this.views),Yo[e].apply(this,t)}}),Object(lr.extend)(Ko.prototype,Fo.prototype),Ko.extend=Fo.extend;const Xo=Ko.extend({listItems:"model",sortEvent:"change",sortImmediatelyOnAdd:!1,listSelector:".ordered-items",ItemView:void 0,subviewIndex:"id",initialize(){this.sortEventually=Object(lr.debounce)(()=>this.sortAndPositionAllItems(),100),this.items=Object(lr.get)(this,this.listItems),this.items.on("remove",this.removeView,this),this.items.on("reset",this.removeAll,this),this.items.on("add",(e,t)=>{this.sortImmediatelyOnAdd?this.sortAndPositionAllItems():this.sortEventually()}),this.sortEvent&&this.items.on(this.sortEvent,this.sortEventually,this)},createItemView(e){let t=this.get(e.get(this.subviewIndex));return t?(t.model=e,t.initialize()):(t=new this.ItemView({model:e}),this.add(e.get(this.subviewIndex),t)),t.render(),t},removeView(e){this.remove(e.get(this.subviewIndex))},sortAndPositionAllItems(){if(!this.items.length)return;this.items.sort();const e=this.el.querySelector(this.listSelector),t=document.createElement("div");e.parentNode.replaceChild(t,e),this.items.forEach(t=>{let n=this.get(t.get(this.subviewIndex));n||(n=this.createItemView(t)),e.insertAdjacentElement("beforeend",n.el)}),t.parentNode.replaceChild(e,t)}}),Zo=zn.env.utils,es={renderAvatar(e){const t=(e=e||this.el).querySelector("canvas.avatar, svg.avatar");if(null!==t&&this.model.vcard){const e={classes:t.getAttribute("class"),width:t.getAttribute("width"),height:t.getAttribute("height")},n=this.model.vcard.get("image_type"),i=this.model.vcard.get("image");e.image="data:"+n+";base64,"+i,t.outerHTML=Wo()(e)}}};
/**
 * @module converse-chatboxviews
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */zn.plugins.add("converse-chatboxviews",{dependencies:["converse-chatboxes","converse-vcard"],initialize(){function e(){const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))}xn.promises.add(["chatBoxViewsInitialized"]),xn.settings.update({animate:!0,theme:"default"}),yn.ViewWithAvatar=Fo.extend(es),yn.ChatBoxViews=Ko.extend({_ensureElement(){if(this.el)this.setElement(Object(lr.result)(this,"el"),!1);else{let e=yn.root.querySelector("#conversejs");if(null===e){e=document.createElement("div"),e.setAttribute("id","conversejs"),Zo.addClass("theme-".concat(xn.settings.get("theme")),e);const t=yn.root.querySelector("body");t?t.appendChild(e):yn.root.appendChild(e)}e.innerHTML="",this.setElement(e,!1)}},initialize(){this.listenTo(this.model,"destroy",this.removeChat);const e=document.getElementById("conversejs-bg");e&&!e.innerHTML.trim()&&(e.innerHTML=Go()()),document.querySelector("body").classList.add("converse-".concat(xn.settings.get("view_mode"))),this.el.classList.add("converse-".concat(xn.settings.get("view_mode"))),xn.settings.get("singleton")&&this.el.classList.add("converse-singleton"),this.render()},render(){try{this.el.innerHTML=Qo()()}catch(e){this._ensureElement(),this.el.innerHTML=Qo()()}this.row_el=this.el.querySelector(".row")},insertRowColumn(e){this.row_el.insertAdjacentElement("afterBegin",e)},removeChat(e){this.remove(e.get("id"))},closeAllChatBoxes(){return Promise.all(this.map(e=>e.close({name:"closeAllChatBoxes"})))}}),xn.listen.on("chatBoxesInitialized",()=>{yn.chatboxviews=new yn.ChatBoxViews({model:yn.chatboxes}),xn.trigger("chatBoxViewsInitialized")}),xn.listen.on("clearSession",()=>yn.chatboxviews.closeAllChatBoxes()),xn.listen.on("chatBoxViewsInitialized",()=>e()),window.addEventListener("resize",()=>e())}});var ts=n(19),ns=n.n(ts);function is(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n    <audio controls src="','"></audio>\n    <a target="_blank" rel="noopener" href="','">',"</a>\n"]);return is=function(){return e},e}function rs(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['<a target="_blank" rel="noopener" href="','">',"</a>"]);return rs=function(){return e},e}var os=n(114),ss=n.n(os),as=n(115),cs=n.n(as),ls=n(38),us=n.n(ls),ds=n(116),hs=n.n(ds),fs=n(117),ps=n.n(fs),gs=n(118),ms=n.n(gs),vs=n(39),_s=n.n(vs);function bs(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['<a href="','" class="chat-image__link" target="_blank" rel="noopener"><img class="chat-image img-thumbnail" src="','"/></a>']);return bs=function(){return e},e}var ys=n(119),ws=n.n(ys);function Ss(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['<video controls preload="metadata" src="','" style="max-height: 50vh"></video>']);return Ss=function(){return e},e}
/**
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 * @description This is the DOM/HTML utilities module.
 */
const xs=/\b(https?\:\/\/|www\.|https?:\/\/www\.)[^\s<>]{2,200}\b\/?/g,Es=["http","https","xmpp","mailto"];function As(e,t){return{"muc#roomconfig_lang":"language","muc#roomconfig_roomsecret":(null==t?void 0:t.new_password)?"new-password":"current-password"}[e]}const js={"text-private":"password","text-single":"text",fixed:"label",boolean:"checkbox",hidden:"hidden","jid-multi":"textarea","list-single":"dropdown","list-multi":"dropdown"};function Cs(e){try{return e instanceof ns.a?e:new ns.a(e)}catch(e){return st.debug(e),null}}function ks(e,t){const n=Cs(t);if(null===n||!function(e){return"http:"===window.location.protocol||"https:"===window.location.protocol&&"https"===e.protocol().toLowerCase()}(n))return!1;const i=n.filename().toLowerCase();return!!e.filter(e=>i.endsWith(e)).length}function Os(e){try{return decodeURI(e.filename())}catch(t){return st.debug(t),e.filename()}}function Ts(e,t){const{__:n}=e;return i={url:t.toString(),label_download:n('Download audio file "%1$s"',Os(t))},ho(is(),i.url,i.url,i.label_download);var i}function Ns(e,t){if(!e.api.settings.get("show_images_inline"))return Bt.convertUriToHyperlink(t);const{__:n}=e;return i={url:t.toString(),label_download:n('Download image "%1$s"',Os(t))},ho(bs(),i.url,i.url);var i}function Ms(e,t){const{__:n}=e;return i={url:t.toString(),label_download:n('Download file "%1$s"',Os(t))},ho(rs(),i.url,i.label_download);var i}async function Is(e,t,n,i){if(Bt.isImageURL(e)){let o;try{o=await(r=e,new Promise((e,t)=>{const n="Could not determine whether it's an image: ".concat(r),i=new Image,o=window.setTimeout(()=>t(new Error(n)),2e4);i.onerror=i.onabort=function(){clearTimeout(o),t(new Error(n))},i.onload=function(){clearTimeout(o),e(i)},i.src=r}))}catch(e){return st.error(e),i()}Rt()('a[href="'.concat(t,'"]'),n).forEach(e=>{e.innerHTML="",Bt.addClass("chat-image__link",e),Bt.addClass("chat-image",o),Bt.addClass("img-thumbnail",o),e.insertAdjacentElement("afterBegin",o)})}var r;i()}function Rs(e,t){e.classList.remove("visible"),Object(lr.isFunction)(t)&&t()}Bt.isAudioURL=e=>ks([".ogg",".mp3",".m4a"],e),Bt.isImageURL=e=>ks([".jpg",".jpeg",".png",".gif",".bmp",".tiff",".svg"],e),Bt.isVideoURL=e=>ks([".mp4",".webm"],e),Bt.getOOBURLMarkup=function(e,t){const n=Cs(t);return null===n?t:Bt.isVideoURL(n)?(i={url:t},ho(Ss(),i.url)):Bt.isAudioURL(n)?Ts(e,n):Bt.isImageURL(n)?Ns(e,n):Ms(e,n);var i},Bt.applyDragResistance=function(e,t){if(void 0===e)return;if(void 0===t)return e;return e!==t&&Math.abs(e-t)<10?t:e},Bt.renderImageURLs=function(e,t){if(!e.api.settings.get("show_images_inline"))return Promise.resolve();const n=t.textContent.match(xs)||[];return Promise.all(n.map(e=>new Promise(n=>{let i=Cs(e);if(["imgur.com","pbs.twimg.com"].includes(i.hostname())&&!Bt.isImageURL(e)){const r="pbs.twimg.com"===i.hostname()?i.search(!0).format:"png";i=i.removeSearch(/.*/).toString()+".".concat(r),Is(i,e,t,n)}else Is(e,e,t,n)})))},Bt.renderNewLines=function(e){return e.replace(/\n\n+/g,"<br/><br/>").replace(/\n/g,"<br/>")},Bt.calculateElementHeight=function(e){return Array.from(e.children).reduce((e,t)=>e+t.offsetHeight,0)},Bt.getNextElement=function(e,t="*"){let n=e.nextElementSibling;for(;null!==n&&!Rt.a.matchesSelector(n,t);)n=n.nextElementSibling;return n},Bt.getPreviousElement=function(e,t="*"){let n=e.previousElementSibling;for(;null!==n&&!Rt.a.matchesSelector(n,t);)n=n.previousElementSibling;return n},Bt.getFirstChildElement=function(e,t="*"){let n=e.firstElementChild;for(;null!==n&&!Rt.a.matchesSelector(n,t);)n=n.nextElementSibling;return n},Bt.getLastChildElement=function(e,t="*"){let n=e.lastElementChild;for(;null!==n&&!Rt.a.matchesSelector(n,t);)n=n.previousElementSibling;return n},Bt.hasClass=function(e,t){return t instanceof Element&&t.classList.contains(e)},Bt.toggleClass=function(e,t){Bt.hasClass(e,t)?Bt.removeClass(e,t):Bt.addClass(e,t)},Bt.addClass=function(e,t){return t instanceof Element&&t.classList.add(e),t},Bt.removeClass=function(e,t){return t instanceof Element&&t.classList.remove(e),t},Bt.removeElement=function(e){return e instanceof Element&&e.parentNode&&e.parentNode.removeChild(e),e},Bt.showElement=e=>{Bt.removeClass("collapsed",e),Bt.removeClass("hidden",e)},Bt.hideElement=function(e){return e instanceof Element&&e.classList.add("hidden"),e},Bt.ancestor=function(e,t){let n=e;for(;null!==n&&!Rt.a.matchesSelector(n,t);)n=n.parentElement;return n},Bt.nextUntil=function(e,t){const n=[];let i=e.nextElementSibling;for(;null!==i&&!i.matches(t);)n.push(i),i=i.nextElementSibling;return n},Bt.unescapeHTML=function(e){var t=document.createElement("div");return t.innerHTML=e,t.innerText},Bt.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},Bt.addMentionsMarkup=function(e,t,n){if("groupchat"!==n.get("message_type"))return e;const i=n.get("nick");return t.sort((e,t)=>t.begin-e.begin).forEach(t=>{const n=e.slice(0,t.begin),r=3*((n.match(/&lt;/g)||[]).length+(n.match(/&gt;/g)||[]).length),o=parseInt(t.begin,10)+parseInt(r,10),s=parseInt(t.end,10)+parseInt(r,10),a=e.slice(o,s);e=a===i?e.slice(0,o)+'<span class="mention mention--self badge badge-info">'.concat(a,"</span>")+e.slice(s):e.slice(0,o)+'<span class="mention">'.concat(a,"</span>")+e.slice(s)}),e},Bt.convertUriToHyperlink=function(e,t){let n=e.normalize()._string;const i=e._parts.urn?n:e.readable(),r=Bt.escapeHTML(t||i);return e._parts.protocol||n.startsWith("http://")||n.startsWith("https://")||(n="http://"+n),"xmpp"===e._parts.protocol&&"join"===e._parts.query?'<a target="_blank" rel="noopener" class="open-chatroom" href="'.concat(n,'">').concat(r,"</a>"):'<a target="_blank" rel="noopener" href="'.concat(n,'">').concat(r,"</a>")},Bt.convertUrlToHyperlink=function(e){const t=RegExp("^w{3}.","ig").test(e)?"http://".concat(e):e,n=Cs(e);if(null!==n&&function(e){try{return!!new URL(e)}catch(e){return!1}}(t)&&(function(e,t=Es){return!!t.includes(e)}(n._parts.protocol)||!n._parts.protocol)){return this.convertUriToHyperlink(n,e)}return e},Bt.addHyperlinks=function(e){try{const t={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|xmpp:|mailto:|www\.)/gi};return ns.a.withinString(e,e=>Bt.convertUrlToHyperlink(e),t)}catch(t){return st.debug(t),e}},Bt.slideInAllElements=function(e,t=300){return Promise.all(Array.from(e).map(e=>Bt.slideIn(e,t)))},Bt.slideToggleElement=function(e,t){return Bt.hasClass("collapsed",e)||Bt.hasClass("hidden",e)?Bt.slideOut(e,t):Bt.slideIn(e,t)},Bt.slideOut=function(e,t=200){return new Promise((n,i)=>{if(!e){const e="An element needs to be passed in to slideOut";return st.warn(e),void i(new Error(e))}const r=e.getAttribute("data-slider-marker");r&&(e.removeAttribute("data-slider-marker"),window.cancelAnimationFrame(r));const o=Bt.calculateElementHeight(e);if(window.converse_disable_effects)return e.style.height=o+"px",function(e){e.removeAttribute("data-slider-marker"),e.classList.remove("collapsed"),e.style.overflow="",e.style.height=""}(e),void n();if(!Bt.hasClass("collapsed",e)&&!Bt.hasClass("hidden",e))return void n();const s=t/17;let a=0;e.style.height="0",e.style.overflow="hidden",e.classList.remove("hidden"),e.classList.remove("collapsed"),e.setAttribute("data-slider-marker",window.requestAnimationFrame((function t(){a+=o/s,a<o?(e.style.height=a+"px",e.setAttribute("data-slider-marker",window.requestAnimationFrame(t))):(e.removeAttribute("data-slider-marker"),e.style.height=Bt.calculateElementHeight(e)+"px",e.style.overflow="",e.style.height="",n())})))})},Bt.slideIn=function(e,t=200){return new Promise((n,i)=>{if(!e){const e="An element needs to be passed in to slideIn";return st.warn(e),i(new Error(e))}if(Bt.hasClass("collapsed",e))return n(e);if(window.converse_disable_effects)return e.classList.add("collapsed"),e.style.height="",n(e);const r=e.getAttribute("data-slider-marker");r&&(e.removeAttribute("data-slider-marker"),window.cancelAnimationFrame(r));const o=e.offsetHeight,s=t/17;let a=o;e.style.overflow="hidden",e.setAttribute("data-slider-marker",window.requestAnimationFrame((function t(){a-=o/s,a>0?(e.style.height=a+"px",e.setAttribute("data-slider-marker",window.requestAnimationFrame(t))):(e.removeAttribute("data-slider-marker"),e.classList.add("collapsed"),e.style.height="",n(e))})))})},Bt.isInDOM=function(e){return document.querySelector("body").contains(e)},Bt.isVisible=function(e){return null!==e&&(!Bt.hasClass("hidden",e)&&(e.offsetWidth>0||e.offsetHeight>0||e.getClientRects().length>0))},Bt.fadeIn=function(e,t){if(e||st.warn("An element needs to be passed in to fadeIn"),window.converse_disable_effects)return e.classList.remove("hidden"),Rs(e,t);Bt.hasClass("hidden",e)?(e.classList.add("visible"),e.classList.remove("hidden"),e.addEventListener("webkitAnimationEnd",()=>Rs(e,t)),e.addEventListener("animationend",()=>Rs(e,t)),e.addEventListener("oanimationend",()=>Rs(e,t))):Rs(e,t)},Bt.xForm2webForm=function(e,t,n){if("list-single"===e.getAttribute("type")||"list-multi"===e.getAttribute("type")){const t=Bt.queryChildren(e,"value").map(e=>null==e?void 0:e.textContent),n=Bt.queryChildren(e,"option").map(n=>{var i;const r=null===(i=n.querySelector("value"))||void 0===i?void 0:i.textContent;return ws()({value:r,label:n.getAttribute("label"),selected:t.includes(r),required:!!e.querySelector("required")})});return hs()({id:Bt.getUniqueId(),name:e.getAttribute("var"),label:e.getAttribute("label"),options:n.join(""),multiple:"list-multi"===e.getAttribute("type"),required:!!e.querySelector("required")})}if("fixed"===e.getAttribute("type")){var i;return'<p class="form-help">'+(null===(i=e.querySelector("value"))||void 0===i?void 0:i.textContent)+"</p>"}var r,o,s,a;if("jid-multi"===e.getAttribute("type"))return ps()({name:e.getAttribute("var"),label:e.getAttribute("label")||"",value:null===(r=e.querySelector("value"))||void 0===r?void 0:r.textContent,required:!!e.querySelector("required")});if("boolean"===e.getAttribute("type"))return cs()({id:Bt.getUniqueId(),name:e.getAttribute("var"),label:e.getAttribute("label")||"",checked:"1"===(null===(o=e.querySelector("value"))||void 0===o?void 0:o.textContent)?'checked="1"':"",required:!!e.querySelector("required")});if("url"===e.getAttribute("var"))return ms()({label:e.getAttribute("label")||"",value:null===(s=e.querySelector("value"))||void 0===s?void 0:s.textContent});if("username"===e.getAttribute("var"))return _s()({domain:" @"+n.domain,name:e.getAttribute("var"),type:js[e.getAttribute("type")],label:e.getAttribute("label")||"",value:null===(a=e.querySelector("value"))||void 0===a?void 0:a.textContent,required:!!e.querySelector("required")});if("ocr"===e.getAttribute("var")){const n=e.querySelector("uri"),i=Rt()('data[cid="'+n.textContent.replace(/^cid:/,"")+'"]',t)[0];return ss()({label:e.getAttribute("label"),name:e.getAttribute("var"),data:null==i?void 0:i.textContent,type:n.getAttribute("type"),required:!!e.querySelector("required")})}{var c;const t=e.getAttribute("var");return us()({id:Bt.getUniqueId(),label:e.getAttribute("label")||"",name:t,fixed_username:null==n?void 0:n.fixed_username,autocomplete:As(t,n),placeholder:null,required:!!e.querySelector("required"),type:js[e.getAttribute("type")],value:null===(c=e.querySelector("value"))||void 0===c?void 0:c.textContent})}};var Ds=Bt,Ps=n(120),Ls=n.n(Ps),zs=n(121),Fs=n.n(zs),Bs=n(15),qs=n.n(Bs),Us=n(122),Hs=n.n(Us);function $s(){const e=Vs(['<button type="button" class="close" data-dismiss="modal" aria-label="','"><span aria-hidden="true">×</span></button>']);return $s=function(){return e},e}function Ws(){const e=Vs(['<button type="button" class="btn btn-secondary" data-dismiss="modal">',"</button>"]);return Ws=function(){return e},e}function Vs(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const Gs=ne("Close"),Js=ho(Ws(),Gs),Qs=ho($s(),Gs);function Ks(){const e=Xs(['<p class="older-msg"><time>',"</time>: ","</p>"]);return Ks=function(){return e},e}function Ys(){const e=Xs(['\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h4 class="modal-title" id="message-versions-modal-label">',"</h4>\n                ",'\n            </div>\n            <div class="modal-body">\n                <h4>Older versions</h4>\n                ',"\n                <hr/>\n                <h4>Current version</h4>\n                <p>",'</p>\n            </div>\n            <div class="modal-footer">',"</div>\n        </div>\n    </div>\n"]);return Ys=function(){return e},e}function Xs(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const Zs=ne("Message versions");var ea=n(8),ta=n.n(ea),na=n(4),ia=n.n(na),ra=n(12),oa=n.n(ra);function sa(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['<div class="alert ','" role="alert"><p>',"</p></div>"]);return sa=function(){return e},e}function aa(){const e=la(["<p>","</p>"]);return aa=function(){return e},e}function ca(){const e=la(['\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header ','">\n              <h5 class="modal-title">',"</h5>\n              ",'\n            </div>\n            <div class="modal-body">\n              <span class="modal-alert"></span>\n              ',"\n            </div>\n        </div>\n    </div>\n"]);return ca=function(){return e},e}function la(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function ua(){const e=fa(["<p>","</p>"]);return ua=function(){return e},e}function da(){const e=fa(['\n    <div class="modal-dialog" role="document">\n      <div class="modal-content">\n        <div class="modal-header ','">\n          <h5 class="modal-title">','</h5>\n          <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n            <span aria-hidden="true">×</span>\n          </button>\n        </div>\n        <div class="modal-body">\n            <span class="modal-alert"></span>\n            <form class="converse-form converse-form--modal confirm" action="#">\n              <div class="form-group">\n                  ',"\n              </div>\n              ",'\n              <div class="form-group">\n                  <button type="submit" class="btn btn-primary">','</button>\n                  <input type="button" class="btn btn-secondary" data-dismiss="modal" value="','"/>\n              </div>\n          </form>\n        </div>\n      </div>\n    </div>\n']);return da=function(){return e},e}function ha(){const e=fa(['\n    <div class="form-group">\n        <label>\n            ','\n            <input type="text"\n                name="','"\n                class="',' form-control form-control--labeled"\n                ?required="','"\n                placeholder="','" />\n        </label>\n    </div>\n']);return ha=function(){return e},e}function fa(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const pa=ne("Cancel"),ga=ne("OK");var ma=e=>ho(da(),e.level||"",e.title,e.messages.map(e=>ho(ua(),e)),e.fields.map(e=>(e=>ho(ha(),e.label||"",e.name,e.challenge_failed?"error":"",e.required,e.placeholder))(e)),ga,pa);
/**
 * @module converse-modal
 * @copyright The Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */const{sizzle:va}=zn.env,_a=zn.env.utils;let ba;const ya=Fo.extend({className:"modal",events:{"click  .nav-item .nav-link":"switchTab"},initialize(){this.render(),this.el.setAttribute("tabindex","-1"),this.el.setAttribute("role","dialog"),this.el.setAttribute("aria-hidden","true");const e=this.el.querySelector(".modal-title").getAttribute("id");e&&this.el.setAttribute("aria-labelledby",e),this.insertIntoDOM();const t=oa.a.Modal;this.modal=new t(this.el,{backdrop:"static",keyboard:!0}),this.el.addEventListener("hide.bs.modal",()=>_a.removeClass("selected",this.trigger_el),!1)},insertIntoDOM(){ba.chatboxviews.el.querySelector("#converse-modals").insertAdjacentElement("beforeEnd",this.el)},switchTab(e){e.stopPropagation(),e.preventDefault(),va(".nav-link.active",this.el).forEach(e=>{_a.removeClass("active",this.el.querySelector(e.getAttribute("href"))),_a.removeClass("active",e)}),_a.addClass("active",e.target),_a.addClass("active",this.el.querySelector(e.target.getAttribute("href")))},alert(e,t="primary"){const n=this.el.querySelector(".modal-alert");if(null===n)return void st.error("Could not find a .modal-alert element in the modal to show an alert message in!");var i;uo((i={type:"alert-".concat(t),message:e},ho(sa(),i.type,i.message)),n);const r=n.firstElementChild;setTimeout(()=>{_a.addClass("fade-out",r),setTimeout(()=>_a.removeElement(r),600)},5e3)},show(e){e&&(e.preventDefault(),this.trigger_el=e.target,this.trigger_el.classList.add("selected")),this.modal.show()}}),wa=ya.extend({events:{"submit .confirm":"onConfimation"},initialize(){this.confirmation=_a.getResolveablePromise(),ya.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.render),this.el.addEventListener("closed.bs.modal",()=>this.confirmation.reject(),!1)},toHTML(){return ma(this.model.toJSON())},afterRender(){this.close_handler_registered||(this.el.addEventListener("closed.bs.modal",()=>{this.confirmation.isResolved||this.confirmation.reject()},!1),this.close_handler_registered=!0)},onConfimation(e){e.preventDefault();const t=new FormData(e.target),n=(this.model.get("fields")||[]).map(e=>{const n=t.get(e.name).trim();return e.value=n,e.challenge&&(e.challenge_failed=n!==e.challenge),e});if(n.filter(e=>e.challenge_failed).length)return this.model.set("fields",n),void this.model.trigger("change");this.confirmation.resolve(n),this.modal.hide()}}),Sa=ya.extend({initialize(){ya.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.render)},toHTML(){return e=Object.assign({__:ne},this.model.toJSON()),ho(ca(),e.level,e.title,Qs,e.messages.map(e=>ho(aa(),e)));var e}});zn.plugins.add("converse-modal",{initialize(){let e;ba=this._converse,ba.api.listen.on("disconnect",()=>{const e=document.querySelector("#converse-modals");e&&(e.innerHTML="")}),Object.assign(ba.api,{async confirm(e,t=[],n=[]){Object(lr.isString)(t)&&(t=[t]);const i=new Do({title:e,messages:t,fields:n,type:"confirm"}),r=new wa({model:i});let o;r.show();try{o=await r.confirmation}catch(e){o=!1}return r.remove(),o},async prompt(e,t=[],n=""){Object(lr.isString)(t)&&(t=[t]);const i=new Do({title:e,messages:t,fields:[{name:"reason",placeholder:n}],type:"prompt"}),r=new wa({model:i});let o;r.show();try{var s;o=null===(s=(await r.confirmation).pop())||void 0===s?void 0:s.value}catch(e){o=!1}return r.remove(),o},alert(t,n,i){let r;if(Object(lr.isString)(i)&&(i=[i]),"error"===t?r="alert-danger":"info"===t?r="alert-info":"warn"===t&&(r="alert-warning"),void 0===e){const t=new Do({title:n,messages:i,level:r,type:"alert"});e=new Sa({model:t})}else e.model.set({title:n,messages:i,level:r});e.show()}})}});
/**
 * @module converse-message-view
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:xa,dayjs:Ea}=zn.env,Aa=zn.env.utils;function ja(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n    <div class="flyout box-flyout">\n        <div class="chat-head chat-head-chatbox row no-gutters"></div>\n        <div class="chat-body">\n            <div class="chat-content ','" @scroll=',' aria-live="polite">\n                <div class="chat-content__messages"></div>\n                <div class="chat-content__notifications"></div>\n            </div>\n            <div class="bottom-panel">\n                <div class="emoji-picker__container dropup"></div>\n                <div class="message-form-container">\n            </div>\n        </div>\n    </div>\n']);return ja=function(){return e},e}zn.plugins.add("converse-message-view",{dependencies:["converse-modal","converse-chatboxviews"],initialize(){function e(e,t,n){if(n.isClosing)return;const i=new ns.a(e),r=i.protocol().toLowerCase();return["https","http","xmpp","ftp"].includes(r)&&i.equals(e)&&"<".concat(e,">")===t.toLocaleLowerCase()?t:void 0}xn.settings.update({muc_hats_from_vcard:!1,show_images_inline:!0,time_format:"HH:mm"}),yn.MessageVersionsModal=ya.extend({id:"message-versions-modal",toHTML(){return e=this.model.toJSON(),ho(Ys(),Zs,Qs,Object.keys(e.older_versions).map(t=>ho(Ks(),K()(t).format("MMM D, YYYY, HH:mm:ss"),e.older_versions[t])),e.message,Js);var e}}),yn.MessageView=yn.ViewWithAvatar.extend({events:{"click .chat-msg__edit-modal":"showMessageVersionsModal","click .retry":"onRetryClicked"},initialize(){this.debouncedRender=Object(lr.debounce)(()=>{this.model.collection&&this.render()},50),this.model.rosterContactAdded&&this.model.rosterContactAdded.then(()=>{this.listenTo(this.model.contact,"change:nickname",this.debouncedRender),this.debouncedRender()}),this.model.occupant&&this.addOccupantListeners(),this.listenTo(this.model,"change",this.onChanged),this.listenTo(this.model,"destroy",this.fadeOut),this.listenTo(this.model,"occupantAdded",()=>{this.addOccupantListeners(),this.debouncedRender()}),this.listenTo(this.model,"vcard:change",this.debouncedRender),this.debouncedRender()},async render(){const e=Aa.hasClass("chat-msg--followup",this.el);if(this.model.get("file")&&!this.model.get("oob_url")){if(!this.model.file)return st.error("Attempted to render a file upload message with no file data"),this.el;this.renderFileUploadProgresBar()}else"error"===this.model.get("type")?this.renderErrorMessage():"info"===this.model.get("type")?this.renderInfoMessage():await this.renderChatMessage();return e&&Aa.addClass("chat-msg--followup",this.el),this.el},async onChanged(e){const t=e.changed.edited;if(this.model.changed.progress)return this.renderFileUploadProgresBar();["correcting","editable","error","message","moderated","received","retracted","type","upload"].filter(e=>Object.prototype.hasOwnProperty.call(this.model.changed,e)).length&&await this.debouncedRender(),t&&this.onMessageEdited()},addOccupantListeners(){this.listenTo(this.model.occupant,"change:affiliation",this.debouncedRender),this.listenTo(this.model.occupant,"change:hats",this.debouncedRender),this.listenTo(this.model.occupant,"change:role",this.debouncedRender)},fadeOut(){xn.settings.get("animate")?(setTimeout(()=>this.remove(),600),Aa.addClass("fade-out",this.el)):this.remove()},async onRetryClicked(){this.showSpinner(),await this.model.error.retry(),this.model.destroy()},showSpinner(){this.el.innerHTML=ta()()},onMessageEdited(){this.model.get("is_archived")||(this.el.addEventListener("animationend",()=>Aa.removeClass("onload",this.el),{once:!0}),Aa.addClass("onload",this.el))},replaceElement(e){return this.el.parentElement&&this.el.parentElement.replaceChild(e,this.el),this.setElement(e),this.el},transformOOBURL:e=>Aa.getOOBURLMarkup(yn,e),async transformBodyText(t){return await xn.trigger("beforeMessageBodyTransformed",this,t,{Synchronous:!0}),t=this.model.isMeCommand()?t.substring(4):t,t=ia.a.filterXSS(t,{whiteList:{},onTag:e}),t=Aa.geoUriToHttp(t,xn.settings.get("geouri_replacement")),t=Aa.addMentionsMarkup(t,this.model.get("references"),this.model.collection.chatbox),t=Aa.addHyperlinks(t),t=Aa.renderNewLines(t),t=Aa.addEmoji(t),await xn.trigger("afterMessageBodyTransformed",this,t,{Synchronous:!0}),t},async renderChatMessage(){await xn.waitUntil("emojisInitialized");const e=Ea(this.model.get("time")),t=this.model.get("retracted")||"retracted"===this.model.get("moderated"),n="groupchat"===this.model.get("type")&&await this.model.mayBeModerated(),i=!t&&(this.model.mayBeRetracted()||n),r="groupchat"===this.model.get("type");let o=[];if(r)if(xn.settings.get("muc_hats_from_vcard")){const e=this.model.vcard?this.model.vcard.get("role"):null;o=e?e.split(","):[]}else{var s;o=(null===(s=this.model.occupant)||void 0===s?void 0:s.get("hats"))||[]}const a=Aa.stringToElement(Hs()(Object.assign(this.model.toJSON(),{__:ne,hats:o,is_groupchat_message:r,is_retracted:t,retractable:i,extra_classes:this.getExtraMessageClasses(),is_me_message:this.model.isMeCommand(),label_show:ne("Show more"),occupant:this.model.occupant,pretty_time:e.format(xn.settings.get("time_format")),retraction_text:t?this.getRetractionText():null,time:e.toISOString(),username:this.model.getDisplayName()}))),c=this.model.get("oob_url");if(c&&uo(this.transformOOBURL(c),a.querySelector(".chat-msg__media")),!t){const e=this.model.getMessageText(),t=a.querySelector(".chat-msg__text");e&&e!==c&&(t.innerHTML=await this.transformBodyText(e),xn.settings.get("show_images_inline")&&Aa.renderImageURLs(yn,t).then(()=>this.triggerRendered()))}"headline"!==this.model.get("type")&&this.renderAvatar(a),this.replaceElement(a),this.triggerRendered()},triggerRendered(){this.model.collection&&this.model.collection.trigger("rendered",this)},renderInfoMessage(){const e=Aa.stringToElement(qs()(Object.assign(this.model.toJSON(),{extra_classes:"chat-info",isodate:Ea(this.model.get("time")).toISOString()})));return this.replaceElement(e)},getRetractionText(){if("groupchat"===this.model.get("type")&&this.model.get("moderated_by")){const e=this.model.get("moderated_by"),t=this.model.collection.chatbox;this.model.mod||(this.model.mod=t.occupants.findOccupant({jid:e})||t.occupants.findOccupant({nick:xa.getResourceFromJid(e)}));const n=this.model.mod?this.model.mod.getDisplayName():"A moderator";return ne("%1$s has removed this message",n)}return ne("%1$s has removed this message",this.model.getDisplayName())},renderErrorMessage(){const e=Aa.stringToElement(qs()(Object.assign(this.model.toJSON(),{extra_classes:"chat-error",isodate:Ea(this.model.get("time")).toISOString()})));return this.replaceElement(e)},renderFileUploadProgresBar(){const e=Aa.stringToElement(Fs()(Object.assign(this.model.toJSON(),{__:ne,filename:this.model.file.name,filesize:Ls()(this.model.file.size)})));this.replaceElement(e),this.renderAvatar()},showMessageVersionsModal(e){e.preventDefault(),void 0===this.model.message_versions_modal&&(this.model.message_versions_modal=new yn.MessageVersionsModal({model:this.model})),this.model.message_versions_modal.show(e)},getExtraMessageClasses(){const e=this.model.get("retracted")||"retracted"===this.model.get("moderated"),t=[...this.model.get("is_delayed")?["delayed"]:[],...e?["chat-msg--retracted"]:[]];return"groupchat"===this.model.get("type")&&(this.model.occupant&&(t.push(this.model.occupant.get("role")),t.push(this.model.occupant.get("affiliation"))),"them"===this.model.get("sender")&&this.model.collection.chatbox.isUserMentioned(this.model)&&t.push("mentioned")),this.model.get("correcting")&&t.push("correcting"),t.filter(e=>e).join(" ")}})}});var Ca=e=>ho(ja(),e.show_send_button?"chat-content-sendbutton":"",e.markScrolled);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const ka=new WeakMap,Oa=Nr((...e)=>t=>{let n=ka.get(t);void 0===n&&(n={lastRenderedIndex:2147483647,values:[]},ka.set(t,n));const i=n.values;let r=i.length;n.values=e;for(let o=0;o<e.length&&!(o>n.lastRenderedIndex);o++){const s=e[o];if(Qr(s)||"function"!=typeof s.then){t.setValue(s),n.lastRenderedIndex=o;break}o<r&&s===i[o]||(n.lastRenderedIndex=2147483647,r=0,Promise.resolve(s).then(e=>{const i=n.values.indexOf(s);i>-1&&i<n.lastRenderedIndex&&(n.lastRenderedIndex=i,t.setValue(e),t.commit())}))}});function Ta(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n    <img alt="','" class="avatar align-self-center ','"\n            height="','" width="','" src="data:',";base64,",'"/>']);return Ta=function(){return e},e}var Na=e=>ho(Ta(),e.alt_text,e.extra_classes,e.height,e.width,e.image_type,e.image);function Ma(){const e=La(['<p class="chat-head__desc">',"</p>"]);return Ma=function(){return e},e}function Ia(){const e=La(["<converse-dropdown .items=","></converse-dropdown>"]);return Ia=function(){return e},e}function Ra(){const e=La(['<a href="','" target="_blank" rel="noopener" class="user">',"</a>"]);return Ra=function(){return e},e}function Da(){const e=La(['<div class="chatbox-navback"><i class="fa fa-arrow-left"></i></div>']);return Da=function(){return e},e}function Pa(){const e=La(['\n        <div class="chatbox-title ','">\n            <div class="chatbox-title--row">\n                ',"\n                ",'\n                <div class="chatbox-title__text" title="','">\n                    ','\n                </div>\n            </div>\n            <div class="chatbox-title__buttons row no-gutters">\n                ',"\n                ","\n            </div>\n        </div>\n        ","\n    "]);return Pa=function(){return e},e}function La(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const za={alt_text:ne("The User's Profile Image"),extra_classes:"",height:40,width:40};var Fa=e=>ho(Pa(),e.status?"":"chatbox-title--no-desc",e._converse.api.settings.get("singleton")?"":ho(Da()),e.type!==e._converse.HEADLINES_TYPE?Na(Object.assign({},e,za)):"",e.jid,e.url?ho(Ra(),e.url,e.display_name):e.display_name,e.dropdown_btns.length?ho(Ia(),e.dropdown_btns):"",e.standalone_btns.length?(e=>e.standalone_btns.reverse().map(e=>Oa(e,"")))(e):"",e.status?ho(Ma(),e.status):""),Ba=n(123),qa=n.n(Ba),Ua=n(124),Ha=n.n(Ua),$a=n(125),Wa=n.n($a),Va=n(126),Ga=n.n(Va),Ja=n(127),Qa=n.n(Ja),Ka=n(128),Ya=n.n(Ka);function Xa(){const e=cc(["<p><label>",":</label> ","</p>"]);return Xa=function(){return e},e}function Za(){const e=cc(["<p><label>",':</label> <a href="mailto:','">',"</a></p>"]);return Za=function(){return e},e}function ec(){const e=cc(["<p><label>",':</label> <a target="_blank" rel="noopener" href="','">',"</a></p>"]);return ec=function(){return e},e}function tc(){const e=cc(["<p><label>",":</label> ","</p>"]);return tc=function(){return e},e}function nc(){const e=cc(["<p><label>",":</label> ","</p>"]);return nc=function(){return e},e}function ic(){const e=cc(['\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h5 class="modal-title" id="user-details-modal-label">',"</h5>\n                ",'\n            </div>\n            <div class="modal-body">\n                ',"\n                ","\n                <p><label>",':</label> <a href="xmpp:','">',"</a></p>\n                ","\n                ","\n                ","\n                ","\n\n                ",'\n            </div>\n            <div class="modal-footer">\n                ','\n                <button type="button" class="btn btn-info refresh-contact"><i class="fa fa-refresh"> </i>',"</button>\n                ","\n\n            </div>\n        </div>\n    </div>\n"]);return ic=function(){return e},e}function rc(){const e=cc(['\n        <button type="button" @click="','" class="btn btn-danger remove-contact">\n            <i class="far fa-trash-alt"></i>',"\n        </button>\n    "]);return rc=function(){return e},e}function oc(){const e=cc(['<li class="list-group-item"> '," </li>"]);return oc=function(){return e},e}function sc(){const e=cc(['\n        <hr/>\n        <ul class="list-group fingerprints">\n            <li class="list-group-item active">',"</li>\n            ","\n        </ul>\n    "]);return sc=function(){return e},e}function ac(){const e=cc(['\n            <li class="list-group-item">\n                <form class="fingerprint-trust">\n                <div class="btn-group btn-group-toggle">\n                    <label class="btn btn--small ','">\n                        <input type="radio" name="','" value="1" ?checked=',">",'\n                    </label>\n                    <label class="btn btn--small ','">\n                        <input type="radio" name="','" value="-1" ?checked=',">",'\n                    </label>\n                </div>\n                <code class="fingerprint">',"</code>\n                </form>\n            </li>\n        "]);return ac=function(){return e},e}function cc(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const lc=ne("XMPP Address"),uc=ne("Email"),dc=ne("OMEMO Fingerprints"),hc=ne("Full Name"),fc=ne("Nickname"),pc=ne("The User's Profile Image"),gc=ne("Refresh"),mc=ne("Role"),vc=ne("URL"),_c=ne("Remove as contact"),bc=ne("Trusted"),yc=ne("Untrusted"),wc=ne("No OMEMO-enabled devices found"),Sc={alt_text:pc,extra_classes:"mb-3"},xc=e=>{const t=e.view.devicelist.devices;return ho(sc(),dc,t.length?t.map(t=>(e=>e.device.get("bundle")&&e.device.get("bundle").fingerprint?ho(ac(),-1!==e.device.get("trusted")?"btn-primary active":"btn-secondary",e.device.get("id"),-1!==e.device.get("trusted"),bc,-1!==e.device.get("trusted")?"btn-primary active":"btn-secondary",e.device.get("id"),-1===e.device.get("trusted"),yc,e.utils.formatFingerprint(e.device.get("bundle").fingerprint)):"")(Object.assign({device:t},e))):ho(oc(),wc))};var Ec=e=>ho(ic(),e.display_name,Qs,e.image?Na(Object.assign(Sc,e)):"",e.fullname?ho(nc(),hc,e.fullname):"",lc,e.jid,e.jid,e.nickname?ho(tc(),fc,e.nickname):"",e.url?ho(ec(),vc,e.url,e.url):"",e.email?ho(Za(),uc,e.email,e.email):"",e.role?ho(Xa(),mc,e.role):"",e._converse.pluggable.plugins["converse-omemo"].enabled(e._converse)?xc(e):"",Js,gc,e.allow_contact_removal&&e.is_roster_contact?(e=>ho(rc(),e.removeContact,_c))(e):"");function Ac(){const e=Cc(['<a href="#"\n                    class="dropdown-item ','"\n                    @click=','\n                    title="','"><i class="fa ','"></i>',"</a>"]);return Ac=function(){return e},e}function jc(){const e=Cc(['<a href="#"\n                    class="chatbox-btn '," fa ",'"\n                    @click=','\n                    title="','"></a>']);return jc=function(){return e},e}function Cc(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}
/**
 * @module converse-chatview
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */const{Strophe:kc,sizzle:Oc,dayjs:Tc}=zn.env,Nc=zn.env.utils;zn.plugins.add("converse-chatview",{dependencies:["converse-chatboxviews","converse-chat","converse-disco","converse-message-view","converse-modal"],initialize(){xn.settings.update({auto_focus:!0,message_limit:0,show_send_button:!0,show_retraction_warning:!0,show_toolbar:!0,visible_toolbar_buttons:{call:!1,clear:!0,spoiler:!0}}),yn.UserDetailsModal=ya.extend({id:"user-details-modal",events:{"click button.refresh-contact":"refreshContact","click .fingerprint-trust .btn input":"toggleDeviceTrust"},initialize(){ya.prototype.initialize.apply(this,arguments),this.model.rosterContactAdded.then(()=>this.registerContactEventHandlers()),this.listenTo(this.model,"change",this.render),this.registerContactEventHandlers(),xn.trigger("userDetailsModalInitialized",this.model)},toHTML(){var e;const t=null===(e=this.model)||void 0===e?void 0:e.vcard,n=t?t.toJSON():{};return Ec(Object.assign(this.model.toJSON(),n,{_converse:yn,allow_contact_removal:yn.allow_contact_removal,display_name:this.model.getDisplayName(),is_roster_contact:void 0!==this.model.contact,removeContact:e=>this.removeContact(e),view:this,utils:Nc}))},registerContactEventHandlers(){void 0!==this.model.contact&&(this.listenTo(this.model.contact,"change",this.render),this.listenTo(this.model.contact.vcard,"change",this.render),this.model.contact.on("destroy",()=>{delete this.model.contact,this.render()}))},async refreshContact(e){e&&e.preventDefault&&e.preventDefault();const t=this.el.querySelector(".fa-refresh");Nc.addClass("fa-spin",t);try{await xn.vcard.update(this.model.contact.vcard,!0)}catch(e){st.fatal(e),this.alert(ne("Sorry, something went wrong while trying to refresh"),"danger")}Nc.removeClass("fa-spin",t)},removeContact(e){if(e&&e.preventDefault&&e.preventDefault(),!yn.allow_contact_removal)return;!0===confirm(ne("Are you sure you want to remove this contact?"))&&(this.modal.hide(),setTimeout(()=>{this.model.contact.removeFromRoster(()=>this.model.contact.destroy(),e=>{st.error(e),xn.alert("error",ne("Error"),[ne("Sorry, there was an error while trying to remove %1$s as a contact.",this.model.contact.getDisplayName())])})},1))}}),yn.ChatBoxView=Ko.extend({length:200,className:"chatbox hidden",is_chatroom:!1,events:{"change input.fileupload":"onFileSelection","click .chat-msg__action-edit":"onMessageEditButtonClicked","click .chat-msg__action-retract":"onMessageRetractButtonClicked","click .chatbox-navback":"showControlBox","click .new-msgs-indicator":"viewUnreadMessages","click .send-button":"onFormSubmitted","click .spoiler-toggle":"toggleSpoilerMessage","click .toggle-call":"toggleCall","click .toggle-clear":"clearMessages","click .toggle-compose-spoiler":"toggleComposeSpoilerMessage","click .upload-file":"toggleFileUpload","input .chat-textarea":"inputChanged","keydown .chat-textarea":"onKeyDown","keyup .chat-textarea":"onKeyUp","paste .chat-textarea":"onPaste","dragover .chat-textarea":"onDragOver","drop .chat-textarea":"onDrop"},async initialize(){this.initDebounced(),this.listenTo(this.model.messages,"add",this.onMessageAdded),this.listenTo(this.model.messages,"rendered",this.scrollDown),this.model.messages.on("reset",()=>{this.msgs_container.innerHTML="",this.removeAll()}),this.listenTo(this.model.notifications,"change",this.renderChatStateNotification),this.listenTo(this.model,"change:status",this.onStatusMessageChanged),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"show",this.show),this.listenTo(this.model,"vcard:change",this.renderHeading),this.model.contact&&this.listenTo(this.model.contact,"destroy",this.renderHeading),this.model.rosterContactAdded&&this.model.rosterContactAdded.then(()=>{this.listenTo(this.model.contact,"change:nickname",this.renderHeading),this.renderHeading()}),this.listenTo(this.model.presence,"change:show",this.onPresenceChanged),this.render(),await this.updateAfterMessagesFetched(),this.model.maybeShow(),xn.trigger("chatBoxViewInitialized",this)},initDebounced(){this.scrollDown=Object(lr.debounce)(this._scrollDown,50),this.markScrolled=Object(lr.debounce)(this._markScrolled,100)},render(){const e=Ca(Object.assign(this.model.toJSON(),{unread_msgs:ne("You have unread messages"),markScrolled:()=>this.markScrolled()}));return uo(e,this.el),this.content=this.el.querySelector(".chat-content"),this.notifications=this.el.querySelector(".chat-content__notifications"),this.msgs_container=this.el.querySelector(".chat-content__messages"),this.renderChatStateNotification(),this.renderMessageForm(),this.renderHeading(),this},renderChatStateNotification(){this.model.notifications.get("chat_state")===yn.COMPOSING?this.notifications.innerText=ne("%1$s is typing",this.model.getDisplayName()):this.model.notifications.get("chat_state")===yn.PAUSED?this.notifications.innerText=ne("%1$s has stopped typing",this.model.getDisplayName()):this.model.notifications.get("chat_state")===yn.GONE?this.notifications.innerText=ne("%1$s has gone away",this.model.getDisplayName()):this.notifications.innerText=""},renderToolbar(){if(!xn.settings.get("show_toolbar"))return this;const e=Object.assign(this.model.toJSON(),this.getToolbarOptions());return this.el.querySelector(".chat-toolbar").innerHTML=Qa()(e),this.addSpoilerButton(e),this.addFileUploadButton(),xn.trigger("renderToolbar",this),this},renderMessageForm(){var e,t;this.el.querySelector(".message-form-container").innerHTML=qa()(Object.assign(this.model.toJSON(),{__:ne,message_limit:xn.settings.get("message_limit"),hint_value:null===(e=this.el.querySelector(".spoiler-hint"))||void 0===e?void 0:e.value,label_message:this.model.get("composing_spoiler")?ne("Hidden message"):ne("Message"),label_spoiler_hint:ne("Optional hint"),message_value:null===(t=this.el.querySelector(".chat-textarea"))||void 0===t?void 0:t.value,show_send_button:xn.settings.get("show_send_button"),show_toolbar:xn.settings.get("show_toolbar"),unread_msgs:ne("You have unread messages")})),this.el.addEventListener("focusin",e=>this.emitFocused(e)),this.el.addEventListener("focusout",e=>this.emitBlurred(e)),this.renderToolbar()},showControlBox(){yn.chatboxviews.get("controlbox").show(),this.hide()},showUserDetailsModal(e){e.preventDefault(),void 0===this.user_details_modal&&(this.user_details_modal=new yn.UserDetailsModal({model:this.model})),this.user_details_modal.show(e)},toggleFileUpload(){this.el.querySelector("input.fileupload").click()},onFileSelection(e){this.model.sendFiles(e.target.files)},onDragOver(e){e.preventDefault()},onDrop(e){0!=e.dataTransfer.files.length&&(e.preventDefault(),this.model.sendFiles(e.dataTransfer.files))},async addFileUploadButton(){if(await xn.disco.supports(kc.NS.HTTPUPLOAD,yn.domain)){if(this.el.querySelector(".chat-toolbar .upload-file"))return;this.el.querySelector(".chat-toolbar").insertAdjacentHTML("beforeend",Ya()({tooltip_upload_file:ne("Choose a file to send")}))}},async addSpoilerButton(e){if(!e.show_spoiler_button||this.model.get("type")===yn.CHATROOMS_TYPE)return;const t=this.model.get("jid");if(0!==this.model.presence.resources.length&&(await Promise.all(this.model.presence.resources.map(e=>xn.disco.supports(kc.NS.SPOILER,"".concat(t,"/").concat(e.get("name")))))).reduce((e,t)=>e&&t,!0)){const e=Ga()(this.model.toJSON());this.el.querySelector(".chat-toolbar").insertAdjacentHTML("afterBegin",e)}},async renderHeading(){const e=await this.generateHeadingTemplate();uo(e,this.el.querySelector(".chat-head-chatbox"))},async getHeadingStandaloneButton(e){const t=await e;return ho(jc(),t.a_class,t.icon_class,t.handler,t.i18n_title)},async getHeadingDropdownItem(e){const t=await e;return ho(Ac(),t.a_class,t.handler,t.i18n_title,t.icon_class,t.i18n_text)},async generateHeadingTemplate(){var e;const t=null===(e=this.model)||void 0===e?void 0:e.vcard,n=t?t.toJSON():{},i=await this.getHeadingButtons(),r=i.filter(e=>e.standalone),o=i.filter(e=>!e.standalone);return Fa(Object.assign(n,this.model.toJSON(),{_converse:yn,dropdown_btns:o.map(e=>this.getHeadingDropdownItem(e)),standalone_btns:r.map(e=>this.getHeadingStandaloneButton(e)),display_name:this.model.getDisplayName()}))},getHeadingButtons(){const e=[{a_class:"show-user-details-modal",handler:e=>this.showUserDetailsModal(e),i18n_text:ne("Details"),i18n_title:ne("See more information about this person"),icon_class:"fa-id-card",name:"details",standalone:"overlayed"===xn.settings.get("view_mode")}];return xn.settings.get("singleton")||e.push({a_class:"close-chatbox-button",handler:e=>this.close(e),i18n_text:ne("Close"),i18n_title:ne("Close and end this conversation"),icon_class:"fa-times",name:"close",standalone:"overlayed"===xn.settings.get("view_mode")}),yn.api.hook("getHeadingButtons",this,e)},getToolbarOptions(){let e;return e=this.model.get("composing_spoiler")?ne("Click to write as a normal (non-spoiler) message"):ne("Click to write your message as a spoiler"),{label_clear:ne("Clear all messages"),label_message_limit:ne("Message characters remaining"),label_toggle_spoiler:e,message_limit:xn.settings.get("message_limit"),show_call_button:xn.settings.get("visible_toolbar_buttons").call,show_spoiler_button:xn.settings.get("visible_toolbar_buttons").spoiler,tooltip_start_call:ne("Start a call")}},async updateAfterMessagesFetched(){await this.model.messages.fetched,await Promise.all(this.model.messages.map(e=>this.onMessageAdded(e))),this.insertIntoDOM(),this.scrollDown(),this.content.addEventListener("scroll",()=>this.markScrolled()),xn.trigger("afterMessagesFetched",this)},insertIntoDOM(){return yn.chatboxviews.insertRowColumn(this.el),xn.trigger("chatBoxInsertedIntoDOM",this),this},showChatEvent(e){const t=(new Date).toISOString();return this.msgs_container.insertAdjacentHTML("beforeend",qs()({extra_classes:"chat-event",message:e,isodate:t})),this.insertDayIndicator(this.msgs_container.lastElementChild),this.scrollDown(),t},addSpinner(e=!1){null===this.el.querySelector(".spinner")&&(e?(this.content.insertAdjacentHTML("beforeend",ta()()),this.scrollDown()):this.content.insertAdjacentHTML("afterbegin",ta()()))},clearSpinner(){this.content.querySelectorAll(".spinner").forEach(Nc.removeElement)},insertDayIndicator(e){const t=Nc.getPreviousElement(e,".message:not(.chat-state-notification)"),n=null===t?null:t.getAttribute("data-isodate"),i=e.getAttribute("data-isodate");if((null!==n||null!==i)&&(null===n||Tc(i).isAfter(n,"day"))){const t=Tc(i).startOf("day");e.insertAdjacentHTML("beforeBegin",Wa()({isodate:t.toISOString(),datestring:t.format("dddd MMM Do YYYY")}))}},getLastMessageDate(e){const t=Nc.getFirstChildElement(this.msgs_container,".message:not(.chat-state-notification)"),n=t?t.getAttribute("data-isodate"):null;if(null!==n&&Tc(n).isAfter(e))return null;const i=Nc.getLastChildElement(this.msgs_container,".message:not(.chat-state-notification)"),r=i?i.getAttribute("data-isodate"):null;if(null===r)return null;if(Tc(r).isBefore(e))return Tc(r).toDate();const o=Oc(".message:not(.chat-state-notification)",this.msgs_container).map(e=>e.getAttribute("data-isodate")),s=e.toISOString();o.push(s),o.sort();const a=o.lastIndexOf(s);return 0===a?null:Tc(o[a-1]).toDate()},setScrollPosition(e){if(this.model.get("scrolled")){const t=Nc.getNextElement(e,".chat-msg");if(t&&(0===this.content.scrollTop||this.model.get("top_visible_message"))){const e=this.model.get("top_visible_message")||t;this.model.set("top_visible_message",e),this.content.scrollTop=e.offsetTop-30}}else this.scrollDown()},onStatusMessageChanged(e){this.renderHeading(),xn.trigger("contactStatusMessageChanged",{contact:e.attributes,message:e.get("status")})},showHelpMessages(e,t="info",n){return e.forEach(e=>{this.msgs_container.insertAdjacentHTML("beforeend",Ha()({isodate:(new Date).toISOString(),type:t,message:ia.a.filterXSS(e,{whiteList:{strong:[]}})}))}),!0===n?this.addSpinner():!1===n&&this.clearSpinner(),this.scrollDown()},shouldShowOnTextMessage(){return!Nc.isVisible(this.el)},insertMessage(e){if("error"===e.model.get("type")){const t=this.msgs_container.querySelector('[data-msgid="'.concat(e.model.get("msgid"),'"]'));if(t)return t.insertAdjacentElement("afterend",e.el),this.trigger("messageInserted",e.el)}const t=Tc(e.model.get("time")).toDate()||new Date,n=this.getLastMessageDate(t);if(null===n)this.msgs_container.insertAdjacentElement("afterbegin",e.el);else{const t=Oc('[data-isodate="'.concat(n.toISOString(),'"]:last'),this.msgs_container).pop();if("error"===e.model.get("type")&&Nc.hasClass("chat-error",t)&&t.textContent===e.model.get("message"))return;t.insertAdjacentElement("afterend",e.el),this.markFollowups(e.el)}return this.trigger("messageInserted",e.el)},markFollowups(e){const t=e.getAttribute("data-from"),n=e.previousElementSibling,i=Tc(e.getAttribute("data-isodate")),r=e.nextElementSibling;Nc.hasClass("chat-msg--action",e)||Nc.hasClass("chat-msg--action",n)||Nc.hasClass("chat-info",e)||Nc.hasClass("chat-info",n)||n.getAttribute("data-from")!==t||!i.isBefore(Tc(n.getAttribute("data-isodate")).add(10,"minutes"))||e.getAttribute("data-encrypted")!==n.getAttribute("data-encrypted")||Nc.addClass("chat-msg--followup",e),r&&(!Nc.hasClass("chat-msg--action",e)&&Nc.hasClass("chat-info",e)&&r.getAttribute("data-from")===t&&Tc(r.getAttribute("data-isodate")).isBefore(i.add(10,"minutes"))&&e.getAttribute("data-encrypted")===r.getAttribute("data-encrypted")?Nc.addClass("chat-msg--followup",r):Nc.removeClass("chat-msg--followup",r))},async showMessage(e){await e.initialized;const t=this.add(e.get("id"),new yn.MessageView({model:e}));await t.render(),this.insertMessage(t),this.insertDayIndicator(t.el),this.setScrollPosition(t.el),Nc.isNewMessage(e)&&("me"===e.get("sender")?this.model.set("scrolled",!1):this.model.get("scrolled",!0)&&this.showNewMessagesIndicator()),this.shouldShowOnTextMessage()?this.show():this.scrollDown(),e.get("correcting")&&this.insertIntoTextArea(e.get("message"),!0,!0)},async onMessageAdded(e){const t=e.get("id");t&&this.get(t)||(e.get("dangling_retraction")||await this.showMessage(e),xn.trigger("messageAdded",{message:e,chatbox:this.model}))},parseMessageForCommands(e){const t=e.replace(/^\s*/,"").match(/^\/(.*)\s*$/);if(t){if("clear"===t[1])return this.clearMessages(),!0;if("close"===t[1])return this.close(),!0;if("help"===t[1]){const e=["<strong>/clear</strong>: ".concat(ne("Remove messages")),"<strong>/close</strong>: ".concat(ne("Close this chat")),"<strong>/me</strong>: ".concat(ne("Write in the third person")),"<strong>/help</strong>: ".concat(ne("Show this menu"))];return this.showHelpMessages(e),!0}}},async onFormSubmitted(e){e.preventDefault();const t=this.el.querySelector(".chat-textarea"),n=t.value.trim();if(xn.settings.get("message_limit")&&n.length>xn.settings.get("message_limit")||!n.replace(/\s/g,"").length)return;if(!yn.connection.authenticated)return this.showHelpMessages(["Sorry, the connection has been lost, and your message could not be sent"],"error"),void xn.connection.reconnect();let i,r={};this.model.get("composing_spoiler")&&(r=this.el.querySelector("form.sendXMPPMessage input.spoiler-hint"),i=r.value),Nc.addClass("disabled",t),t.setAttribute("disabled","disabled");const o=this.parseMessageForCommands(n),s=o?null:await this.model.sendMessage(n,i);(o||s)&&(r.value="",t.value="",Nc.removeClass("correcting",t),t.style.height="auto",this.updateCharCounter(t.value)),s&&xn.trigger("messageSend",s),"overlayed"===xn.settings.get("view_mode")&&(this.msgs_container.parentElement.style.display="none"),t.removeAttribute("disabled"),Nc.removeClass("disabled",t),"overlayed"===xn.settings.get("view_mode")&&(this.msgs_container.parentElement.style.display=""),this.model.setChatState(yn.ACTIVE,{silent:!0}),t.focus()},updateCharCounter(e){if(xn.settings.get("message_limit")){const t=this.el.querySelector(".message-limit"),n=xn.settings.get("message_limit")-e.length;t.textContent=n,n<1?Nc.addClass("error",t):Nc.removeClass("error",t)}},onPaste(e){if(0!==e.clipboardData.files.length)return e.preventDefault(),void this.model.sendFiles(Array.from(e.clipboardData.files));this.updateCharCounter(e.clipboardData.getData("text/plain"))},onKeyUp(e){this.updateCharCounter(e.target.value)},onKeyDown(e){if(!e.ctrlKey){if(!e.shiftKey&&!e.altKey&&!e.metaKey){if(e.keyCode===zn.keycodes.FORWARD_SLASH)return;if(e.keyCode===zn.keycodes.ESCAPE)return this.onEscapePressed(e);if(e.keyCode===zn.keycodes.ENTER)return this.onEnterPressed(e);if(e.keyCode!==zn.keycodes.UP_ARROW||e.target.selectionEnd){if(e.keyCode===zn.keycodes.DOWN_ARROW&&e.target.selectionEnd===e.target.value.length&&Nc.hasClass("correcting",this.el.querySelector(".chat-textarea")))return this.editLaterMessage()}else{const e=this.el.querySelector(".chat-textarea");if(!e.value||Nc.hasClass("correcting",e))return this.editEarlierMessage()}}[zn.keycodes.SHIFT,zn.keycodes.META,zn.keycodes.META_RIGHT,zn.keycodes.ESCAPE,zn.keycodes.ALT].includes(e.keyCode)||this.model.get("chat_state")!==yn.COMPOSING&&this.model.setChatState(yn.COMPOSING)}},getOwnMessages(){return this.model.messages.filter({sender:"me"})},onEnterPressed(e){return this.onFormSubmitted(e)},onEscapePressed(e){e.preventDefault();const t=this.model.messages.findLastIndex("correcting"),n=t>=0?this.model.messages.at(t):null;n&&n.save("correcting",!1),this.insertIntoTextArea("",!0,!1)},async onMessageRetractButtonClicked(e){e.preventDefault();const t=Nc.ancestor(e.target,".message"),n=t.getAttribute("data-msgid"),i=t.getAttribute("data-isodate"),r=this.model.messages.findWhere({msgid:n,time:i});if("me"!==r.get("sender"))return st.error("onMessageEditButtonClicked called for someone else's message!");const o=ne("Be aware that other XMPP/Jabber clients (and servers) may not yet support retractions and that this message may not be removed everywhere."),s=[ne("Are you sure you want to retract this message?")];xn.settings.get("show_retraction_warning")&&(s[1]=o),await xn.confirm(ne("Confirm"),s)&&this.model.retractOwnMessage(r)},onMessageEditButtonClicked(e){e.preventDefault();const t=this.model.messages.findLastIndex("correcting"),n=t>=0?this.model.messages.at(t):null,i=Nc.ancestor(e.target,".chat-msg"),r=this.model.messages.findWhere({msgid:i.getAttribute("data-msgid")}),o=this.el.querySelector(".chat-textarea");(!o.value||null!==n&&n.get("message")===o.value||confirm(ne("You have an unsent message which will be lost if you continue. Are you sure?")))&&(n!==r?(null!==n&&n.save("correcting",!1),r.save("correcting",!0),this.insertIntoTextArea(Nc.prefixMentions(r),!0,!0)):(r.save("correcting",!1),this.insertIntoTextArea("",!0,!1)))},editLaterMessage(){let e,t=this.model.messages.findLastIndex("correcting");if(t>=0)for(this.model.messages.at(t).save("correcting",!1);t<this.model.messages.length-1;){t+=1;const n=this.model.messages.at(t);if(n.get("editable")){e=n;break}}e?(this.insertIntoTextArea(Nc.prefixMentions(e),!0,!0),e.save("correcting",!0)):this.insertIntoTextArea("",!0,!1)},editEarlierMessage(){let e,t=this.model.messages.findLastIndex("correcting");if(t>=0)for(this.model.messages.at(t).save("correcting",!1);t>0;){t-=1;const n=this.model.messages.at(t);if(n.get("editable")){e=n;break}}e=e||this.getOwnMessages().reverse().find(e=>e.get("editable")),e&&(this.insertIntoTextArea(Nc.prefixMentions(e),!0,!0),e.save("correcting",!0))},inputChanged(e){const t=e.target.scrollHeight+"px";e.target.style.height!=t&&(e.target.style.height="auto",e.target.style.height=t)},async clearMessages(e){return e&&e.preventDefault&&e.preventDefault(),!0===confirm(ne("Are you sure you want to clear the messages from this conversation?"))&&await this.model.clearMessages(),this},insertIntoTextArea(e,t=!1,n=!1,i){const r=this.el.querySelector(".chat-textarea");if(n?Nc.addClass("correcting",r):Nc.removeClass("correcting",r),t)r.value=i&&"string"==typeof t?r.value.replace(new RegExp(t,"g"),(n,r)=>r==i-t.length?e+" ":n):e;else{let t=r.value;t&&" "!==t[t.length-1]&&(t+=" "),r.value=t+e+" "}this.updateCharCounter(r.value),Nc.placeCaretAtEnd(r)},toggleCall(e){e.stopPropagation(),xn.trigger("callButtonClicked",{connection:yn.connection,model:this.model})},toggleComposeSpoilerMessage(){this.model.set("composing_spoiler",!this.model.get("composing_spoiler")),this.renderMessageForm(),this.focus()},toggleSpoilerMessage(e){e&&e.preventDefault&&e.preventDefault();const t=e.target,n=t.firstElementChild;Nc.slideToggleElement(t.parentElement.parentElement.querySelector(".spoiler")),"closed"==t.getAttribute("data-toggle-state")?(t.textContent="Show less",n.classList.remove("fa-eye"),n.classList.add("fa-eye-slash"),t.insertAdjacentElement("afterBegin",n),t.setAttribute("data-toggle-state","open")):(t.textContent="Show more",n.classList.remove("fa-eye-slash"),n.classList.add("fa-eye"),t.insertAdjacentElement("afterBegin",n),t.setAttribute("data-toggle-state","closed"))},onPresenceChanged(e){const t=e.get("show"),n=this.model.getDisplayName();let i;Nc.isVisible(this.el)&&("offline"===t?i=ne("%1$s has gone offline",n):"away"===t?i=ne("%1$s has gone away",n):"dnd"===t?i=ne("%1$s is busy",n):"online"===t&&(i=ne("%1$s is online",n)),i&&this.model.createMessage({message:i,type:"info"}))},async close(e){return e&&e.preventDefault&&e.preventDefault(),yn.router.history.getFragment()==="converse/chat?jid="+this.model.get("jid")&&yn.router.navigate(""),xn.connection.connected()&&(this.model.setChatState(yn.INACTIVE),this.model.sendChatState()),await this.model.close(),this.remove(),xn.trigger("chatBoxClosed",this),this},emitBlurred(e){this.el.contains(document.activeElement)||this.el.contains(e.relatedTarget)||xn.trigger("chatBoxBlurred",this,e)},emitFocused(e){this.el.contains(e.relatedTarget)||xn.trigger("chatBoxFocused",this,e)},focus(){const e=this.el.getElementsByClassName("chat-textarea")[0];return e&&document.activeElement!==e&&e.focus(),this},maybeFocus(){xn.settings.get("auto_focus")&&this.focus()},hide(){return this.el.classList.add("hidden"),this},afterShown(){this.model.clearUnreadMsgCounter(),this.model.setChatState(yn.ACTIVE),this.scrollDown(),this.maybeFocus()},show(){Nc.isVisible(this.el)?this.maybeFocus():(xn.trigger("beforeShowingChatView",this),xn.settings.get("animate")?Nc.fadeIn(this.el,()=>this.afterShown()):(Nc.showElement(this.el),this.afterShown()))},showNewMessagesIndicator(){Nc.showElement(this.el.querySelector(".new-msgs-indicator"))},hideNewMessagesIndicator(){const e=this.el.querySelector(".new-msgs-indicator");null!==e&&e.classList.add("hidden")},_markScrolled:function(){let e=!0;this.content.scrollTop+this.content.clientHeight>=this.content.scrollHeight-62&&(e=!1,this.onScrolledDown()),Nc.safeSave(this.model,{scrolled:e,top_visible_message:null})},viewUnreadMessages(){this.model.save({scrolled:!1,top_visible_message:null}),this.scrollDown()},_scrollDown(){void 0!==this.content&&Nc.isVisible(this.content)&&!this.model.get("scrolled")&&(0===this.content.scrollTop||this.content.scrollTop<this.content.scrollHeight/2?Nc.removeClass("smooth-scroll",this.content):xn.settings.get("animate")&&Nc.addClass("smooth-scroll",this.content),this.content.scrollTop=this.content.scrollHeight)},onScrolledDown(){this.hideNewMessagesIndicator(),"hidden"!==yn.windowState&&this.model.clearUnreadMsgCounter(),xn.trigger("chatBoxScrolledDown",{chatbox:this.model})},onWindowStateChanged(e){"visible"===e?this.model.isHidden()||this.model.get("num_unread",0)&&this.model.clearUnreadMsgCounter():"hidden"===e&&(this.model.setChatState(yn.INACTIVE,{silent:!0}),this.model.sendChatState())}}),xn.listen.on("chatBoxViewsInitialized",()=>{const e=yn.chatboxviews;yn.chatboxes.on("add",async t=>{e.get(t.get("id"))||t.get("type")!==yn.PRIVATE_CHAT_TYPE||(await t.initialized,e.add(t.get("id"),new yn.ChatBoxView({model:t})))})}),xn.listen.on("windowStateChanged",(function(e){yn.chatboxviews&&yn.chatboxviews.forEach(t=>{"controlbox"!==t.model.get("id")&&t.onWindowStateChanged(e.state)})})),xn.listen.on("connected",()=>xn.disco.own.features.add(kc.NS.SPOILER)),Object.assign(xn,{chatviews:{get:e=>void 0===e?Object.values(yn.chatboxviews.getAll()):Object(lr.isString)(e)?yn.chatboxviews.get(e):e.map(e=>yn.chatboxviews.get(e))}})}});var Mc=n(129),Ic=n.n(Mc),Rc=n(130),Dc=n.n(Rc),Pc=n(131),Lc=n.n(Pc);function zc(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['<span class="spinner fa fa-spinner centered"/>']);return zc=function(){return e},e}var Fc=()=>ho(zc());function Bc(){const e=Jc(['\n    <form id="converse-login" class="converse-form" method="post">\n        <div class="conn-feedback fade-in ','">\n            <p class="feedback-subject">','</p>\n            <p class="feedback-message ','">',"</p>\n        </div>\n        ","\n    </form>\n"]);return Bc=function(){return e},e}function qc(){const e=Jc(["<p>","</p>"]);return qc=function(){return e},e}function Uc(){const e=Jc(['<input class="btn btn-primary login-anon" type="submit" value="','">']);return Uc=function(){return e},e}function Hc(){const e=Jc(["\n    ","\n    ","\n    ","\n"]);return Hc=function(){return e},e}function $c(){const e=Jc(['\n    <div class="form-group">\n        <label for="converse-login-jid">',':</label>\n        <input id="converse-login-jid" class="form-control" required="required" type="text" name="jid" placeholder="','"/>\n    </div>\n    ',"\n    ",'\n    <fieldset class="buttons">\n        <input class="btn btn-primary" type="submit" value="','"/>\n    </fieldset>\n    ',"\n"]);return $c=function(){return e},e}function Wc(){const e=Jc(['\n    <fieldset class="switch-form">\n        <p>','</p>\n        <p><a class="register-account toggle-register-login" href="#converse/register">',"</a></p>\n    </fieldset>\n"]);return Wc=function(){return e},e}function Vc(){const e=Jc(['\n    <div class="form-group">\n        <label for="converse-login-password">','</label>\n        <input id="converse-login-password" class="form-control" required="required" type="password" name="password" placeholder="','"/>\n    </div>\n']);return Vc=function(){return e},e}function Gc(){const e=Jc(['\n    <div class="form-group form-check login-trusted">\n        <input id="converse-login-trusted" type="checkbox" class="form-check-input" name="trusted" ?checked=','>\n        <label for="converse-login-trusted" class="form-check-label login-trusted__desc">','</label>\n        <i class="fa fa-info-circle" data-toggle="popover"\n            data-title="Trusted device?"\n            data-content="','"></i>\n    </div>\n']);return Gc=function(){return e},e}function Jc(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const Qc=ne("Click here to log in anonymously"),Kc=ne("Disconnected"),Yc=ne("Log in"),Xc=ne("Don't have a chat account?"),Zc=ne("Password"),el=ne("This is a trusted device"),tl=ne("Username"),nl=ne("Create an account"),il=ne("To improve performance, we cache your data in this browser. Uncheck this box if this is a public computer or if you want your data to be deleted when you log out. It's important that you explicitly log out, otherwise not all cached data might be deleted. Please note, when using an untrusted device, OMEMO encryption is NOT available."),rl=e=>ho($c(),tl,e.placeholder_username,e.authentication!==e.EXTERNAL?ho(Vc(),Zc,Zc):"",e.show_trust_checkbox?(e=>ho(Gc(),e._converse.config.get("trusted"),el,il))(e):"",Yc,(e=>{const t=e._converse;return t.allow_registration&&!t.api.settings.get("auto_login")&&t.pluggable.plugins["converse-register"].enabled(t)})(e)?ho(Wc(),Xc,nl):"");var ol=e=>ho(Bc(),e.conn_feedback_subject?e.conn_feedback_class:"hidden",e.conn_feedback_subject,e.conn_feedback_message?"":"hidden",e.conn_feedback_message,"CONNECTING"===e._converse.CONNECTION_STATUS[e.connection_status]?Fc():(e=>ho(Hc(),e.authentication==e.LOGIN||e.authentication==e.EXTERNAL?rl(e):"",e.authentication==e.ANONYMOUS?ho(Uc(),Qc):"",e.authentication==e.PREBIND?ho(qc(),Kc):""))(e));
/**
 * @module converse-controlbox
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */const{Strophe:sl,dayjs:al}=zn.env,cl=zn.env.utils,ll={Error:"error",Connecting:"info","Connection failure":"error",Authenticating:"info","Authentication failure":"error",Connected:"info",Disconnected:"error",Disconnecting:"warn",Attached:"info",Redirect:"info",Reconnecting:"warn"},ul={0:"Error",1:"Connecting",2:"Connection failure",3:"Authenticating",4:"Authentication failure",5:"Connected",6:"Disconnected",7:"Disconnecting",8:"Attached",9:"Redirect",10:"Reconnecting"},dl=[0,1,2,3,4,7,10];zn.plugins.add("converse-controlbox",{dependencies:["converse-modal","converse-chatboxes","converse-chat","converse-rosterview","converse-chatview"],enabled:e=>!e.api.settings.get("singleton"),overrides:{ChatBoxes:{model(e,t){const{_converse:n}=this.__super__;return e&&"controlbox"==e.id?new n.ControlBox(e,t):this.__super__.model.apply(this,arguments)}}},initialize(){function e(){const e=new yn.ControlBox({id:"controlbox"});return yn.chatboxes.add(e)}xn.settings.update({allow_logout:!0,default_domain:void 0,locked_domain:void 0,show_controlbox_by_default:!1,sticky_controlbox:!1}),xn.promises.add("controlBoxInitialized"),yn.ControlBox=yn.ChatBox.extend({defaults(){return{bookmarked:!1,box_id:"controlbox",chat_state:void 0,closed:!xn.settings.get("show_controlbox_by_default"),num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),type:yn.CONTROLBOX_TYPE,url:""}},initialize(){"controlbox"===this.get("id")?this.set({time_opened:al(0).valueOf()}):yn.ChatBox.prototype.initialize.apply(this,arguments)},validate(e){return e.type===yn.CONTROLBOX_TYPE?"embedded"===xn.settings.get("view_mode")&&xn.settings.get("singleton")?"Controlbox not relevant in embedded view mode":void 0:yn.ChatBox.prototype.validate.call(this,e)},maybeShow(e){return e||"controlbox"!==this.get("id")?yn.ChatBox.prototype.maybeShow.call(this,e):this},onReconnection:function(){}}),yn.ControlBoxView=yn.ChatBoxView.extend({tagName:"div",className:"chatbox",id:"controlbox",events:{"click a.close-chatbox-button":"close"},initialize(){void 0===yn.controlboxtoggle&&(yn.controlboxtoggle=new yn.ControlBoxToggle),yn.controlboxtoggle.el.insertAdjacentElement("afterend",this.el),this.listenTo(this.model,"change:connected",this.onConnected),this.listenTo(this.model,"destroy",this.hide),this.listenTo(this.model,"hide",this.hide),this.listenTo(this.model,"show",this.show),this.listenTo(this.model,"change:closed",this.ensureClosedState),this.render(),xn.trigger("controlBoxInitialized",this)},render(){this.model.get("connected")&&void 0===this.model.get("closed")&&this.model.set("closed",!xn.settings.get("show_controlbox_by_default")),this.el.innerHTML=Dc()(Object.assign(this.model.toJSON())),this.model.get("closed")?this.hide():this.show();const e=(null==yn?void 0:yn.connection)||{};return e.connected&&e.authenticated&&!e.disconnecting?this.model.get("connected")&&this.renderControlBoxPane():this.renderLoginPanel(),this},onConnected(){this.model.get("connected")&&this.render()},createBrandHeadingHTML:()=>Ic()({sticky_controlbox:xn.settings.get("sticky_controlbox")}),insertBrandHeading(){const e=this.el.querySelector(".brand-heading-container");if(null===e){this.el.querySelector(".controlbox-head").insertAdjacentHTML("beforeend",this.createBrandHeadingHTML())}else e.outerHTML=this.createBrandHeadingHTML()},renderLoginPanel(){if(this.el.classList.add("logged-out"),this.loginpanel)this.loginpanel.render();else{this.loginpanel=new yn.LoginPanel({model:new yn.LoginPanelModel});const e=this.el.querySelector(".controlbox-panes");e.innerHTML="",e.appendChild(this.loginpanel.render().el),this.insertBrandHeading()}return this.loginpanel.initPopovers(),yn.auto_focus&&this.loginpanel.el.querySelector("#converse-login-jid").focus(),this},renderControlBoxPane(){this.loginpanel&&(this.loginpanel.remove(),delete this.loginpanel),this.controlbox_pane&&cl.isVisible(this.controlbox_pane.el)||(this.el.classList.remove("logged-out"),this.controlbox_pane=new yn.ControlBoxPane,this.el.querySelector(".controlbox-panes").insertAdjacentElement("afterBegin",this.controlbox_pane.el))},async close(e){if(e&&e.preventDefault&&e.preventDefault(),"closeAllChatBoxes"===(null==e?void 0:e.name)&&(yn.disconnection_cause!==yn.LOGOUT||xn.settings.get("show_controlbox_by_default")))return;if(xn.settings.get("sticky_controlbox"))return;const t=(null==yn?void 0:yn.connection)||{};return t.connected&&!t.disconnecting?await new Promise((e,t)=>this.model.save({closed:!0},{success:e,error:t,wait:!0})):this.model.trigger("hide"),xn.trigger("controlBoxClosed",this),this},ensureClosedState(){this.model.get("closed")?this.hide():this.show()},hide(e){if(!xn.settings.get("sticky_controlbox"))return cl.addClass("hidden",this.el),xn.trigger("chatBoxClosed",this),xn.connection.connected()||yn.controlboxtoggle.render(),yn.controlboxtoggle.show(e),this},onControlBoxToggleHidden(){this.model.set("closed",!1),this.el.classList.remove("hidden"),xn.trigger("controlBoxOpened",this)},show(){return yn.controlboxtoggle.hide(()=>this.onControlBoxToggleHidden()),this},showHelpMessages(){}}),yn.LoginPanelModel=Do.extend({defaults:{errors:[]}}),yn.LoginPanel=Fo.extend({tagName:"div",id:"converse-login-panel",className:"controlbox-pane fade-in row no-gutters",events:{"submit form#converse-login":"authenticate","change input":"validate"},initialize(){this.listenTo(this.model,"change",this.render),this.listenTo(yn.connfeedback,"change",this.render),this.render()},toHTML(){const e=yn.connfeedback.get("connection_status");let t,n;return dl.includes(e)&&(n=ul[e],t=ll[n]),ol(Object.assign(this.model.toJSON(),{_converse:yn,ANONYMOUS:yn.ANONYMOUS,EXTERNAL:yn.EXTERNAL,LOGIN:yn.LOGIN,PREBIND:yn.PREBIND,auto_login:yn.auto_login,authentication:xn.settings.get("authentication"),connection_status:e,conn_feedback_class:t,conn_feedback_subject:n,conn_feedback_message:yn.connfeedback.get("message"),placeholder_username:(xn.settings.get("locked_domain")||xn.settings.get("default_domain"))&&ne("Username")||ne("user@domain"),show_trust_checkbox:"on"!==yn.trusted&&"off"!==yn.trusted}))},initPopovers(){Array.from(this.el.querySelectorAll("[data-title]")).forEach(e=>{new oa.a.Popover(e,{trigger:"mobile"===xn.settings.get("view_mode")?"click":"hover",dismissible:"mobile"===xn.settings.get("view_mode"),container:this.el.parentElement.parentElement.parentElement})})},validate(){const e=this.el.querySelector("form").querySelector("input[name=jid]");return!e.value||xn.settings.get("locked_domain")||xn.settings.get("default_domain")||cl.isValidJID(e.value)?(e.setCustomValidity(""),!0):(e.setCustomValidity(ne("Please enter a valid XMPP address")),!1)},authenticate(e){if(e&&e.preventDefault&&e.preventDefault(),xn.settings.get("authentication")===yn.ANONYMOUS)return this.connect(yn.jid,null);if(!this.validate())return;const t=new FormData(e.target);"on"===yn.trusted||"off"===yn.trusted?yn.config.save({trusted:"on"===yn.trusted,storage:"on"===yn.trusted?"persistent":"session"}):yn.config.save({trusted:!!t.get("trusted"),storage:t.get("trusted")?"persistent":"session"});let n=t.get("jid");if(xn.settings.get("locked_domain")){const e="@"+xn.settings.get("locked_domain");n.endsWith(e)&&(n=n.substr(0,n.length-e.length)),n=sl.escapeNode(n)+e}else xn.settings.get("default_domain")&&!n.includes("@")&&(n=n+"@"+xn.settings.get("default_domain"));this.connect(n,t.get("password"))},connect(e,t){["converse/login","converse/register"].includes(yn.router.history.getFragment())&&yn.router.navigate("",{replace:!0}),yn.connection&&yn.connection.reset(),xn.user.login(e,t)}}),yn.ControlBoxPane=Fo.extend({tagName:"div",className:"controlbox-pane",initialize(){xn.trigger("controlBoxPaneInitialized",this)}}),yn.ControlBoxToggle=Fo.extend({tagName:"a",className:"toggle-controlbox hidden",id:"toggle-controlbox",events:{click:"onClick"},attributes:{href:"#"},initialize(){yn.chatboxviews.insertRowColumn(this.render().el),xn.waitUntil("initialized").then(this.render.bind(this)).catch(e=>st.fatal(e))},render(){return this.el.innerHTML=Lc()({label_toggle:xn.connection.connected()?ne("Chat Contacts"):ne("Toggle chat")}),this},hide(e){cl.isVisible(this.el)&&(cl.hideElement(this.el),e())},show(e){cl.isVisible(this.el)||cl.fadeIn(this.el,e)},showControlBox(){let t=yn.chatboxes.get("controlbox");t||(t=e()),xn.connection.connected()?t.save({closed:!1}):t.trigger("show")},onClick(e){if(e.preventDefault(),cl.isVisible(yn.root.querySelector("#controlbox"))){const e=yn.chatboxes.get("controlbox");xn.connection.connected?e.save({closed:!0}):e.trigger("hide")}else this.showControlBox()}}),xn.listen.on("chatBoxViewsInitialized",()=>{yn.chatboxes.on("add",e=>{if(e.get("type")===yn.CONTROLBOX_TYPE){const t=yn.chatboxviews,n=t.get(e.get("id"));n?(n.model=e,n.initialize()):t.add(e.get("id"),new yn.ControlBoxView({model:e}))}})}),xn.listen.on("clearSession",()=>{const e=null==yn?void 0:yn.chatboxviews,t=e&&e.get("controlbox");t&&(cl.safeSave(t.model,{connected:!1}),(null==t?void 0:t.controlbox_pane)&&(t.controlbox_pane.remove(),delete t.controlbox_pane))}),xn.waitUntil("chatBoxViewsInitialized").then(e).catch(e=>st.fatal(e)),xn.listen.on("chatBoxesFetched",()=>{(yn.chatboxes.get("controlbox")||e()).save({connected:!0})});const t=function(){const e=yn.chatboxviews.get("controlbox");return e.model.set({connected:!1}),e};xn.listen.on("disconnected",()=>t().renderLoginPanel()),xn.listen.on("will-reconnect",t),Object.assign(xn,{controlbox:{async open(){await xn.waitUntil("chatBoxesFetched");const e=await xn.chatboxes.get("controlbox")||xn.chatboxes.create("controlbox",{},yn.Controlbox);return e.trigger("show"),e},get:()=>yn.chatboxviews.get("controlbox")}})}});var hl=n(132),fl=n.n(hl);
/**
 * @module converse-dragresize
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const pl=zn.env.utils;function gl(e,t){const n=t.el.querySelector(".box-flyout"),i=document.createElement("div");i.innerHTML=fl()(),n.insertBefore(i,n.firstChild)}zn.plugins.add("converse-dragresize",{dependencies:["converse-chatview","converse-headlines-view","converse-muc-views"],enabled:e=>"overlayed"==e.api.settings.get("view_mode"),overrides:{ChatBox:{initialize(){const e=this.__super__.initialize.apply(this,arguments),t=this.get("height"),n=this.get("width");return("controlbox"===this.get("id")?e=>this.set(e):e=>this.save(e))({height:pl.applyDragResistance(t,this.get("default_height")),width:pl.applyDragResistance(n,this.get("default_width"))}),e}},ChatBoxView:{events:{"mousedown .dragresize-top":"onStartVerticalResize","mousedown .dragresize-left":"onStartHorizontalResize","mousedown .dragresize-topleft":"onStartDiagonalResize"},render(){const e=this.__super__.render.apply(this,arguments);return gl(this.__super__._converse,this),this.setWidth(),e}},HeadlinesBoxView:{events:{"mousedown .dragresize-top":"onStartVerticalResize","mousedown .dragresize-left":"onStartHorizontalResize","mousedown .dragresize-topleft":"onStartDiagonalResize"},render(){const e=this.__super__.render.apply(this,arguments);return gl(this.__super__._converse,this),this.setWidth(),e}},ControlBoxView:{events:{"mousedown .dragresize-top":"onStartVerticalResize","mousedown .dragresize-left":"onStartHorizontalResize","mousedown .dragresize-topleft":"onStartDiagonalResize"},render(){const e=this.__super__.render.apply(this,arguments);return gl(this.__super__._converse,this),this.setWidth(),e},renderLoginPanel(){const e=this.__super__.renderLoginPanel.apply(this,arguments);return this.initDragResize().setDimensions(),e},renderControlBoxPane(){const e=this.__super__.renderControlBoxPane.apply(this,arguments);return this.initDragResize().setDimensions(),e}},ChatRoomView:{events:{"mousedown .dragresize-top":"onStartVerticalResize","mousedown .dragresize-left":"onStartHorizontalResize","mousedown .dragresize-topleft":"onStartDiagonalResize"},render(){const e=this.__super__.render.apply(this,arguments);return gl(this.__super__._converse,this),this.setWidth(),e}}},initialize(){xn.settings.update({allow_dragresize:!0});const e={initDragResize(){var e;const t=this,n=Object(lr.debounce)(()=>t.setDimensions());window.addEventListener("resize",t.debouncedSetDimensions),this.listenTo(this.model,"destroy",()=>window.removeEventListener("resize",n));const i=this.el.querySelector(".box-flyout"),r=window.getComputedStyle(i);if(void 0===this.model.get("height")){const e=parseInt(r.height.replace(/px$/,""),10),t=parseInt(r.width.replace(/px$/,""),10);this.model.set("height",e),this.model.set("default_height",e),this.model.set("width",t),this.model.set("default_width",t)}const o=r["min-width"],s=r["min-height"];return this.model.set("min_width",o.endsWith("px")?Number(o.replace(/px$/,"")):0),this.model.set("min_height",s.endsWith("px")?Number(s.replace(/px$/,"")):0),this.prev_pageY=0,this.prev_pageX=0,(null===(e=yn.connection)||void 0===e?void 0:e.connected)&&(this.height=this.model.get("height"),this.width=this.model.get("width")),this},resizeChatBox(e){let t;0===yn.resizing.direction.indexOf("top")&&(t=e.pageY-this.prev_pageY,t&&(this.height=this.height-t>(this.model.get("min_height")||0)?this.height-t:this.model.get("min_height"),this.prev_pageY=e.pageY,this.setChatBoxHeight(this.height))),yn.resizing.direction.includes("left")&&(t=this.prev_pageX-e.pageX,t&&(this.width=this.width+t>(this.model.get("min_width")||0)?this.width+t:this.model.get("min_width"),this.prev_pageX=e.pageX,this.setChatBoxWidth(this.width)))},setWidth(){this.model.get("width")&&(this.el.style.width=this.model.get("width"))},setDimensions(){this.adjustToViewport(),this.setChatBoxHeight(this.model.get("height")),this.setChatBoxWidth(this.model.get("width"))},setChatBoxHeight(e){e=e?pl.applyDragResistance(e,this.model.get("default_height"))+"px":"";const t=this.el.querySelector(".box-flyout");null!==t&&(t.style.height=e)},setChatBoxWidth(e){e=e?pl.applyDragResistance(e,this.model.get("default_width"))+"px":"",this.el.style.width=e;const t=this.el.querySelector(".box-flyout");null!==t&&(t.style.width=e)},adjustToViewport(){const e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),t=Math.max(document.documentElement.clientHeight,window.innerHeight||0);e<=480?(this.model.set("height",void 0),this.model.set("width",void 0)):e<=this.model.get("width")?this.model.set("width",void 0):t<=this.model.get("height")&&this.model.set("height",void 0)},onStartVerticalResize(e,t=!0){if(!xn.settings.get("allow_dragresize"))return!0;e.preventDefault();const n=this.el.querySelector(".box-flyout"),i=window.getComputedStyle(n);this.height=parseInt(i.height.replace(/px$/,""),10),yn.resizing={chatbox:this,direction:"top"},this.prev_pageY=e.pageY,t&&xn.trigger("startVerticalResize",this)},onStartHorizontalResize(e,t=!0){if(!xn.settings.get("allow_dragresize"))return!0;e.preventDefault();const n=this.el.querySelector(".box-flyout"),i=window.getComputedStyle(n);this.width=parseInt(i.width.replace(/px$/,""),10),yn.resizing={chatbox:this,direction:"left"},this.prev_pageX=e.pageX,t&&xn.trigger("startHorizontalResize",this)},onStartDiagonalResize(e){this.onStartHorizontalResize(e,!1),this.onStartVerticalResize(e,!1),yn.resizing.direction="topleft",xn.trigger("startDiagonalResize",this)}};function t(e){if(!yn.resizing||!xn.settings.get("allow_dragresize"))return!0;e.preventDefault(),yn.resizing.chatbox.resizeChatBox(e)}function n(e){if(!yn.resizing||!xn.settings.get("allow_dragresize"))return!0;e.preventDefault();const t=pl.applyDragResistance(yn.resizing.chatbox.height,yn.resizing.chatbox.model.get("default_height")),n=pl.applyDragResistance(yn.resizing.chatbox.width,yn.resizing.chatbox.model.get("default_width"));xn.connection.connected()?(yn.resizing.chatbox.model.save({height:t}),yn.resizing.chatbox.model.save({width:n})):(yn.resizing.chatbox.model.set({height:t}),yn.resizing.chatbox.model.set({width:n})),yn.resizing=null}Object.assign(yn.ChatBoxView.prototype,e),pl.applyDragResistance=function(e,t){if(void 0===e)return;if(void 0===t)return e;return e!==t&&Math.abs(e-t)<10?t:e},xn.listen.on("registeredGlobalEventHandlers",(function(){document.addEventListener("mousemove",t),document.addEventListener("mouseup",n)})),xn.listen.on("unregisteredGlobalEventHandlers",(function(){document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n)})),xn.listen.on("beforeShowingChatView",e=>e.initDragResize().setDimensions())}});const{keycodes:ml}=zn;function vl(e){let t=0;do{isNaN(e.offsetTop)||(t+=e.offsetTop)}while(e=e.offsetParent);return t}function _l(e){let t=0;do{isNaN(e.offsetLeft)||(t+=e.offsetLeft)}while(e=e.offsetParent);return t}class bl{static get DIRECTION(){return{down:"down",end:"end",home:"home",left:"left",right:"right",up:"up"}}static get DEFAULTS(){return{home:["".concat(ml.SHIFT,"+").concat(ml.UP_ARROW)],end:["".concat(ml.SHIFT,"+").concat(ml.DOWN_ARROW)],up:[ml.UP_ARROW],down:[ml.DOWN_ARROW],left:[ml.LEFT_ARROW,"".concat(ml.SHIFT,"+").concat(ml.TAB)],right:[ml.RIGHT_ARROW,ml.TAB],getSelector:null,jump_to_picked:null,jump_to_picked_direction:null,jump_to_picked_selector:"picked",onSelected:null,selected:"selected",selector:"li"}}static getClosestElement(e,t){return e.reduce((e,n)=>{const i=t(n);return i<e.distance?{distance:i,element:n}:e},{distance:1/0}).element}constructor(e,t){this.doc=window.document,this.container=e,this.scroll_container=t.scroll_container||e,this.options=Object.assign({},bl.DEFAULTS,t),this.init()}init(){this.selected=null,this.keydownHandler=null,this.elements={},this.keys={},this.options.down.forEach(e=>this.keys[e]=bl.DIRECTION.down),this.options.end.forEach(e=>this.keys[e]=bl.DIRECTION.end),this.options.home.forEach(e=>this.keys[e]=bl.DIRECTION.home),this.options.left.forEach(e=>this.keys[e]=bl.DIRECTION.left),this.options.right.forEach(e=>this.keys[e]=bl.DIRECTION.right),this.options.up.forEach(e=>this.keys[e]=bl.DIRECTION.up)}enable(){this.getElements(),this.keydownHandler=e=>this.handleKeydown(e),this.doc.addEventListener("keydown",this.keydownHandler),this.enabled=!0}disable(){this.keydownHandler&&this.doc.removeEventListener("keydown",this.keydownHandler),this.unselect(),this.elements={},this.enabled=!1}destroy(){this.disable(),this.container.domNavigator&&delete this.container.domNavigator}getNextElement(e){let t;if(e===bl.DIRECTION.home)t=this.getElements(e)[0];else if(e===bl.DIRECTION.end)t=Array.from(this.getElements(e)).pop();else if(this.selected)if(e===bl.DIRECTION.right){const n=this.getElements(e);t=n.slice(n.indexOf(this.selected))[1]}else if(e==bl.DIRECTION.left){const n=this.getElements(e);t=n.slice(0,n.indexOf(this.selected)).pop()||this.selected}else if(e==bl.DIRECTION.down){const e=this.selected.offsetLeft,n=this.selected.offsetTop+this.selected.offsetHeight,i=this.elementsAfter(0,n),r=t=>Math.abs(t.offsetLeft-e)+Math.abs(t.offsetTop-n);t=bl.getClosestElement(i,r)}else{if(e!=bl.DIRECTION.up)throw new Error("getNextElement: invalid direction value");{const e=this.selected.offsetLeft,n=this.selected.offsetTop-1,i=this.elementsBefore(1/0,n),r=t=>Math.abs(e-t.offsetLeft)+Math.abs(n-t.offsetTop);t=bl.getClosestElement(i,r)}}else t=e===bl.DIRECTION.right||e===bl.DIRECTION.down?this.getElements(e)[1]:this.getElements(e)[0];return this.options.jump_to_picked&&t&&t.matches(this.options.jump_to_picked)&&e===this.options.jump_to_picked_direction&&(t=this.container.querySelector(this.options.jump_to_picked_selector)||t),t}select(e,t){e&&e!==this.selected&&(this.unselect(),t&&this.scrollTo(e,t),e.matches("input")?e.focus():Ds.addClass(this.options.selected,e),this.selected=e,this.options.onSelected&&this.options.onSelected(e))}unselect(){this.selected&&(Ds.removeClass(this.options.selected,this.selected),delete this.selected)}scrollTo(e,t){if(this.inScrollContainerViewport(e)){if(!function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=window.innerHeight&&t.right<=window.innerWidth}(e))switch(t){case bl.DIRECTION.left:document.body.scrollLeft=_l(e)-document.body.offsetLeft;break;case bl.DIRECTION.up:document.body.scrollTop=vl(e)-document.body.offsetTop;break;case bl.DIRECTION.right:document.body.scrollLeft=_l(e)-document.body.offsetLeft-(document.documentElement.clientWidth-e.offsetWidth);break;case bl.DIRECTION.down:document.body.scrollTop=vl(e)-document.body.offsetTop-(document.documentElement.clientHeight-e.offsetHeight)}}else{const n=this.scroll_container;if(!n.contains(e))return;switch(t){case bl.DIRECTION.left:n.scrollLeft=e.offsetLeft-n.offsetLeft,n.scrollTop=e.offsetTop-n.offsetTop;break;case bl.DIRECTION.up:n.scrollTop=e.offsetTop-n.offsetTop;break;case bl.DIRECTION.right:n.scrollLeft=e.offsetLeft-n.offsetLeft-(n.offsetWidth-e.offsetWidth),n.scrollTop=e.offsetTop-n.offsetTop-(n.offsetHeight-e.offsetHeight);break;case bl.DIRECTION.down:n.scrollTop=e.offsetTop-n.offsetTop-(n.offsetHeight-e.offsetHeight)}}}inScrollContainerViewport(e){const t=this.scroll_container;return!(e.offsetLeft-t.scrollLeft<t.offsetLeft)&&(!(e.offsetTop-t.scrollTop<t.offsetTop)&&(!(e.offsetLeft+e.offsetWidth-t.scrollLeft>t.offsetLeft+t.offsetWidth)&&!(e.offsetTop+e.offsetHeight-t.scrollTop>t.offsetTop+t.offsetHeight)))}getElements(e){const t=this.options.getSelector?this.options.getSelector(e):this.options.selector;return this.elements[t]||(this.elements[t]=Array.from(this.container.querySelectorAll(t))),this.elements[t]}elementsAfter(e,t){return this.getElements(bl.DIRECTION.down).filter(n=>n.offsetLeft>=e&&n.offsetTop>=t)}elementsBefore(e,t){return this.getElements(bl.DIRECTION.up).filter(n=>n.offsetLeft<=e&&n.offsetTop<=t)}handleKeydown(e){const t=ml,n=e.shiftKey?this.keys["".concat(t.SHIFT,"+").concat(e.which)]:this.keys[e.which];if(n){e.preventDefault(),e.stopPropagation();const t=this.getNextElement(n,e);this.select(t,n)}}}var yl=bl;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const wl=new WeakMap,Sl=Nr(e=>t=>{if(!(t instanceof Zr))throw new Error("unsafeHTML can only be used in text bindings");const n=wl.get(t);if(void 0!==n&&Qr(e)&&e===n.value&&t.value===n.fragment)return;const i=document.createElement("template");i.innerHTML=e;const r=document.importNode(i.content,!0);t.setValue(r),wl.set(t,{value:e,fragment:r})});function xl(){const e=Nl(['\n    <div class="emoji-picker__header">\n        <input class="form-control emoji-search" name="emoji-search" placeholder="','"\n               .value=',"\n               @keydown=","\n               @blur=","\n               @focus=",">\n        ",'\n    </div>\n    <div class="emoji-picker__lists">\n        ',"\n        ",'\n    </div>\n    <div class="emoji-skintone-picker">\n        <label>Skin tone</label>\n        <ul>',"</ul>\n    </div>\n"]);return xl=function(){return e},e}function El(){const e=Nl(["\n    <span ?hidden=",' class="emoji-lists__container emoji-lists__container--browse">\n        ',"\n    </span>\n"]);return El=function(){return e},e}function Al(){const e=Nl(['\n        <li data-skintone="','" class="emoji-skintone ','">\n            <a class="pick-skintone" href="#" data-skintone="','" @click=',">","</a>\n        </li>\n    "]);return Al=function(){return e},e}function jl(){const e=Nl(['\n    <a id="emoji-picker-','" class="emoji-category__heading" data-category="','">','</a>\n    <ul class="emoji-picker" data-category="','">\n        ',"\n    </ul>\n"]);return jl=function(){return e},e}function Cl(){const e=Nl(["\n    <span ?hidden=",' class="emoji-lists__container emojis-lists__container--search">\n    <a id="emoji-picker-search-results" class="emoji-category__heading">','</a>\n    <ul class="emoji-picker">\n        ',"\n    </ul>\n    </span>\n"]);return Cl=function(){return e},e}function kl(){const e=Nl(['\n        <li class="emoji insert-emoji ','" data-emoji="','" title="','">\n            <a href="#" @click=',' data-emoji="','">',"</a>\n        </li>\n    "]);return kl=function(){return e},e}function Ol(){const e=Nl(["\n    <ul>\n        ","\n    </ul>\n"]);return Ol=function(){return e},e}function Tl(){const e=Nl(['\n        <li data-category="','"\n            class="emoji-category '," ",'"\n            title="','">\n\n            <a class="pick-category"\n               @click=','\n               href="#emoji-picker-','"\n               data-category="','">'," </a>\n        </li>\n    "]);return Tl=function(){return e},e}function Nl(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const Ml=ne("Search"),Il=ne("Search results"),Rl=["tone1","tone2","tone3","tone4","tone5"],Dl=e=>ho(Ol(),Object.keys(e.emoji_categories).map(t=>e.emoji_categories[t]?(e=>{const t=Sl(ia.a.filterXSS(e.transformCategory(e.emoji_categories[e.category]),{whiteList:{img:["class","draggable","alt","src","title"]}}));return ho(Tl(),e.category,e.category,e.current_category===e.category?"picked":"",ne(e._converse.emoji_category_labels[e.category]),e.onCategoryPicked,e.category,e.category,t)})(Object.assign({category:t},e)):"")),Pl=e=>{const t=Sl(ia.a.filterXSS(e.transform(e.emoji.sn),{whiteList:{img:["class","draggable","alt","src","title"]}}));return ho(kl(),e.shouldBeHidden(e.emoji.sn)?"hidden":"",e.emoji.sn,e.emoji.sn,e.onEmojiPicked,e.emoji.sn,t)},Ll=e=>ho(El(),e.query,Object.keys(e.emoji_categories).map(t=>e.emoji_categories[t]?(e=>ho(jl(),e.category,e.category,ne(e._converse.api.settings.get("emoji_category_labels")[e.category]),e.category,Object.values(e.emojis_by_category[e.category]).map(t=>Pl(Object.assign({emoji:t},e)))))(Object.assign({category:t},e)):""));var zl=e=>ho(xl(),Ml,e.query||"",e.onSearchInputKeyDown,e.onSearchInputBlurred,e.onSearchInputFocus,e.query?"":Dl(e),(e=>ho(Cl(),!e.query,Il,e.search_results.map(t=>Pl(Object.assign({emoji:t},e)))))(e),Ll(e),Rl.map(t=>(e=>{const t=":"+e.skintone+":",n=Sl(ia.a.filterXSS(e.transform(t),{whiteList:{img:["class","draggable","alt","src","title"]}}));return ho(Al(),e.skintone,e.current_skintone===e.skintone?"picked":"",e.skintone,e.onSkintonePicked,n)})(Object.assign({skintone:t},e)))),Fl=n(133),Bl=n.n(Fl);
/**
 * @module converse-emoji-views
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const ql=zn.env.utils;zn.plugins.add("converse-emoji-views",{dependencies:["converse-emoji","converse-chatview","converse-muc-views"],overrides:{ChatBoxView:{events:{"click .toggle-smiley":"toggleEmojiMenu"},onEnterPressed(){this.emoji_dropdown&&ql.isVisible(this.emoji_dropdown.el.querySelector(".emoji-picker"))&&this.emoji_dropdown.toggle(),this.__super__.onEnterPressed.apply(this,arguments)},onKeyDown(e){if(e.keyCode===zn.keycodes.TAB){const t=ql.getCurrentWord(e.target,null,/(:.*?:)/g);if(t.startsWith(":"))return e.preventDefault(),e.stopPropagation(),this.autocompleteInPicker(e.target,t)}return this.__super__.onKeyDown.call(this,e)}},ChatRoomView:{events:{"click .toggle-smiley":"toggleEmojiMenu"}}},initialize(){xn.settings.update({use_system_emojis:!0,visible_toolbar_buttons:{emoji:!0}});const e={async autocompleteInPicker(e,t){await this.createEmojiDropdown(),this.emoji_picker_view.model.set({autocompleting:t,position:e.selectionStart},{silent:!0}),this.emoji_picker_view.filter(t),this.emoji_dropdown.toggle()},async createEmojiPicker(){await xn.emojis.initialize();const e="converse.emoji-".concat(yn.bare_jid,"-").concat(this.model.get("jid")),t=new yn.EmojiPicker({id:e});t.browserStorage=yn.createStore(e),await new Promise(e=>t.fetch({success:e,error:e})),this.emoji_picker_view=new yn.EmojiPickerView({model:t,chatview:this});const n=this.el.querySelector(".emoji-picker__container");n.innerHTML="",n.appendChild(this.emoji_picker_view.el)},async createEmojiDropdown(){if(!this.emoji_dropdown){await this.createEmojiPicker();const e=this.el.querySelector(".emoji-picker");this.emoji_dropdown=new oa.a.Dropdown(e,!0),this.emoji_dropdown.el=e}},async toggleEmojiMenu(e){e.stopPropagation(),await this.createEmojiDropdown(),this.emoji_dropdown.toggle(),this.emoji_picker_view.setScrollPosition()}};Object.assign(yn.ChatBoxView.prototype,e),yn.EmojiPickerView=Fo.extend({className:"emoji-picker dropdown-menu toolbar-menu",initialize(e){this.chatview=e.chatview,this.onGlobalKeyDown=e=>this._onGlobalKeyDown(e),document.querySelector("body").addEventListener("keydown",this.onGlobalKeyDown),this.search_results=[],this.debouncedFilter=Object(lr.debounce)(e=>this.filter(e.value),250),this.listenTo(this.model,"change:query",this.render),this.listenTo(this.model,"change:current_skintone",this.render),this.listenTo(this.model,"change:current_category",this.render),this.render(),this.initArrowNavigation(),this.initIntersectionObserver()},toHTML(){return zl(Object.assign(this.model.toJSON(),{_converse:yn,emoji_categories:xn.settings.get("emoji_categories"),emojis_by_category:yn.emojis.json,onSkintonePicked:e=>this.chooseSkinTone(e),onEmojiPicked:e=>this.insertEmoji(e),onCategoryPicked:e=>this.chooseCategory(e),onSearchInputBlurred:e=>this.chatview.emitFocused(e),onSearchInputKeyDown:e=>this.onKeyDown(e),onSearchInputFocus:e=>this.onSearchInputFocus(e),search_results:this.search_results,shouldBeHidden:e=>this.shouldBeHidden(e),toned_emojis:yn.emojis.toned,transform:ql.getEmojiRenderer(),transformCategory:e=>ql.getEmojiRenderer()(this.getTonedShortname(e))}))},afterRender(){this.setScrollPosition()},onSearchInputFocus(e){this.chatview.emitBlurred(e),this.disableArrowNavigation()},remove(){document.querySelector("body").removeEventListener("keydown",this.onGlobalKeyDown),Fo.prototype.remove.call(this)},initArrowNavigation(){if(!this.navigator){const e="li:not(.hidden):not(.emoji-skintone), .emoji-search",t={jump_to_picked:".emoji-category",jump_to_picked_selector:".emoji-category.picked",jump_to_picked_direction:yl.DIRECTION.down,picked_selector:".picked",scroll_container:this.el.querySelector(".emoji-picker__lists"),getSelector:t=>{if(t===yl.DIRECTION.down){const t=this.navigator.selected&&this.navigator.selected.getAttribute("data-category");return t?'ul[data-category="'.concat(t,'"] li:not(.hidden):not(.emoji-skintone), .emoji-search'):e}return e},onSelected:e=>{e.matches(".insert-emoji")&&this.setCategoryForElement(e.parentElement),e.matches(".insert-emoji, .emoji-category")&&e.firstElementChild.focus(),e.matches(".emoji-search")&&e.focus()}};this.navigator=new yl(this.el,t),this.listenTo(this.chatview.model,"destroy",()=>this.navigator.destroy())}},enableArrowNavigation(e){e&&(e.preventDefault(),e.stopPropagation()),this.disableArrowNavigation(),this.navigator.enable(),this.navigator.handleKeydown(e)},disableArrowNavigation(){this.navigator.disable()},filter(e){const t=this.model.get("query");e?t&&e.includes(t)?this.search_results=this.search_results.filter(t=>yn.FILTER_CONTAINS(t.sn,e)):this.search_results=yn.emojis_list.filter(t=>yn.FILTER_CONTAINS(t.sn,e)):this.search_results=[],this.model.set({query:e})},setCategoryForElement(e){const t=e.getAttribute("data-category");this.model.get("current_category")!==t&&this.model.save({current_category:t})},setCategoryOnVisibilityChange(e){const t=this.navigator.selected,n=e.filter(e=>e.target.contains(t)).pop();let i;i=n||e.reduce((e,t)=>t.intersectionRatio>=((null==e?void 0:e.intersectionRatio)||0)?t:e,null),i&&i.isIntersecting&&this.setCategoryForElement(i.target)},initIntersectionObserver(){if(window.IntersectionObserver){if(this.observer)this.observer.disconnect();else{const e={root:this.el.querySelector(".emoji-picker__lists"),threshold:[.1]},t=e=>this.setCategoryOnVisibilityChange(e);this.observer=new IntersectionObserver(t,e)}Rt()(".emoji-picker",this.el).forEach(e=>this.observer.observe(e))}},insertIntoTextArea(e){const t=this.model.get("autocompleting"),n=this.model.get("position");this.model.set({autocompleting:null,position:null}),this.chatview.insertIntoTextArea(e,t,!1,n),this.chatview.emoji_dropdown&&this.chatview.emoji_dropdown.toggle(),this.filter(""),this.disableArrowNavigation()},onEnterPressed(e){e.preventDefault(),e.stopPropagation(),yn.emoji_shortnames.includes(e.target.value)?this.insertIntoTextArea(e.target.value):1===this.search_results.length?this.insertIntoTextArea(this.search_results[0].sn):this.navigator.selected&&this.navigator.selected.matches(".insert-emoji")?this.insertIntoTextArea(this.navigator.selected.getAttribute("data-emoji")):this.navigator.selected&&this.navigator.selected.matches(".emoji-category")&&this.chooseCategory({target:this.navigator.selected})},_onGlobalKeyDown(e){this.navigator&&(e.keyCode===zn.keycodes.ENTER&&this.navigator.selected&&ql.isVisible(this.el)?this.onEnterPressed(e):e.keyCode===zn.keycodes.DOWN_ARROW&&!this.navigator.enabled&&ql.isVisible(this.el)&&this.enableArrowNavigation(e))},onKeyDown(e){if(e.keyCode===zn.keycodes.TAB)if(e.target.value){e.preventDefault();const t=Object(lr.find)(yn.emoji_shortnames,t=>yn.FILTER_CONTAINS(t,e.target.value));t&&this.filter(t)}else this.navigator.enabled||this.enableArrowNavigation(e);else e.keyCode!==zn.keycodes.DOWN_ARROW||this.navigator.enabled?e.keyCode===zn.keycodes.ENTER?this.onEnterPressed(e):e.keyCode!==zn.keycodes.ENTER&&e.keyCode!==zn.keycodes.DOWN_ARROW&&this.debouncedFilter(e.target):this.enableArrowNavigation(e)},shouldBeHidden(e){const t=this.model.get("current_skintone");if(e.includes("_tone")){if(!t||!e.includes(t))return!0}else if(t&&yn.emojis.toned.includes(e))return!0;const n=this.model.get("query");return!(!n||yn.FILTER_CONTAINS(e,n))},getTonedShortname(e){return yn.emojis.toned.includes(e)&&this.model.get("current_skintone")?"".concat(e.slice(0,e.length-1),"_").concat(this.model.get("current_skintone"),":"):e},chooseSkinTone(e){e.preventDefault(),e.stopPropagation();const t=("IMG"===e.target.nodeName?e.target.parentElement:e.target).getAttribute("data-skintone").trim();this.model.get("current_skintone")===t?this.model.save({current_skintone:""}):this.model.save({current_skintone:t})},chooseCategory(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation();const t=e.target.matches("li")?e.target:ql.ancestor(e.target,"li");this.setCategoryForElement(t),this.navigator.select(t),!this.navigator.enabled&&this.navigator.enable()},setScrollPosition(){const e=this.model.get("current_category"),t=this.el.querySelector(".emoji-lists__container--browse"),n=this.el.querySelector("#emoji-picker-".concat(e));n&&(t.scrollTop=n.offsetTop-3*n.offsetHeight+4)},insertEmoji(e){e.preventDefault(),e.stopPropagation();const t="IMG"===e.target.nodeName?e.target.parentElement:e.target,n=this.model.get("autocompleting"),i=this.model.get("position");this.model.set({autocompleting:null,position:null}),this.chatview.insertIntoTextArea(t.getAttribute("data-emoji"),n,!1,i),this.chatview.emoji_dropdown.toggle(),this.filter("")}}),xn.listen.on("chatBoxClosed",e=>e.emoji_picker_view&&e.emoji_picker_view.remove()),xn.listen.on("renderToolbar",e=>{if(xn.settings.get("visible_toolbar_buttons").emoji){const t=Bl()({tooltip_insert_smiley:ne("Insert emojis")});e.el.querySelector(".chat-toolbar").insertAdjacentHTML("afterBegin",t)}}),xn.listen.on("headlinesBoxInitialized",()=>xn.emojis.initialize()),xn.listen.on("chatRoomInitialized",()=>xn.emojis.initialize()),xn.listen.on("chatBoxInitialized",()=>xn.emojis.initialize())}}),
/**
 * @module converse-singleton
 * @copyright JC Brand
 * @license Mozilla Public License (MPLv2)
 * @description A plugin which restricts Converse to only one chat.
 */
zn.plugins.add("converse-singleton",{enabled:e=>e.api.settings.get("singleton"),initialize(){this._converse.api.settings.update({allow_logout:!1,allow_muc_invitations:!1,hide_muc_server:!0});const{_converse:e}=this;if(!Array.isArray(e.auto_join_rooms)&&!Array.isArray(e.auto_join_private_chats))throw new Error("converse-singleton: auto_join_rooms must be an Array");if(e.auto_join_rooms.length>1||e.auto_join_private_chats.length>1)throw new Error("It doesn't make sense to have singleton set to true and auto_join_rooms or auto_join_private_chats set to more then one, since only one chat room may be open at any time.")}});var Ul=n(134),Hl=n.n(Ul);
/**
 * @module converse-fullscreen
 * @license Mozilla Public License (MPLv2)
 * @copyright 2020, the Converse.js contributors
 */
zn.plugins.add("converse-fullscreen",{enabled:e=>e.isUniView(),overrides:{ControlBoxView:{createBrandHeadingHTML(){const{_converse:e}=this.__super__;return Hl()({version_name:e.VERSION_NAME})},insertBrandHeading(){const{_converse:e}=this.__super__;e.root.getElementById("converse-login-panel").parentNode.insertAdjacentHTML("afterbegin",this.createBrandHeadingHTML())}}},initialize(){this._converse.api.settings.update({chatview_avatar_height:50,chatview_avatar_width:50,hide_open_bookmarks:!0,show_controlbox_by_default:!0,sticky_controlbox:!0})}}),
/**
 * @module converse-mam-views
 * @description
 * Views for XEP-0313 Message Archive Management
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
zn.plugins.add("converse-mam-views",{dependencies:["converse-mam","converse-chatview","converse-muc-views"],overrides:{ChatBoxView:{render(){const e=this.__super__.render.apply(this,arguments);return this.disable_mam||this.content.addEventListener("scroll",Object(lr.debounce)(this.onScroll.bind(this),100)),e},async onScroll(){if(0===this.content.scrollTop&&this.model.messages.length){const e=this.model.getOldestMessage();if(e){const t=this.model.get("jid"),n=e&&e.get("stanza_id ".concat(t));this.addSpinner(),n?await this.model.fetchArchivedMessages({before:n}):await this.model.fetchArchivedMessages({end:e.get("time")}),this.clearSpinner()}}}},ChatRoomView:{renderChatArea(){const e=this.__super__.renderChatArea.apply(this,arguments);return this.disable_mam||this.content.addEventListener("scroll",Object(lr.debounce)(this.onScroll.bind(this),100)),e}}}});var $l=n(135),Wl=n.n($l),Vl=n(136),Gl=n.n(Vl),Jl=n(137),Ql=n.n(Jl);
/**
 * @module converse-minimize
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{dayjs:Kl}=zn.env,Yl=zn.env.utils;function Xl(){const e=bu(['<li class="list-group-item">',"</li>"]);return Xl=function(){return e},e}function Zl(){const e=bu(['<li class="list-group-item"> '," </li>"]);return Zl=function(){return e},e}function eu(){const e=bu(['<div class="row"><div class="col pt-2"><p class="helptext pb-3">',"</p></div></div>"]);return eu=function(){return e},e}function tu(){const e=bu(['<input class="form-control" .value="','" @keyup=',' type="text" name="filter" placeholder="','"/>']);return tu=function(){return e},e}function nu(){const e=bu(['<li class="list-group-item">',"</li>"]);return nu=function(){return e},e}function iu(){const e=bu(['<li class="list-group-item">',"</li>"]);return iu=function(){return e},e}function ru(){const e=bu(['<li class="list-group-item"> '," </li>"]);return ru=function(){return e},e}function ou(){const e=bu(['<div class="row"><div class="col pt-2"><p class="helptext pb-3">',"</p></div></div>"]);return ou=function(){return e},e}function su(){const e=bu(['<input class="form-control" .value="','" @keyup=',' type="text" name="filter" placeholder="','"/>']);return su=function(){return e},e}function au(){const e=bu(['\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h5 class="modal-title" id="converse-modtools-modal-label">',"</h5>\n                ",'\n            </div>\n            <div class="modal-body d-flex flex-column">\n                <span class="modal-alert"></span>\n\n                ','\n\n                <div class="tab-content">\n                    <div class="tab-pane tab-pane--columns ','" id="affiliations-tabpanel" role="tabpanel" aria-labelledby="affiliations-tab">\n                        <form class="converse-form query-affiliation" @submit=','>\n                            <p class="helptext pb-3">','</p>\n                            <div class="form-group">\n                                <label for="affiliation">\n                                    <strong>',':</strong>\n                                </label>\n                                <div class="row">\n                                    <div class="col">\n                                        <select class="custom-select select-affiliation" name="affiliation">\n                                            ','\n                                        </select>\n                                    </div>\n                                    <div class="col">\n                                        <input type="submit" class="btn btn-primary" name="users_with_affiliation" value="','"/>\n                                    </div>\n                                </div>\n                                <div class="row">\n                                    <div class="col mt-3">\n                                        ',"\n                                    </div>\n                                </div>\n\n                                ",'\n                            </div>\n                        </form>\n                        <div class="scrollable-container">\n                            <ul class="list-group list-group--users">\n                                ',"\n                                ","\n\n                                ",'\n                            </ul>\n                        </div>\n                    </div>\n\n                    <div class="tab-pane tab-pane--columns ','" id="roles-tabpanel" role="tabpanel" aria-labelledby="roles-tab">\n                        <form class="converse-form query-role" @submit=','>\n                            <p class="helptext pb-3">','</p>\n                            <div class="form-group">\n                                <label for="role"><strong>',':</strong></label>\n                                <div class="row">\n                                    <div class="col">\n                                        <select class="custom-select select-role" name="role">\n                                            ','\n                                        </select>\n                                    </div>\n                                    <div class="col">\n                                        <input type="submit" class="btn btn-primary" name="users_with_role" value="','"/>\n                                    </div>\n                                </div>\n                                <div class="row">\n                                    <div class="col mt-3">\n                                        ',"\n                                    </div>\n                                </div>\n\n                                ",'\n                            </div>\n                        </form>\n                        <div class="scrollable-container">\n                            <ul class="list-group list-group--users">\n                                ',"\n                                ","\n                                ","\n                            </ul>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>"]);return au=function(){return e},e}function cu(){const e=bu(['\n    <ul class="nav nav-pills justify-content-center">\n        <li role="presentation" class="nav-item">\n            <a class="nav-link active" id="affiliations-tab" href="#affiliations-tabpanel" aria-controls="affiliations-tabpanel" role="tab" data-toggle="tab" @click=','>Affiliations</a>\n        </li>\n        <li role="presentation" class="nav-item">\n            <a class="nav-link" id="roles-tab" href="#roles-tabpanel" aria-controls="roles-tabpanel" role="tab" data-toggle="tab" @click=',">Roles</a>\n        </li>\n    </ul>\n"]);return cu=function(){return e},e}function lu(){const e=bu(['<a href="#" data-form="affiliation-form" class="toggle-form right fa fa-wrench" @click=',"></a>"]);return lu=function(){return e},e}function uu(){const e=bu(['\n    <li class="list-group-item" data-nick="','">\n        <ul class="list-group">\n            <li class="list-group-item active">\n                <div><strong>JID:</strong> ','</div>\n            </li>\n            <li class="list-group-item">\n                <div><strong>Nickname:</strong> ','</div>\n            </li>\n            <li class="list-group-item">\n                <div><strong>Affiliation:</strong> '," ","</div>\n                ","\n            </li>\n        </ul>\n    </li>\n"]);return uu=function(){return e},e}function du(){const e=bu(['<option value="','" ?selected=',">","</option>"]);return du=function(){return e},e}function hu(){const e=bu(['\n    <form class="affiliation-form hidden" @submit=','>\n        <div class="form-group">\n            <input type="hidden" name="jid" value="','"/>\n            <input type="hidden" name="nick" value="','"/>\n            <div class="row">\n                <div class="col">\n                    <label><strong>',':</strong></label>\n                    <select class="custom-select select-affiliation" name="affiliation">\n                        ','\n                    </select>\n                </div>\n                <div class="col">\n                    <label><strong>',':</strong></label>\n                    <input class="form-control" type="text" name="reason"/>\n                </div>\n            </div>\n        </div>\n        <div class="form-group">\n            <input type="submit" class="btn btn-primary" name="change" value="','"/>\n        </div>\n    </form>\n']);return hu=function(){return e},e}function fu(){const e=bu(['<a href="#" data-form="role-form" class="toggle-form right fa fa-wrench" @click=',"></a>"]);return fu=function(){return e},e}function pu(){const e=bu(['\n    <li class="list-group-item" data-nick="','">\n        <ul class="list-group">\n            <li class="list-group-item active">\n                <div><strong>JID:</strong> ','</div>\n            </li>\n            <li class="list-group-item">\n                <div><strong>Nickname:</strong> ','</div>\n            </li>\n            <li class="list-group-item">\n                <div><strong>Role:</strong> '," ","</div>\n                ","\n            </li>\n        </ul>\n    </li>\n"]);return pu=function(){return e},e}function gu(){const e=bu(['<option value="','" ?selected=',">","</option>"]);return gu=function(){return e},e}function mu(){const e=bu(['\n    <form class="role-form hidden" @submit=','>\n        <div class="form-group">\n            <input type="hidden" name="jid" value="','"/>\n            <input type="hidden" name="nick" value="','"/>\n            <div class="row">\n                <div class="col">\n                    <label><strong>',':</strong></label>\n                    <select class="custom-select select-role" name="role">\n                        ','\n                    </select>\n                </div>\n                <div class="col">\n                    <label><strong>',':</strong></label>\n                    <input class="form-control" type="text" name="reason"/>\n                </div>\n            </div>\n        </div>\n        <div class="form-group">\n            <input type="submit" class="btn btn-primary" value="','"/>\n        </div>\n    </form>\n']);return mu=function(){return e},e}function vu(){const e=bu(['\n    <option value="','"\n            ?selected=','\n            title="','">',"</option>\n"]);return vu=function(){return e},e}function _u(){const e=bu(['\n    <option value="','"\n            ?selected=','\n            title="','">',"</option>\n"]);return _u=function(){return e},e}function bu(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}zn.plugins.add("converse-minimize",{dependencies:["converse-chatview","converse-controlbox","converse-muc-views","converse-headlines-view","converse-dragresize"],enabled:e=>"overlayed"===e.api.settings.get("view_mode"),overrides:{ChatBox:{initialize(){this.__super__.initialize.apply(this,arguments),this.on("show",this.maximize,this),"controlbox"!==this.get("id")&&this.save({minimized:this.get("minimized")||!1,time_minimized:this.get("time_minimized")||Kl()})},maybeShow(e){return!e&&this.get("minimized")?this:this.__super__.maybeShow.apply(this,arguments)}},ChatBoxView:{show(){const{_converse:e}=this.__super__;return"overlayed"===e.api.settings.get("view_mode")&&this.model.get("minimized")?(this.model.minimize(),this):this.__super__.show.apply(this,arguments)},isNewMessageHidden(){return this.model.get("minimized")||this.__super__.isNewMessageHidden.apply(this,arguments)},shouldShowOnTextMessage(){return!this.model.get("minimized")&&this.__super__.shouldShowOnTextMessage.apply(this,arguments)},setChatBoxHeight(e){if(!this.model.get("minimized"))return this.__super__.setChatBoxHeight.call(this,e)},setChatBoxWidth(e){if(!this.model.get("minimized"))return this.__super__.setChatBoxWidth.call(this,e)}}},initialize(){xn.settings.update({no_trimming:!1});const e={maximize(){Yl.safeSave(this,{minimized:!1,time_opened:(new Date).getTime()})},minimize(){Yl.safeSave(this,{minimized:!0,time_minimized:(new Date).toISOString()})}};Object.assign(yn.ChatBox.prototype,e);const t={onMaximized(){const{_converse:e}=this.__super__;return this.insertIntoDOM(),this.model.isScrolledUp()||this.model.clearUnreadMsgCounter(),this.model.setChatState(e.ACTIVE),this.show(),xn.trigger("chatBoxMaximized",this),this},onMinimized(e){const{_converse:t}=this.__super__;return e&&e.preventDefault&&e.preventDefault(),this.model.collection&&this.model.collection.browserStorage?this.model.save({scroll:this.content.scrollTop}):this.model.set({scroll:this.content.scrollTop}),this.model.setChatState(t.INACTIVE),this.hide(),xn.trigger("chatBoxMinimized",this),this},minimize(e){return e&&e.preventDefault&&e.preventDefault(),this.model.minimize(),this},onMinimizedChanged(e){e.get("minimized")?this.onMinimized():this.onMaximized()}};Object.assign(yn.ChatBoxView.prototype,t);const n={getChatBoxWidth(e){if("controlbox"===e.model.get("id")){const e=this.get("controlbox");return e&&Yl.isVisible(e.el)?Yl.getOuterWidth(e.el,!0):Yl.getOuterWidth(yn.controlboxtoggle.el,!0)}return!e.model.get("minimized")&&Yl.isVisible(e.el)?Yl.getOuterWidth(e.el,!0):0},getShownChats(){return this.filter(e=>!e.model.get("minimized")&&!e.model.get("closed")&&Yl.isVisible(e.el))},getMinimizedWidth(){var e;const t=null===(e=yn.minimized_chats)||void 0===e?void 0:e.el;return this.model.pluck("minimized").includes(!0)?Yl.getOuterWidth(t,!0):0},getBoxesWidth(e){const t=e?e.model.get("id"):null,n=e?Yl.getOuterWidth(e.el,!0):0;return Object.values(this.xget(t)).reduce((e,t)=>e+this.getChatBoxWidth(t),n)},async trimChats(e){var t;if(xn.settings.get("no_trimming")||!xn.connection.connected()||"overlayed"!==xn.settings.get("view_mode"))return;const n=this.getShownChats();if(n.length<=1)return;const i=Yl.getOuterWidth(document.querySelector("body"),!0);if(this.getChatBoxWidth(n[0])!==i&&(await xn.waitUntil("minimizedChatsInitialized"),null===(t=yn.minimized_chats)||void 0===t?void 0:t.el))for(;this.getMinimizedWidth()+this.getBoxesWidth(e)>i;){const t=e?e.model.get("id"):null,n=this.getOldestMaximizedChat([t]);if(!n)break;{const e=this.get(n.get("id"));e&&e.hide(),n.minimize()}}},getOldestMaximizedChat(e){e.push("controlbox");let t=0,n=this.model.sort().at(t);for(;e.includes(n.get("id"))||!0===n.get("minimized");)if(t++,n=this.model.at(t),!n)return null;return n}};Object.assign(yn.ChatBoxViews.prototype,n),xn.promises.add("minimizedChatsInitialized"),yn.MinimizedChatBoxView=Fo.extend({tagName:"div",events:{"click .close-chatbox-button":"close","click .restore-chat":"restore"},initialize(){this.listenTo(this.model,"change:num_unread",this.render),this.listenTo(this.model,"change:name",this.render),this.listenTo(this.model,"change:fullname",this.render),this.listenTo(this.model,"change:jid",this.render),this.listenTo(this.model,"destroy",this.remove),xn.trigger("minimizedChatViewInitialized",this)},render(){const e=Object.assign(this.model.toJSON(),{tooltip:ne("Click to restore this chat"),title:this.model.getDisplayName()});return this.el.innerHTML=Ql()(e),this.el},close(e){e&&e.preventDefault&&e.preventDefault(),this.remove();const t=yn.chatboxviews.get(this.model.get("id"));return t?t.close():(this.model.destroy(),xn.trigger("chatBoxClosed",this)),this},restore:Object(lr.debounce)((function(e){e&&e.preventDefault&&e.preventDefault(),this.model.off("change:num_unread",null,this),this.remove(),this.model.maximize()}),200,{leading:!0})}),yn.MinimizedChats=Ko.extend({tagName:"div",id:"minimized-chats",className:"hidden",events:{"click #toggle-minimized-chats":"toggle"},initialize(){this.render(),this.initToggle(),this.addMultipleChats(this.model.where({minimized:!0})),this.listenTo(this.model,"add",this.onChanged),this.listenTo(this.model,"destroy",this.removeChat),this.listenTo(this.model,"change:minimized",this.onChanged),this.listenTo(this.model,"change:num_unread",this.updateUnreadMessagesCounter)},render(){return this.el.parentElement||(this.el.innerHTML=Wl()(),yn.chatboxviews.insertRowColumn(this.el)),0===this.keys().length?this.el.classList.add("hidden"):this.keys().length>0&&!Yl.isVisible(this.el)&&this.el.classList.remove("hidden"),this.el},initToggle(){const e="converse.minchatstoggle-".concat(yn.bare_jid);this.toggleview=new yn.MinimizedChatsToggleView({model:new yn.MinimizedChatsToggle({id:e})}),this.toggleview.model.browserStorage=yn.createStore(e),this.toggleview.model.fetch()},toggle(e){e&&e.preventDefault&&e.preventDefault(),this.toggleview.model.save({collapsed:!this.toggleview.model.get("collapsed")}),Yl.slideToggleElement(this.el.querySelector(".minimized-chats-flyout"),200)},onChanged(e){"controlbox"!==e.get("id")&&(e.get("minimized")?this.addChat(e):this.get(e.get("id"))&&this.removeChat(e))},addChatView(e){const t=this.get(e.get("id"));if(t&&t.el.parentNode)return;const n=new yn.MinimizedChatBoxView({model:e});this.el.querySelector(".minimized-chats-flyout").insertAdjacentElement("beforeEnd",n.render()),this.add(e.get("id"),n)},addMultipleChats(e){e.forEach(e=>this.addChatView(e)),this.toggleview.model.set({num_minimized:this.keys().length}),this.render()},addChat(e){this.addChatView(e),this.toggleview.model.set({num_minimized:this.keys().length}),this.render()},removeChat(e){this.remove(e.get("id")),this.toggleview.model.set({num_minimized:this.keys().length}),this.render()},updateUnreadMessagesCounter(){this.toggleview.model.save({num_unread:Object(lr.sum)(this.model.pluck("num_unread"))}),this.render()}}),yn.MinimizedChatsToggle=Do.extend({defaults:{collapsed:!1,num_minimized:0,num_unread:0}}),yn.MinimizedChatsToggleView=Fo.extend({_setElement(){this.el=yn.root.querySelector("#toggle-minimized-chats")},initialize(){this.listenTo(this.model,"change:num_minimized",this.render),this.listenTo(this.model,"change:num_unread",this.render),this.flyout=this.el.parentElement.querySelector(".minimized-chats-flyout")},render(){return this.el.innerHTML=Gl()(Object.assign(this.model.toJSON(),{Minimized:ne("Minimized")})),this.model.get("collapsed")?Yl.hideElement(this.flyout):Yl.showElement(this.flyout),this.el}}),xn.listen.on("chatBoxInsertedIntoDOM",e=>yn.chatboxviews.trimChats(e)),xn.listen.on("chatBoxViewsInitialized",()=>(yn.minimized_chats=new yn.MinimizedChats({model:yn.chatboxes}),void xn.trigger("minimizedChatsInitialized"))),xn.listen.on("controlBoxOpened",e=>yn.chatboxviews.trimChats(e)),xn.listen.on("chatBoxViewInitialized",e=>e.listenTo(e.model,"change:minimized",e.onMinimizedChanged)),xn.listen.on("chatRoomViewInitialized",e=>{e.listenTo(e.model,"change:minimized",e.onMinimizedChanged),e.model.get("minimized")&&e.hide()}),xn.listen.on("getHeadingButtons",(e,t)=>e.model.get("type")===yn.CHATROOMS_TYPE?function(e,t){const n={a_class:"toggle-chatbox-button",handler:t=>e.minimize(t),i18n_text:ne("Minimize"),i18n_title:ne("Minimize this groupchat"),icon_class:"fa-minus",name:"minimize",standalone:"overlayed"===yn.api.settings.get("view_mode")},i=t.map(e=>e.name).indexOf("signout");return i>-1?[...t.slice(0,i),n,...t.slice(i)]:[n,...t]}(e,t):function(e,t){const n={a_class:"toggle-chatbox-button",handler:t=>e.minimize(t),i18n_text:ne("Minimize"),i18n_title:ne("Minimize this chat"),icon_class:"fa-minus",name:"minimize",standalone:"overlayed"===yn.api.settings.get("view_mode")},i=t.map(e=>e.name).indexOf("close");return i>-1?[...t.slice(0,i),n,...t.slice(i)]:[n,...t]}(e,t));const i=Object(lr.debounce)(()=>yn.chatboxviews.trimChats(),250);xn.listen.on("registeredGlobalEventHandlers",()=>window.addEventListener("resize",i)),xn.listen.on("unregisteredGlobalEventHandlers",()=>window.removeEventListener("resize",i))}});const yu=ne("Affiliation"),wu=ne("Change affiliation"),Su=ne("Change role"),xu=ne("Moderator Tools"),Eu=ne("New affiliation"),Au=ne("New Role"),ju=ne("No users with that affiliation found."),Cu=ne("No users with that role found."),ku=ne("Reason"),Ou=ne("Type here to filter the search results"),Tu=ne("Role"),Nu=ne("Show users"),Mu=ne("Roles are assigned to users to grant or deny them certain abilities in a multi-user chat. They're assigned either explicitly or implicitly as part of an affiliation. A role that's not due to an affiliation, is only valid for the duration of the user's session."),Iu=ne("An affiliation is a long-lived entitlement which typically implies a certain role and which grants privileges and responsibilities. For example admins and owners automatically have the moderator role.");function Ru(e){return"moderator"===e?ne("Moderators are privileged users who can change the roles of other users (except those with admin or owner affiliations."):"participant"===e?ne("The default role, implies that you can read and write messages."):"visitor"==e?ne("Visitors aren't allowed to write messages in a moderated multi-user chat."):void 0}function Du(e){return"owner"===e?ne("Owner is the highest affiliation. Owners can modify roles and affiliations of all other users."):"admin"===e?ne("Admin is the 2nd highest affiliation. Admins can modify roles and affiliations of all other users except owners."):"outcast"===e?ne('To ban a user, you give them the affiliation of "outcast".'):void 0}const Pu=e=>ho(pu(),e.item.nick,e.item.jid,e.item.nick,e.item.role,e.assignable_roles.length?ho(fu(),e.toggleForm):"",e.assignable_roles.length?(e=>ho(mu(),e.assignRole,e.item.jid,e.item.nick,Au,e.assignable_roles.map(t=>ho(gu(),t,t===e.item.role,t)),ku,Su))(e):""),Lu=e=>ho(uu(),e.item.nick,e.item.jid,e.item.nick,e.item.affiliation,e.assignable_affiliations.length?ho(lu(),e.toggleForm):"",e.assignable_affiliations.length?(e=>ho(hu(),e.assignAffiliation,e.item.jid,e.item.nick,Eu,e.assignable_affiliations.map(t=>ho(du(),t,t===e.item.affiliation,t)),ku,wu))(e):"");var zu=e=>{const t=e.queryable_roles.length&&e.queryable_affiliations.length;return ho(au(),xu,Qs,t?(e=>ho(cu(),e.switchTab,e.switchTab))(e):"",e.queryable_affiliations.length?"active":"",e.queryAffiliation,Iu,yu,e.queryable_affiliations.map(t=>(e=>ho(vu(),e.item||"",e.item===e.affiliation,Du(e.item),e.item))(Object.assign({item:t},e))),Nu,Array.isArray(e.users_with_affiliation)&&e.users_with_affiliation.length>5?ho(su(),e.affiliations_filter,e.filterAffiliationResults,Ou):"",Du(e.affiliation)?ho(ou(),Du(e.affiliation)):"",e.loading_users_with_affiliation?ho(ru(),Fc()):"",Array.isArray(e.users_with_affiliation)&&0===e.users_with_affiliation.length?ho(iu(),ju):"",e.users_with_affiliation instanceof Error?ho(nu(),e.users_with_affiliation.message):(e.users_with_affiliation||[]).map(t=>(t.nick||t.jid).match(e.affiliations_filter)?Lu(Object.assign({item:t},e)):""),!t&&e.queryable_roles.length?"active":"",e.queryRole,Mu,Tu,e.queryable_roles.map(t=>(e=>ho(_u(),e.item||"",e.item===e.role,Ru(e.item),e.item))(Object.assign({item:t},e))),Nu,Array.isArray(e.users_with_role)&&e.users_with_role.length>5?ho(tu(),e.roles_filter,e.filterRoleResults,Ou):"",Ru(e.role)?ho(eu(),Ru(e.role)):"",e.loading_users_with_role?ho(Zl(),Fc()):"",e.users_with_role&&0===e.users_with_role.length?ho(Xl(),Cu):"",(e.users_with_role||[]).map(t=>t.nick.match(e.roles_filter)?Pu(Object.assign({item:t},e)):""))};const{Strophe:Fu}=zn.env,Bu=zn.env.utils;let qu;var Uu=ya.extend({id:"converse-modtools-modal",initialize(e){qu=e._converse,this.chatroomview=e.chatroomview,ya.prototype.initialize.apply(this,arguments),this.affiliations_filter="",this.roles_filter="",this.listenTo(this.model,"change:role",()=>{this.users_with_role=this.chatroomview.model.getOccupantsWithRole(this.model.get("role")),this.render()}),this.listenTo(this.model,"change:affiliation",async()=>{this.loading_users_with_affiliation=!0,this.users_with_affiliation=null,this.render();const e=this.chatroomview.model,t=this.model.get("affiliation");this.shouldFetchAffiliationsList()?this.users_with_affiliation=await e.getAffiliationList(t):this.users_with_affiliation=e.getOccupantsWithAffiliation(t),this.loading_users_with_affiliation=!1,this.render()})},toHTML(){const e=this.chatroomview.model.occupants.findWhere({jid:qu.bare_jid});return zu(Object.assign(this.model.toJSON(),{affiliations_filter:this.affiliations_filter,assignAffiliation:e=>this.assignAffiliation(e),assignRole:e=>this.assignRole(e),assignable_affiliations:this.getAssignableAffiliations(e),assignable_roles:this.getAssignableRoles(e),filterAffiliationResults:e=>this.filterAffiliationResults(e),filterRoleResults:e=>this.filterRoleResults(e),loading_users_with_affiliation:this.loading_users_with_affiliation,queryAffiliation:e=>this.queryAffiliation(e),queryRole:e=>this.queryRole(e),queryable_affiliations:hi.filter(e=>!qu.modtools_disable_query.includes(e)),queryable_roles:di.filter(e=>!qu.modtools_disable_query.includes(e)),roles_filter:this.roles_filter,switchTab:e=>this.switchTab(e),toggleForm:e=>this.toggleForm(e),users_with_affiliation:this.users_with_affiliation,users_with_role:this.users_with_role}))},getAssignableAffiliations(e){const t=qu.modtools_disable_assign;return Array.isArray(t)?"owner"===e.get("affiliation")?hi.filter(e=>!t.includes(e)):"admin"===e.get("affiliation")?hi.filter(e=>!["owner",...t].includes(e)):[]:t?[]:hi},getAssignableRoles(e){const t=qu.modtools_disable_assign;return Array.isArray(t)?"moderator"===e.get("role")?di.filter(e=>!t.includes(e)):[]:t?[]:di},shouldFetchAffiliationsList(){const e=this.model.get("affiliation");return"none"!==e&&!this.chatroomview.model.occupants.getAutoFetchedAffiliationLists().includes(e)},toggleForm(e){e.stopPropagation(),e.preventDefault();const t=e.target.getAttribute("data-form"),n=Bu.ancestor(e.target,".list-group-item").querySelector(".".concat(t));Bu.hasClass("hidden",n)?Bu.removeClass("hidden",n):Bu.addClass("hidden",n)},filterRoleResults(e){this.roles_filter=e.target.value,this.render()},filterAffiliationResults(e){this.affiliations_filter=e.target.value,this.render()},queryRole(e){e.stopPropagation(),e.preventDefault();const t=new FormData(e.target).get("role");this.model.set({role:null},{silent:!0}),this.model.set({role:t})},queryAffiliation(e){e.stopPropagation(),e.preventDefault();const t=new FormData(e.target).get("affiliation");this.model.set({affiliation:null},{silent:!0}),this.model.set({affiliation:t})},assignAffiliation(e){e.stopPropagation(),e.preventDefault();const t=new FormData(e.target),n=t.get("affiliation"),i={jid:t.get("jid"),reason:t.get("reason")},r=this.model.get("affiliation");this.chatroomview.model.setAffiliation(n,[i]).then(async()=>{this.alert(ne("Affiliation changed"),"primary"),await this.chatroomview.model.occupants.fetchMembers(),this.model.set({affiliation:null},{silent:!0}),this.model.set({affiliation:r})}).catch(e=>{this.alert(ne("Sorry, something went wrong while trying to set the affiliation"),"danger"),st.error(e)})},assignRole(e){e.stopPropagation(),e.preventDefault();const t=new FormData(e.target),n=this.chatroomview.model.getOccupant(t.get("jid")||t.get("nick")),i=t.get("role"),r=t.get("reason"),o=this.model.get("role");this.chatroomview.model.setRole(n,i,r,()=>{this.alert(ne("Role changed"),"primary"),this.model.set({role:null},{silent:!0}),this.model.set({role:o})},e=>{Rt()('not-allowed[xmlns="'.concat(Fu.NS.STANZAS,'"]'),e).length?this.alert(ne("You're not allowed to make that change"),"danger"):(this.alert(ne("Sorry, something went wrong while trying to set the role"),"danger"),Bu.isErrorObject(e)&&st.error(e))})}});function Hu(){const e=rd(['<li class="feature" ><span class="fa fa-database"></span>'," - <em>","</em></li>"]);return Hu=function(){return e},e}function $u(){const e=rd(['<li class="feature" ><span class="fa fa-info-circle"></span>'," - <em>","</em></li>"]);return $u=function(){return e},e}function Wu(){const e=rd(['<li class="feature" ><span class="fa fa-gavel"></span>'," - <em>","</em></li>"]);return Wu=function(){return e},e}function Vu(){const e=rd(['<li class="feature" ><span class="fa fa-user-secret"></span>'," - <em>","</em></li>"]);return Vu=function(){return e},e}function Gu(){const e=rd(['<li class="feature" ><span class="fa fa-id-card"></span>'," - <em>","</em></li>"]);return Gu=function(){return e},e}function Ju(){const e=rd(['<li class="feature" ><span class="fa fa-snowflake-o"></span>'," - <em>","</em></li>"]);return Ju=function(){return e},e}function Qu(){const e=rd(['<li class="feature" ><span class="fa fa-save"></span>'," - <em>","</em></li>"]);return Qu=function(){return e},e}function Ku(){const e=rd(['<li class="feature" ><span class="fa fa-globe"></span>'," - <em>","</em></li>"]);return Ku=function(){return e},e}function Yu(){const e=rd(['<li class="feature" ><span class="fa fa-address-book"></span>'," - <em>","</em></li>"]);return Yu=function(){return e},e}function Xu(){const e=rd(['<li class="feature" ><span class="fa fa-eye"></span>'," - <em>","</em></li>"]);return Xu=function(){return e},e}function Zu(){const e=rd(['<li class="feature" ><span class="fa fa-eye-slash"></span>'," - <em>","</em></li>"]);return Zu=function(){return e},e}function ed(){const e=rd(['<li class="feature" ><span class="fa fa-unlock"></span>'," - <em>","</em></li>"]);return ed=function(){return e},e}function td(){const e=rd(['<li class="feature" ><span class="fa fa-lock"></span>'," - <em>","</em></li>"]);return td=function(){return e},e}function nd(){const e=rd(['\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h5 class="modal-title" id="room-details-modal-label">',"</h5>\n                ",'\n            </div>\n            <div class="modal-body">\n                <span class="modal-alert"></span>\n                <div class="room-info">\n                    <p class="room-info"><strong>',"</strong>: ",'</p>\n                    <p class="room-info"><strong>',"</strong>: ",'</p>\n                    <p class="room-info"><strong>',"</strong>: ","</p>\n                    ",'\n                    <p class="room-info"><strong>',"</strong>: ",'</p>\n                    <p class="room-info"><strong>','</strong>:\n                        <div class="chatroom-features">\n                        <ul class="features-list">\n                            ',"\n                            ","\n                            ","\n                            ","\n                            ","\n                            ","\n                            ","\n                            ","\n                            ","\n                            ","\n                            ","\n                            ","\n                            ",'\n                        </ul>\n                        </div>\n                    </p>\n                </div>\n            </div>\n            <div class="modal-footer">',"</div>\n        </div>\n    </div>\n"]);return nd=function(){return e},e}function id(){const e=rd(['\n    <p class="room-info"><strong>',"</strong>: ",'</p>\n        <p class="room-info"><strong>',"</strong>: ","</p>\n"]);return id=function(){return e},e}function rd(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const od=ne("Groupchat address (JID)"),sd=ne("Message archiving"),ad=ne("Messages are archived on the server"),cd=ne("Description"),ld=ne("Features"),ud=ne("Hidden"),dd=ne("This groupchat is not publicly searchable"),hd=ne("This groupchat is restricted to members only"),fd=ne("Members only"),pd=ne("Moderated"),gd=ne("Participants entering this groupchat need to request permission to write"),md=ne("Name"),vd=ne("This groupchat does not require a password upon entry"),_d=ne("No password required"),bd=ne("Not anonymous"),yd=ne("All other groupchat participants can see your XMPP address"),wd=ne("Not moderated"),Sd=ne("Participants entering this groupchat can write right away"),xd=ne("Online users"),Ed=ne("Open"),Ad=ne("Anyone can join this groupchat"),jd=ne("This groupchat requires a password before entry"),Cd=ne("Password protected"),kd=ne("Persistent"),Od=ne("This groupchat persists even if it's unoccupied"),Td=ne("Public"),Nd=ne("Semi-anonymous"),Md=ne("Only moderators can see your XMPP address"),Id=ne("Temporary"),Rd=ne("This groupchat will disappear once the last person leaves"),Dd=ne("Topic"),Pd=ne("Topic author");var Ld=e=>ho(nd(),e.display_name,Qs,md,e.name,od,e.jid,cd,e.config.description,e.subject?(e=>ho(id(),Dd,Sl(ia.a.filterXSS(e.subject.text,{whiteList:{}})),Pd,e.subject&&e.subject.author))(e):"",xd,e.num_occupants,ld,e.features.passwordprotected?ho(td(),Cd,jd):"",e.features.unsecured?ho(ed(),_d,vd):"",e.features.hidden?ho(Zu(),ud,dd):"",e.features.public_room?ho(Xu(),Td,e.__("This groupchat is publicly searchable")):"",e.features.membersonly?ho(Yu(),fd,hd):"",e.features.open?ho(Ku(),Ed,Ad):"",e.features.persistent?ho(Qu(),kd,Od):"",e.features.temporary?ho(Ju(),Id,Rd):"",e.features.nonanonymous?ho(Gu(),bd,yd):"",e.features.semianonymous?ho(Vu(),Nd,Md):"",e.features.moderated?ho(Wu(),pd,gd):"",e.features.unmoderated?ho($u(),wd,Sd):"",e.features.mam_enabled?ho(Hu(),sd,ad):"",Js),zd=ya.extend({id:"room-details-modal",initialize(){ya.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.render),this.listenTo(this.model.features,"change",this.render),this.listenTo(this.model.occupants,"add",this.render),this.listenTo(this.model.occupants,"change",this.render)},toHTML(){return Ld(Object.assign(this.model.toJSON(),{config:this.model.config.toJSON(),display_name:ne("Groupchat info for %1$s",this.model.getDisplayName()),features:this.model.features.toJSON(),num_occupants:this.model.occupants.length}))}});function Fd(){const e=Hd(['<div class="form-group">',"</div>"]);return Fd=function(){return e},e}function Bd(){const e=Hd(['<label class="roomid-policy-error">',"</label>"]);return Bd=function(){return e},e}function qd(){const e=Hd(['\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h5 class="modal-title" id="add-chatroom-modal-label">',"</h5>\n                ",'\n            </div>\n            <div class="modal-body">\n                <span class="modal-alert"></span>\n                <form class="converse-form add-chatroom">\n                    <div class="form-group">\n                        <label for="chatroom">',":</label>\n                        ",'\n                        <input type="text" required="required" name="chatroom" class="form-control roomjid-input" placeholder="','"/>\n                    </div>\n                    ',"\n                    ",'\n                    <input type="submit" class="btn btn-primary" name="join" value="','" ?disabled=',">\n                </form>\n            </div>\n        </div>\n    </div>\n"]);return qd=function(){return e},e}function Ud(){const e=Hd(['\n    <div class="form-group" >\n        <label for="nickname">',':</label>\n        <input type="text" title="','" required="required" name="nickname" value="','" class="form-control"/>\n    </div>\n']);return Ud=function(){return e},e}function Hd(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const $d=ne("Join"),Wd=ne("Enter a new Groupchat"),Vd=ne("Nickname"),Gd=ne("This field is required");var Jd=e=>ho(qd(),Wd,Qs,e.label_room_address,e.muc_roomid_policy_error_msg?ho(Bd(),e.muc_roomid_policy_error_msg):"",e.chatroom_placeholder,e.muc_roomid_policy_hint?ho(Fd(),Sl(ia.a.filterXSS(e.muc_roomid_policy_hint,{whiteList:{b:[],br:[],em:[]}}))):"",e._converse.locked_muc_nickname?"":(e=>ho(Ud(),Vd,Gd,e.nick||""))(e),$d||"",e.muc_roomid_policy_error_msg);function Qd(){const e=Yd(['<div class="empty-history-feedback"><span>',"</span></div>"]);return Qd=function(){return e},e}function Kd(){const e=Yd(['\n    <div class="flyout box-flyout">\n        <div class="chat-head chat-head-chatroom row no-gutters"></div>\n        <div class="chat-body chatroom-body row no-gutters">\n            <div class="chat-area col">\n                <div class="chat-content ','" aria-live="polite">\n                    <div class="chat-content__messages">\n                        ','\n                    </div>\n                    <div class="chat-content__notifications"></div>\n                </div>\n                <div class="bottom-panel"></div>\n            </div>\n            <div class="disconnect-container hidden"></div>\n        </div>\n    </div>\n']);return Kd=function(){return e},e}function Yd(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const Xd=ne("No message history available.");var Zd=n(138),eh=n.n(Zd),th=n(139),nh=n.n(th),ih=n(140),rh=n.n(ih);function oh(e,t){const{element:{content:n},parts:i}=e,r=document.createTreeWalker(n,133,null,!1);let o=ah(i),s=i[o],a=-1,c=0;const l=[];let u=null;for(;r.nextNode();){a++;const e=r.currentNode;for(e.previousSibling===u&&(u=null),t.has(e)&&(l.push(e),null===u&&(u=e)),null!==u&&c++;void 0!==s&&s.index===a;)s.index=null!==u?-1:s.index-c,o=ah(i,o),s=i[o]}l.forEach(e=>e.parentNode.removeChild(e))}const sh=e=>{let t=11===e.nodeType?0:1;const n=document.createTreeWalker(e,133,null,!1);for(;n.nextNode();)t++;return t},ah=(e,t=-1)=>{for(let n=t+1;n<e.length;n++){const t=e[n];if(Hr(t))return n}return-1};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const ch=(e,t)=>`${e}--${t}`;let lh=!0;void 0===window.ShadyCSS?lh=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),lh=!1);const uh=e=>t=>{const n=ch(t.type,e);let i=co.get(n);void 0===i&&(i={stringsArray:new WeakMap,keyString:new Map},co.set(n,i));let r=i.stringsArray.get(t.strings);if(void 0!==r)return r;const o=t.strings.join(zr);if(r=i.keyString.get(o),void 0===r){const n=t.getTemplateElement();lh&&window.ShadyCSS.prepareTemplateDom(n,e),r=new qr(t,n),i.keyString.set(o,r)}return i.stringsArray.set(t.strings,r),r},dh=["html","svg"],hh=new Set,fh=(e,t,n)=>{hh.add(e);const i=n?n.element:document.createElement("template"),r=t.querySelectorAll("style"),{length:o}=r;if(0===o)return void window.ShadyCSS.prepareTemplateStyles(i,e);const s=document.createElement("style");for(let e=0;e<o;e++){const t=r[e];t.parentNode.removeChild(t),s.textContent+=t.textContent}(e=>{dh.forEach(t=>{const n=co.get(ch(t,e));void 0!==n&&n.keyString.forEach(e=>{const{element:{content:t}}=e,n=new Set;Array.from(t.querySelectorAll("style")).forEach(e=>{n.add(e)}),oh(e,n)})})})(e);const a=i.content;n?function(e,t,n=null){const{element:{content:i},parts:r}=e;if(null==n)return void i.appendChild(t);const o=document.createTreeWalker(i,133,null,!1);let s=ah(r),a=0,c=-1;for(;o.nextNode();){for(c++,o.currentNode===n&&(a=sh(t),n.parentNode.insertBefore(t,n));-1!==s&&r[s].index===c;){if(a>0){for(;-1!==s;)r[s].index+=a,s=ah(r,s);return}s=ah(r,s)}}}(n,s,a.firstChild):a.insertBefore(s,a.firstChild),window.ShadyCSS.prepareTemplateStyles(i,e);const c=a.querySelector("style");if(window.ShadyCSS.nativeShadow&&null!==c)t.insertBefore(c.cloneNode(!0),t.firstChild);else if(n){a.insertBefore(s,a.firstChild);const e=new Set;e.add(s),oh(n,e)}};window.JSCompiler_renameProperty=(e,t)=>e;const ph={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return null!==e;case Number:return null===e?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},gh=(e,t)=>t!==e&&(t==t||e==e),mh={attribute:!0,type:String,converter:ph,reflect:!1,hasChanged:gh};class vh extends HTMLElement{constructor(){super(),this._updateState=0,this._instanceProperties=void 0,this._updatePromise=new Promise(e=>this._enableUpdatingResolver=e),this._changedProperties=new Map,this._reflectingProperties=void 0,this.initialize()}static get observedAttributes(){this.finalize();const e=[];return this._classProperties.forEach((t,n)=>{const i=this._attributeNameForProperty(n,t);void 0!==i&&(this._attributeToPropertyMap.set(i,n),e.push(i))}),e}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const e=Object.getPrototypeOf(this)._classProperties;void 0!==e&&e.forEach((e,t)=>this._classProperties.set(t,e))}}static createProperty(e,t=mh){if(this._ensureClassProperties(),this._classProperties.set(e,t),t.noAccessor||this.prototype.hasOwnProperty(e))return;const n="symbol"==typeof e?Symbol():"__"+e,i=this.getPropertyDescriptor(e,n,t);void 0!==i&&Object.defineProperty(this.prototype,e,i)}static getPropertyDescriptor(e,t,n){return{get(){return this[t]},set(n){const i=this[e];this[t]=n,this._requestUpdate(e,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this._classProperties&&this._classProperties.get(e)||mh}static finalize(){const e=Object.getPrototypeOf(this);if(e.hasOwnProperty("finalized")||e.finalize(),this.finalized=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const e=this.properties,t=[...Object.getOwnPropertyNames(e),..."function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]];for(const n of t)this.createProperty(n,e[n])}}static _attributeNameForProperty(e,t){const n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}static _valueHasChanged(e,t,n=gh){return n(e,t)}static _propertyValueFromAttribute(e,t){const n=t.type,i=t.converter||ph,r="function"==typeof i?i:i.fromAttribute;return r?r(e,n):e}static _propertyValueToAttribute(e,t){if(void 0===t.reflect)return;const n=t.type,i=t.converter;return(i&&i.toAttribute||ph.toAttribute)(e,n)}initialize(){this._saveInstanceProperties(),this._requestUpdate()}_saveInstanceProperties(){this.constructor._classProperties.forEach((e,t)=>{if(this.hasOwnProperty(t)){const e=this[t];delete this[t],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(t,e)}})}_applyInstanceProperties(){this._instanceProperties.forEach((e,t)=>this[t]=e),this._instanceProperties=void 0}connectedCallback(){this.enableUpdating()}enableUpdating(){void 0!==this._enableUpdatingResolver&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(e,t,n){t!==n&&this._attributeToProperty(e,n)}_propertyToAttribute(e,t,n=mh){const i=this.constructor,r=i._attributeNameForProperty(e,n);if(void 0!==r){const e=i._propertyValueToAttribute(t,n);if(void 0===e)return;this._updateState=8|this._updateState,null==e?this.removeAttribute(r):this.setAttribute(r,e),this._updateState=-9&this._updateState}}_attributeToProperty(e,t){if(8&this._updateState)return;const n=this.constructor,i=n._attributeToPropertyMap.get(e);if(void 0!==i){const e=n.getPropertyOptions(i);this._updateState=16|this._updateState,this[i]=n._propertyValueFromAttribute(t,e),this._updateState=-17&this._updateState}}_requestUpdate(e,t){let n=!0;if(void 0!==e){const i=this.constructor,r=i.getPropertyOptions(e);i._valueHasChanged(this[e],t,r.hasChanged)?(this._changedProperties.has(e)||this._changedProperties.set(e,t),!0!==r.reflect||16&this._updateState||(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(e,r))):n=!1}!this._hasRequestedUpdate&&n&&(this._updatePromise=this._enqueueUpdate())}requestUpdate(e,t){return this._requestUpdate(e,t),this.updateComplete}async _enqueueUpdate(){this._updateState=4|this._updateState;try{await this._updatePromise}catch(e){}const e=this.performUpdate();return null!=e&&await e,!this._hasRequestedUpdate}get _hasRequestedUpdate(){return 4&this._updateState}get hasUpdated(){return 1&this._updateState}performUpdate(){this._instanceProperties&&this._applyInstanceProperties();let e=!1;const t=this._changedProperties;try{e=this.shouldUpdate(t),e?this.update(t):this._markUpdated()}catch(t){throw e=!1,this._markUpdated(),t}e&&(1&this._updateState||(this._updateState=1|this._updateState,this.firstUpdated(t)),this.updated(t))}_markUpdated(){this._changedProperties=new Map,this._updateState=-5&this._updateState}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this._updatePromise}shouldUpdate(e){return!0}update(e){void 0!==this._reflectingProperties&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach((e,t)=>this._propertyToAttribute(t,this[t],e)),this._reflectingProperties=void 0),this._markUpdated()}updated(e){}firstUpdated(e){}}vh.finalized=!0;
/**
@license
Copyright (c) 2019 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/
const _h="adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype;Symbol();
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
(window.litElementVersions||(window.litElementVersions=[])).push("2.3.1");const bh={};class yh extends vh{static getStyles(){return this.styles}static _getUniqueStyles(){if(this.hasOwnProperty(JSCompiler_renameProperty("_styles",this)))return;const e=this.getStyles();if(void 0===e)this._styles=[];else if(Array.isArray(e)){const t=(e,n)=>e.reduceRight((e,n)=>Array.isArray(n)?t(n,e):(e.add(n),e),n),n=t(e,new Set),i=[];n.forEach(e=>i.unshift(e)),this._styles=i}else this._styles=[e]}initialize(){super.initialize(),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow({mode:"open"})}adoptStyles(){const e=this.constructor._styles;0!==e.length&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow?_h?this.renderRoot.adoptedStyleSheets=e.map(e=>e.styleSheet):this._needsShimAdoptedStyleSheets=!0:window.ShadyCSS.ScopingShim.prepareAdoptedCssText(e.map(e=>e.cssText),this.localName))}connectedCallback(){super.connectedCallback(),this.hasUpdated&&void 0!==window.ShadyCSS&&window.ShadyCSS.styleElement(this)}update(e){const t=this.render();super.update(e),t!==bh&&this.constructor.render(t,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach(e=>{const t=document.createElement("style");t.textContent=e.cssText,this.renderRoot.appendChild(t)}))}render(){return bh}}yh.finalized=!0,yh.render=(e,t,n)=>{if(!n||"object"!=typeof n||!n.scopeName)throw new Error("The `scopeName` option is required.");const i=n.scopeName,r=lo.has(t),o=lh&&11===t.nodeType&&!!t.host,s=o&&!hh.has(i),a=s?document.createDocumentFragment():t;if(uo(e,a,Object.assign({templateFactory:uh(i)},n)),s){const e=lo.get(a);lo.delete(a);const n=e.value instanceof Vr?e.value.template:void 0;fh(i,a,n),Dr(t,t.firstChild),t.appendChild(a),lo.set(t,e)}!r&&o&&window.ShadyCSS.styleElement(t.host)};class wh extends yh{createRenderRoot(){return this}}function Sh(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n            <div class="dropleft">\n                <button type="button" class="btn btn--transparent btn--standalone" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                    <i class="fa fa-bars only-icon"></i>\n                </button>\n                <div class="dropdown-menu">\n                    ',"\n                </div>\n            </div>\n        "]);return Sh=function(){return e},e}const xh=zn.env.utils;class Eh extends wh{firstUpdated(){this.menu=this.querySelector(".dropdown-menu"),this.dropdown=this.firstElementChild,this.button=this.dropdown.querySelector("button"),this.dropdown.addEventListener("click",e=>this.toggleMenu(e)),this.dropdown.addEventListener("keyup",e=>this.handleKeyUp(e)),document.addEventListener("click",e=>!this.contains(e.target)&&this.hideMenu(e))}hideMenu(){xh.removeClass("show",this.menu),this.button.setAttribute("aria-expanded",!1),this.button.blur()}showMenu(){xh.addClass("show",this.menu),this.button.setAttribute("aria-expanded",!0)}toggleMenu(){xh.hasClass("show",this.menu)?this.hideMenu():this.showMenu()}handleKeyUp(e){e.keyCode===zn.keycodes.ESCAPE?this.hideMenu():e.keyCode!==zn.keycodes.DOWN_ARROW||this.navigator.enabled||this.enableArrowNavigation(e)}}function Ah(){const e=Th(['<p class="chat-head__desc" title="','">',"</p>"]);return Ah=function(){return e},e}function jh(){const e=Th(["<converse-dropdown .items=","></converse-dropdown>"]);return jh=function(){return e},e}function Ch(){const e=Th(['<i class="fa fa-bookmark chatbox-title__text--bookmarked" title="','"></i>']);return Ch=function(){return e},e}function kh(){const e=Th(['<div class="chatbox-navback"><i class="fa fa-arrow-left"></i></div>']);return kh=function(){return e},e}function Oh(){const e=Th(['\n        <div class="chatbox-title ','">\n            ','\n            <div class="chatbox-title__text" title="','">',"\n                ",'\n            </div>\n            <div class="chatbox-title__buttons row no-gutters">\n                ',"\n                ","\n            </div>\n        </div>\n        ","\n    "]);return Oh=function(){return e},e}function Th(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}window.customElements.define("converse-dropdown",class extends Eh{static get properties(){return{items:{type:Array}}}render(){return ho(Sh(),this.items.map(e=>Oa(e,"")))}hideMenu(){super.hideMenu(),this.navigator.disable()}firstUpdated(){super.firstUpdated(),this.initArrowNavigation()}initArrowNavigation(){if(!this.navigator){const e={selector:".dropdown-item",onSelected:e=>e.focus()};this.navigator=new yl(this.menu,e)}}enableArrowNavigation(e){e&&(e.preventDefault(),e.stopPropagation()),this.navigator.enable(),this.navigator.select(this.menu.firstElementChild)}handleKeyUp(e){super.handleKeyUp(),e.keyCode!==zn.keycodes.DOWN_ARROW||this.navigator.enabled||this.enableArrowNavigation(e)}});const Nh=zn.env.utils,Mh=ne("Hide the groupchat topic"),Ih=ne("This groupchat is bookmarked");var Rh=e=>{const t=e.subject?Nh.addHyperlinks(ia.a.filterXSS(e.subject.text,{whiteList:{}})):"",n=t&&!e.subject_hidden;return ho(Oh(),n?"":"chatbox-title--no-desc",e._converse.standalone?ho(kh()):"","hidden"!==e._converse.locked_muc_domain?e.jid:"",e.title,e.bookmarked?ho(Ch(),Ih):"",e.standalone_btns.length?(e=>e.standalone_btns.reverse().map(e=>Oa(e,"")))(e):"",e.dropdown_btns.length?ho(jh(),e.dropdown_btns):"",n?ho(Ah(),Mh,Sl(t)):"")},Dh=n(141),Ph=n.n(Dh);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const Lh=(e,t)=>{const n=e.startNode.parentNode,i=void 0===t?e.endNode:t.startNode,r=n.insertBefore($r(),i);n.insertBefore($r(),i);const o=new Zr(e.options);return o.insertAfterNode(r),o},zh=(e,t)=>(e.setValue(t),e.commit(),e),Fh=(e,t,n)=>{const i=e.startNode.parentNode,r=n?n.startNode:e.endNode,o=t.endNode.nextSibling;o!==r&&Rr(i,t.startNode,o,r)},Bh=e=>{Dr(e.startNode.parentNode,e.startNode,e.endNode.nextSibling)},qh=(e,t,n)=>{const i=new Map;for(let r=t;r<=n;r++)i.set(e[r],r);return i},Uh=new WeakMap,Hh=new WeakMap,$h=Nr((e,t,n)=>{let i;return void 0===n?n=t:void 0!==t&&(i=t),t=>{if(!(t instanceof Zr))throw new Error("repeat can only be used in text bindings");const r=Uh.get(t)||[],o=Hh.get(t)||[],s=[],a=[],c=[];let l,u,d=0;for(const t of e)c[d]=i?i(t,d):d,a[d]=n(t,d),d++;let h=0,f=r.length-1,p=0,g=a.length-1;for(;h<=f&&p<=g;)if(null===r[h])h++;else if(null===r[f])f--;else if(o[h]===c[p])s[p]=zh(r[h],a[p]),h++,p++;else if(o[f]===c[g])s[g]=zh(r[f],a[g]),f--,g--;else if(o[h]===c[g])s[g]=zh(r[h],a[g]),Fh(t,r[h],s[g+1]),h++,g--;else if(o[f]===c[p])s[p]=zh(r[f],a[p]),Fh(t,r[f],r[h]),f--,p++;else if(void 0===l&&(l=qh(c,p,g),u=qh(o,h,f)),l.has(o[h]))if(l.has(o[f])){const e=u.get(c[p]),n=void 0!==e?r[e]:null;if(null===n){const e=Lh(t,r[h]);zh(e,a[p]),s[p]=e}else s[p]=zh(n,a[p]),Fh(t,n,r[h]),r[e]=null;p++}else Bh(r[f]),f--;else Bh(r[h]),h++;for(;p<=g;){const e=Lh(t,s[g+1]);zh(e,a[p]),s[p++]=e}for(;h<=f;){const e=r[h++];null!==e&&Bh(e)}Uh.set(t,s),Hh.set(t,c)}});function Wh(){const e=Kh(['<li class="list-group-item active">',"</li>"]);return Wh=function(){return e},e}function Vh(){const e=Kh(['<li class="list-group-item"> '," </li>"]);return Vh=function(){return e},e}function Gh(){const e=Kh(['\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h5 class="modal-title" id="list-chatrooms-modal-label">',"</h5>\n                ",'\n            </div>\n            <div class="modal-body d-flex flex-column">\n                <span class="modal-alert"></span>\n                ','\n                <ul class="available-chatrooms list-group">\n                    ',"\n                    ","\n                    ",'\n                </ul>\n            </div>\n            <div class="modal-footer">',"</div>\n        </div>\n    </div>\n"]);return Gh=function(){return e},e}function Jh(){const e=Kh(['\n    <li class="room-item list-group-item">\n        <div class="available-chatroom d-flex flex-row">\n            <a class="open-room available-room w-100"\n               @click=','\n               data-room-jid="','"\n               data-room-name="','"\n               title="','"\n               href="#">','</a>\n            <a class="right room-info icon-room-info"\n               @click=','\n               data-room-jid="','"\n               title="','"\n               href="#"></a>\n        </div>\n    </li>\n']);return Jh=function(){return e},e}function Qh(){const e=Kh(['\n    <form class="converse-form list-chatrooms"\n          @submit=','>\n        <div class="form-group">\n            <label for="chatroom">',':</label>\n            <input type="text"\n                   @change=','\n                   value="','"\n                   required="required"\n                   name="server"\n                   class="form-control"\n                   placeholder="','"/>\n        </div>\n        <input type="submit" class="btn btn-primary" name="list" value="','"/>\n    </form>\n']);return Qh=function(){return e},e}function Kh(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const Yh=ne("Show more information on this groupchat"),Xh=ne("Query for Groupchats"),Zh=ne("Click to open this groupchat"),ef=ne("Show groupchats"),tf=ne("Server address");var nf=e=>ho(Gh(),Xh,Qs,e.show_form?(e=>ho(Qh(),e.submitForm,tf,e.setDomainFromEvent,e.muc_domain,e.server_placeholder,ef))(e):"",e.loading_items?ho(Vh(),Fc()):"",e.feedback_text?ho(Wh(),e.feedback_text):"",$h(e.items,e=>e.jid,t=>((e,t)=>ho(Jh(),e.openRoom,t.jid,t.name,Zh,t.name||t.jid,e.toggleRoomInfo,t.jid,Yh))(e,t)),Js);function rf(){const e=sf(['<p class="form-help">',"</p>"]);return rf=function(){return e},e}function of(){const e=sf(['\n    <form class="converse-form chatroom-form" autocomplete="off" @submit=','>\n        <fieldset class="form-group">\n            <legend>',"</legend>\n            ","\n            \x3c!-- Fields are generated internally, with xForm2webForm --\x3e\n            ",'\n        </fieldset>\n        <fieldset>\n            <input type="submit" class="btn btn-primary" value="','">\n            <input type="button" class="btn btn-secondary button-cancel" value="','" @click=',">\n        </fieldset>\n    </form>\n"]);return of=function(){return e},e}function sf(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const af=ne("Save"),cf=ne("Cancel");function lf(){const e=df(['<div class="error error-feedback">',"</div>"]);return lf=function(){return e},e}function uf(){const e=df(['\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h5 class="modal-title" id="add-chatroom-modal-label">',"</h5>\n                ",'\n            </div>\n            <div class="modal-body">\n                <span class="modal-alert"></span>\n                <div class="suggestion-box room-invite">\n                    <form @submit=','>\n                        <div class="form-group">\n                            <label class="clearfix" for="invitee_jids">',":</label>\n                            ",'\n                            <input class="form-control suggestion-box__input"\n                                   required="required"\n                                   name="invitee_jids"\n                                   id="invitee_jids"\n                                   placeholder="','"\n                                   type="text"/>\n                            <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span>\n                            <ul class="suggestion-box__results suggestion-box__results--below" hidden=""></ul>\n                        </div>\n                        <div class="form-group">\n                            <label>',':</label>\n                            <textarea class="form-control" name="reason"></textarea>\n                        </div>\n                        <div class="form-group">\n                            <button type="submit" class="btn btn-primary">',"</button>\n                        </div>\n                    </form>\n                </div>\n            </div>\n        </div>\n    </div>\n"]);return uf=function(){return e},e}function df(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const hf=ne("Invite"),ff=ne("Invite someone to this groupchat"),pf=ne("user@example.org"),gf=ne("Please enter a valid XMPP address"),mf=ne("XMPP Address"),vf=ne("Optional reason for the invitation");function _f(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n    <form class="converse-form chatroom-form converse-centered-form" @submit=','>\n        <fieldset class="form-group">\n            <label>','</label>\n            <p class="validation-message">','</p>\n            <input class="hidden-username" type="text" autocomplete="username" value="','"></input>\n            <input type="password"\n                   name="password"\n                   required="required"\n                   class="form-control ','"\n                   placeholder="','"/>\n        </fieldset>\n        <fieldset class="form-group">\n            <input class="btn btn-primary" type="submit" value="','"/>\n        </fieldset>\n    </form>\n']);return _f=function(){return e},e}const bf=ne("This groupchat requires a password"),yf=ne("Password: "),wf=ne("Submit");function Sf(){const e=kf(['<span class="badge badge-secondary">',"</span>"]);return Sf=function(){return e},e}function xf(){const e=kf(['<span class="badge badge-info">',"</span>"]);return xf=function(){return e},e}function Ef(){const e=kf(['<span class="badge badge-info">',"</span>"]);return Ef=function(){return e},e}function Af(){const e=kf(['<span class="badge badge-info">',"</span>"]);return Af=function(){return e},e}function jf(){const e=kf(['<span class="badge badge-groupchat">',"</span>"]);return jf=function(){return e},e}function Cf(){const e=kf(['\n    <li class="occupant" id="','" title="','">\n        <div class="row no-gutters">\n            <div class="col-auto">\n                <div class="occupant-status occupant-',' circle" title="','"></div>\n            </div>\n            <div class="col occupant-nick-badge">\n                <span class="occupant-nick">','</span>\n                <span class="occupant-badges">\n                    ',"\n                    ","\n                    ","\n                    ","\n                    ","\n                </span>\n            </div>\n        </div>\n    </li>\n"]);return Cf=function(){return e},e}function kf(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const Of=ne("This user is a moderator."),Tf=ne("This user can send messages in this groupchat."),Nf=ne("This user can NOT send messages in this groupchat."),Mf=ne("Owner"),If=ne("Admin"),Rf=ne("Member"),Df=ne("Moderator"),Pf=ne("Visitor");var Lf=e=>ho(Cf(),e.id,(e=>"moderator"===e.role?"".concat(e.jid," ").concat(Of," ").concat(e.hint_occupant):"participant"===e.role?"".concat(e.jid," ").concat(Tf," ").concat(e.hint_occupant):"visitor"===e.role?"".concat(e.jid," ").concat(Nf," ").concat(e.hint_occupant):["visitor","participant","moderator"].includes(e.role)?void 0:"".concat(e.jid," ").concat(e.hint_occupant))(e),e.show,e.hint_show,e.nick||e.jid,"owner"===e.affiliation?ho(jf(),Mf):"","admin"===e.affiliation?ho(Af(),If):"","member"===e.affiliation?ho(Ef(),Rf):"","moderator"===e.role?ho(xf(),Df):"","visitor"===e.role?ho(Sf(),Pf):"");function zf(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n    <div class="occupants-header">\n        <i class="hide-occupants fa fa-times"></i>\n        <div class="occupants-header--title">\n            <span class="occupants-heading">','</span>\n        </div>\n    </div>\n    <div class="dragresize dragresize-occupants-left"></div>\n    <ul class="occupant-list">\n        ',"\n    </ul>\n"]);return zf=function(){return e},e}const Ff={offline:"Offline",unavailable:"Unavailable",xa:"Extended Away",away:"Away",dnd:"Do not disturb",chat:"Chattty",online:"Online"},Bf=e=>ne("Click to mention %1$s in your message.",e.get("nick")),qf=ne("Participants");var Uf=n(142),Hf=n.n(Uf),$f=n(143),Wf=n.n($f);
/**
 * @module converse-muc-views
 * @copyright 2020, the Converse.js contributors
 * @description XEP-0045 Multi-User Chat Views
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:Vf,sizzle:Gf,$iq:Jf,$pres:Qf}=zn.env,Kf=zn.env.utils,Yf=["owner"],Xf=["admin","ban","deop","destroy","member","op","revoke"],Zf=["kick","mute","voice","modtools"],ep=["nick"],tp={deop:"participant",kick:"none",mute:"visitor",op:"moderator",voice:"participant"},np={admin:"admin",ban:"outcast",member:"member",owner:"owner",revoke:"none"};function ip(){const e=op(['\n    <div class="list-container list-container--headline ','">\n        <div class="items-list rooms-list headline-list">\n            ',"\n        </div>\n    </div>\n"]);return ip=function(){return e},e}function rp(){const e=op(['\n    <div class="list-item controlbox-padded d-flex flex-row"\n        data-headline-jid="','">\n    <a class="list-item-link open-headline available-room w-100"\n        data-headline-jid="','"\n        title="','" href="#">',"</a>\n    </div>\n"]);return rp=function(){return e},e}function op(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}zn.plugins.add("converse-muc-views",{dependencies:["converse-autocomplete","converse-modal","converse-controlbox","converse-chatview"],overrides:{ControlBoxView:{renderControlBoxPane(){const{_converse:e}=this.__super__;this.__super__.renderControlBoxPane.apply(this,arguments),e.allow_muc&&this.renderRoomsPanel()}}},initialize(){const{_converse:e}=this;xn.promises.add(["roomsPanelRendered"]),xn.settings.update({auto_list_rooms:!1,cache_muc_messages:!0,locked_muc_nickname:!1,modtools_disable_query:[],modtools_disable_assign:!1,muc_disable_slash_commands:!1,muc_mention_autocomplete_filter:"contains",muc_mention_autocomplete_min_chars:0,muc_mention_autocomplete_show_avatar:!0,muc_roomid_policy:null,muc_roomid_policy_hint:null,roomconfig_whitelist:[],show_retraction_warning:!0,visible_toolbar_buttons:{toggle_occupants:!0}});const t={renderRoomsPanel(){if(this.roomspanel&&Kf.isInDOM(this.roomspanel.el))return this.roomspanel;const t="converse.roomspanel".concat(e.bare_jid);return this.roomspanel=new e.RoomsPanel({model:new(e.RoomsPanelModel.extend({id:t,browserStorage:e.createStore(t)}))}),this.roomspanel.model.fetch(),this.el.querySelector(".controlbox-pane").insertAdjacentElement("beforeEnd",this.roomspanel.render().el),xn.trigger("roomsPanelRendered"),this.roomspanel},getRoomsPanel(){return this.roomspanel&&Kf.isInDOM(this.roomspanel.el)?this.roomspanel:this.renderRoomsPanel()}};function n(e){const t=Kf.ancestor(e.target,".room-item"),n=t.querySelector("div.room-info");n?(Kf.slideIn(n).then(Kf.removeElement),t.querySelector("a.room-info").classList.remove("selected")):(t.insertAdjacentHTML("beforeend",ta()()),xn.disco.info(e.target.getAttribute("data-room-jid"),null).then(e=>function(e,t){var n,i;e.querySelector("span.spinner").remove(),e.querySelector("a.room-info").classList.add("selected"),e.insertAdjacentHTML("beforeEnd",Hf()({jid:t.getAttribute("from"),desc:null===(n=Object(lr.head)(Gf('field[var="muc#roominfo_description"] value',t)))||void 0===n?void 0:n.textContent,occ:null===(i=Object(lr.head)(Gf('field[var="muc#roominfo_occupants"] value',t)))||void 0===i?void 0:i.textContent,hidden:Gf('feature[var="muc_hidden"]',t).length,membersonly:Gf('feature[var="muc_membersonly"]',t).length,moderated:Gf('feature[var="muc_moderated"]',t).length,nonanonymous:Gf('feature[var="muc_nonanonymous"]',t).length,open:Gf('feature[var="muc_open"]',t).length,passwordprotected:Gf('feature[var="muc_passwordprotected"]',t).length,persistent:Gf('feature[var="muc_persistent"]',t).length,publicroom:Gf('feature[var="muc_publicroom"]',t).length,semianonymous:Gf('feature[var="muc_semianonymous"]',t).length,temporary:Gf('feature[var="muc_temporary"]',t).length,unmoderated:Gf('feature[var="muc_unmoderated"]',t).length,label_desc:ne("Description:"),label_jid:ne("Groupchat Address (JID):"),label_occ:ne("Participants:"),label_features:ne("Features:"),label_requires_auth:ne("Requires authentication"),label_hidden:ne("Hidden"),label_requires_invite:ne("Requires an invitation"),label_moderated:ne("Moderated"),label_non_anon:ne("Non-anonymous"),label_open_room:ne("Open"),label_permanent_room:ne("Permanent"),label_public:ne("Public"),label_semi_anon:ne("Semi-anonymous"),label_temp_room:ne("Temporary"),label_unmoderated:ne("Unmoderated")}))}(t,e)).catch(e=>st.error(e)))}function i(e,t){t.getRoomsPanel().model.save("muc_domain",Vf.getDomainFromJid(e))}function r(t){t.model.get("connected")&&(t.getRoomsPanel().model.get("muc_domain")||(void 0===e.muc_domain?function(t){function n(e){e&&e.get("var")===Vf.NS.MUC&&e.entity.getIdentity("conference","text").then(n=>{n&&i(e.get("from"),t)})}xn.waitUntil("discoInitialized").then(()=>{xn.listen.on("serviceDiscovered",n),e.disco_entities.each(e=>n(e.features.findWhere({var:Vf.NS.MUC})))}).catch(e=>st.error(e))}(t):i(e.muc_domain,t)))}e.ControlBoxView&&Object.assign(e.ControlBoxView.prototype,t),e.ListChatRoomsModal=ya.extend({id:"list-chatrooms-modal",initialize(){this.items=[],this.loading_items=!1,ya.prototype.initialize.apply(this,arguments),e.muc_domain&&!this.model.get("muc_domain")&&this.model.save("muc_domain",e.muc_domain),this.listenTo(this.model,"change:muc_domain",this.onDomainChange)},toHTML(){const t=this.model.get("muc_domain")||e.muc_domain;return nf(Object.assign(this.model.toJSON(),{show_form:!e.locked_muc_domain,server_placeholder:t||ne("conference.example.org"),items:this.items,loading_items:this.loading_items,openRoom:e=>this.openRoom(e),setDomainFromEvent:e=>this.setDomainFromEvent(e),submitForm:e=>this.showRooms(e),toggleRoomInfo:e=>this.toggleRoomInfo(e)}))},afterRender(){e.locked_muc_domain?this.updateRoomsList():this.el.addEventListener("shown.bs.modal",()=>this.el.querySelector('input[name="server"]').focus(),!1)},openRoom(e){e.preventDefault();const t=e.target.getAttribute("data-room-jid"),n=e.target.getAttribute("data-room-name");this.modal.hide(),xn.rooms.open(t,{name:n},!0)},toggleRoomInfo(e){e.preventDefault(),n(e)},onDomainChange(){e.auto_list_rooms&&this.updateRoomsList()},onRoomsFound(e){this.loading_items=!1;const t=e?Gf("query item",e):[];return t.length?(this.model.set({feedback_text:ne("Groupchats found")},{silent:!0}),this.items=t.map(cn.getAttributes)):(this.items=[],this.model.set({feedback_text:ne("No groupchats found")},{silent:!0})),this.render(),!0},updateRoomsList(){const t=Jf({to:this.model.get("muc_domain"),from:e.connection.jid,type:"get"}).c("query",{xmlns:Vf.NS.DISCO_ITEMS});xn.sendIQ(t).then(e=>this.onRoomsFound(e)).catch(()=>this.onRoomsFound())},showRooms(e){e.preventDefault(),this.loading_items=!0,this.render();const t=new FormData(e.target);this.model.setDomain(t.get("server")),this.updateRoomsList()},setDomainFromEvent(e){this.model.setDomain(e.target.value)},setNick(e){this.model.save({nick:e.target.value})}}),e.AddChatRoomModal=ya.extend({id:"add-chatroom-modal",events:{"submit form.add-chatroom":"openChatRoom","keyup .roomjid-input":"checkRoomidPolicy","change .roomjid-input":"checkRoomidPolicy"},initialize(){ya.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:muc_domain",this.render),this.muc_roomid_policy_error_msg=null},toHTML(){let t="";if(!e.locked_muc_domain){const n=this.model.get("muc_domain")||e.muc_domain;t=n?"name@".concat(n):ne("name@conference.example.org")}return Jd(Object.assign(this.model.toJSON(),{_converse:e,label_room_address:e.muc_domain?ne("Groupchat name"):ne("Groupchat address"),chatroom_placeholder:t,muc_roomid_policy_error_msg:this.muc_roomid_policy_error_msg,muc_roomid_policy_hint:e.muc_roomid_policy_hint}))},afterRender(){this.el.addEventListener("shown.bs.modal",()=>{this.el.querySelector('input[name="chatroom"]').focus()},!1)},parseRoomDataFromEvent(t){const n=new FormData(t),i=n.get("chatroom");let r;if(e.locked_muc_nickname){if(r=e.getDefaultMUCNickname(),!r)throw new Error("Using locked_muc_nickname but no nickname found!")}else r=n.get("nickname").trim();return{jid:i,nick:r}},openChatRoom(t){t.preventDefault();const n=this.parseRoomDataFromEvent(t.target);let i;""===n.nick&&(n.nick=void 0),e.locked_muc_domain||e.muc_domain&&!Kf.isValidJID(n.jid)?i="".concat(Vf.escapeNode(n.jid),"@").concat(e.muc_domain):(i=n.jid,this.model.setDomain(i)),xn.rooms.open(i,Object.assign(n,{jid:i}),!0),this.modal.hide(),t.target.reset()},checkRoomidPolicy(){if(e.muc_roomid_policy&&e.muc_domain){let t=this.el.querySelector(".roomjid-input").value;!zn.locked_muc_domain&&Kf.isValidJID(t)||(t="".concat(Vf.escapeNode(t),"@").concat(e.muc_domain));const n=Vf.getNodeFromJid(t),i=Vf.getDomainFromJid(t);e.muc_domain!==i||e.muc_roomid_policy.test(n)?this.muc_roomid_policy_error_msg=null:this.muc_roomid_policy_error_msg=ne("Groupchat id is invalid."),this.render()}}}),e.ChatRoomView=e.ChatBoxView.extend({length:300,tagName:"div",className:"chatbox chatroom hidden",is_chatroom:!0,events:{"change input.fileupload":"onFileSelection","click .chat-msg__action-edit":"onMessageEditButtonClicked","click .chat-msg__action-retract":"onMessageRetractButtonClicked","click .chatbox-navback":"showControlBox","click .hide-occupants":"hideOccupants","click .new-msgs-indicator":"viewUnreadMessages","click .occupant-nick":function(e){this.insertIntoTextArea(e.target.textContent)},"click .send-button":"onFormSubmitted","click .toggle-call":"toggleCall","click .toggle-occupants":"toggleOccupants","click .upload-file":"toggleFileUpload","dragover .chat-textarea":"onDragOver","drop .chat-textarea":"onDrop","input .chat-textarea":"inputChanged","keydown .chat-textarea":"onKeyDown","keyup .chat-textarea":"onKeyUp","mousedown .dragresize-occupants-left":"onStartResizeOccupants","paste .chat-textarea":"onPaste","submit .muc-nickname-form":"submitNickname"},async initialize(){this.initDebounced(),this.listenTo(this.model.messages,"add",this.onMessageAdded),this.listenTo(this.model.messages,"change:edited",this.onMessageEdited),this.listenTo(this.model.messages,"rendered",this.scrollDown),this.model.messages.on("reset",()=>{this.msgs_container.innerHTML="",this.removeAll()}),this.listenTo(this.model.session,"change:connection_status",this.onConnectionStatusChanged),this.listenTo(this.model,"change",Object(lr.debounce)(()=>this.renderHeading(),250)),this.listenTo(this.model,"change:hidden_occupants",this.updateOccupantsToggle),this.listenTo(this.model,"configurationNeeded",this.getAndRenderConfigurationForm),this.listenTo(this.model,"destroy",this.hide),this.listenTo(this.model,"show",this.show),this.listenTo(this.model.features,"change:moderated",this.renderBottomPanel),this.listenTo(this.model.features,"change:open",this.renderHeading),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),await this.render(),this.model.occupants.forEach(e=>this.onOccupantAdded(e)),this.listenTo(this.model.occupants,"add",this.onOccupantAdded),this.listenTo(this.model.occupants,"remove",this.onOccupantRemoved),this.listenTo(this.model.occupants,"change:show",this.showJoinOrLeaveNotification),this.listenTo(this.model.occupants,"change:role",this.onOccupantRoleChanged),this.listenTo(this.model.occupants,"change:affiliation",this.onOccupantAffiliationChanged),this.listenTo(this.model.notifications,"change",this.renderNotifications),this.createSidebarView(),await this.updateAfterMessagesFetched();const t=await e.api.user.settings.getModel();this.listenTo(t,"change:mucs_with_hidden_subject",this.renderHeading),this.onConnectionStatusChanged(),this.model.maybeShow(),xn.trigger("chatRoomViewInitialized",this)},async render(){var t;this.el.setAttribute("id",this.model.get("box_id")),uo((t={muc_show_logs_before_join:e.muc_show_logs_before_join,show_send_button:e.show_send_button},ho(Kd(),t.show_send_button?"chat-content-sendbutton":"",t.muc_show_logs_before_join?ho(Qd(),Xd):"")),this.el),this.notifications=this.el.querySelector(".chat-content__notifications"),this.content=this.el.querySelector(".chat-content"),this.msgs_container=this.el.querySelector(".chat-content__messages"),this.renderBottomPanel(),e.muc_show_logs_before_join||this.model.session.get("connection_status")===zn.ROOMSTATUS.ENTERED||this.showSpinner(),await this.renderHeading(),!this.model.get("hidden")&&this.show()},renderNotifications(){const t=this.model.notifications.toJSON(),n=(xn.settings.get("muc_show_join_leave")?[...zn.CHAT_STATES,...zn.MUC_TRAFFIC_STATES,...zn.MUC_ROLE_CHANGES]:zn.CHAT_STATES).reduce((n,i)=>{const r=t[i];if(!(null==r?void 0:r.length))return n;const o=r.map(e=>{var t;return(null===(t=this.model.getOccupant(e))||void 0===t?void 0:t.getDisplayName())||e});if(1===o.length){if("composing"===i)return"".concat(n).concat(ne("%1$s is typing",o[0]),"\n");if("paused"===i)return"".concat(n).concat(ne("%1$s has stopped typing",o[0]),"\n");if(i===e.GONE)return"".concat(n).concat(ne("%1$s has gone away",o[0]),"\n");if("entered"===i)return"".concat(n).concat(ne("%1$s has entered the groupchat",o[0]),"\n");if("exited"===i)return"".concat(n).concat(ne("%1$s has left the groupchat",o[0]),"\n");if("op"===i)return"".concat(n).concat(ne("%1$s is now a moderator",o[0]),"\n");if("deop"===i)return"".concat(n).concat(ne("%1$s is no longer a moderator",o[0]),"\n");if("voice"===i)return"".concat(n).concat(ne("%1$s has been given a voice",o[0]),"\n");if("mute"===i)return"".concat(n).concat(ne("%1$s has been muted",o[0]),"\n")}else if(o.length>1){let t;if(o.length>3)t="".concat(Array.from(o).slice(0,2).join(", ")," and others");else{const e=o.pop();t=ne("%1$s and %2$s",o.join(", "),e)}if("composing"===i)return"".concat(n).concat(ne("%1$s are typing",t),"\n");if("paused"===i)return"".concat(n).concat(ne("%1$s have stopped typing",t),"\n");if(i===e.GONE)return"".concat(n).concat(ne("%1$s have gone away",t),"\n");if("entered"===i)return"".concat(n).concat(ne("%1$s have entered the groupchat",t),"\n");if("exited"===i)return"".concat(n).concat(ne("%1$s have left the groupchat",t),"\n");if("op"===i)return"".concat(n).concat(ne("%1$s are now moderators",o[0]),"\n");if("deop"===i)return"".concat(n).concat(ne("%1$s are no longer moderator",o[0]),"\n");if("voice"===i)return"".concat(n).concat(ne("%1$s have been given voices",o[0]),"\n");if("mute"===i)return"".concat(n).concat(ne("%1$s have been muted",o[0]),"\n")}return n},"");this.notifications.innerHTML=n,n.includes("\n")&&this.scrollDown()},async renderHeading(){const e=await this.generateHeadingTemplate();uo(e,this.el.querySelector(".chat-head-chatroom"))},renderBottomPanel(){const e=this.el.querySelector(".bottom-panel"),t=this.model.session.get("connection_status")===zn.ROOMSTATUS.ENTERED,n=t&&!(this.model.features.get("moderated")&&"visitor"===this.model.getOwnRole());e.innerHTML=eh()({__:ne,can_edit:n,entered:t}),t&&n&&(this.renderMessageForm(),this.initMentionAutoComplete())},createSidebarView(){this.model.occupants.chatroomview=this,this.sidebar_view=new e.MUCSidebar({model:this.model.occupants});const t=this.el.querySelector(".chatroom-body"),n=this.model.get("occupants_width");this.sidebar_view&&void 0!==n&&(this.sidebar_view.el.style.flex="0 0 "+n+"px"),t.insertAdjacentElement("beforeend",this.sidebar_view.el)},onStartResizeOccupants(e){this.resizing=!0,this.el.addEventListener("mousemove",this.onMouseMove),this.el.addEventListener("mouseup",this.onMouseUp);const t=window.getComputedStyle(this.sidebar_view.el);this.width=parseInt(t.width.replace(/px$/,""),10),this.prev_pageX=e.pageX},onMouseMove(e){if(this.resizing){e.preventDefault();const t=this.prev_pageX-e.pageX;this.resizeSidebarView(t,e.pageX),this.prev_pageX=e.pageX}},onMouseUp(t){if(this.resizing){t.preventDefault(),this.resizing=!1,this.el.removeEventListener("mousemove",this.onMouseMove),this.el.removeEventListener("mouseup",this.onMouseUp);const n=this.sidebar_view.el.getBoundingClientRect(),i={occupants_width:this.calculateSidebarWidth(n,0)};e.connection.connected?this.model.save(i):this.model.set(i)}},resizeSidebarView(e,t){const n=this.sidebar_view.el.getBoundingClientRect();if(this.is_minimum)this.is_minimum=n.left<t;else if(this.is_maximum)this.is_maximum=n.left>t;else{const t=this.calculateSidebarWidth(n,e);this.sidebar_view.el.style.flex="0 0 "+t+"px"}},calculateSidebarWidth(e,t){let n=e.width+t;const i=this.el.clientWidth;return n<.2*i?(n=.2*i,this.is_minimum=!0):n>.75*i?(n=.75*i,this.is_maximum=!0):i-n<250?(n=i-250,this.is_maximum=!0):(this.is_maximum=!1,this.is_minimum=!1),n},getAutoCompleteList(){return this.model.getAllKnownNicknames().map(e=>({label:e,value:"@".concat(e)}))},getAutoCompleteListItem(t,n){n=n.trim();const i=document.createElement("li");if(i.setAttribute("aria-selected","false"),e.muc_mention_autocomplete_show_avatar){const n=document.createElement("img");let r="data:"+e.DEFAULT_IMAGE_TYPE+";base64,"+e.DEFAULT_IMAGE;if(e.vcards){const n=e.vcards.findWhere({nickname:t});n&&(r="data:"+n.get("image_type")+";base64,"+n.get("image"))}n.setAttribute("src",r),n.setAttribute("width","22"),n.setAttribute("class","avatar avatar-autocomplete"),i.appendChild(n)}const r=new RegExp("("+n+")","ig");return(n?t.split(r):[t]).forEach(e=>{if(n&&e.match(r)){const t=document.createElement("mark");t.textContent=e,i.appendChild(t)}else i.appendChild(document.createTextNode(e))}),i},initMentionAutoComplete(){this.mention_auto_complete=new e.AutoComplete(this.el,{auto_first:!0,auto_evaluate:!1,min_chars:e.muc_mention_autocomplete_min_chars,match_current_word:!0,list:()=>this.getAutoCompleteList(),filter:"contains"==e.muc_mention_autocomplete_filter?e.FILTER_CONTAINS:e.FILTER_STARTSWITH,ac_triggers:["Tab","@"],include_triggers:[],item:this.getAutoCompleteListItem}),this.mention_auto_complete.on("suggestion-box-selectcomplete",()=>this.auto_completing=!1)},submitNickname(e){e.preventDefault();const t=e.target.nick.value.trim();t&&this.model.join(t)},onKeyDown(t){if(!this.mention_auto_complete.onKeyDown(t))return e.ChatBoxView.prototype.onKeyDown.call(this,t)},onKeyUp(t){return this.mention_auto_complete.evaluate(t),e.ChatBoxView.prototype.onKeyUp.call(this,t)},async onMessageRetractButtonClicked(t){t.preventDefault();const n=Kf.ancestor(t.target,".message"),i=n.getAttribute("data-msgid"),r=n.getAttribute("data-isodate"),o=this.model.messages.findWhere({msgid:i,time:r}),s=ne("Be aware that other XMPP/Jabber clients (and servers) may not yet support retractions and that this message may not be removed everywhere.");if(o.mayBeRetracted()){const t=[ne("Are you sure you want to retract this message?")];e.show_retraction_warning&&(t[1]=s),await xn.confirm(ne("Confirm"),t)&&this.retractOwnMessage(o)}else if(await o.mayBeModerated())if("me"===o.get("sender")){let t=[ne("Are you sure you want to retract this message?")];e.show_retraction_warning&&(t=[t[0],s,t[1]]),await xn.confirm(ne("Confirm"),t)&&this.retractOtherMessage(o)}else{let t=[ne("You are about to retract this message."),ne("You may optionally include a message, explaining the reason for the retraction.")];e.show_retraction_warning&&(t=[t[0],s,t[1]]);const n=await xn.prompt(ne("Message Retraction"),t,ne("Optional reason"));!1!==n&&this.retractOtherMessage(o,n)}else{const e=ne("Sorry, you're not allowed to retract this message");xn.alert("error",ne("Error"),e)}},retractOwnMessage(e){this.model.retractOwnMessage(e).catch(e=>{const t=ne("Sorry, something went wrong while trying to retract your message.");this.model.createMessage({message:t,type:"error"}),!Kf.isErrorStanza(e)&&this.model.createMessage({message:e.message,type:"error"}),st.error(e)})},async retractOtherMessage(e,t){const n=await this.model.retractOtherMessage(e,t);if(null===n){const e=ne("A timeout occurred while trying to retract the message");xn.alert("error",ne("Error"),e),st(e,Vf.LogLevel.WARN)}else if(Kf.isErrorStanza(n)){const e=ne("Sorry, you're not allowed to retract this message.");xn.alert("error",ne("Error"),e),st(e,Vf.LogLevel.WARN),st(n,Vf.LogLevel.WARN)}},showModeratorToolsModal(t){if(this.verifyRoles(["moderator"])){if(Object(lr.isUndefined)(this.model.modtools_modal)){const n=new Do({affiliation:t});this.modtools_modal=new Uu({model:n,_converse:e,chatroomview:this})}else this.modtools_modal.set("affiliation",t);this.modtools_modal.show()}},showRoomDetailsModal(e){e.preventDefault(),void 0===this.model.room_details_modal&&(this.model.room_details_modal=new zd({model:this.model})),this.model.room_details_modal.show(e)},showChatStateNotification(t){if("me"!==t.get("sender"))return e.ChatBoxView.prototype.showChatStateNotification.apply(this,arguments)},onOccupantAffiliationChanged(t){t.get("jid")===e.bare_jid&&this.renderHeading()},onOccupantRoleChanged(t){t.get("jid")===e.bare_jid&&this.renderBottomPanel()},getHeadingButtons(t){const n=[];n.push({i18n_text:ne("Details"),i18n_title:ne("Show more information about this groupchat"),handler:e=>this.showRoomDetailsModal(e),a_class:"show-room-details-modal",icon_class:"fa-info-circle",name:"details"}),"owner"===this.model.getOwnAffiliation()&&n.push({i18n_text:ne("Configure"),i18n_title:ne("Configure this groupchat"),handler:e=>this.getAndRenderConfigurationForm(e),a_class:"configure-chatroom-button",icon_class:"fa-wrench",name:"configure"}),this.model.invitesAllowed()&&n.push({i18n_text:ne("Invite"),i18n_title:ne("Invite someone to join this groupchat"),handler:e=>this.showInviteModal(e),a_class:"open-invite-modal",icon_class:"fa-user-plus",name:"invite"});const i=this.model.get("subject");if(i&&i.text&&n.push({i18n_text:ne(t?"Show topic":"Hide topic"),i18n_title:ne(t?"Show the topic message in the heading":"Hide the topic in the heading"),handler:e=>this.toggleTopic(e),a_class:"hide-topic",icon_class:"fa-minus-square",name:"toggle-topic"}),this.model.session.get("connection_status")===zn.ROOMSTATUS.ENTERED){const e=this.getAllowedCommands();e.includes("modtools")&&n.push({i18n_text:ne("Moderate"),i18n_title:ne("Moderate this groupchat"),handler:()=>this.showModeratorToolsModal(),a_class:"moderate-chatroom-button",icon_class:"fa-user-cog",name:"moderate"}),e.includes("destroy")&&n.push({i18n_text:ne("Destroy"),i18n_title:ne("Remove this groupchat"),handler:e=>this.destroy(e),a_class:"destroy-chatroom-button",icon_class:"fa-trash",name:"destroy"})}return xn.settings.get("singleton")||n.push({i18n_text:ne("Leave"),i18n_title:ne("Leave and close this groupchat"),handler:async e=>{const t=[ne("Are you sure you want to leave this groupchat?")];await xn.confirm(ne("Confirm"),t)&&this.close(e)},a_class:"close-chatbox-button",standalone:"overlayed"===xn.settings.get("view_mode"),icon_class:"fa-sign-out-alt",name:"signout"}),e.api.hook("getHeadingButtons",this,n)},async generateHeadingTemplate(){const t=await this.model.isSubjectHidden(),n=await this.getHeadingButtons(t),i=n.filter(e=>e.standalone),r=n.filter(e=>!e.standalone);return Rh(Object.assign(this.model.toJSON(),{_converse:e,subject_hidden:t,dropdown_btns:r.map(e=>this.getHeadingDropdownItem(e)),standalone_btns:i.map(e=>this.getHeadingStandaloneButton(e)),title:this.model.getDisplayName()}))},toggleTopic(){this.model.toggleSubjectHiddenState()},showInviteModal(t){t.preventDefault(),void 0===this.muc_invite_modal&&(this.muc_invite_modal=new e.MUCInviteModal({model:new Do}),this.muc_invite_modal.chatroomview=this),this.muc_invite_modal.show(t)},afterShown(){Kf.isPersistableModel(this.model)&&this.model.clearUnreadMsgCounter(),this.scrollDown()},onConnectionStatusChanged(){const e=this.model.session.get("connection_status");e===zn.ROOMSTATUS.NICKNAME_REQUIRED?this.renderNicknameForm():e===zn.ROOMSTATUS.PASSWORD_REQUIRED?this.renderPasswordForm():e===zn.ROOMSTATUS.CONNECTING?this.showSpinner():e===zn.ROOMSTATUS.ENTERED?(this.renderBottomPanel(),this.hideSpinner(),this.maybeFocus()):e===zn.ROOMSTATUS.DISCONNECTED?this.showDisconnectMessage():e===zn.ROOMSTATUS.DESTROYED&&this.showDestroyedMessage()},getToolbarOptions(){return Object.assign(e.ChatBoxView.prototype.getToolbarOptions.apply(this,arguments),{label_hide_occupants:ne("Hide the list of participants"),show_occupants_toggle:e.visible_toolbar_buttons.toggle_occupants})},async close(){return this.hide(),e.router.history.getFragment()==="converse/room?jid="+this.model.get("jid")&&e.router.navigate(""),await this.model.leave(),e.ChatBoxView.prototype.close.apply(this,arguments)},updateOccupantsToggle(){const e=this.el.querySelector(".toggle-occupants"),t=this.el.querySelector(".chat-area");this.model.get("hidden_occupants")?(Kf.removeClass("fa-angle-double-right",e),Kf.addClass("fa-angle-double-left",e),Kf.addClass("full",t)):(Kf.addClass("fa-angle-double-right",e),Kf.removeClass("fa-angle-double-left",e),Kf.removeClass("full",t))},hideOccupants(e){e&&(e.preventDefault(),e.stopPropagation()),this.model.save({hidden_occupants:!0}),this.scrollDown()},toggleOccupants(e){e&&(e.preventDefault(),e.stopPropagation()),this.model.save({hidden_occupants:!this.model.get("hidden_occupants")}),this.scrollDown()},verifyRoles(t,n,i=!0){if(!Array.isArray(t))throw new TypeError("roles must be an Array");if(!t.length)return!0;if(n=n||this.model.occupants.findWhere({jid:e.bare_jid})){const e=n.get("role");if(t.includes(e))return!0}if(i){const e=ne("Forbidden: you do not have the necessary role in order to do that.");this.model.createMessage({message:e,type:"error"})}return!1},verifyAffiliations(t,n,i=!0){if(!Array.isArray(t))throw new TypeError("affiliations must be an Array");if(!t.length)return!0;if(n=n||this.model.occupants.findWhere({jid:e.bare_jid})){const e=n.get("affiliation");if(t.includes(e))return!0}if(i){const e=ne("Forbidden: you do not have the necessary affiliation in order to do that.");this.model.createMessage({message:e,type:"error"})}return!1},validateRoleOrAffiliationChangeArgs(e,t){if(!t){const t=ne('Error: the "%1$s" command takes two arguments, the user\'s nickname and optionally a reason.',e);return this.model.createMessage({message:t,type:"error"}),!1}return!0},getNickOrJIDFromCommandArgs(e){if(Kf.isValidJID(e.trim()))return e.trim();e.startsWith("@")||(e="@"+e);const[t,n]=this.model.parseTextForReferences(e);if(!n.length){const e=ne("Error: couldn't find a groupchat participant based on your arguments");return void this.model.createMessage({message:e,type:"error"})}if(n.length>1){const e=ne("Error: found multiple groupchat participant based on your arguments");return void this.model.createMessage({message:e,type:"error"})}const i=n.pop().value,r=e.split(i,2)[1];if(!r||r.startsWith(" "))return i;{const e=ne("Error: couldn't find a groupchat participant based on your arguments");this.model.createMessage({message:e,type:"error"})}},setAffiliation(t,n,i){const r=np[t];if(!r)throw Error("ChatRoomView#setAffiliation called with invalid command: ".concat(t));if(!this.verifyAffiliations(i))return!1;if(!this.validateRoleOrAffiliationChangeArgs(t,n))return!1;const o=this.getNickOrJIDFromCommandArgs(n);if(!o)return!1;let s;const a=n.split(o,2)[1].trim(),c=this.model.getOccupant(o);if(c)s=c.get("jid");else{if(!Kf.isValidJID(o)){const e=ne("Couldn't find a participant with that nickname. They might have left the groupchat.");return void this.model.createMessage({message:e,type:"error"})}s=o}const l={jid:s,reason:a};c&&e.auto_register_muc_nickname&&(l.nick=c.get("nick")),this.model.setAffiliation(r,[l]).then(()=>this.model.occupants.fetchMembers()).catch(e=>this.onCommandError(e))},getReason:e=>e.includes(",")?e.slice(e.indexOf(",")+1).trim():null,setRole(e,t,n=[],i=[]){const r=tp[e];if(!r)throw Error("ChatRoomView#setRole called with invalid command: ".concat(e));if(!this.verifyAffiliations(n)||!this.verifyRoles(i))return!1;if(!this.validateRoleOrAffiliationChangeArgs(e,t))return!1;const o=this.getNickOrJIDFromCommandArgs(t);if(!o)return!1;const s=t.split(o,2)[1].trim(),a=this.model.getOccupant(o);return this.model.setRole(a,r,s,void 0,this.onCommandError.bind(this)),!0},onCommandError(e){st.fatal(e);const t=ne("Sorry, an error happened while running the command.")+" "+ne("Check your browser's developer console for details.");this.model.createMessage({message:t,type:"error"})},getAllowedCommands(){let t=["clear","help","me","nick","register"];(this.model.config.get("changesubject")||["owner","admin"].includes(this.model.getOwnAffiliation()))&&(t=[...t,"subject","topic"]);const n=this.model.occupants.findWhere({jid:e.bare_jid});return this.verifyAffiliations(["owner"],n,!1)?t=t.concat(Yf).concat(Xf):this.verifyAffiliations(["admin"],n,!1)&&(t=t.concat(Xf)),this.verifyRoles(["moderator"],n,!1)?t=t.concat(Zf).concat(ep):this.verifyRoles(["visitor","participant","moderator"],n,!1)||(t=t.concat(ep)),t.sort(),Array.isArray(e.muc_disable_slash_commands)?t.filter(t=>!e.muc_disable_slash_commands.includes(t)):t},async destroy(){const e=[ne("Are you sure you want to destroy this groupchat?")];let t=[{name:"challenge",label:ne("Please enter the XMPP address of this groupchat to confirm"),challenge:this.model.get("jid"),placeholder:ne("name@example.org"),required:!0},{name:"reason",label:ne("Optional reason for destroying this groupchat"),placeholder:ne("Reason")},{name:"newjid",label:ne("Optional XMPP address for a new groupchat that replaces this one"),placeholder:ne("replacement@example.org")}];try{var n,i;t=await xn.confirm(ne("Confirm"),e,t);const r=null===(n=t.filter(e=>"reason"===e.name).pop())||void 0===n?void 0:n.value,o=null===(i=t.filter(e=>"newjid"===e.name).pop())||void 0===i?void 0:i.value;return this.model.sendDestroyIQ(r,o).then(()=>this.close())}catch(e){st.error(e)}},parseMessageForCommands(t){if(e.muc_disable_slash_commands&&!Array.isArray(e.muc_disable_slash_commands))return e.ChatBoxView.prototype.parseMessageForCommands.apply(this,arguments);const n=((t=t.replace(/^\s*/,"")).match(/^\/([a-zA-Z]*) ?/)||[""]).pop().toLowerCase();if(!n)return!1;const i=t.slice(("/"+n).length+1).trim(),r=Array.isArray(e.muc_disable_slash_commands)?e.muc_disable_slash_commands:[],o=this.getAllowedCommands();if(!o.includes(n))return!1;switch(n){case"admin":this.setAffiliation(n,i,["owner"]);break;case"ban":this.setAffiliation(n,i,["admin","owner"]);break;case"modtools":this.showModeratorToolsModal(i);break;case"deop":this.setRole(n,i,["admin","owner"]);break;case"destroy":if(!this.verifyAffiliations(["owner"]))break;this.destroy().catch(e=>this.onCommandError(e));break;case"help":this.showHelpMessages(["<strong>".concat(ne("You can run the following commands"),"</strong>")]),this.showHelpMessages(["<strong>/admin</strong>: ".concat(ne("Change user's affiliation to admin")),"<strong>/ban</strong>: ".concat(ne("Ban user by changing their affiliation to outcast")),"<strong>/clear</strong>: ".concat(ne("Clear the chat area")),"<strong>/close</strong>: ".concat(ne("Close this groupchat")),"<strong>/deop</strong>: ".concat(ne("Change user role to participant")),"<strong>/destroy</strong>: ".concat(ne("Remove this groupchat")),"<strong>/help</strong>: ".concat(ne("Show this menu")),"<strong>/kick</strong>: ".concat(ne("Kick user from groupchat")),"<strong>/me</strong>: ".concat(ne("Write in 3rd person")),"<strong>/member</strong>: ".concat(ne("Grant membership to a user")),"<strong>/modtools</strong>: ".concat(ne("Opens up the moderator tools GUI")),"<strong>/mute</strong>: ".concat(ne("Remove user's ability to post messages")),"<strong>/nick</strong>: ".concat(ne("Change your nickname")),"<strong>/op</strong>: ".concat(ne("Grant moderator role to user")),"<strong>/owner</strong>: ".concat(ne("Grant ownership of this groupchat")),"<strong>/register</strong>: ".concat(ne("Register your nickname")),"<strong>/revoke</strong>: ".concat(ne("Revoke the user's current affiliation")),"<strong>/subject</strong>: ".concat(ne("Set groupchat subject")),"<strong>/topic</strong>: ".concat(ne("Set groupchat subject (alias for /subject)")),"<strong>/voice</strong>: ".concat(ne("Allow muted user to post messages"))].filter(e=>r.every(t=>!e.startsWith(t+"<",9))).filter(e=>o.some(t=>e.startsWith(t+"<",9))));break;case"kick":case"mute":this.setRole(n,i,[],["moderator"]);break;case"member":this.setAffiliation(n,i,["admin","owner"]);break;case"nick":if(!this.verifyRoles(["visitor","participant","moderator"]))break;if(0===i.length){const e=ne('Your nickname is "%1$s"',this.model.get("nick"));this.model.createMessage({message:e,type:"error"})}else{const t=Vf.getBareJidFromJid(this.model.get("jid"));xn.send(Qf({from:e.connection.jid,to:"".concat(t,"/").concat(i),id:Kf.getUniqueId()}).tree())}break;case"owner":this.setAffiliation(n,i,["owner"]);break;case"op":this.setRole(n,i,["admin","owner"]);break;case"register":i.length>1?this.model.createMessage({message:ne("Error: invalid number of arguments"),type:"error"}):this.model.registerNickname().then(e=>{e&&this.model.createMessage({message:e,type:"error"})});break;case"revoke":this.setAffiliation(n,i,["admin","owner"]);break;case"topic":case"subject":this.model.setSubject(i);break;case"voice":this.setRole(n,i,[],["moderator"]);break;default:return e.ChatBoxView.prototype.parseMessageForCommands.apply(this,arguments)}return!0},renderConfigurationForm(e){if(this.hideChatRoomContents(),this.model.save("config_stanza",e.outerHTML),!this.config_form){const{_converse:e}=this.__super__;this.config_form=new e.MUCConfigForm({model:this.model,chatroomview:this}),this.el.querySelector(".chatroom-body").insertAdjacentElement("beforeend",this.config_form.el)}Kf.showElement(this.config_form.el)},renderNicknameForm(){const t=e.muc_show_logs_before_join?ne("Choose a nickname to enter"):ne("Please choose your nickname"),n=Ph()(Object.assign({heading:t,label_nickname:ne("Nickname"),label_join:ne("Enter groupchat")},this.model.toJSON()));if(e.muc_show_logs_before_join){const e=this.el.querySelector(".muc-bottom-panel");e.innerHTML=n,Kf.addClass("muc-bottom-panel--nickname",e)}else{const e=this.el.querySelector(".muc-nickname-form");if(e)Gf(".spinner",this.el).forEach(Kf.removeElement),e.outerHTML=n;else{this.hideChatRoomContents(),this.el.querySelector(".chatroom-body").insertAdjacentHTML("beforeend",n)}}Kf.safeSave(this.model.session,{connection_status:zn.ROOMSTATUS.NICKNAME_REQUIRED})},closeForm(){Gf(".chatroom-form-container",this.el).forEach(e=>Kf.addClass("hidden",e)),this.renderAfterTransition()},getAndRenderConfigurationForm(){this.config_form&&Kf.isVisible(this.config_form.el)?this.closeForm():(this.showSpinner(),this.model.fetchRoomConfiguration().then(e=>this.renderConfigurationForm(e)).catch(e=>st.error(e)))},hideChatRoomContents(){const e=this.el.querySelector(".chatroom-body");null!==e&&[].forEach.call(e.children,e=>e.classList.add("hidden"))},renderPasswordForm(){this.hideChatRoomContents();const t=this.model.get("password_validation_message");if(this.model.save("password_validation_message",void 0),this.password_form)this.password_form.model.set("validation_message",t);else{this.password_form=new e.MUCPasswordForm({model:new Do({validation_message:t}),chatroomview:this}),this.el.querySelector(".chatroom-body").insertAdjacentElement("beforeend",this.password_form.el)}Kf.showElement(this.password_form.el),this.model.session.save("connection_status",zn.ROOMSTATUS.PASSWORD_REQUIRED)},showDestroyedMessage(){Kf.hideElement(this.el.querySelector(".chat-area")),Kf.hideElement(this.el.querySelector(".occupants")),Gf(".spinner",this.el).forEach(Kf.removeElement);const e=this.model.get("destroyed_reason"),t=this.model.get("moved_jid");this.model.save({destroyed_reason:void 0,moved_jid:void 0});const n=this.el.querySelector(".disconnect-container");n.innerHTML=nh()({__:ne,jid:t,reason:e?'"'.concat(e,'"'):null});const i=n.querySelector("a.switch-chat");i&&i.addEventListener("click",async e=>{e.preventDefault(),(await xn.rooms.get(t,null,!0)).maybeShow(!0),this.model.destroy()}),Kf.showElement(n)},showDisconnectMessage(){const e=this.model.get("disconnection_message");if(!e)return;Kf.hideElement(this.el.querySelector(".chat-area")),Kf.hideElement(this.el.querySelector(".occupants")),Gf(".spinner",this.el).forEach(Kf.removeElement);const t=[e],n=this.model.get("disconnection_actor");n&&t.push(ne("This action was done by %1$s.",n));const i=this.model.get("disconnection_reason");i&&t.push(ne('The reason given is: "%1$s".',i)),this.model.save({disconnection_message:void 0,disconnection_reason:void 0,disconnection_actor:void 0});const r=this.el.querySelector(".disconnect-container");r.innerHTML=rh()({messages:t}),Kf.showElement(r)},removeEmptyHistoryFeedback(){const t=this.msgs_container.firstElementChild;e.muc_show_logs_before_join&&t&&t.matches(".empty-history-feedback")&&this.msgs_container.removeChild(this.msgs_container.firstElementChild)},insertDayIndicator(){return this.removeEmptyHistoryFeedback(),e.ChatBoxView.prototype.insertDayIndicator.apply(this,arguments)},insertMessage(t){return this.removeEmptyHistoryFeedback(),e.ChatBoxView.prototype.insertMessage.call(this,t)},insertNotification(e){this.removeEmptyHistoryFeedback(),this.msgs_container.insertAdjacentHTML("beforeend",qs()({isodate:(new Date).toISOString(),extra_classes:"chat-event",message:e}))},onOccupantAdded(t){t.get("jid")===e.bare_jid&&(this.renderHeading(),this.renderBottomPanel())},getPreviousJoinOrLeaveNotification(e,t){const n=(new Date).toISOString().split("T")[0];for(;null!==e;){var i;if(!e.classList.contains("chat-info"))return;const r=e.getAttribute("data-isodate");if(r&&r.split("T")[0]!==n)return;const o=(null===(i=e)||void 0===i?void 0:i.dataset)||{};if(o.join===t||o.leave===t||o.leavejoin===t||o.joinleave===t)return e;e=e.previousElementSibling}},renderAfterTransition(){const e=this.model.session.get("connection_status");e==zn.ROOMSTATUS.NICKNAME_REQUIRED?this.renderNicknameForm():e==zn.ROOMSTATUS.PASSWORD_REQUIRED?this.renderPasswordForm():e==zn.ROOMSTATUS.ENTERED&&(this.hideChatRoomContents(),Kf.showElement(this.el.querySelector(".chat-area")),Kf.showElement(this.el.querySelector(".occupants")),this.scrollDown())},showSpinner(){Gf(".spinner",this.el).forEach(Kf.removeElement),this.hideChatRoomContents(),this.el.querySelector(".chatroom-body").insertAdjacentHTML("afterbegin",ta()())},hideSpinner(){const e=this.el.querySelector(".spinner");return null!==e&&(Kf.removeElement(e),this.renderAfterTransition()),this}}),e.RoomsPanel=Fo.extend({tagName:"div",className:"controlbox-section",id:"chatrooms",events:{"click a.controlbox-heading__btn.show-add-muc-modal":"showAddRoomModal","click a.controlbox-heading__btn.show-list-muc-modal":"showListRoomsModal"},render(){return this.el.innerHTML=Wf()({heading_chatrooms:ne("Groupchats"),title_new_room:ne("Add a new groupchat"),title_list_rooms:ne("Query for groupchats")}),this},showAddRoomModal(t){void 0===this.add_room_modal&&(this.add_room_modal=new e.AddChatRoomModal({model:this.model})),this.add_room_modal.show(t)},showListRoomsModal(t){void 0===this.list_rooms_modal&&(this.list_rooms_modal=new e.ListChatRoomsModal({model:this.model})),this.list_rooms_modal.show(t)}}),e.MUCConfigForm=Fo.extend({className:"chatroom-form-container muc-config-form",initialize(e){this.chatroomview=e.chatroomview,this.listenTo(this.chatroomview.model.features,"change:passwordprotected",this.render),this.listenTo(this.chatroomview.model.features,"change:config_stanza",this.render),this.render()},toHTML(){var t,n;const i=Kf.toStanza(this.model.get("config_stanza")),r=e.roomconfig_whitelist;let o=Gf("field",i);r.length&&(o=o.filter(e=>r.includes(e.getAttribute("var"))));const s={new_password:!this.model.features.get("passwordprotected"),fixed_username:this.model.get("jid")};return a={closeConfigForm:e=>this.closeConfigForm(e),fields:o.map(e=>Kf.xForm2webForm(e,i,s)),instructions:null===(t=i.querySelector("instructions"))||void 0===t?void 0:t.textContent,submitConfigForm:e=>this.submitConfigForm(e),title:null===(n=i.querySelector("title"))||void 0===n?void 0:n.textContent},ho(of(),a.submitConfigForm,a.title,a.title!==a.instructions?ho(rf(),a.instructions):"",a.fields.map(e=>Sl(e)),af,cf,a.closeConfigForm);var a},async submitConfigForm(e){e.preventDefault();const t=Gf(":input:not([type=button]):not([type=submit])",e.target).map(Kf.webForm2xForm);try{await this.model.sendConfiguration(t)}catch(e){st.error(e);const t=ne("Sorry, an error occurred while trying to submit the config form.")+" "+ne("Check your browser's developer console for details.");this.model.createMessage({message:t,type:"error"})}await this.model.refreshDiscoInfo(),this.chatroomview.closeForm()},closeConfigForm(e){e.preventDefault(),this.chatroomview.closeForm()}}),e.MUCPasswordForm=Fo.extend({className:"chatroom-form-container muc-password-form",initialize(e){this.chatroomview=e.chatroomview,this.listenTo(this.model,"change:validation_message",this.render),this.render()},toHTML(){return e={jid:this.model.get("jid"),submitPassword:e=>this.submitPassword(e),validation_message:this.model.get("validation_message")},ho(_f(),e.submitPassword,bf,e.validation_message,e.jid,e.validation_message?"error":"",yf,wf);var e},submitPassword(e){e.preventDefault();const t=this.el.querySelector("input[type=password]").value;this.chatroomview.model.join(this.chatroomview.model.get("nick"),t),this.model.set("validation_message",null)}}),e.MUCInviteModal=ya.extend({id:"muc-invite-modal",initialize(){ya.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.render),this.initInviteWidget()},toHTML(){return e=Object.assign(this.model.toJSON(),{submitInviteForm:e=>this.submitInviteForm(e)}),ho(uf(),ff,Qs,e.submitInviteForm,mf,e.invalid_invite_jid?ho(lf(),gf):"",pf,vf,hf);var e},initInviteWidget(){this.invite_auto_complete&&this.invite_auto_complete.destroy();const t=e.roster.map(e=>({label:e.getDisplayName(),value:e.get("jid")})),n=this.el.querySelector(".suggestion-box").parentElement;this.invite_auto_complete=new e.AutoComplete(n,{min_chars:1,list:t})},submitInviteForm(e){e.preventDefault();const t=new FormData(e.target),n=t.get("invitee_jids"),i=t.get("reason");Kf.isValidJID(n)?(this.chatroomview.model.directInvite(n,i),this.modal.hide()):this.model.set({invalid_invite_jid:!0})}}),e.MUCSidebar=Fo.extend({tagName:"div",className:"occupants col-md-3 col-4",async initialize(){this.chatroomview=this.model.chatroomview,this.listenTo(this.model,"add",this.render),this.listenTo(this.model,"remove",this.render),this.listenTo(this.model,"change",this.render),this.listenTo(this.chatroomview.model.features,"change",this.render),this.listenTo(this.chatroomview.model,"change:hidden_occupants",this.setVisibility),this.render(),await this.model.fetched},toHTML(){return t=Object.assign(this.chatroomview.model.toJSON(),{_converse:e,features:this.chatroomview.model.features,occupants:this.model.models}),ho(zf(),qf,t.occupants.map(e=>Lf(Object.assign({jid:"",hint_show:Ff[e.get("show")],hint_occupant:Bf(e)},e.toJSON()))));var t},afterRender(){this.setVisibility()},setVisibility(){this.chatroomview.model.get("hidden_occupants")||this.chatroomview.model.session.get("connection_status")!==zn.ROOMSTATUS.ENTERED?Kf.hideElement(this.el):(Kf.showElement(this.el),this.setOccupantsHeight())},setOccupantsHeight(){const e=this.el.querySelector(".chatroom-features");e&&(this.el.querySelector(".occupant-list").style.cssText="height: calc(100% - ".concat(e.offsetHeight,"px - 5em);"))}}),xn.listen.on("chatBoxViewsInitialized",()=>{e.chatboxviews.delegate("click","a.open-chatroom",(function(e){e.preventDefault(),xn.rooms.open(e.target.href)})),e.chatboxes.on("add",(async function(t){const n=e.chatboxviews;if(!n.get(t.get("id"))&&t.get("type")===e.CHATROOMS_TYPE&&t.isValid())return await t.initialized,n.add(t.get("id"),new e.ChatRoomView({model:t}))}))}),xn.listen.on("clearSession",()=>{const t=e.chatboxviews.get("controlbox");t&&t.roomspanel&&(t.roomspanel.model.destroy(),t.roomspanel.remove(),delete t.roomspanel)}),xn.listen.on("controlBoxInitialized",t=>{e.allow_muc&&(r(t),t.model.on("change:connected",()=>r(t)))}),Object.assign(e.api,{roomviews:{get(t){if(Array.isArray(t)){return xn.chatviews.get(t).filter(t=>t.model.get("type")===e.CHATROOMS_TYPE)}{const n=xn.chatviews.get(t);return n.model.get("type")===e.CHATROOMS_TYPE?n:null}},close(t){let n;return void 0===t?n=e.chatboxviews:Object(lr.isString)(t)?n=[e.chatboxviews.get(t)].filter(e=>e):Array.isArray(t)&&(n=t.map(t=>e.chatboxviews.get(t))),Promise.all(n.map(e=>e.is_chatroom&&e.model&&e.close()))}}})}});var sp=e=>ho(ip(),e.headlineboxes.length?"":"hidden",e.headlineboxes.map(t=>(e=>ho(rp(),e.headlinebox.get("jid"),e.headlinebox.get("jid"),e.open_title,e.headlinebox.get("jid")))(Object.assign({headlinebox:t},e))));function ap(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n    <div class="d-flex controlbox-padded ','">\n        <span class="w-100 controlbox-heading controlbox-heading--headline">',"</span>\n    </div>\n    ","\n"]);return ap=function(){return e},e}
/**
 * @module converse-headlines-view
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const cp=zn.env.utils;zn.plugins.add("converse-headlines-view",{dependencies:["converse-headlines","converse-chatview"],overrides:{ControlBoxView:{renderControlBoxPane(){this.__super__.renderControlBoxPane.apply(this,arguments),this.renderHeadlinesPanel()}}},initialize(){const e={renderHeadlinesPanel(){return this.headlinepanel&&cp.isInDOM(this.headlinepanel.el)||(this.headlinepanel=new yn.HeadlinesPanel({model:yn.chatboxes}),xn.trigger("headlinesPanelRendered")),this.headlinepanel}};yn.ControlBoxView&&Object.assign(yn.ControlBoxView.prototype,e),yn.HeadlinesPanel=Fo.extend({tagName:"div",className:"controlbox-section",id:"headline",events:{"click .open-headline":"openHeadline"},initialize(){this.listenTo(this.model,"add",this.renderIfHeadline),this.listenTo(this.model,"remove",this.renderIfHeadline),this.listenTo(this.model,"destroy",this.renderIfHeadline),this.render(),this.insertIntoDOM()},toHTML(){return e={heading_headline:ne("Announcements"),headlineboxes:this.model.filter(e=>e.get("type")===yn.HEADLINES_TYPE),open_title:ne("Click to open this server message")},ho(ap(),e.headlineboxes.length?"":"hidden",e.heading_headline,sp(e));var e},renderIfHeadline(e){return e&&e.get("type")===yn.HEADLINES_TYPE&&this.render()},openHeadline(e){e.preventDefault();const t=e.target.getAttribute("data-headline-jid");yn.chatboxes.get(t).maybeShow(!0)},insertIntoDOM(){const e=yn.chatboxviews.get("controlbox");e&&e.el.querySelector(".controlbox-pane").insertAdjacentElement("beforeEnd",this.el)}}),yn.HeadlinesBoxView=yn.ChatBoxView.extend({className:"chatbox headlines",events:{"click .close-chatbox-button":"close","click .toggle-chatbox-button":"minimize","keypress textarea.chat-textarea":"onKeyDown"},initialize(){this.initDebounced(),this.model.disable_mam=!0,this.listenTo(this.model.messages,"add",this.onMessageAdded),this.listenTo(this.model,"show",this.show),this.listenTo(this.model,"destroy",this.hide),this.listenTo(this.model,"change:minimized",this.onMinimizedChanged),this.render(),this.renderHeading(),this.updateAfterMessagesFetched(),this.insertIntoDOM().hide(),this.model.maybeShow(),xn.trigger("headlinesBoxViewInitialized",this)},render(){this.el.setAttribute("id",this.model.get("box_id"));const e=Ca(Object.assign(this.model.toJSON(),{info_close:"",label_personal_message:"",show_send_button:!1,show_toolbar:!1,unread_msgs:""}));return uo(e,this.el),this.content=this.el.querySelector(".chat-content"),this.msgs_container=this.el.querySelector(".chat-content__messages"),this},getHeadingButtons(){const e=[];return xn.settings.get("singleton")||e.push({a_class:"close-chatbox-button",handler:e=>this.close(e),i18n_text:ne("Close"),i18n_title:ne("Close these announcements"),icon_class:"fa-times",name:"close",standalone:"overlayed"===xn.settings.get("view_mode")}),yn.api.hook("getHeadingButtons",this,e)},renderMessageForm:function(){},afterShown:function(){}}),xn.listen.on("chatBoxViewsInitialized",()=>{const e=yn.chatboxviews;yn.chatboxes.on("add",t=>{e.get(t.get("id"))||t.get("type")!==yn.HEADLINES_TYPE||e.add(t.get("id"),new yn.HeadlinesBoxView({model:t}))})})}});
/**
 * @module converse-notification
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:lp,sizzle:up}=zn.env,dp=zn.env.utils;function hp(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n            <div class="suggestion-box suggestion-box__name">\n                <ul class="suggestion-box__results suggestion-box__results--above" hidden=""></ul>\n                <input type="text" name="','"\n                       autocomplete="off"\n                       @keydown=',"\n                       @keyup=",'\n                       class="form-control suggestion-box__input"\n                       placeholder="','"/>\n                <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span>\n            </div>\n        ']);return hp=function(){return e},e}zn.plugins.add("converse-notification",{dependencies:["converse-chatboxes"],initialize(){yn.supports_html5_notification="Notification"in window,xn.settings.update({notify_all_room_messages:!1,show_desktop_notifications:!0,show_chat_state_notifications:!1,chatstate_notification_blacklist:[],play_sounds:!0,sounds_path:xn.settings.get("assets_path")+"/sounds/",notification_icon:"logo/conversejs-filled.svg",notification_delay:5e3}),yn.shouldNotifyOfGroupMessage=function(e){let t=yn.notify_all_room_messages;const n=e.getAttribute("from"),i=lp.getResourceFromJid(n),r=lp.getBareJidFromJid(n),o=i&&lp.unescapeNode(i)||"";if(""===o||e.querySelectorAll("delay").length>0)return!1;const s=yn.chatboxes.get(r),a=e.querySelector("body");if(null===a)return!1;const c=new RegExp("\\b".concat(s.get("nick"),"\\b")).test(a.textContent);return t=!0===t||Array.isArray(t)&&t.includes(r),!(o===s.get("nick")||!t&&!c)},yn.isMessageToHiddenChat=function(e){if(yn.isUniView()){const t=lp.getBareJidFromJid(e.getAttribute("from")),n=yn.chatboxviews.get(t);return!n||(n.model.get("hidden")||"hidden"===yn.windowState||!dp.isVisible(n.el))}return"hidden"===yn.windowState},yn.shouldNotifyOfMessage=function(e){if(null!==e.querySelector("forwarded"))return!1;if("groupchat"===e.getAttribute("type"))return yn.shouldNotifyOfGroupMessage(e);if(cn.isHeadline(e))return yn.isMessageToHiddenChat(e);const t=lp.getBareJidFromJid(e.getAttribute("from"))===yn.bare_jid;return!dp.isOnlyChatStateNotification(e)&&!dp.isOnlyMessageDeliveryReceipt(e)&&!t&&("all"===yn.show_desktop_notifications||yn.isMessageToHiddenChat(e))},yn.playSoundNotification=function(){if(yn.play_sounds&&void 0!==window.Audio){const e=new Audio(yn.sounds_path+"msg_received.ogg"),t=e.canPlayType("audio/ogg");if("probably"===t)return e.play();const n=new Audio(yn.sounds_path+"msg_received.mp3"),i=n.canPlayType("audio/mp3");"probably"===i?n.play():"maybe"===t?e.play():"maybe"===i&&n.play()}},yn.areDesktopNotificationsEnabled=function(){return yn.supports_html5_notification&&yn.show_desktop_notifications&&"granted"===Notification.permission},yn.showMessageNotification=function(e){var t;if(!yn.areDesktopNotificationsEnabled())return;let n,i;const r=e.getAttribute("from"),o=lp.getBareJidFromJid(r);if("headline"===e.getAttribute("type")){if(o.includes("@")&&!xn.settings.get("allow_non_roster_messaging"))return;n=ne("Notification from %1$s",o)}else if(o.includes("@"))if("groupchat"===e.getAttribute("type"))n=ne("%1$s says",lp.getResourceFromJid(r));else{if(void 0===yn.roster)return void st.error("Could not send notification, because roster is undefined");if(i=yn.roster.get(o),void 0!==i)n=ne("%1$s says",i.getDisplayName());else{if(!xn.settings.get("allow_non_roster_messaging"))return;n=ne("%1$s says",o)}}else n=ne("Notification from %1$s",o);const s=up('encrypted[xmlns="'.concat(lp.NS.OMEMO,'"]'),e).length?ne("OMEMO Message received"):null===(t=e.querySelector("body"))||void 0===t?void 0:t.textContent;if(!s)return;const a=new Notification(n,{body:s,lang:yn.locale,icon:yn.notification_icon,requireInteraction:!yn.notification_delay});yn.notification_delay&&setTimeout(a.close.bind(a),yn.notification_delay),a.onclick=function(e){e.preventDefault(),window.focus(),yn.chatboxes.get(o).maybeShow(!0)},a.onclick.bind(yn)},yn.showChatStateNotification=function(e){if(yn.chatstate_notification_blacklist.includes(e.jid))return;const t=e.chat_status;let n=null;if("offline"===t?n=ne("has gone offline"):"away"===t?n=ne("has gone away"):"dnd"===t?n=ne("is busy"):"online"===t&&(n=ne("has come online")),null===n)return;const i=new Notification(e.getDisplayName(),{body:n,lang:yn.locale,icon:yn.notification_icon});setTimeout(i.close.bind(i),5e3)},yn.showContactRequestNotification=function(e){const t=new Notification(e.getDisplayName(),{body:ne("wants to be your contact"),lang:yn.locale,icon:yn.notification_icon});setTimeout(t.close.bind(t),5e3)},yn.showFeedbackNotification=function(e){if("error"===e.klass||"warn"===e.klass){const t=new Notification(e.subject,{body:e.message,lang:yn.locale,icon:yn.notification_icon});setTimeout(t.close.bind(t),5e3)}},yn.handleChatStateNotification=function(e){yn.areDesktopNotificationsEnabled()&&yn.show_chat_state_notifications&&yn.showChatStateNotification(e)},yn.handleMessageNotification=function(e){const t=e.stanza;if(!yn.shouldNotifyOfMessage(t))return!1;xn.trigger("messageNotification",t),yn.playSoundNotification(),yn.showMessageNotification(t)},yn.handleContactRequestNotification=function(e){yn.areDesktopNotificationsEnabled(!0)&&yn.showContactRequestNotification(e)},yn.handleFeedback=function(e){yn.areDesktopNotificationsEnabled(!0)&&yn.showFeedbackNotification(e)},yn.requestPermission=function(){yn.supports_html5_notification&&!["denied","granted"].includes(Notification.permission)&&Notification.requestPermission()},xn.listen.on("pluginsInitialized",(function(){xn.listen.on("contactRequest",yn.handleContactRequestNotification),xn.listen.on("contactPresenceChanged",yn.handleChatStateNotification),xn.listen.on("message",yn.handleMessageNotification),xn.listen.on("feedback",yn.handleFeedback),xn.listen.on("connected",yn.requestPermission)}))}});function fp(){const e=bp(['\n        <fieldset class="form-group">\n            <ul class="list-group">\n                <li class="list-group-item active">',":</li>\n                ","\n            </ul>\n        </fieldset>"]);return fp=function(){return e},e}function pp(){const e=bp(['<div class="alert alert-','" role="alert">',"</div>"]);return pp=function(){return e},e}function gp(){const e=bp(["\n    ",'\n    <form class="converse-form" @submit=','>\n        <fieldset class="form-group">\n            <label>\n                ','\n                <p class="form-help">','</p>\n                <converse-autocomplete\n                    .getAutoCompleteList="','"\n                    placeholder="','"\n                    name="jid"/>\n            </label>\n        </fieldset>\n        <fieldset class="form-group">\n            <input type="submit" class="btn btn-primary" value="','">\n        </fieldset>\n        ',"\n\n    </form>\n"]);return gp=function(){return e},e}function mp(){const e=bp(['\n    <li class="room-item list-group-item">\n        <div class="available-chatroom d-flex flex-row">\n            <a class="open-room available-room w-100"\n               @click=','\n               data-command-node="','"\n               data-command-jid="','"\n               data-command-name="','"\n               title="','"\n               href="#">',"</a>\n        </div>\n        ","\n    </li>\n"]);return mp=function(){return e},e}function vp(){const e=bp(['<div class="alert alert-','" role="alert">',"</div>"]);return vp=function(){return e},e}function _p(){const e=bp(["\n    <form @submit=",">\n        ",'\n        <fieldset class="form-group">\n            <input type="hidden" name="command_node" value="','"/>\n            <input type="hidden" name="command_jid" value="','"/>\n\n            <p class="form-help">',"</p>\n            \x3c!-- Fields are generated internally, with xForm2webForm --\x3e\n            ",'\n        </fieldset>\n        <fieldset>\n            <input type="submit" class="btn btn-primary" value="','">\n            <input type="button" class="btn btn-secondary button-cancel" value="','" @click=',">\n        </fieldset>\n    </form>\n"]);return _p=function(){return e},e}function bp(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}window.customElements.define("converse-autocomplete",class extends wh{static get properties(){return{getAutoCompleteList:{type:Function},auto_evaluate:{type:Boolean},auto_first:{type:Boolean},filter:{type:String},include_triggers:{type:String},min_chars:{type:Number},name:{type:String},placeholder:{type:String},triggers:{type:String}}}constructor(){super(),this.auto_evaluate=!0,this.auto_first=!1,this.filter="contains",this.include_triggers="",this.match_current_word=!1,this.max_items=10,this.min_chars=1,this.triggers=""}render(){return ho(hp(),this.name,this.onKeyDown,this.onKeyUp,this.placeholder)}firstUpdated(){this.auto_complete=new Or(this.firstElementChild,{ac_triggers:this.triggers.split(" "),auto_evaluate:this.auto_evaluate,auto_first:this.auto_first,filter:"contains"==this.filter?xr:Er,include_triggers:[],list:()=>this.getAutoCompleteList(),match_current_word:!0,max_items:this.max_items,min_chars:this.min_chars}),this.auto_complete.on("suggestion-box-selectcomplete",()=>this.auto_completing=!1)}onKeyDown(e){this.auto_complete.onKeyDown(e)}onKeyUp(e){this.auto_complete.evaluate(e)}});const{Strophe:yp,$iq:wp}=zn.env,Sp=zn.env.utils,xp=ne("Hide"),Ep=ne("On which entity do you want to run commands?"),Ap=ne("Certain XMPP services and entities allow privileged users to execute ad-hoc commands on them."),jp=ne("Commands found"),Cp=ne("List available commands"),kp=ne("XMPP Address"),Op=ne("No commands found"),Tp=ne("Execute"),Np=(e,t)=>ho(mp(),e.toggleCommandForm,t.node,t.jid,t.name,t.name,t.name||t.jid,t.node===e.showform?((e,t)=>ho(_p(),e.runCommand,t.alert?ho(vp(),t.alert_type,t.alert):"",t.node,t.jid,t.instructions,t.fields.map(e=>Sl(e)),Tp,xp,e.hideCommandForm))(e,t):"");async function Mp(){const e=[...await xn.rooms.get(),...await xn.contacts.get()];return[...new Set(e.map(e=>yp.getDomainFromJid(e.get("jid"))))]}function Ip(){const e=Dp(['\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h5 class="modal-title" id="converse-modtools-modal-label">',"</h5>\n                ",'\n            </div>\n            <div class="modal-body">\n                ','\n\n                <div class="tab-content">\n                    <div class="tab-pane tab-pane--columns ','"\n                         id="about-tabpanel" role="tabpanel" aria-labelledby="about-tab">\n\n                        <span class="modal-alert"></span>\n                        <br/>\n                        <div class="container brand-heading-container">\n                            <h6 class="brand-heading">Converse</h6>\n                            <p class="brand-subtitle">','</p>\n                            <p class="brand-subtitle">','</p>\n                            <p class="brand-subtitle">','</p>\n                        </div>\n                    </div>\n\n                    <div class="tab-pane tab-pane--columns ','"\n                         id="commands-tabpanel"\n                         role="tabpanel"\n                         aria-labelledby="commands-tab">\n                        <converse-adhoc-commands/>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n']);return Ip=function(){return e},e}function Rp(){const e=Dp(['\n    <ul class="nav nav-pills justify-content-center">\n        <li role="presentation" class="nav-item">\n            <a class="nav-link active" id="about-tab" href="#about-tabpanel" aria-controls="about-tabpanel" role="tab" data-toggle="tab" @click=',">",'</a>\n        </li>\n        <li role="presentation" class="nav-item">\n            <a class="nav-link" id="commands-tab" href="#commands-tabpanel" aria-controls="commands-tabpanel" role="tab" data-toggle="tab" @click=',">","</a>\n        </li>\n    </ul>\n"]);return Rp=function(){return e},e}function Dp(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}window.customElements.define("converse-adhoc-commands",class extends wh{static get properties(){return{alert:{type:String},alert_type:{type:String},nonce:{type:String},showform:{type:String},view:{type:String}}}constructor(){super(),this.view="choose-service",this.showform="",this.commands=[]}render(){return e={alert:this.alert,alert_type:this.alert_type,commands:this.commands,fetchCommands:e=>this.fetchCommands(e),hideCommandForm:e=>this.hideCommandForm(e),runCommand:e=>this.runCommand(e),showform:this.showform,toggleCommandForm:e=>this.toggleCommandForm(e),view:this.view},ho(gp(),e.alert?ho(pp(),e.alert_type,e.alert):"",e.fetchCommands,Ep,Ap,Mp,kp,Cp,"list-commands"===e.view?ho(fp(),e.commands.length?jp:Op,e.commands.map(t=>Np(e,t))):"");var e}async fetchCommands(e){e.preventDefault(),delete this.alert_type,delete this.alert;const t=new FormData(e.target).get("jid").trim();let n;try{n=await xn.disco.supports(yp.NS.ADHOC,t)}catch(e){st.error(e)}if(n)try{this.commands=await xn.adhoc.getCommands(t),this.view="list-commands"}catch(e){return st.error(e),this.alert_type="danger",this.alert=ne("Sorry, an error occurred while looking for commands on that entity."),this.commands=[],void st.error(e)}else this.alert_type="danger",this.alert=ne("The specified entity doesn't support ad-hoc commands")}async toggleCommandForm(e){e.preventDefault();const t=e.target.getAttribute("data-command-node"),n=this.commands.filter(e=>e.node===t)[0];this.showform!==t&&await async function(e){const t=e.node,n=e.jid,i=wp({type:"set",to:n}).c("command",{xmlns:yp.NS.ADHOC,node:t,action:"execute"});try{var r;const t=await xn.sendIQ(i),n=Rt()('command[xmlns="'.concat(yp.NS.ADHOC,'"]'),t).pop();e.sessionid=n.getAttribute("sessionid"),e.instructions=null===(r=Rt()('x[type="form"][xmlns="jabber:x:data"] instructions',n).pop())||void 0===r?void 0:r.textContent,e.fields=Rt()('x[type="form"][xmlns="jabber:x:data"] field',n).map(e=>Sp.xForm2webForm(e,n))}catch(t){null===t?st.error("Error: timeout while trying to execute command for ".concat(n)):(st.error("Error while trying to execute command for ".concat(n)),st.error(t)),e.fields=[]}}(n),this.showform=t}hideCommandForm(e){e.preventDefault(),this.showform=""}async runCommand(e){e.preventDefault();const t=new FormData(e.target),n=t.get("command_jid").trim(),i=t.get("command_node").trim(),r=this.commands.filter(e=>e.node===i)[0],o=Rt()(":input:not([type=button]):not([type=submit])",e.target).filter(e=>!["command_jid","command_node"].includes(e.getAttribute("name"))).map(Sp.webForm2xForm),s=wp({to:n,type:"set"}).c("command",{sessionid:r.session,node:r.node,xmlns:yp.NS.ADHOC}).c("x",{xmlns:yp.NS.XFORM,type:"submit"});let a;o.forEach(e=>s.cnode(e).up());try{a=await xn.sendIQ(s)}catch(e){r.alert_type="danger",r.alert=ne("Sorry, an error occurred while trying to execute the command. See the developer console for details"),st.error("Error while trying to execute an ad-hoc command"),st.error(e)}var c;a?r.alert=null===(c=a.querySelector("note"))||void 0===c?void 0:c.textContent:r.alert="Done";r.alert_type="primary",this.nonce=Sp.getUniqueId()}});const Pp=ne("Settings"),Lp=ne("About"),zp=ne("Commands"),Fp=ne("%1$s Open Source %2$s XMPP chat client brought to you by %3$s Opkode %2$s",'<a target="_blank" rel="nofollow" href="https://conversejs.org">',"</a>",'<a target="_blank" rel="nofollow" href="https://opkode.com">'),Bp=ne("%1$s Translate %2$s it into your own language",'<a target="_blank" rel="nofollow" href="https://hosted.weblate.org/projects/conversejs/#languages">',"</a>");var qp=e=>{const t=xn.settings.get("show_client_info"),n=xn.settings.get("allow_adhoc_commands"),i=t&&n;return ho(Ip(),Pp,Qs,i?(e=>ho(Rp(),e.switchTab,Lp,e.switchTab,zp))(e):"",t?"active":"",e.version_name,Sl(ia.a.filterXSS(Fp,{whiteList:{a:[]}})),Sl(ia.a.filterXSS(Bp,{whiteList:{a:[]}})),!t&&n?"active":"")};let Up;var Hp=ya.extend({id:"converse-client-info-modal",initialize(e){Up=e._converse,ya.prototype.initialize.apply(this,arguments)},toHTML(){return qp(Object.assign(this.model.toJSON(),this.model.vcard.toJSON(),{version_name:Up.VERSION_NAME}))}});function $p(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h5 class="modal-title" id="changeStatusModalLabel">',"</h5>\n                ",'\n            </div>\n            <div class="modal-body">\n                <span class="modal-alert"></span>\n                <form class="converse-form set-xmpp-status" id="set-xmpp-status">\n                    <div class="form-group">\n                        <div class="custom-control custom-radio">\n                            <input ?checked=','\n                                type="radio" id="radio-online" value="online" name="chat_status" class="custom-control-input"/>\n                            <label class="custom-control-label" for="radio-online">\n                                <span class="fa fa-circle chat-status chat-status--online"></span>','</label>\n                        </div>\n                        <div class="custom-control custom-radio">\n                            <input ?checked=','\n                                type="radio" id="radio-busy" value="dnd" name="chat_status" class="custom-control-input"/>\n                            <label class="custom-control-label" for="radio-busy">\n                                <span class="fa fa-minus-circle  chat-status chat-status--busy"></span>','</label>\n                        </div>\n                        <div class="custom-control custom-radio">\n                            <input ?checked=','\n                                type="radio" id="radio-away" value="away" name="chat_status" class="custom-control-input"/>\n                            <label class="custom-control-label" for="radio-away">\n                                <span class="fa fa-circle chat-status chat-status--away"></span>','</label>\n                        </div>\n                        <div class="custom-control custom-radio">\n                            <input ?checked=','\n                                type="radio" id="radio-xa" value="xa" name="chat_status" class="custom-control-input"/>\n                            <label class="custom-control-label" for="radio-xa">\n                                <span class="far fa-circle chat-status chat-status--xa"></span>','</label>\n                        </div>\n                    </div>\n                    <div class="form-group">\n                        <div class="btn-group w-100">\n                            <input name="status_message" type="text" class="form-control"\n                                value="','" placeholder="','"/>\n                            <span class="clear-input fa fa-times ','"></span>\n                        </div>\n                    </div>\n                    <button type="submit" class="btn btn-primary">',"</button>\n                </form>\n            </div>\n        </div>\n    </div>\n"]);return $p=function(){return e},e}function Wp(){const e=Jp(['<a class="controlbox-heading__btn logout fa fa-sign-out-alt align-self-center" title="','"></a>']);return Wp=function(){return e},e}function Vp(){const e=Jp(['<a class="controlbox-heading__btn show-client-info fa fa-cog align-self-center" title="','" @click=',"></a>"]);return Vp=function(){return e},e}function Gp(){const e=Jp(['\n    <div class="userinfo controlbox-padded">\n        <div class="controlbox-section profile d-flex">\n            <a class="show-profile" href="#">\n                <canvas class="avatar align-self-center" height="40" width="40"></canvas>\n            </a>\n            <span class="username w-100 align-self-center">',"</span>\n            ","\n            ",'\n        </div>\n        <div class="d-flex xmpp-status">\n            <a class="change-status" title="','" data-toggle="modal" data-target="#changeStatusModal">\n                <span class="',' w-100 align-self-center" data-value="','">\n                    <span class="\n                        ',"\n                        ","\n                        ","\n                        ","\n                        ",'"></span> ',"</span>\n            </a>\n        </div>\n    </div>\n"]);return Gp=function(){return e},e}function Jp(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const Qp=ne("Log out"),Kp=ne("Click to change your chat status"),Yp=ne("Show details about this chat client");function Xp(){const e=sg(['\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h5 class="modal-title" id="user-profile-modal-label">',"</h5>\n                ",'\n            </div>\n            <div class="modal-body">\n                <span class="modal-alert"></span>\n                ','\n                <div class="tab-content">\n                    <div class="tab-pane active" id="profile-tabpanel" role="tabpanel" aria-labelledby="profile-tab">\n                        <form class="converse-form converse-form--modal profile-form" action="#">\n                            <div class="row">\n                                <div class="col-auto">\n                                    <a class="change-avatar" href="#">\n                                        ','\n                                    </a>\n                                    <input class="hidden" name="image" type="file"/>\n                                </div>\n                                <div class="col">\n                                    <div class="form-group">\n                                        <label class="col-form-label">',":</label>\n                                        <div>",'</div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="form-group">\n                                <label for="vcard-fullname" class="col-form-label">',':</label>\n                                <input id="vcard-fullname" type="text" class="form-control" name="fn" value="','"/>\n                            </div>\n                            <div class="form-group">\n                                <label for="vcard-nickname" class="col-form-label">',':</label>\n                                <input id="vcard-nickname" type="text" class="form-control" name="nickname" value="','"/>\n                            </div>\n                            <div class="form-group">\n                                <label for="vcard-url" class="col-form-label">',':</label>\n                                <input id="vcard-url" type="url" class="form-control" name="url" value="','"/>\n                            </div>\n                            <div class="form-group">\n                                <label for="vcard-email" class="col-form-label">',':</label>\n                                <input id="vcard-email" type="email" class="form-control" name="email" value="','"/>\n                            </div>\n                            <div class="form-group">\n                                <label for="vcard-role" class="col-form-label">',':</label>\n                                <input id="vcard-role" type="text" class="form-control" name="role" value="','" aria-describedby="vcard-role-help"/>\n                                <small id="vcard-role-help" class="form-text text-muted">','</small>\n                            </div>\n                            <hr/>\n                            <div class="form-group">\n                                <button type="submit" class="save-form btn btn-primary">',"</button>\n                            </div>\n                        </form>\n                    </div>\n                    ",'\n                </div>\n            </div>\n            <div class="modal-footer">',"</div>\n        </div>\n    </div>\n"]);return Xp=function(){return e},e}function Zp(){const e=sg(['\n    <div class="tab-pane" id="omemo-tabpanel" role="tabpanel" aria-labelledby="omemo-tab">\n        <form class="converse-form fingerprint-removal">\n            <ul class="list-group fingerprints">\n                <li class="list-group-item active">','</li>\n                <li class="list-group-item">\n                    ','\n                </li>\n            </ul>\n            <div class="form-group">\n                <button type="button" class="generate-bundle btn btn-danger">',"</button>\n            </div>\n            ","\n        </form>\n    </div>"]);return Zp=function(){return e},e}function eg(){const e=sg(['\n    <ul class="list-group fingerprints">\n        <li class="list-group-item nopadding active">\n            <label>\n                <input type="checkbox" class="select-all" title="','" aria-label="','"/>\n                ',"\n            </label>\n        </li>\n        ",'\n    </ul>\n    <div class="form-group"><button type="submit" class="save-form btn btn-primary">',"</button></div>\n"]);return eg=function(){return e},e}function tg(){const e=sg(["\n    ","\n"]);return tg=function(){return e},e}function ng(){const e=sg(['\n    <li class="fingerprint-removal-item list-group-item nopadding">\n        <label>\n        <input type="checkbox" value="','"\n            aria-label="','"/>\n        <span>',"</span>\n        </label>\n    </li>\n"]);return ng=function(){return e},e}function ig(){const e=sg(['\n    <li class="fingerprint-removal-item list-group-item nopadding">\n        <label>\n        <input type="checkbox" value="','"\n            aria-label="','"/>\n        <span class="fingerprint">',"</span>\n        </label>\n    </li>\n"]);return ig=function(){return e},e}function rg(){const e=sg(['\n    <span class="fingerprint">',"</span>"]);return rg=function(){return e},e}function og(){const e=sg(['\n    <ul class="nav nav-pills justify-content-center">\n        <li role="presentation" class="nav-item">\n            <a class="nav-link active" id="profile-tab" href="#profile-tabpanel" aria-controls="profile-tabpanel" role="tab" data-toggle="tab">','</a>\n        </li>\n        <li role="presentation" class="nav-item">\n            <a class="nav-link" id="omemo-tab" href="#omemo-tabpanel" aria-controls="omemo-tabpanel" role="tab" data-toggle="tab">',"</a>\n        </li>\n    </ul>"]);return og=function(){return e},e}function sg(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}const ag=ne("Your avatar image"),cg=ne("Your Profile"),lg=ne("Checkbox for selecting the following fingerprint"),ug=ne("Device without a fingerprint"),dg=ne("Email"),hg=ne("This device's OMEMO fingerprint"),fg=ne("Full Name"),pg=ne("Generate new keys and fingerprint"),gg=ne("Username"),mg=ne("Nickname"),vg=ne("Other OMEMO-enabled devices"),_g=ne("Checkbox to select fingerprints of all other OMEMO devices"),bg=ne("Remove checked devices and close"),yg=ne("Role"),wg=ne("Save and close"),Sg=ne("Select all"),xg=ne("Use commas to separate multiple roles. Your roles are shown next to your name on your chat messages."),Eg=ne("URL"),Ag=ne("OMEMO"),jg=ne("Profile"),Cg=ho(og(),jg,Ag),kg=e=>ho(tg(),e.device.get("bundle")&&e.device.get("bundle").fingerprint?(e=>ho(ig(),e.device.get("id"),lg,e.utils.formatFingerprint(e.device.get("bundle").fingerprint)))(e):(e=>ho(ng(),e.device.get("id"),lg,ug))(e)),Og=e=>ho(Zp(),hg,e.view.current_device&&e.view.current_device.get("bundle")&&e.view.current_device.get("bundle").fingerprint?(e=>ho(rg(),e.utils.formatFingerprint(e.view.current_device.get("bundle").fingerprint)))(e):Fc(),pg,e.view.other_devices.length?(e=>ho(eg(),Sg,_g,vg,e.view.other_devices.map(t=>kg(Object.assign({device:t},e))),bg))(e):"");
/**
 * @module converse-profile
 * @copyright The Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const Tg=zn.env.utils;zn.plugins.add("converse-profile",{dependencies:["converse-status","converse-modal","converse-vcard","converse-chatboxviews"],initialize(){xn.settings.update({allow_adhoc_commands:!0,show_client_info:!0}),yn.ProfileModal=ya.extend({id:"user-profile-modal",events:{'change input[type="file"':"updateFilePreview","click .change-avatar":"openFileSelection","submit .profile-form":"onFormSubmitted"},initialize(){this.listenTo(this.model,"change",this.render),ya.prototype.initialize.apply(this,arguments),xn.trigger("profileModalInitialized",this.model)},toHTML(){return e=Object.assign(this.model.toJSON(),this.model.vcard.toJSON(),{_converse:yn,utils:Tg,view:this}),ho(Xp(),cg,Qs,e._converse.pluggable.plugins["converse-omemo"].enabled(e._converse)&&Cg,e.image?Na(Object.assign({alt_text:ag},e)):'<canvas class="avatar" height="100px" width="100px"></canvas>',gg,e.jid,fg,e.fullname||"",mg,e.nickname||"",Eg,e.url||"",dg,e.email||"",yg,e.role||"",xg,wg,e._converse.pluggable.plugins["converse-omemo"].enabled(e._converse)&&Og(e),Js);var e},afterRender(){this.tabs=Rt()(".nav-item .nav-link",this.el).map(e=>new oa.a.Tab(e))},openFileSelection(e){e.preventDefault(),this.el.querySelector('input[type="file"]').click()},updateFilePreview(e){const t=e.target.files[0],n=new FileReader;n.onloadend=()=>{this.el.querySelector(".avatar").setAttribute("src",n.result)},n.readAsDataURL(t)},setVCard(e){xn.vcard.set(yn.bare_jid,e).then(()=>xn.vcard.update(this.model.vcard,!0)).catch(e=>{st.fatal(e),xn.show("error",ne("Error"),[ne("Sorry, an error happened while trying to save your profile data."),ne("You can check your browser's developer console for any error output.")])}),this.modal.hide()},onFormSubmitted(e){e.preventDefault();const t=new FileReader,n=new FormData(e.target),i=n.get("image"),r={fn:n.get("fn"),nickname:n.get("nickname"),role:n.get("role"),email:n.get("email"),url:n.get("url")};i.size?(t.onloadend=()=>{Object.assign(r,{image:btoa(t.result),image_type:i.type}),this.setVCard(r)},t.readAsBinaryString(i)):(Object.assign(r,{image:this.model.vcard.get("image"),image_type:this.model.vcard.get("image_type")}),this.setVCard(r))}}),yn.ChatStatusModal=ya.extend({id:"modal-status-change",events:{"submit form#set-xmpp-status":"onFormSubmitted","click .clear-input":"clearStatusMessage"},toHTML(){return e=Object.assign(this.model.toJSON(),this.model.vcard.toJSON(),{label_away:ne("Away"),label_busy:ne("Busy"),label_cancel:ne("Cancel"),label_close:ne("Close"),label_custom_status:ne("Custom status"),label_offline:ne("Offline"),label_online:ne("Online"),label_save:ne("Save"),label_xa:ne("Away for long"),modal_title:ne("Change chat status"),placeholder_status_message:ne("Personal status message")}),ho($p(),e.modal_title,Qs,"online"===e.status,e.label_online,"busy"===e.status,e.label_busy,"away"===e.status,e.label_away,"xa"===e.status,e.label_xa,e.status_message||"",e.placeholder_status_message,e.status_message?"":"hidden",e.label_save);var e},afterRender(){this.el.addEventListener("shown.bs.modal",()=>{this.el.querySelector('input[name="status_message"]').focus()},!1)},clearStatusMessage(e){e&&e.preventDefault&&(e.preventDefault(),Tg.hideElement(this.el.querySelector(".clear-input"))),this.el.querySelector('input[name="status_message"]').value=""},onFormSubmitted(e){e.preventDefault();const t=new FormData(e.target);this.model.save({status_message:t.get("status_message"),status:t.get("chat_status")}),this.modal.hide()}}),yn.XMPPStatusView=yn.ViewWithAvatar.extend({tagName:"div",events:{"click a.show-profile":"showProfileModal","click a.change-status":"showStatusChangeModal","click .logout":"logOut"},initialize(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model.vcard,"change",this.render)},toHTML(){const e=this.model.get("status")||"offline";return(e=>{const t=xn.settings.get("show_client_info")||xn.settings.get("allow_adhoc_commands");return ho(Gp(),e.fullname,t?ho(Vp(),Yp,e.showUserSettingsModal):"",xn.settings.get("allow_logout")?ho(Wp(),Qp):"",Kp,e.chat_status,e.chat_status,"online"===e.chat_status&&"fa fa-circle chat-status chat-status--online","dnd"===e.chat_status&&"fa fa-minus-circle chat-status chat-status--busy","away"===e.chat_status&&"fa fa-circle chat-status chat-status--away","xa"===e.chat_status&&"far fa-circle chat-status chat-status--xa ","offline"===e.chat_status&&"fa fa-circle chat-status chat-status--offline",e.status_message)})(Object.assign(this.model.toJSON(),this.model.vcard.toJSON(),{chat_status:e,fullname:this.model.vcard.get("fullname")||yn.bare_jid,showUserSettingsModal:e=>this.showUserSettingsModal(e),status_message:this.model.get("status_message")||ne("I am %1$s",this.getPrettyStatus(e))}))},afterRender(){this.renderAvatar()},showProfileModal(e){e.preventDefault(),void 0===this.profile_modal&&(this.profile_modal=new yn.ProfileModal({model:this.model})),this.profile_modal.show(e)},showStatusChangeModal(e){e.preventDefault(),void 0===this.status_modal&&(this.status_modal=new yn.ChatStatusModal({model:this.model})),this.status_modal.show(e)},showUserSettingsModal(e){e.preventDefault(),void 0===this.user_settings_modal&&(this.user_settings_modal=new Hp({model:this.model,_converse:yn})),this.user_settings_modal.show(e)},logOut(e){e.preventDefault(),!0===confirm(ne("Are you sure you want to log out?"))&&xn.user.logout()},getPrettyStatus:e=>"chat"===e?ne("online"):"dnd"===e?ne("busy"):"xa"===e?ne("away for long"):"away"===e?ne("away"):"offline"===e?ne("offline"):ne(e)||ne("online")}),xn.listen.on("controlBoxPaneInitialized",async e=>{await xn.waitUntil("VCardsInitialized"),yn.xmppstatusview=new yn.XMPPStatusView({model:yn.xmppstatus}),e.el.insertAdjacentElement("afterBegin",yn.xmppstatusview.render().el)})}});var Ng=n(144),Mg=n.n(Ng);const Ig=Array.prototype.slice,Rg=function(e,t){t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,ur.a.extend({silent:!0},t))};Rg.extend=ko;const Dg={add:!0,remove:!0,merge:!0},Pg={add:!0,remove:!1},Lg=function(e,t,n){n=Math.min(Math.max(n,0),e.length);const i=Array(e.length-n),r=t.length;let o;for(o=0;o<i.length;o++)i[o]=e[o+n];for(o=0;o<r;o++)e[o+n]=t[o];for(o=0;o<i.length;o++)e[o+r+n]=i[o]};ur.a.extend(Rg.prototype,dr,{model:Do,preinitialize:function(){},initialize:function(){},toJSON:function(e){return this.map((function(t){return t.toJSON(e)}))},sync:function(e,t,n){return Io(this)(e,t,n)},add:function(e,t){return this.set(e,ur.a.extend({merge:!1},t,Pg))},remove:function(e,t){t=ur.a.extend({},t);const n=!ur.a.isArray(e);e=n?[e]:e.slice();const i=this._removeModels(e,t);return!t.silent&&i.length&&(t.changes={added:[],merged:[],removed:i},this.trigger("update",this,t)),n?i[0]:i},set:function(e,t){if(null==e)return;(t=ur.a.extend({},Dg,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);const n=!ur.a.isArray(e);e=n?[e]:e.slice();let i=t.at;null!=i&&(i=+i),i>this.length&&(i=this.length),i<0&&(i+=this.length+1);const r=[],o=[],s=[],a=[],c={},l=t.add,u=t.merge,d=t.remove;let h=!1;const f=this.comparator&&null==i&&!1!==t.sort,p=ur.a.isString(this.comparator)?this.comparator:null;let g,m;for(m=0;m<e.length;m++){g=e[m];const n=this.get(g);if(n){if(u&&g!==n){let e=this._isModel(g)?g.attributes:g;t.parse&&(e=n.parse(e,t)),n.set(e,t),s.push(n),f&&!h&&(h=n.hasChanged(p))}c[n.cid]||(c[n.cid]=!0,r.push(n)),e[m]=n}else l&&(g=e[m]=this._prepareModel(g,t),g&&(o.push(g),this._addReference(g,t),c[g.cid]=!0,r.push(g)))}if(d){for(m=0;m<this.length;m++)g=this.models[m],c[g.cid]||a.push(g);a.length&&this._removeModels(a,t)}let v=!1;const _=!f&&l&&d;if(r.length&&_?(v=this.length!==r.length||ur.a.some(this.models,(function(e,t){return e!==r[t]})),this.models.length=0,Lg(this.models,r,0),this.length=this.models.length):o.length&&(f&&(h=!0),Lg(this.models,o,null==i?this.length:i),this.length=this.models.length),h&&this.sort({silent:!0}),!t.silent){for(m=0;m<o.length;m++)null!=i&&(t.index=i+m),g=o[m],g.trigger("add",g,this,t);(h||v)&&this.trigger("sort",this,t),(o.length||a.length||s.length)&&(t.changes={added:o,removed:a,merged:s},this.trigger("update",this,t))}return n?e[0]:e},clearStore:async function(e={}){await Promise.all(Array.from(this.models).map(t=>new Promise(n=>{t.destroy(Object.assign(e,{success:n,error:(e,t)=>{console.error(t),n()}}))}))),await this.browserStorage.clear(),this.reset()},reset:function(e,t){t=t?ur.a.clone(t):{};for(let e=0;e<this.models.length;e++)this._removeReference(this.models[e],t);return t.previousModels=this.models,this._reset(),e=this.add(e,ur.a.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,ur.a.extend({at:this.length},t))},pop:function(e){const t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,ur.a.extend({at:0},t))},shift:function(e){const t=this.at(0);return this.remove(t,e)},slice:function(){return Ig.apply(this.models,arguments)},filter:function(e,t){return this.models.filter(ur.a.isFunction(e)?e:t=>t.matches(e),t)},each:function(e,t){return this.forEach(e,t)},forEach:function(e,t){return this.models.forEach(e,t)},includes:function(e,t){return this.models.includes(e,t)},map:function(e,t){return this.models.map(ur.a.isFunction(e)?e:t=>ur.a.isString(e)?t.get(e):t.matches(e),t)},reduce:function(e,t){return this.models.reduce(e,t||this.models[0])},reduceRight:function(e,t){return this.models.reduceRight(e,t||this.models[0])},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){let t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});const n=t.length;return ur.a.isFunction(t)&&(t=t.bind(this)),1===n||ur.a.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){const t=(e=ur.a.extend({parse:!0},e)).success,n=this;return e.success=function(i){const r=e.reset?"reset":"set";n[r](i,e),t&&t.call(e.context,n,i,e),n.trigger("sync",n,i,e)},No(this,e),this.sync("read",this,e)},create:function(e,t){const n=(t=t?ur.a.clone(t):{}).wait,i=t.promise,r=i&&Oo();if(!(e=this._prepareModel(e,t)))return!1;n||this.add(e,t);const o=this,s=t.success;return t.success=function(e,t,a){n&&o.add(e,a),s&&s.call(a.context,e,t,a),i&&r.resolve(e)},e.save(null,t),i?r:e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},values:function(){return new Fg(this,Bg)},keys:function(){return new Fg(this,qg)},entries:function(){return new Fg(this,Ug)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;(t=t?ur.a.clone(t):{}).collection=this;const n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeModels:function(e,t){const n=[];for(let i=0;i<e.length;i++){const r=this.get(e[i]);if(!r)continue;const o=this.indexOf(r);this.models.splice(o,1),this.length--,delete this._byId[r.cid];const s=this.modelId(r.attributes);null!=s&&delete this._byId[s],t.silent||(t.index=o,r.trigger("remove",r,this,t)),n.push(r),this._removeReference(r,t)}return n},_isModel:function(e){return e instanceof Do},_addReference:function(e,t){this._byId[e.cid]=e;const n=this.modelId(e.attributes);null!=n&&(this._byId[n]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];const n=this.modelId(e.attributes);null!=n&&delete this._byId[n],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){if(t){if(("add"===e||"remove"===e)&&n!==this)return;if("destroy"===e&&this.remove(t,i),"change"===e){const e=this.modelId(t.previousAttributes()),n=this.modelId(t.attributes);e!==n&&(null!=e&&delete this._byId[e],null!=n&&(this._byId[n]=t))}}this.trigger.apply(this,arguments)}});const zg="function"==typeof Symbol&&Symbol.iterator;zg&&(Rg.prototype[zg]=Rg.prototype.values);const Fg=function(e,t){this._collection=e,this._kind=t,this._index=0},Bg=1,qg=2,Ug=3;zg&&(Fg.prototype[zg]=function(){return this}),Fg.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){const e=this._collection.at(this._index);let t;if(this._index++,this._kind===Bg)t=e;else{const n=this._collection.modelId(e.attributes);t=this._kind===qg?n:[n,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};const Hg=function(e,t,n,i){ur.a.each(n,(function(n,r){t[r]&&(e.prototype[r]=function(e,t,n,i){switch(t){case 1:return function(){return e[n](this[i])};case 2:return function(t){return e[n](this[i],t)};case 3:return function(t,r){return e[n](this[i],$g(t,this),r)};case 4:return function(t,r,o){return e[n](this[i],$g(t,this),r,o)};default:return function(){const t=Ig.call(arguments);return t.unshift(this[i]),e[n].apply(e,t)}}}(t,n,r,i))}))},$g=function(e,t){return ur.a.isFunction(e)?e:ur.a.isObject(e)&&!t._isModel(e)?Wg(e):ur.a.isString(e)?function(t){return t.get(e)}:e},Wg=function(e){const t=ur.a.matches(e);return function(e){return t(e.attributes)}};ur.a.each([[Rg,{all:3,any:3,chain:1,collect:3,contains:3,countBy:3,detect:3,difference:0,drop:3,each:3,every:3,find:3,findIndex:3,findLastIndex:3,first:3,foldl:0,foldr:0,groupBy:3,head:3,include:3,includes:3,keyBy:3,indexOf:3,initial:3,inject:0,invokeMap:0,isEmpty:1,last:3,lastIndexOf:3,max:3,min:3,partition:3,reject:3,sample:3,select:3,shuffle:1,size:1,some:3,sortBy:3,tail:3,take:3,toArray:1,without:0},"models"],[Do,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],(function(e){const t=e[0],n=e[1],i=e[2];t.mixin=function(e){const n=ur.a.reduce(ur.a.functions(e),(function(e,t){return e[t]=0,e}),{});Hg(t,e,n,i)},Hg(t,ur.a,n,i)}));
/**
 * @module converse-omemo
 * @copyright The Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:Vg,sizzle:Gg,$build:Jg,$iq:Qg,$msg:Kg}=zn.env,Yg=zn.env.utils;Vg.addNamespace("OMEMO_DEVICELIST",Vg.NS.OMEMO+".devicelist"),Vg.addNamespace("OMEMO_VERIFICATION",Vg.NS.OMEMO+".verification"),Vg.addNamespace("OMEMO_WHITELISTED",Vg.NS.OMEMO+".whitelisted"),Vg.addNamespace("OMEMO_BUNDLES",Vg.NS.OMEMO+".bundles");const Xg={name:"AES-GCM",length:128};class Zg extends Error{constructor(e,t){super(e,t),this.name="IQError",this.iq=t}}function em(e){const t=e.querySelector("signedPreKeyPublic"),n=e.querySelector("signedPreKeySignature"),i=Gg("prekeys > preKeyPublic",e).map(e=>({id:parseInt(e.getAttribute("preKeyId"),10),key:e.textContent}));return{identity_key:e.querySelector("identityKey").textContent.trim(),signed_prekey:{id:parseInt(t.getAttribute("signedPreKeyId"),10),public_key:t.textContent,signature:n.textContent},prekeys:i}}zn.plugins.add("converse-omemo",{enabled:e=>window.libsignal&&!e.api.settings.get("blacklisted_plugins").includes("converse-omemo")&&e.config.get("trusted"),dependencies:["converse-chatview","converse-pubsub","converse-profile"],overrides:{ProfileModal:{events:{"change input.select-all":"selectAll","click .generate-bundle":"generateOMEMODeviceBundle","submit .fingerprint-removal":"removeSelectedFingerprints"},initialize(){return this.debouncedRender=Object(lr.debounce)(this.render,50),this.devicelist=yn.devicelists.get(yn.bare_jid),this.listenTo(this.devicelist.devices,"change:bundle",this.debouncedRender),this.listenTo(this.devicelist.devices,"reset",this.debouncedRender),this.listenTo(this.devicelist.devices,"reset",this.debouncedRender),this.listenTo(this.devicelist.devices,"remove",this.debouncedRender),this.listenTo(this.devicelist.devices,"add",this.debouncedRender),this.__super__.initialize.apply(this,arguments)},beforeRender(){const e=yn.omemo_store.get("device_id");if(e&&(this.current_device=this.devicelist.devices.get(e)),this.other_devices=this.devicelist.devices.filter(t=>t.get("id")!==e),this.__super__.beforeRender)return this.__super__.beforeRender.apply(this,arguments)},selectAll(e){let t=Yg.ancestor(e.target,"li");for(;t;)t.querySelector('input[type="checkbox"]').checked=e.target.checked,t=t.nextElementSibling},removeSelectedFingerprints(e){e.preventDefault(),e.stopPropagation(),e.target.querySelector(".select-all").checked=!1;const t=Gg('.fingerprint-removal-item input[type="checkbox"]:checked',e.target).map(e=>e.value);this.devicelist.removeOwnDevices(t).then(this.modal.hide).catch(e=>{st.error(e),yn.api.alert(Vg.LogLevel.ERROR,ne("Error"),[ne("Sorry, an error occurred while trying to remove the devices.")])})},generateOMEMODeviceBundle(e){e.preventDefault(),confirm(ne("Are you sure you want to generate new OMEMO keys? This will remove your old keys and all previously encrypted messages will no longer be decryptable on this device."))&&xn.omemo.bundle.generate()}},UserDetailsModal:{events:{"click .fingerprint-trust .btn input":"toggleDeviceTrust"},initialize(){const e=this.model.get("jid");return this.devicelist=yn.devicelists.getDeviceList(e),this.listenTo(this.devicelist.devices,"change:bundle",this.render),this.listenTo(this.devicelist.devices,"change:trusted",this.render),this.listenTo(this.devicelist.devices,"remove",this.render),this.listenTo(this.devicelist.devices,"add",this.render),this.listenTo(this.devicelist.devices,"reset",this.render),this.__super__.initialize.apply(this,arguments)},toggleDeviceTrust(e){const t=e.target;this.devicelist.devices.get(t.getAttribute("name")).save("trusted",parseInt(t.value,10))}},ChatBox:{async sendMessage(e,t){if(this.get("omemo_active")&&e){const n=this.getOutgoingMessageAttributes(e,t);let i,r;n.is_encrypted=!0,n.plaintext=n.message;try{const e=await yn.getBundlesAndBuildSessions(this);i=await this.createMessage(n),r=await yn.createOMEMOMessageStanza(this,i,e)}catch(e){return this.handleMessageSendError(e),null}return yn.api.send(r),i}return this.__super__.sendMessage.apply(this,arguments)}},ChatBoxView:{events:{"click .toggle-omemo":"toggleOMEMO"},initialize(){this.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"change:omemo_active",this.renderOMEMOToolbarButton),this.listenTo(this.model,"change:omemo_supported",this.onOMEMOSupportedDetermined)},showMessage(e){if(!e.get("is_only_key"))return this.__super__.showMessage.apply(this,arguments)}},ChatRoomView:{events:{"click .toggle-omemo":"toggleOMEMO"},initialize(){this.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"change:omemo_active",this.renderOMEMOToolbarButton),this.listenTo(this.model,"change:omemo_supported",this.onOMEMOSupportedDetermined)}}},initialize(){xn.settings.update({omemo_default:!1}),xn.promises.add(["OMEMOInitialized"]),yn.NUM_PREKEYS=100;const e={async encryptMessage(e){const t=crypto.getRandomValues(new window.Uint8Array(12)),n=await crypto.subtle.generateKey(Xg,!0,["encrypt","decrypt"]),i={name:"AES-GCM",iv:t,tagLength:128},r=await crypto.subtle.encrypt(i,n,Yg.stringToArrayBuffer(e)),o=r.byteLength-16,s=r.slice(0,o),a=r.slice(o),c=await crypto.subtle.exportKey("raw",n);return Promise.resolve({key:c,tag:a,key_and_tag:Yg.appendArrayBuffer(c,a),payload:Yg.arrayBufferToBase64(s),iv:Yg.arrayBufferToBase64(t)})},async decryptMessage(e){const t=await crypto.subtle.importKey("raw",e.key,Xg,!0,["encrypt","decrypt"]),n=Yg.appendArrayBuffer(Yg.base64ToArrayBuffer(e.payload),e.tag),i={name:"AES-GCM",iv:Yg.base64ToArrayBuffer(e.iv),tagLength:128};return Yg.arrayBufferToString(await crypto.subtle.decrypt(i,t,n))},reportDecryptionError(e){"debug"===xn.settings.get("loglevel")&&this.createMessage({message:ne("Sorry, could not decrypt a received OMEMO message due to an error.")+" ".concat(e.name," ").concat(e.message),type:"error"}),st.error("".concat(e.name," ").concat(e.message))},async handleDecryptedWhisperMessage(e,t){const n=e.encrypted,i=yn.devicelists.getDeviceList(this.get("jid"));await i._devices_promise,this.save("omemo_supported",!0);let r=i.get(n.device_id);if(r||(r=await i.devices.create({id:n.device_id,jid:e.from},{promise:!0})),n.payload){const e=t.slice(0,16),i=t.slice(16),o=await this.decryptMessage(Object.assign(n,{key:e,tag:i}));return r.save("active",!0),o}},async decrypt(e){const t=this.getSessionCipher(e.from,parseInt(e.encrypted.device_id,10)),n=Yg.base64ToArrayBuffer(e.encrypted.key);if(!0===e.encrypted.prekey)try{const i=await t.decryptPreKeyWhisperMessage(n,"binary"),r=await this.handleDecryptedWhisperMessage(e,i);return await yn.omemo_store.generateMissingPreKeys(),await yn.omemo_store.publishBundle(),r?Object.assign(e,{plaintext:r}):Object.assign(e,{is_only_key:!0})}catch(t){return this.reportDecryptionError(t),e}else try{const i=await t.decryptWhisperMessage(n,"binary"),r=await this.handleDecryptedWhisperMessage(e,i);return Object.assign(e,{plaintext:r})}catch(t){return this.reportDecryptionError(t),e}},getSessionCipher(e,t){const n=new libsignal.SignalProtocolAddress(e,t);return this.session_cipher=new window.libsignal.SessionCipher(yn.omemo_store,n),this.session_cipher},encryptKey(e,t){return this.getSessionCipher(t.get("jid"),t.get("id")).encrypt(e).then(e=>({payload:e,device:t}))},handleMessageSendError(e){if("IQError"===e.name){this.save("omemo_supported",!1);const t=[];Gg('presence-subscription-required[xmlns="'.concat(Vg.NS.PUBSUB_ERROR,'"]'),e.iq).length?t.push(ne("Sorry, we're unable to send an encrypted message because %1$s requires you to be subscribed to their presence in order to see their OMEMO information",e.iq.getAttribute("from"))):Gg('remote-server-not-found[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]',e.iq).length?t.push(ne("Sorry, we're unable to send an encrypted message because the remote server for %1$s could not be found",e.iq.getAttribute("from"))):(t.push(ne("Unable to send an encrypted message due to an unexpected error.")),t.push(e.iq.outerHTML)),xn.alert("error",ne("Error"),t),st.error(e)}else{if(!e.user_facing)throw e;xn.alert("error",ne("Error"),[e.message]),st.error(e)}}};Object.assign(yn.ChatBox.prototype,e);const t={onOMEMOSupportedDetermined(){!this.model.get("omemo_supported")&&this.model.get("omemo_active")?this.model.set("omemo_active",!1):this.renderOMEMOToolbarButton()},renderOMEMOToolbarButton(){if(this.model.get("type")!==yn.CHATROOMS_TYPE||this.model.features.get("membersonly")&&this.model.features.get("nonanonymous")){const e=this.el.querySelector(".toggle-omemo"),t=Mg()(Object.assign(this.model.toJSON(),{__:ne}));e?e.outerHTML=t:this.el.querySelector(".chat-toolbar").insertAdjacentHTML("beforeend",t)}else{const e=this.el.querySelector(".toggle-omemo");e&&e.parentElement.removeChild(e)}},toggleOMEMO(e){if(!this.model.get("omemo_supported")){let e;return e=this.model.get("type")===yn.CHATROOMS_TYPE?[ne("Cannot use end-to-end encryption in this groupchat, either the groupchat has some anonymity or not all participants support OMEMO.")]:[ne("Cannot use end-to-end encryption because %1$s uses a client that doesn't support OMEMO.",this.model.contact.getDisplayName())],xn.alert("error",ne("Error"),e)}e.preventDefault(),this.model.save({omemo_active:!this.model.get("omemo_active")})}};async function n(e){var t;if(null===(t=e.get("bundle"))||void 0===t?void 0:t.fingerprint)return;const n=await e.getBundle();n.fingerprint=Yg.arrayBufferToHex(Yg.base64ToArrayBuffer(n.identity_key)),e.save("bundle",n),e.trigger("change:bundle")}async function i(e){await xn.waitUntil("OMEMOInitialized");const t=yn.devicelists.get(e)||yn.devicelists.create({jid:e});return await t.fetchDevices(),t.devices}async function r(e){const t=new libsignal.SignalProtocolAddress(e.get("jid"),e.get("id")),n=await yn.omemo_store.loadSession(t.toString());if(n)return Promise.resolve(n);try{return await async function(e){const t=new libsignal.SignalProtocolAddress(e.get("jid"),e.get("id")),n=new libsignal.SessionBuilder(yn.omemo_store,t),i=e.getRandomPreKey(),r=await e.getBundle();return n.processPreKey({registrationId:parseInt(e.get("id"),10),identityKey:Yg.base64ToArrayBuffer(r.identity_key),signedPreKey:{keyId:r.signed_prekey.id,publicKey:Yg.base64ToArrayBuffer(r.signed_prekey.public_key),signature:Yg.base64ToArrayBuffer(r.signed_prekey.signature)},preKey:{keyId:i.id,publicKey:Yg.base64ToArrayBuffer(i.key)}})}(e)}catch(t){return st.error("Could not build an OMEMO session for device ".concat(e.get("id"))),st.error(t),null}}async function o(){await new Promise((e,t)=>yn.devicelists.fetch({success:e,error:(e,n)=>t(n)}));let e=yn.devicelists.get(yn.bare_jid);return e?e.fetchDevices():e=await yn.devicelists.create({jid:yn.bare_jid},{promise:!0}),e._devices_promise}function s(){if(void 0===yn.omemo_store){const e="converse.omemosession-".concat(yn.bare_jid);yn.omemo_store=new yn.OMEMOStore({id:e}),yn.omemo_store.browserStorage=yn.createStore(e)}return yn.omemo_store.fetchSession()}async function a(e){let t;e.get("type")===yn.CHATROOMS_TYPE?(await xn.waitUntil("OMEMOInitialized"),t=e.features.get("nonanonymous")&&e.features.get("membersonly")):e.get("type")===yn.PRIVATE_CHAT_TYPE&&(t=await yn.contactHasOMEMOSupport(e.get("jid"))),e.set("omemo_supported",t),t&&xn.settings.get("omemo_default")&&e.set("omemo_active",!0)}Object.assign(yn.ChatBoxView.prototype,t),yn.generateFingerprints=async function(e){const t=await i(e);return Promise.all(t.map(e=>n(e)))},yn.getDeviceForContact=function(e,t){return i(e).then(e=>e.get(t))},yn.contactHasOMEMOSupport=async function(e){return(await i(e)).length>0},yn.getBundlesAndBuildSessions=async function(e){const t=ne("Sorry, no devices found to which we can send an OMEMO encrypted message.");let n;if(e.get("type")===yn.CHATROOMS_TYPE){const t=await Promise.all(e.occupants.map(e=>i(e.get("jid"))));n=t.reduce((e,t)=>Object(lr.concat)(e,t.models),[])}else if(e.get("type")===yn.PRIVATE_CHAT_TYPE){const r=await i(e.get("jid"));if(0===r.length){const e=new Error(t);throw e.user_facing=!0,e}const o=yn.devicelists.get(yn.bare_jid).devices;n=[...o.models,...r.models]}const o=yn.omemo_store.get("device_id");n=n.filter(e=>e.get("id")!==o),await Promise.all(n.map(e=>e.getBundle()));const s=await Promise.all(n.map(e=>r(e)));if(s.includes(null)&&(n=n.filter(e=>s[n.indexOf(e)]),0===n.length)){const e=new Error(t);throw e.user_facing=!0,e}return n},yn.createOMEMOMessageStanza=function(e,t,n){const i=ne("This is an OMEMO encrypted message which your client doesn’t seem to support. Find more information on https://conversations.im/omemo");if(!t.get("message"))throw new Error("No message body to encrypt!");const r=Kg({from:yn.connection.jid,to:e.get("jid"),type:e.get("message_type"),id:t.get("msgid")}).c("body").t(i).up();return"chat"===t.get("type")&&r.c("request",{xmlns:Vg.NS.RECEIPTS}).up(),r.c("encrypted",{xmlns:Vg.NS.OMEMO}).c("header",{sid:yn.omemo_store.get("device_id")}),e.encryptMessage(t.get("message")).then(t=>{const i=n.filter(e=>-1!=e.get("trusted")&&e.get("active")).map(n=>e.encryptKey(t.key_and_tag,n));return Promise.all(i).then(e=>function(e,t,n){for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const r=t[i].payload,o=t[i].device,s=3==parseInt(r.type,10);e.c("key",{rid:o.get("id")}).t(btoa(r.body)),s&&e.attrs({prekey:s}),e.up(),i==t.length-1&&e.c("iv").t(n).up().up()}return Promise.resolve(e)}(r,e,t.iv)).then(e=>(e.c("payload").t(t.payload).up().up(),e.c("store",{xmlns:Vg.NS.HINTS}),e))})},yn.OMEMOStore=Do.extend({Direction:{SENDING:1,RECEIVING:2},getIdentityKeyPair(){const e=this.get("identity_keypair");return Promise.resolve({privKey:Yg.base64ToArrayBuffer(e.privKey),pubKey:Yg.base64ToArrayBuffer(e.pubKey)})},getLocalRegistrationId(){return Promise.resolve(parseInt(this.get("device_id"),10))},isTrustedIdentity(e,t,n){if(null==e)throw new Error("Can't check identity key for invalid key");if(!(t instanceof ArrayBuffer))throw new Error("Expected identity_key to be an ArrayBuffer");const i=this.get("identity_key"+e);return void 0===i?Promise.resolve(!0):Promise.resolve(Yg.arrayBufferToBase64(t)===i)},loadIdentityKey(e){if(null==e)throw new Error("Can't load identity_key for invalid identifier");return Promise.resolve(Yg.base64ToArrayBuffer(this.get("identity_key"+e)))},saveIdentity(e,t){if(null==e)throw new Error("Can't save identity_key for invalid identifier");const n=new libsignal.SignalProtocolAddress.fromString(e),i=this.get("identity_key"+n.getName()),r=Yg.arrayBufferToBase64(t);return this.save("identity_key"+n.getName(),r),i&&r!==i?Promise.resolve(!0):Promise.resolve(!1)},getPreKeys(){return this.get("prekeys")||{}},loadPreKey(e){const t=this.getPreKeys()[e];return t?Promise.resolve({privKey:Yg.base64ToArrayBuffer(t.privKey),pubKey:Yg.base64ToArrayBuffer(t.pubKey)}):Promise.resolve()},storePreKey(e,t){const n={};return n[e]={pubKey:Yg.arrayBufferToBase64(t.pubKey),privKey:Yg.arrayBufferToBase64(t.privKey)},this.save("prekeys",Object.assign(this.getPreKeys(),n)),Promise.resolve()},removePreKey(e){return this.save("prekeys",Object(lr.omit)(this.getPreKeys(),e)),Promise.resolve()},loadSignedPreKey(e){const t=this.get("signed_prekey");return t?Promise.resolve({privKey:Yg.base64ToArrayBuffer(t.privKey),pubKey:Yg.base64ToArrayBuffer(t.pubKey)}):Promise.resolve()},storeSignedPreKey(e){if("object"!=typeof e)throw new Error("storeSignedPreKey: expected an object");return this.save("signed_prekey",{id:e.keyId,privKey:Yg.arrayBufferToBase64(e.keyPair.privKey),pubKey:Yg.arrayBufferToBase64(e.keyPair.pubKey),signature:Yg.arrayBufferToBase64(e.signature)}),Promise.resolve()},removeSignedPreKey(e){return this.get("signed_prekey").id===e&&(this.unset("signed_prekey"),this.save()),Promise.resolve()},loadSession(e){return Promise.resolve(this.get("session"+e))},storeSession(e,t){return Promise.resolve(this.save("session"+e,t))},removeSession(e){return Promise.resolve(this.unset("session"+e))},removeAllSessions(e){const t=Object.keys(this.attributes).filter(t=>!!t.startsWith("session"+e)&&t),n={};return t.forEach(e=>{n[e]=void 0}),this.save(n),Promise.resolve()},publishBundle(){const e=this.get("signed_prekey"),t="".concat(Vg.NS.OMEMO_BUNDLES,":").concat(this.get("device_id")),n=Jg("item").c("bundle",{xmlns:Vg.NS.OMEMO}).c("signedPreKeyPublic",{signedPreKeyId:e.id}).t(e.pubKey).up().c("signedPreKeySignature").t(e.signature).up().c("identityKey").t(this.get("identity_keypair").pubKey).up().c("prekeys");Object.values(this.get("prekeys")).forEach((e,t)=>n.c("preKeyPublic",{preKeyId:t}).t(e.pubKey).up());return xn.pubsub.publish(null,t,n,{"pubsub#access_model":"open"},!1)},async generateMissingPreKeys(){const e=Object(lr.difference)(Object(lr.invokeMap)(Object(lr.range)(0,yn.NUM_PREKEYS),Number.prototype.toString),Object.keys(this.getPreKeys()));if(e.length<1)return st.warn("No missing prekeys to generate for our own device"),Promise.resolve();(await Promise.all(e.map(e=>libsignal.KeyHelper.generatePreKey(parseInt(e,10))))).forEach(e=>this.storePreKey(e.keyId,e.keyPair));const t=Object.keys(this.getPreKeys()).map(e=>({id:e.keyId,key:Yg.arrayBufferToBase64(e.pubKey)})),n=yn.devicelists.get(yn.bare_jid).devices.get(this.get("device_id")),i=await n.getBundle();n.save("bundle",Object.assign(i,{prekeys:t}))},async generateBundle(){const e=await libsignal.KeyHelper.generateIdentityKeyPair(),t={},n=Yg.arrayBufferToBase64(e.pubKey),i=function(){const e=yn.devicelists.get(yn.bare_jid).devices.pluck("id");let t=libsignal.KeyHelper.generateRegistrationId(),n=0;for(;e.includes(t);)if(t=libsignal.KeyHelper.generateRegistrationId(),n++,10==n)throw new Error("Unable to generate a unique device ID");return t.toString()}();t.identity_key=n,t.device_id=i,this.save({device_id:i,identity_keypair:{privKey:Yg.arrayBufferToBase64(e.privKey),pubKey:n},identity_key:n});const r=await libsignal.KeyHelper.generateSignedPreKey(e,0);yn.omemo_store.storeSignedPreKey(r),t.signed_prekey={id:r.keyId,public_key:Yg.arrayBufferToBase64(r.keyPair.privKey),signature:Yg.arrayBufferToBase64(r.signature)};const o=await Promise.all(Object(lr.range)(0,yn.NUM_PREKEYS).map(e=>libsignal.KeyHelper.generatePreKey(e)));o.forEach(e=>yn.omemo_store.storePreKey(e.keyId,e.keyPair));const s=yn.devicelists.get(yn.bare_jid),a=await s.devices.create({id:t.device_id,jid:yn.bare_jid},{promise:!0}),c=o.map(e=>({id:e.keyId,key:Yg.arrayBufferToBase64(e.keyPair.pubKey)}));t.prekeys=c,a.save("bundle",t)},fetchSession(){return void 0===this._setup_promise&&(this._setup_promise=new Promise((e,t)=>{this.fetch({success:()=>{yn.omemo_store.get("device_id")?e():this.generateBundle().then(e).catch(t)},error:(n,i)=>{st.warn("Could not fetch OMEMO session from cache, we'll generate a new one."),st.warn(i),this.generateBundle().then(e).catch(t)}})})),this._setup_promise}}),yn.Device=Do.extend({defaults:{trusted:0,active:!0},getRandomPreKey(){const e=this.get("bundle");return e.prekeys[Yg.getRandomInt(e.prekeys.length)]},async fetchBundleFromServer(){const e=Qg({type:"get",from:yn.bare_jid,to:this.get("jid")}).c("pubsub",{xmlns:Vg.NS.PUBSUB}).c("items",{node:"".concat(Vg.NS.OMEMO_BUNDLES,":").concat(this.get("id"))});let t;try{t=await xn.sendIQ(e)}catch(t){throw new Zg("Could not fetch bundle",t)}if(t.querySelector("error"))throw new Zg("Could not fetch bundle",t);const n=Gg('items[node="'.concat(Vg.NS.OMEMO_BUNDLES,":").concat(this.get("id"),'"]'),t).pop(),i=em(Gg('bundle[xmlns="'.concat(Vg.NS.OMEMO,'"]'),n).pop());return this.save("bundle",i),i},getBundle(){return this.get("bundle")?Promise.resolve(this.get("bundle"),this):this.fetchBundleFromServer()}}),yn.Devices=Rg.extend({model:yn.Device}),yn.DeviceList=Do.extend({idAttribute:"jid",initialize(){this.devices=new yn.Devices;const e="converse.devicelist-".concat(yn.bare_jid,"-").concat(this.get("jid"));this.devices.browserStorage=yn.createStore(e),this.fetchDevices()},async onDevicesFound(e){if(0===e.length){let e;try{e=await this.fetchDevicesFromServer()}catch(e){null===e?st.error("Timeout error while fetching devices for ".concat(this.get("jid"))):(st.error("Could not fetch devices for ".concat(this.get("jid"))),st.error(e)),this.destroy()}this.get("jid")===yn.bare_jid&&await this.publishCurrentDevice(e)}},fetchDevices(){return void 0===this._devices_promise&&(this._devices_promise=new Promise(e=>{this.devices.fetch({success:t=>e(this.onDevicesFound(t)),error:(t,n)=>{st.error(n),e()}})})),this._devices_promise},async publishCurrentDevice(e){if(this.get("jid")!==yn.bare_jid)return;await s();let t=yn.omemo_store.get("device_id");return this.devices.findWhere({id:t})||(await yn.omemo_store.generateBundle(),t=yn.omemo_store.get("device_id")),e.includes(t)?void 0:this.publishDevices()},async fetchDevicesFromServer(){const e=Qg({type:"get",from:yn.bare_jid,to:this.get("jid")}).c("pubsub",{xmlns:Vg.NS.PUBSUB}).c("items",{node:Vg.NS.OMEMO_DEVICELIST});let t;try{t=await xn.sendIQ(e)}catch(e){return st.error(e),[]}const n='list[xmlns="'.concat(Vg.NS.OMEMO,'"] device'),i=Gg(n,t).map(e=>e.getAttribute("id"));return await Promise.all(i.map(e=>this.devices.create({id:e,jid:this.get("jid")},{promise:!0}))),i},publishDevices(){const e=Jg("item").c("list",{xmlns:Vg.NS.OMEMO});this.devices.filter(e=>e.get("active")).forEach(t=>e.c("device",{id:t.get("id")}).up());return xn.pubsub.publish(null,Vg.NS.OMEMO_DEVICELIST,e,{"pubsub#access_model":"open"},!1)},removeOwnDevices(e){if(this.get("jid")!==yn.bare_jid)throw new Error("Cannot remove devices from someone else's device list");return e.forEach(e=>this.devices.get(e).destroy()),this.publishDevices()}}),yn.DeviceLists=Rg.extend({model:yn.DeviceList,getDeviceList(e){return this.get(e)||this.create({jid:e})}}),xn.waitUntil("chatBoxesInitialized").then(()=>yn.chatboxes.on("add",e=>{a(e),e.get("type")===yn.CHATROOMS_TYPE&&(e.occupants.on("add",t=>async function(e,t){if(!t.isSelf()&&e.features.get("nonanonymous")&&e.features.get("membersonly")&&e.get("omemo_active")){await yn.contactHasOMEMOSupport(t.get("jid"))||(e.createMessage({message:ne("%1$s doesn't appear to have a client that supports OMEMO. Encrypted chat will no longer be possible in this grouchat.",t.get("nick")),type:"error"}),e.save({omemo_active:!1,omemo_supported:!1}))}}(e,t)),e.features.on("change",()=>a(e)))})),xn.listen.on("connected",(function(){yn.connection.addHandler(e=>{try{Gg('event[xmlns="'.concat(Vg.NS.PUBSUB,'#event"]'),e).length&&(function(e){const t=Gg('items[node="'.concat(Vg.NS.OMEMO_DEVICELIST,'"]'),e).pop();if(!t)return;const n='item list[xmlns="'.concat(Vg.NS.OMEMO,'"] device'),i=Gg(n,t).map(e=>e.getAttribute("id")),r=e.getAttribute("from"),o=yn.devicelists.getDeviceList(r),s=o.devices;Object(lr.difference)(s.pluck("id"),i).forEach(e=>{r===yn.bare_jid&&e===yn.omemo_store.get("device_id")||s.get(e).save("active",!1)}),i.forEach(e=>{const t=s.get(e);t?t.save("active",!0):s.create({id:e,jid:r})}),Yg.isSameBareJID(r,yn.bare_jid)&&o.publishCurrentDevice(i)}(e),function(e){const t=Gg("items",e).pop();if(!t||!t.getAttribute("node").startsWith(Vg.NS.OMEMO_BUNDLES))return;const n=t.getAttribute("node").split(":")[1],i=e.getAttribute("from"),r=Gg("item > bundle",t).pop(),o=yn.devicelists.getDeviceList(i);(o.devices.get(n)||o.devices.create({id:n,jid:i})).save({bundle:em(r)})}(e))}catch(e){st.error(e.message)}return!0},null,"message","headline")})),xn.listen.on("renderToolbar",e=>e.renderOMEMOToolbarButton()),xn.listen.on("statusInitialized",(async function(){if(!yn.config.get("trusted"))return;yn.devicelists=new yn.DeviceLists;const e="converse.devicelists-".concat(yn.bare_jid);yn.devicelists.browserStorage=yn.createStore(e);try{await o(),await s(),await yn.omemo_store.publishBundle()}catch(e){return st.error("Could not initialize OMEMO support"),void st.error(e)}xn.trigger("OMEMOInitialized")})),xn.listen.on("addClientFeatures",()=>xn.disco.own.features.add("".concat(Vg.NS.OMEMO_DEVICELIST,"+notify"))),xn.listen.on("userDetailsModalInitialized",e=>{const t=e.get("jid");yn.generateFingerprints(t).catch(e=>st.error(e))}),xn.listen.on("profileModalInitialized",()=>{yn.generateFingerprints(yn.bare_jid).catch(e=>st.error(e))}),xn.listen.on("afterTearDown",()=>delete yn.omemo_store),xn.listen.on("clearSession",()=>{yn.shouldClearCache()&&yn.devicelists&&(yn.devicelists.clearStore(),delete yn.devicelists)}),Object.assign(yn.api,{omemo:{bundle:{generate:async()=>{const e=yn.devicelists.get(yn.bare_jid),t=yn.omemo_store.get("device_id");if(t){const n=e.devices.get(t);yn.omemo_store.unset(t),n&&await new Promise(e=>n.destroy({success:e,error:e})),e.devices.trigger("remove")}return await yn.omemo_store.generateBundle(),await e.publishDevices(),n(e.devices.get(yn.omemo_store.get("device_id")))}}}})}});
/**
 * @module converse-push
 * @description
 * Converse.js plugin which add support for registering
 * an "App Server" as defined in  XEP-0357
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:tm,$iq:nm}=zn.env;tm.addNamespace("PUSH","urn:xmpp:push:0"),zn.plugins.add("converse-push",{initialize(){async function e(e){e=e||yn.bare_jid;const t=yn.session.get("push_enabled")||[];if(t.includes(e))return;const n=Object(lr.reject)(xn.settings.get("push_app_servers"),"disable"),i=Object(lr.filter)(xn.settings.get("push_app_servers"),"disable"),r=n.map(t=>async function(e,t){if(!t.jid||!t.node)return;if(!await xn.disco.getIdentity("pubsub","push",t.jid))return st.warn('Not enabling push the service "'.concat(t.jid,"\", it doesn't have the right disco identtiy."));const n=await Promise.all([xn.disco.supports(tm.NS.PUSH,t.jid),xn.disco.supports(tm.NS.PUSH,e)]);if(!n[0]&&!n[1])return void st.warn('Not enabling push app server "'.concat(t.jid,'", no disco support from your server.'));const i=nm({type:"set"});return e!==yn.bare_jid&&i.attrs({to:e}),i.c("enable",{xmlns:tm.NS.PUSH,jid:t.jid,node:t.node}),t.secret&&i.c("x",{xmlns:tm.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE"}).c("value").t("".concat(tm.NS.PUBSUB,"#publish-options")).up().up().c("field",{var:"secret"}).c("value").t(t.secret),xn.sendIQ(i)}(e,t)),o=i.map(t=>async function(e,t){if(!t.jid)return;if(!await xn.disco.supports(tm.NS.PUSH,e||yn.bare_jid))return void st.warn('Not disabling push app server "'.concat(t.jid,'", no disco support from your server.'));const n=nm({type:"set"});e!==yn.bare_jid&&n.attrs({to:e}),n.c("disable",{xmlns:tm.NS.PUSH,jid:t.jid}),t.node&&n.attrs({node:t.node}),xn.sendIQ(n).catch(e=>{st.error("Could not disable push app server for ".concat(t.jid)),st.error(e)})}(e,t));try{await Promise.all(r.concat(o))}catch(e){st.error("Could not enable or disable push App Server"),e&&st.error(e)}finally{t.push(e)}yn.session.save("push_enabled",t)}function t(t){t.get("type")==yn.CHATROOMS_TYPE&&e(tm.getDomainFromJid(t.get("jid")))}xn.settings.update({push_app_servers:[],enable_muc_push:!1}),xn.listen.on("statusInitialized",()=>e()),xn.settings.get("enable_muc_push")&&xn.listen.on("chatBoxesInitialized",()=>yn.chatboxes.on("add",t))}});var im=n(145),rm=n.n(im),om=n(146),sm=n.n(om),am=n(147),cm=n.n(am);
/**
 * @module converse-register
 * @description
 * This is a Converse.js plugin which add support for in-band registration
 * as specified in XEP-0077.
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:lm,sizzle:um,$iq:dm}=zn.env,hm=zn.env.utils;lm.addNamespace("REGISTER","jabber:iq:register");const fm=Object.keys(lm.Status).reduce((e,t)=>Math.max(e,lm.Status[t]),0);function pm(){const e=bm(['\n    <div class="list-container list-container--openrooms ','">\n        <a class="list-toggle open-rooms-toggle controlbox-padded" title="','" @click=','>\n        <span class="fa ','"></span> ','</a>\n        <div class="items-list rooms-list open-rooms-list ','">\n            ',"\n        </div>\n    </div>\n"]);return pm=function(){return e},e}function gm(){const e=bm(['\n    <div class="list-item controlbox-padded available-chatroom d-flex flex-row '," ",'"\n         data-room-jid="','">\n\n        ','\n        <a class="list-item-link open-room available-room w-100"\n           data-room-jid="','"\n           title="','"\n           @click=',">","</a>\n\n        ",'\n\n        <a class="list-item-action room-info fa fa-info-circle"\n           data-room-jid="','"\n           title="','"\n           @click=','></a>\n\n        <a class="list-item-action fa fa-sign-out-alt close-room"\n           data-room-jid="','"\n           data-room-name="','"\n           title="','"\n           @click=',"></a>\n    </div>\n"]);return gm=function(){return e},e}function mm(){const e=bm(['\n            <a class="list-item-action fa fa-bookmark add-bookmark"\n               data-room-jid="','"\n               data-bookmark-name="','"\n               @click=','\n               title="','"></a>']);return mm=function(){return e},e}function vm(){const e=bm(['\n            <a class="list-item-action fa fa-bookmark remove-bookmark button-on"\n               data-room-jid="','"\n               data-bookmark-name="','"\n               @click=','\n               title="','"></a>']);return vm=function(){return e},e}function _m(){const e=bm(['<span class="list-item-badge badge badge-room-color msgs-indicator">',"</span>"]);return _m=function(){return e},e}function bm(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}lm.Status.REGIFAIL=fm+1,lm.Status.REGISTERED=fm+2,lm.Status.CONFLICT=fm+3,lm.Status.NOTACCEPTABLE=fm+5,zn.plugins.add("converse-register",{enabled:()=>!0,overrides:{ControlBoxView:{renderLoginPanel(){return this.__super__.renderLoginPanel.apply(this,arguments),this.renderRegistrationPanel(),this}}},initialize(){function e(e){xn.waitUntil("controlBoxInitialized").then(()=>{yn.chatboxes.get("controlbox").set({"active-form":e})}).catch(e=>st.fatal(e))}yn.CONNECTION_STATUS[lm.Status.REGIFAIL]="REGIFAIL",yn.CONNECTION_STATUS[lm.Status.REGISTERED]="REGISTERED",yn.CONNECTION_STATUS[lm.Status.CONFLICT]="CONFLICT",yn.CONNECTION_STATUS[lm.Status.NOTACCEPTABLE]="NOTACCEPTABLE",xn.settings.update({allow_registration:!0,domain_placeholder:ne(" e.g. conversejs.org"),providers_link:"https://compliance.conversations.im/",registration_domain:""}),Object.assign(yn.ControlBoxView.prototype,{showLoginOrRegisterForm(){this.registerpanel&&("register"==this.model.get("active-form")?(this.loginpanel.el.classList.add("hidden"),this.registerpanel.el.classList.remove("hidden")):(this.loginpanel.el.classList.remove("hidden"),this.registerpanel.el.classList.add("hidden")))},renderRegistrationPanel(){if(xn.settings.get("allow_registration")){this.registerpanel=new yn.RegisterPanel({model:this.model}),this.registerpanel.render(),this.registerpanel.el.classList.add("hidden");const e=this.el.querySelector("#converse-login-panel");e&&e.insertAdjacentElement("afterend",this.registerpanel.el),this.showLoginOrRegisterForm()}return this}}),yn.router.route("converse/login",()=>e("login")),yn.router.route("converse/register",()=>e("register")),yn.RegisterPanel=Fo.extend({tagName:"div",id:"converse-register-panel",className:"controlbox-pane fade-in",events:{"submit form#converse-register":"onFormSubmission","click .button-cancel":"renderProviderChoiceForm"},initialize(){this.reset(),xn.listen.on("connectionInitialized",()=>this.registerHooks())},render(){return this.model.set("registration_form_rendered",!1),this.el.innerHTML=rm()({__:ne,default_domain:xn.settings.get("registration_domain"),label_register:ne("Fetch registration form"),help_providers:ne("Tip: A list of public XMPP providers is available"),help_providers_link:ne("here"),href_providers:xn.settings.get("providers_link"),domain_placeholder:xn.settings.get("domain_placeholder")}),xn.settings.get("registration_domain")&&this.fetchRegistrationForm(xn.settings.get("registration_domain")),this},registerHooks(){const e=yn.connection,t=e._connect_cb.bind(e);e._connect_cb=(e,n,i)=>{this._registering?this.getRegistrationFields(e,n)&&(this._registering=!1):t(e,n,i)}},getRegistrationFields(e,t){const n=yn.connection;n.connected=!0;const i=n._proto._reqToData(e);if(!i)return;if(n._proto._connect_cb(i)===lm.Status.CONNFAIL)return this.showValidationError(ne("Sorry, we're unable to connect to your chosen provider.")),!1;const r=i.getElementsByTagName("register"),o=i.getElementsByTagName("mechanism");if(0===r.length&&0===o.length)return n._proto._no_auth_received(t),!1;if(0===r.length)return n._changeConnectStatus(lm.Status.REGIFAIL),this.showValidationError(ne("Sorry, the given provider does not support in band account registration. Please try with a different provider.")),!0;n._addSysHandler(this.onRegistrationFields.bind(this),null,"iq",null,null);const s=dm({type:"get"}).c("query",{xmlns:lm.NS.REGISTER}).tree();return s.setAttribute("id",n.getUniqueId("sendIQ")),n.send(s),n.connected=!1,!0},onRegistrationFields(e){return"error"===e.getAttribute("type")?(yn.connection._changeConnectStatus(lm.Status.REGIFAIL,ne('Something went wrong while establishing a connection with "%1$s". Are you sure it exists?',this.domain)),!1):1!==e.getElementsByTagName("query").length?(yn.connection._changeConnectStatus(lm.Status.REGIFAIL,"unknown"),!1):(this.setFields(e),this.model.get("registration_form_rendered")||this.renderRegistrationForm(e),!1)},reset(e){const t={fields:{},urls:[],title:"",instructions:"",registered:!1,_registering:!1,domain:null,form_type:null};Object.assign(this,t),e&&Object.assign(this,Object(lr.pick)(e,Object.keys(t)))},onFormSubmission(e){e&&e.preventDefault&&e.preventDefault(),null===e.target.querySelector("input[name=domain]")?this.submitRegistrationForm(e.target):this.onProviderChosen(e.target)},onProviderChosen(e){const t=e.querySelector("input[name=domain]"),n=null==t?void 0:t.value;n?(e.querySelector("input[type=submit]").classList.add("hidden"),this.fetchRegistrationForm(n.trim())):t.classList.add("error")},async fetchRegistrationForm(e){return this.model.get("registration_form_rendered")||this.renderRegistrationRequest(),this.reset({domain:lm.getDomainFromJid(e),_registering:!0}),await yn.initConnection(this.domain),yn.connection.connect(this.domain,"",e=>this.onConnectStatusChanged(e)),!1},renderRegistrationRequest(){this.clearRegistrationForm().insertAdjacentHTML("beforeend",cm()({__:yn.__,cancel:xn.settings.get("registration_domain")}))},giveFeedback(e,t){let n=this.el.querySelector(".reg-feedback");null!==n&&n.parentNode.removeChild(n);const i=this.el.querySelector("form");i.insertAdjacentHTML("afterbegin",'<span class="reg-feedback"></span>'),n=i.querySelector(".reg-feedback"),n.textContent=e,t&&n.classList.add(t)},clearRegistrationForm(){const e=this.el.querySelector("form");return e.innerHTML="",this.model.set("registration_form_rendered",!1),e},showSpinner(){return this.el.querySelector("form").innerHTML=ta()(),this.model.set("registration_form_rendered",!1),this},onConnectStatusChanged(e){st.debug("converse-register: onConnectStatusChanged"),[lm.Status.DISCONNECTED,lm.Status.CONNFAIL,lm.Status.REGIFAIL,lm.Status.NOTACCEPTABLE,lm.Status.CONFLICT].includes(e)?(st.error("Problem during registration: Strophe.Status is ".concat(yn.CONNECTION_STATUS[e])),this.abortRegistration()):e===lm.Status.REGISTERED&&(st.debug("Registered successfully."),yn.connection.reset(),this.showSpinner(),["converse/login","converse/register"].includes(yn.router.history.getFragment())&&yn.router.navigate("",{replace:!0}),this.fields.password&&this.fields.username?(yn.connection.connect(this.fields.username.toLowerCase()+"@"+this.domain.toLowerCase(),this.fields.password,yn.onConnectStatusChanged),this.giveFeedback(ne("Now logging you in"),"info")):(yn.chatboxviews.get("controlbox").renderLoginPanel(),yn.giveFeedback(ne("Registered successfully"))),this.reset())},renderLegacyRegistrationForm(e){Object.keys(this.fields).forEach(t=>{"username"===t?e.insertAdjacentHTML("beforeend",_s()({domain:" @".concat(this.domain),name:t,type:"text",label:t,value:"",required:!0})):e.insertAdjacentHTML("beforeend",us()({label:t,name:t,placeholder:t,required:!0,type:"password"===t||"email"===t?t:"text",value:""}))}),this.urls.forEach(t=>e.insertAdjacentHTML("afterend",'<a target="blank" rel="noopener" href="'+t+'">'+t+"</a>"))},renderRegistrationForm(e){const t=this.el.querySelector("form");t.innerHTML=sm()({__:ne,domain:this.domain,title:this.title,instructions:this.instructions,registration_domain:xn.settings.get("registration_domain")});const n=t.querySelector("fieldset.buttons");"xform"===this.form_type?e.querySelectorAll("field").forEach(t=>{n.insertAdjacentHTML("beforebegin",ui.xForm2webForm(t,e,{domain:this.domain}))}):this.renderLegacyRegistrationForm(t),this.fields||t.querySelector(".button-primary").classList.add("hidden"),t.classList.remove("hidden"),this.model.set("registration_form_rendered",!0)},showValidationError(e){const t=this.el.querySelector("form");let n=t.querySelector(".form-errors");if(null===n){n='<div class="form-errors hidden"></div>';const e=t.querySelector("p.instructions");null===e?t.insertAdjacentHTML("afterbegin",n):e.insertAdjacentHTML("afterend",n),n=t.querySelector(".form-errors")}else n.innerHTML="";n.insertAdjacentHTML("beforeend",'<p class="form-help error">'+e+"</p>"),n.classList.remove("hidden")},reportErrors(e){const t=e.querySelectorAll("error");if(t.forEach(e=>this.showValidationError(e.textContent)),!t.length){const e=ne("The provider rejected your registration attempt. Please check the values you entered for correctness.");this.showValidationError(e)}},renderProviderChoiceForm(e){e&&e.preventDefault&&e.preventDefault(),yn.connection._proto._abortAllRequests(),yn.connection.reset(),this.render()},abortRegistration(){yn.connection._proto._abortAllRequests(),yn.connection.reset(),this.model.get("registration_form_rendered")?xn.settings.get("registration_domain")&&this.model.get("registration_form_rendered")&&this.fetchRegistrationForm(xn.settings.get("registration_domain")):this.render()},submitRegistrationForm(e){if(Array.from(this.el.querySelectorAll("input.required")).reduce((e,t)=>""===t.value?(t.classList.add("error"),e+1):e,0))return;const t=um(":input:not([type=button]):not([type=submit])",e),n=dm({type:"set",id:hm.getUniqueId()}).c("query",{xmlns:lm.NS.REGISTER});"xform"===this.form_type?(n.c("x",{xmlns:lm.NS.XFORM,type:"submit"}),t.forEach(e=>n.cnode(ui.webForm2xForm(e)).up())):t.forEach(e=>n.c(e.getAttribute("name"),{},e.value)),yn.connection._addSysHandler(this._onRegisterIQ.bind(this),null,"iq",null,null),yn.connection.send(n),this.setFields(n.tree())},setFields(e){const t=e.querySelector("query"),n=um('x[xmlns="'.concat(lm.NS.XFORM,'"]'),t);n.length>0?this._setFieldsFromXForm(n.pop()):this._setFieldsFromLegacy(t)},_setFieldsFromLegacy(e){[].forEach.call(e.children,e=>{"instructions"!==e.tagName.toLowerCase()?"x"!==e.tagName.toLowerCase()?this.fields[e.tagName.toLowerCase()]=lm.getText(e):"jabber:x:oob"===e.getAttribute("xmlns")&&this.urls.concat(um("url",e).map(e=>e.textContent)):this.instructions=lm.getText(e)}),this.form_type="legacy"},_setFieldsFromXForm(e){var t,n;this.title=null===(t=e.querySelector("title"))||void 0===t?void 0:t.textContent,this.instructions=null===(n=e.querySelector("instructions"))||void 0===n?void 0:n.textContent,e.querySelectorAll("field").forEach(e=>{const t=e.getAttribute("var");var n,i;t?this.fields[t.toLowerCase()]=null!==(n=null===(i=e.querySelector("value"))||void 0===i?void 0:i.textContent)&&void 0!==n?n:"":st.warn("Found field we couldn't parse")}),this.form_type="xform"},_onRegisterIQ(e){if("error"===e.getAttribute("type")){st.error("Registration failed."),this.reportErrors(e);let t=e.getElementsByTagName("error");if(1!==t.length)return yn.connection._changeConnectStatus(lm.Status.REGIFAIL,"unknown"),!1;t=t[0].firstElementChild.tagName.toLowerCase(),"conflict"===t?yn.connection._changeConnectStatus(lm.Status.CONFLICT,t):"not-acceptable"===t?yn.connection._changeConnectStatus(lm.Status.NOTACCEPTABLE,t):yn.connection._changeConnectStatus(lm.Status.REGIFAIL,t)}else yn.connection._changeConnectStatus(lm.Status.REGISTERED,null);return!1}}),xn.listen.on("controlBoxInitialized",e=>{e.model.on("change:active-form",e.showLoginOrRegisterForm,e)})}});const ym=ne("Click to toggle the list of open groupchats"),wm=ne("Bookmark this groupchat"),Sm=ne("Leave this groupchat"),xm=ne("Unbookmark this groupchat"),Em=ne("Show more information on this groupchat"),Am=ne("Click to open this groupchat"),jm=ne("Open Groupchats"),Cm=e=>ho(gm(),e.currently_open(e.room)?"open":"",e.room.get("num_unread_general")?"unread-msgs":"",e.room.get("jid"),e.room.get("num_unread")?(e=>ho(_m(),e.room.get("num_unread")))(e):"",e.room.get("jid"),Am,e.openRoom,e.room.getDisplayName(),e.allow_bookmarks?(e=>e.bookmarked?ho(vm(),e.room.get("jid"),e.room.getDisplayName(),e.removeBookmark,e.bookmarked?xm:wm):ho(mm(),e.room.get("jid"),e.room.getDisplayName(),e.addBookmark,e.bookmarked?xm:wm))(e):"",e.room.get("jid"),Em,e.showRoomDetailsModal,e.room.get("jid"),e.room.getDisplayName(),Sm,e.closeRoom);
/**
 * @module converse-roomslist
 * @description
 *  Converse.js plugin which shows a list of currently open
 *  rooms in the "Rooms Panel" of the ControlBox.
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:km}=zn.env,Om=zn.env.utils;function Tm(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h5 class="modal-title" id="addContactModalLabel">',"</h5>\n                ",'\n            </div>\n            <form class="converse-form add-xmpp-contact">\n                <div class="modal-body">\n                    <span class="modal-alert"></span>\n                    <div class="form-group add-xmpp-contact__jid">\n                        <label class="clearfix" for="jid">',':</label>\n                        <div class="suggestion-box suggestion-box__jid">\n                            <ul class="suggestion-box__results suggestion-box__results--above" hidden=""></ul>\n                            <input type="text" name="jid" ?required=','\n                                value="','"\n                                class="form-control suggestion-box__input"\n                                placeholder="','"/>\n                            <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span>\n                        </div>\n                    </div>\n                    <div class="form-group add-xmpp-contact__name">\n                        <label class="clearfix" for="name">',':</label>\n                        <div class="suggestion-box suggestion-box__name">\n                            <ul class="suggestion-box__results suggestion-box__results--above" hidden=""></ul>\n                            <input type="text" name="name" value="','"\n                                class="form-control suggestion-box__input"\n                                placeholder="','"/>\n                            <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span>\n                        </div>\n                    </div>\n                    <div class="form-group">\n                        <div class="invalid-feedback">','</div>\n                    </div>\n                    <button type="submit" class="btn btn-primary">',"</button>\n                </div>\n            </form>\n        </div>\n    </div>\n"]);return Tm=function(){return e},e}zn.plugins.add("converse-roomslist",{dependencies:["converse-singleton","converse-controlbox","converse-muc","converse-bookmarks"],initialize(){xn.promises.add("roomsListInitialized"),yn.RoomsList=Do.extend({defaults:{"toggle-state":yn.OPENED}}),yn.RoomsListView=Fo.extend({tagName:"span",initialize(){this.listenTo(this.model,"add",this.renderIfChatRoom),this.listenTo(this.model,"remove",this.renderIfChatRoom),this.listenTo(this.model,"destroy",this.renderIfChatRoom),this.listenTo(this.model,"change",this.renderIfRelevantChange);const e="converse.roomslist".concat(yn.bare_jid);this.list_model=new yn.RoomsList({id:e}),this.list_model.browserStorage=yn.createStore(e),this.list_model.fetch(),this.render(),this.insertIntoControlBox()},renderIfChatRoom(e){Om.isChatRoom(e)&&this.render()},renderIfRelevantChange(e){const t=["bookmarked","hidden","name","num_unread","num_unread_general"],n=e.changed||{};Om.isChatRoom(e)&&Object.keys(n).filter(e=>t.includes(e)).length&&this.render()},toHTML(){return e={_converse:yn,addBookmark:e=>this.addBookmark(e),allow_bookmarks:yn.allow_bookmarks&&yn.bookmarks,closeRoom:e=>this.closeRoom(e),collapsed:this.list_model.get("toggle-state")!==yn.OPENED,currently_open:e=>yn.isUniView()&&!e.get("hidden"),openRoom:e=>this.openRoom(e),removeBookmark:e=>this.removeBookmark(e),rooms:this.model.filter(e=>e.get("type")===yn.CHATROOMS_TYPE),showRoomDetailsModal:e=>this.showRoomDetailsModal(e),toggleRoomsList:e=>this.toggleRoomsList(e),toggle_state:this.list_model.get("toggle-state")},ho(pm(),e.rooms.length?"":"hidden",ym,e.toggleRoomsList,e.toggle_state===e._converse.OPENED?"fa-caret-down":"fa-caret-right",jm,e.collapsed&&"collapsed",e.rooms.map(t=>Cm(Object.assign({room:t},e))));var e},insertIntoControlBox(){const e=yn.chatboxviews.get("controlbox");if(void 0!==e&&!Om.rootContains(yn.root,this.el)){const t=e.el.querySelector(".list-container--openrooms");t&&t.parentNode.replaceChild(this.el,t)}},showRoomDetailsModal(e){const t=e.target.getAttribute("data-room-jid"),n=yn.chatboxes.get(t);e.preventDefault(),void 0===n.room_details_modal&&(n.room_details_modal=new zd({model:n})),n.room_details_modal.show(e)},async openRoom(e){e.preventDefault();const t=e.target.textContent,n=e.target.getAttribute("data-room-jid"),i={name:t||km.unescapeNode(km.getNodeFromJid(n))||n};await xn.rooms.open(n,i,!0),xn.chatviews.get(n).maybeFocus()},closeRoom(e){e.preventDefault();const t=e.target.getAttribute("data-room-name"),n=e.target.getAttribute("data-room-jid");confirm(ne("Are you sure you want to leave the groupchat %1$s?",t))&&yn.chatboxviews.get(n).close()},removeBookmark:yn.removeBookmarkViaEvent,addBookmark:yn.addBookmarkViaEvent,toggleRoomsList(e){e&&e.preventDefault&&e.preventDefault();const t=e.target.matches(".fa")?e.target:e.target.querySelector(".fa");t.classList.contains("fa-caret-down")?Om.slideIn(this.el.querySelector(".open-rooms-list")).then(()=>{this.list_model.save({"toggle-state":yn.CLOSED}),t.classList.remove("fa-caret-down"),t.classList.add("fa-caret-right")}):Om.slideOut(this.el.querySelector(".open-rooms-list")).then(()=>{this.list_model.save({"toggle-state":yn.OPENED}),t.classList.remove("fa-caret-right"),t.classList.add("fa-caret-down")})}});const e=function(){yn.rooms_list_view=new yn.RoomsListView({model:yn.chatboxes}),xn.trigger("roomsListInitialized")};xn.listen.on("connected",async()=>{yn.allow_bookmarks?await xn.waitUntil("bookmarksInitialized"):await Promise.all([xn.waitUntil("chatBoxesFetched"),xn.waitUntil("roomsPanelRendered")]),e()}),xn.listen.on("reconnected",e)}});const Nm=ne("name@example.org"),Mm=ne("Add"),Im=ne("Please enter a valid XMPP address"),Rm=ne("Add a Contact"),Dm=ne("Username"),Pm=ne("Nickname");var Lm=n(148),zm=n.n(Lm),Fm=n(149),Bm=n.n(Fm),qm=n(150),Um=n.n(qm),Hm=n(151),$m=n.n(Hm);function Wm(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n    <form class="controlbox-padded roster-filter-form input-button-group ','"\n          @submit=','>\n        <div class="form-inline flex-nowrap">\n            <div class="filter-by d-flex flex-nowrap">\n                <span @click=',' class="fa fa-user ','" data-type="contacts" title="','"></span>\n                <span @click=',' class="fa fa-users ','" data-type="groups" title="','"></span>\n                <span @click=',' class="fa fa-circle ','" data-type="state" title="','"></span>\n            </div>\n            <div class="btn-group">\n                <input .value="','"\n                       @keydown=','\n                       class="roster-filter form-control ','"\n                       placeholder="','"/>\n                <span class="clear-input fa fa-times ','"\n                      @click=','>\n                </span>\n            </div>\n            <select class="form-control state-type ','"\n                    @change=','>\n                <option value="">',"</option>\n                <option ?selected=",' value="unread_messages">',"</option>\n                <option ?selected=",' value="online">',"</option>\n                <option ?selected=",' value="chat">',"</option>\n                <option ?selected=",' value="dnd">',"</option>\n                <option ?selected=",' value="away">',"</option>\n                <option ?selected=",' value="xa">',"</option>\n                <option ?selected=",' value="offline">',"</option>\n            </select>\n        </div>\n    </form>\n"]);return Wm=function(){return e},e}var Vm=n(152),Gm=n.n(Vm);
/**
 * @module converse-rosterview
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const{Strophe:Jm}=zn.env,Qm=zn.env.utils;zn.plugins.add("converse-rosterview",{dependencies:["converse-roster","converse-modal","converse-chatboxviews"],initialize(){xn.settings.update({autocomplete_add_contact:!0,allow_chat_pending_contacts:!0,allow_contact_removal:!0,hide_offline_users:!1,roster_groups:!0,xhr_user_search_url:null}),xn.promises.add("rosterViewInitialized");const e={dnd:ne("This contact is busy"),online:ne("This contact is online"),offline:ne("This contact is offline"),unavailable:ne("This contact is unavailable"),xa:ne("This contact is away for an extended period"),away:ne("This contact is away")};function t(){xn.settings.get("authentication")!==yn.ANONYMOUS&&(yn.rosterview=new yn.RosterView({model:yn.rostergroups}),yn.rosterview.render(),xn.trigger("rosterViewInitialized"))}yn.AddContactModal=ya.extend({id:"add-contact-modal",events:{"submit form":"addContactFromForm"},initialize(){ya.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.render)},toHTML(){const e=xn.settings.get("xhr_user_search_url")?ne("Contact name"):ne("Optional nickname");return t=Object.assign(this.model.toJSON(),{_converse:yn,label_nickname:e}),ho(Tm(),Rm,Qs,Dm,!t._converse.xhr_user_search_url,t.jid||"",Nm,Pm,t.nickname||"",Pm,Im,Mm);var t},afterRender(){xn.settings.get("xhr_user_search_url")&&Object(lr.isString)(xn.settings.get("xhr_user_search_url"))?this.initXHRAutoComplete():this.initJIDAutoComplete();const e=this.el.querySelector('input[name="jid"]');this.el.addEventListener("shown.bs.modal",()=>e.focus(),!1)},initJIDAutoComplete(){if(!xn.settings.get("autocomplete_add_contact"))return;const e=this.el.querySelector(".suggestion-box__jid").parentElement;this.jid_auto_complete=new yn.AutoComplete(e,{data:(e,t)=>"".concat(t.slice(0,t.indexOf("@")),"@").concat(e),filter:yn.FILTER_STARTSWITH,list:Object(lr.uniq)(yn.roster.map(e=>Jm.getDomainFromJid(e.get("jid"))))})},initXHRAutoComplete(){if(!xn.settings.get("autocomplete_add_contact"))return this.initXHRFetch();const e=this.el.querySelector(".suggestion-box__name").parentElement;this.name_auto_complete=new yn.AutoComplete(e,{auto_evaluate:!1,filter:yn.FILTER_STARTSWITH,list:[]});const t=new window.XMLHttpRequest;t.onload=()=>{if(t.responseText){const e=t.responseText;this.name_auto_complete.list=JSON.parse(e).map(e=>({label:e.fullname||e.jid,value:e.jid})),this.name_auto_complete.auto_completing=!0,this.name_auto_complete.evaluate()}};const n=this.el.querySelector('input[name="name"]');n.addEventListener("input",Object(lr.debounce)(()=>{t.open("GET","".concat(xn.settings.get("xhr_user_search_url"),"q=").concat(encodeURIComponent(n.value)),!0),t.send()},300)),this.name_auto_complete.on("suggestion-box-selectcomplete",e=>{this.el.querySelector('input[name="name"]').value=e.text.label,this.el.querySelector('input[name="jid"]').value=e.text.value})},initXHRFetch(){this.xhr=new window.XMLHttpRequest,this.xhr.onload=()=>{if(this.xhr.responseText){const e=this.xhr.responseText,t=JSON.parse(e).map(e=>({label:e.fullname||e.jid,value:e.jid}));if(1!==t.length){const e=this.el.querySelector(".invalid-feedback");return e.textContent=ne("Sorry, could not find a contact with that name"),void Qm.addClass("d-block",e)}const n=t[0].value;if(this.validateSubmission(n)){const e=this.el.querySelector("form"),i=t[0].label;this.afterSubmission(e,n,i)}}}},validateSubmission(e){const t=this.el.querySelector(".invalid-feedback");return!(e=e+"@"+yn.api.settings.get("locked_domain"))||Object(lr.compact)(e.split("@")).length<2?(Qm.addClass("is-invalid",this.el.querySelector('input[name="jid"]')),Qm.addClass("d-block",t),!1):yn.roster.get(Jm.getBareJidFromJid(e))?(t.textContent=ne("This contact has already been added"),Qm.addClass("d-block",t),!1):(Qm.removeClass("d-block",t),!0)},afterSubmission(e,t,n){yn.roster.addAndSubscribe(t,n),this.model.clear(),this.modal.hide()},addContactFromForm(e){e.preventDefault();const t=new FormData(e.target),n=(t.get("jid")||"").trim();if(!n&&xn.settings.get("xhr_user_search_url")&&Object(lr.isString)(xn.settings.get("xhr_user_search_url"))){const e=this.el.querySelector('input[name="name"]');return this.xhr.open("GET","".concat(xn.settings.get("xhr_user_search_url"),"q=").concat(encodeURIComponent(e.value)),!0),void this.xhr.send()}this.validateSubmission(n)&&this.afterSubmission(e.target,n,t.get("name"))}}),yn.RosterFilter=Do.extend({initialize(){this.set({filter_text:"",filter_type:"contacts",chat_state:"online"})}}),yn.RosterFilterView=Fo.extend({tagName:"span",initialize(){this.listenTo(this.model,"change:filter_type",this.render),this.listenTo(this.model,"change:filter_text",this.render)},toHTML(){return e=Object.assign(this.model.toJSON(),{visible:this.shouldBeVisible(),placeholder:ne("Filter"),title_contact_filter:ne("Filter by contact name"),title_group_filter:ne("Filter by group name"),title_status_filter:ne("Filter by status"),label_any:ne("Any"),label_unread_messages:ne("Unread"),label_online:ne("Online"),label_chatty:ne("Chatty"),label_busy:ne("Busy"),label_away:ne("Away"),label_xa:ne("Extended Away"),label_offline:ne("Offline"),changeChatStateFilter:e=>this.changeChatStateFilter(e),changeTypeFilter:e=>this.changeTypeFilter(e),clearFilter:e=>this.clearFilter(e),liveFilter:e=>this.liveFilter(e),submitFilter:e=>this.submitFilter(e)}),ho(Wm(),e.visible?"fade-in":"hidden",e.submitFilter,e.changeTypeFilter,"contacts"===e.filter_type?"selected":"",e.title_contact_filter,e.changeTypeFilter,"groups"===e.filter_type?"selected":"",e.title_group_filter,e.changeTypeFilter,"state"===e.filter_type?"selected":"",e.title_status_filter,e.filter_text||"",e.liveFilter,"state"===e.filter_type?"hidden":"",e.placeholder,e.filter_text&&"state"!==e.filter_type?"":"hidden",e.clearFilter,"state"!==e.filter_type?"hidden":"",e.changeChatStateFilter,e.label_any,"unread_messages"===e.chat_state,e.label_unread_messages,"online"===e.chat_state,e.label_online,"chat"===e.chat_state,e.label_chatty,"dnd"===e.chat_state,e.label_busy,"away"===e.chat_state,e.label_away,"xa"===e.chat_state,e.label_xa,"offline"===e.chat_state,e.label_offline);var e},changeChatStateFilter(e){e&&e.preventDefault(),this.model.save({chat_state:this.el.querySelector(".state-type").value})},changeTypeFilter(e){e&&e.preventDefault();const t=e.target.dataset.type;"state"===t?this.model.save({filter_type:t,chat_state:this.el.querySelector(".state-type").value}):this.model.save({filter_type:t,filter_text:this.el.querySelector(".roster-filter").value})},liveFilter:Object(lr.debounce)((function(){this.model.save({filter_text:this.el.querySelector(".roster-filter").value})}),250),submitFilter(e){e&&e.preventDefault(),this.liveFilter()},isActive(){return"state"===this.model.get("filter_type")||this.model.get("filter_text")},shouldBeVisible(){return yn.roster&&yn.roster.length>=5||this.isActive()},clearFilter(e){e&&e.preventDefault(),this.model.save({filter_text:""})}}),yn.RosterContactView=yn.ViewWithAvatar.extend({tagName:"li",className:"list-item d-flex hidden controlbox-padded",events:{"click .accept-xmpp-request":"acceptRequest","click .decline-xmpp-request":"declineRequest","click .open-chat":"openChat","click .remove-xmpp-contact":"removeContact"},async initialize(){await this.model.initialized,this.debouncedRender=Object(lr.debounce)(this.render,50),this.listenTo(this.model,"change",this.debouncedRender),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"highlight",this.highlight),this.listenTo(this.model,"remove",this.remove),this.listenTo(this.model,"vcard:change",this.debouncedRender),this.listenTo(this.model.presence,"change:show",this.debouncedRender),this.render()},render(){if(!this.mayBeShown())return Qm.hideElement(this.el),this;const t=this.model.get("ask"),n=this.model.presence.get("show"),i=this.model.get("requesting"),r=this.model.get("subscription"),o=this.model.get("jid");if(["current-xmpp-contact","pending-xmpp-contact","requesting-xmpp-contact"].concat(Object.keys(e)).forEach(e=>Qm.removeClass(e,this.el)),this.el.classList.add(n),this.el.setAttribute("data-status",n),this.highlight(),yn.isUniView()){const e=yn.chatboxes.get(this.model.get("jid"));e&&(e.get("hidden")?this.el.classList.remove("open"):this.el.classList.add("open"))}if("subscribe"===t||"from"===r){const e=this.model.getDisplayName();this.el.classList.add("pending-xmpp-contact"),this.el.innerHTML=Bm()(Object.assign(this.model.toJSON(),{display_name:e,desc_remove:ne("Click to remove %1$s as a contact",e),allow_chat_pending_contacts:xn.settings.get("allow_chat_pending_contacts")}))}else if(!0===i){const e=this.model.getDisplayName();this.el.classList.add("requesting-xmpp-contact"),this.el.innerHTML=Um()(Object.assign(this.model.toJSON(),{display_name:e,desc_accept:ne("Click to accept the contact request from %1$s",e),desc_decline:ne("Click to decline the contact request from %1$s",e),allow_chat_pending_contacts:xn.settings.get("allow_chat_pending_contacts")}))}else("both"===r||"to"===r||yn.rosterview.isSelf(o))&&(this.el.classList.add("current-xmpp-contact"),this.el.classList.remove(Object(lr.without)(["both","to"],r)[0]),this.el.classList.add(r),this.renderRosterItem(this.model));return this},highlight(){if(yn.isUniView()){const e=yn.chatboxes.get(this.model.get("jid"));e&&e.get("hidden")||!e?this.el.classList.remove("open"):this.el.classList.add("open")}},renderRosterItem(t){const n=t.presence.get("show")||"offline";let i;i="online"===n?"fa fa-circle chat-status chat-status--online":"away"===n?"fa fa-circle chat-status chat-status--away":"xa"===n?"far fa-circle chat-status chat-status-xa":"dnd"===n?"fa fa-minus-circle chat-status chat-status--busy":"fa fa-times-circle chat-status chat-status--offline";const r=t.getDisplayName();return this.el.innerHTML=Gm()(Object.assign(t.toJSON(),{show:n,display_name:r,status_icon:i,desc_status:e[n],desc_chat:ne("Click to chat with %1$s (XMPP address: %2$s)",r,t.get("jid")),desc_remove:ne("Click to remove %1$s as a contact",r),allow_contact_removal:xn.settings.get("allow_contact_removal"),num_unread:t.get("num_unread")||0,classes:""})),this.renderAvatar(),this},mayBeShown(){const e=this.model.presence.get("show");return!xn.settings.get("hide_offline_users")||"offline"!==e||("subscribe"===this.model.get("ask")||"from"===this.model.get("subscription")||!0===this.model.get("requesting"))},openChat(e){e&&e.preventDefault&&e.preventDefault(),this.model.openChat()},async removeContact(e){if(e&&e.preventDefault&&e.preventDefault(),xn.settings.get("allow_contact_removal")&&confirm(ne("Are you sure you want to remove this contact?")))try{await this.model.removeFromRoster(),this.remove(),this.model.collection&&this.model.destroy()}catch(e){st.error(e),xn.alert("error",ne("Error"),[ne("Sorry, there was an error while trying to remove %1$s as a contact.",this.model.getDisplayName())])}},async acceptRequest(e){e&&e.preventDefault&&e.preventDefault(),await yn.roster.sendContactAddIQ(this.model.get("jid"),this.model.getFullname(),[]),this.model.authorize().subscribe()},declineRequest(e){return e&&e.preventDefault&&e.preventDefault(),!0===confirm(ne("Are you sure you want to decline this contact request?"))&&this.model.unauthorize().destroy(),this}}),yn.RosterGroupView=Xo.extend({tagName:"div",className:"roster-group hidden",events:{"click a.group-toggle":"toggle"},sortImmediatelyOnAdd:!0,ItemView:yn.RosterContactView,listItems:"model.contacts",listSelector:".roster-group-contacts",sortEvent:"presenceChanged",initialize(){Xo.prototype.initialize.apply(this,arguments),this.model.get("name")===yn.HEADER_UNREAD&&this.listenTo(this.model.contacts,"change:num_unread",e=>!this.model.get("unread_messages")&&this.removeContact(e)),this.model.get("name")===yn.HEADER_REQUESTING_CONTACTS&&this.listenTo(this.model.contacts,"change:requesting",e=>!e.get("requesting")&&this.removeContact(e)),this.model.get("name")===yn.HEADER_PENDING_CONTACTS&&this.listenTo(this.model.contacts,"change:subscription",e=>"from"!==e.get("subscription")&&this.removeContact(e)),this.listenTo(this.model.contacts,"remove",this.onRemove),this.listenTo(yn.roster,"change:groups",this.onContactGroupChange),yn.rosterview.on("rosterContactsFetchedAndProcessed",()=>this.sortAndPositionAllItems())},render(){return this.el.setAttribute("data-group",this.model.get("name")),this.el.innerHTML=zm()({label_group:this.model.get("name"),desc_group_toggle:this.model.get("description"),toggle_state:this.model.get("state"),_converse:yn}),this.contacts_el=this.el.querySelector(".roster-group-contacts"),this},show(){return Qm.showElement(this.el),this.model.get("state")===yn.OPENED&&Object.values(this.getAll()).filter(e=>e.mayBeShown()).forEach(e=>Qm.showElement(e.el)),this},collapse(){return Qm.slideIn(this.contacts_el)},filterOutContacts(e=[]){let t=0;this.model.contacts.forEach(n=>{const i=this.get(n.get("id"));e.includes(n)?Qm.hideElement(i.el):i.mayBeShown()&&(Qm.showElement(i.el),t+=1)}),t?Qm.showElement(this.el):Qm.hideElement(this.el)},getFilterMatches(e,t){if(0===e.length)return[];e=e.toLowerCase();const n=this.model.contacts;if("state"===t){return[yn.HEADER_REQUESTING_CONTACTS,yn.HEADER_UNREAD].includes(this.model.get("name"))?[]:"unread_messages"===e?n.filter({num_unread:0}):"online"===e?n.filter(e=>["offline","unavailable"].includes(e.presence.get("show"))):n.filter(t=>!t.presence.get("show").includes(e))}return n.filter(t=>!t.getFilterCriteria().includes(e))},filter(e,t){null==e&&(e="state"===(t=t||yn.rosterview.filter_view.model.get("filter_type"))?yn.rosterview.filter_view.model.get("chat_state"):yn.rosterview.filter_view.model.get("filter_text")),this.filterOutContacts(this.getFilterMatches(e,t))},async toggle(e){e&&e.preventDefault&&e.preventDefault();const t=e.target.matches(".fa")?e.target:e.target.querySelector(".fa");Qm.hasClass("fa-caret-down",t)?(this.model.save({state:yn.CLOSED}),await this.collapse(),t.classList.remove("fa-caret-down"),t.classList.add("fa-caret-right")):(t.classList.remove("fa-caret-right"),t.classList.add("fa-caret-down"),this.model.save({state:yn.OPENED}),this.filter(),Qm.showElement(this.el),Qm.slideOut(this.contacts_el))},onContactGroupChange(e){const t=e.get("groups").includes(this.model.get("name")),n=e.get("id"),i=!this.get(n);t&&!i?this.items.trigger("add",e):t||this.removeContact(e)},removeContact(e){this.model.contacts.remove(e,{silent:!0}),this.onRemove(e)},onRemove(e){this.remove(e.get("jid")),0===this.model.contacts.length&&this.remove()}}),yn.RosterView=Xo.extend({tagName:"div",id:"converse-roster",className:"controlbox-section",ItemView:yn.RosterGroupView,listItems:"model",listSelector:".roster-contacts",sortEvent:null,subviewIndex:"name",sortImmediatelyOnAdd:!0,events:{"click a.controlbox-heading__btn.add-contact":"showAddContactModal","click a.controlbox-heading__btn.sync-contacts":"syncContacts"},initialize(){Xo.prototype.initialize.apply(this,arguments),this.listenTo(yn.roster,"add",this.onContactAdded),this.listenTo(yn.roster,"change:groups",this.onContactAdded),this.listenTo(yn.roster,"change",this.onContactChange),this.listenTo(yn.roster,"destroy",this.update),this.listenTo(yn.roster,"remove",this.update),yn.presences.on("change:show",()=>{this.update(),this.updateFilter()}),this.listenTo(this.model,"reset",this.reset),xn.listen.on("rosterGroupsFetched",this.sortAndPositionAllItems.bind(this)),xn.listen.on("rosterContactsFetched",()=>{yn.roster.each(e=>this.addRosterContact(e,{silent:!0})),this.update(),this.updateFilter(),this.trigger("rosterContactsFetchedAndProcessed")}),this.createRosterFilter()},render(){this.el.innerHTML=$m()({allow_contact_requests:yn.allow_contact_requests,heading_contacts:ne("Contacts"),title_add_contact:ne("Add a contact"),title_sync_contacts:ne("Re-sync your contacts")});const e=this.el.querySelector(".roster-filter-form");return this.el.replaceChild(this.filter_view.render().el,e),this.roster_el=this.el.querySelector(".roster-contacts"),this},showAddContactModal(e){void 0===this.add_contact_modal&&(this.add_contact_modal=new yn.AddContactModal({model:new Do})),this.add_contact_modal.show(e)},createRosterFilter(){const e=new yn.RosterFilter;e.id="_converse.rosterfilter-".concat(yn.bare_jid),e.browserStorage=yn.createStore(e.id),this.filter_view=new yn.RosterFilterView({model:e}),this.listenTo(this.filter_view.model,"change",this.updateFilter),this.filter_view.model.fetch()},updateFilter:Object(lr.debounce)((function(){const e=this.filter_view.model.get("filter_type");"state"===e?this.filter(this.filter_view.model.get("chat_state"),e):this.filter(this.filter_view.model.get("filter_text"),e)}),100),update(){return Qm.isVisible(this.roster_el)||Qm.showElement(this.roster_el),this.filter_view.render(),this},filter(e,t){const n=Object.values(this.getAll());n.forEach(e=>e.model.contacts.length>0&&e.show().filter("")),e=e.toLowerCase(),"groups"===t?n.forEach(t=>{t.model.get("name").toLowerCase().includes(e)?t.model.contacts.length>0&&Qm.slideOut(t.el):Qm.slideIn(t.el)}):n.forEach(n=>n.filter(e,t))},async syncContacts(e){e.preventDefault(),Qm.addClass("fa-spin",e.target),yn.roster.data.save("version",null),await yn.roster.fetchFromServer(),xn.user.presence.send(),Qm.removeClass("fa-spin",e.target)},reset(){return this.removeAll(),this.render().update(),this},onContactAdded(e){this.addRosterContact(e),this.update(),this.updateFilter()},onContactChange(e){this.update(),Object(lr.has)(e.changed,"subscription")&&("from"===e.changed.subscription?this.addContactToGroup(e,yn.HEADER_PENDING_CONTACTS):["both","to"].includes(e.get("subscription"))&&this.addExistingContact(e)),Object(lr.has)(e.changed,"num_unread")&&e.get("num_unread")&&this.addContactToGroup(e,yn.HEADER_UNREAD),Object(lr.has)(e.changed,"ask")&&"subscribe"===e.changed.ask&&this.addContactToGroup(e,yn.HEADER_PENDING_CONTACTS),Object(lr.has)(e.changed,"subscription")&&"true"===e.changed.requesting&&this.addContactToGroup(e,yn.HEADER_REQUESTING_CONTACTS),this.updateFilter()},getGroup(e){const t=this.get(e);return t?t.model:this.model.create({name:e})},addContactToGroup(e,t,n){this.getGroup(t).contacts.add(e,n),this.sortAndPositionAllItems()},addExistingContact(e,t){let n;xn.settings.get("roster_groups")?(n=e.get("groups"),n=0===n.length?[yn.HEADER_UNGROUPED]:n):n=[yn.HEADER_CURRENT_CONTACTS],e.get("num_unread")&&n.push(yn.HEADER_UNREAD),n.forEach(n=>this.addContactToGroup(e,n,t))},isSelf:e=>Qm.isSameBareJID(e,yn.connection.jid),addRosterContact(e,t){const n=e.get("jid");if("both"===e.get("subscription")||"to"===e.get("subscription")||this.isSelf(n))this.addExistingContact(e,t);else{if(!yn.allow_contact_requests)return void st.debug("Not adding requesting or pending contact ".concat(n," ")+"because allow_contact_requests is false");"subscribe"===e.get("ask")||"from"===e.get("subscription")?this.addContactToGroup(e,yn.HEADER_PENDING_CONTACTS,t):!0===e.get("requesting")&&this.addContactToGroup(e,yn.HEADER_REQUESTING_CONTACTS,t)}return this}}),xn.listen.on("chatBoxesInitialized",()=>{function e(e){const t=yn.roster&&yn.roster.findWhere({jid:e.get("jid")});void 0!==t&&t.trigger("highlight")}yn.chatboxes.on("destroy",t=>e(t)),yn.chatboxes.on("change:hidden",t=>e(t))}),xn.listen.on("controlBoxInitialized",e=>{function t(){e.model.get("connected")&&xn.settings.get("authentication")!==yn.ANONYMOUS&&xn.waitUntil("rosterViewInitialized").then(()=>e.controlbox_pane.el.insertAdjacentElement("beforeEnd",yn.rosterview.el)).catch(e=>st.fatal(e))}t(),e.model.on("change:connected",t)}),xn.listen.on("rosterInitialized",t),xn.listen.on("rosterReadyAfterReconnection",t),xn.listen.on("afterTearDown",()=>{zn.rosterview&&(zn.rosterview.model.off().reset(),zn.rosterview.each(e=>e.removeAll().remove()),zn.rosterview.removeAll().remove(),delete zn.rosterview)})}});
/**
 * @module converse-uniview
 * @description
 * A plugin which ensures that only one chat (private or groupchat) is
 * visible at any one time. All other ongoing chats are hidden and kept in the
 * background.
 *
 * This plugin makes sense in mobile, embedded or fullscreen chat environments
 * (as configured by the `view_mode` setting).
 * @copyright 2020, the Converse.js contributors
 * @license Mozilla Public License (MPLv2)
 */
const Km=zn.env.utils;function Ym(e){"controlbox"!==e.model.get("id")&&(Km.safeSave(e.model,{hidden:!0}),e.hide())}zn.plugins.add("converse-uniview",{dependencies:["converse-chatboxes","converse-muc-views","converse-controlbox","converse-rosterview"],overrides:{ChatBoxes:{createChatBox(e,t){const{_converse:n}=this.__super__;return n.isUniView()&&((t=t||{}).hidden=!0),this.__super__.createChatBox.call(this,e,t)}},ChatBox:{maybeShow(e){e&&Km.safeSave(this,{hidden:!1});const{_converse:t}=this.__super__;return t.isUniView()&&this.get("hidden")?void 0:this.__super__.maybeShow.apply(this,arguments)}},ChatBoxView:{shouldShowOnTextMessage(){const{_converse:e}=this.__super__;return!e.isUniView()&&this.__super__.shouldShowOnTextMessage.apply(this,arguments)}}},initialize(){const{_converse:e}=this;e.api.listen.on("beforeShowingChatView",t=>{if(e.isUniView()&&(Object.values(e.chatboxviews.xget(t.model.get("id"))).filter(e=>!e.model.get("hidden")).forEach(Ym),t.model.get("hidden")))return new Promise(e=>{Km.safeSave(t.model,{hidden:!1},{success:e,failure:e})})})}});n(415);
/**
 * @description Converse.js (A browser based XMPP chat client)
 * @copyright 2020, The Converse developers
 * @license Mozilla Public License (MPLv2)
 */const Xm=["converse-autocomplete","converse-bookmark-views","converse-chatboxviews","converse-chatview","converse-controlbox","converse-dragresize","converse-emoji-views","converse-fullscreen","converse-mam-views","converse-message-view","converse-minimize","converse-modal","converse-muc-views","converse-headlines-view","converse-notification","converse-omemo","converse-profile","converse-push","converse-register","converse-roomslist","converse-rosterview","converse-singleton","converse-uniview"],Zm=zn.initialize;zn.initialize=function(e,t){return Array.isArray(e.whitelisted_plugins)?e.whitelisted_plugins=e.whitelisted_plugins.concat(Xm):e.whitelisted_plugins=Xm,Zm(e,t)},zn.confirm=(e,t)=>{if(void 0!==window.dialog){return 0==window.dialog.showMessageBoxSync({buttons:[ne("yes"),ne("cancel")],title:t||ne("Confirm"),message:e})}};t.default=zn}]);
//# sourceMappingURL=converse.min.js.map